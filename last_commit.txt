Repository: plone.app.layout


Branch: refs/heads/2.5.x
Date: 2018-10-13T08:47:57-03:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/e08fae8f33c1fb2853db54056840c943ce0a3d57

Allow addition of extra body classes via multiple ``IBodyClassAdapter`` adapter registrations without the need to overload the ILayoutPolicy view.

Files changed:
M CHANGES.rst
M plone/app/layout/globals/interfaces.py
M plone/app/layout/globals/layout.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex c8ec450..13ba161 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -10,7 +10,8 @@ Breaking changes:\n \n New features:\n \n-- *add item here*\n+- Allow addition of extra body classes via multiple IBodyClassAdapter adapter registrations without the need to overload the ILayoutPolicy view.\n+  [thet, jensens, agitator]\n \n Bug fixes:\n \ndiff --git a/plone/app/layout/globals/interfaces.py b/plone/app/layout/globals/interfaces.py\nindex ed8f4c4..212264c 100644\n--- a/plone/app/layout/globals/interfaces.py\n+++ b/plone/app/layout/globals/interfaces.py\n@@ -275,6 +275,11 @@ class IViewView(Interface):\n     """\n \n \n+class IBodyClassAdapter(Interface):\n+    """Adapter interface for retrieving extra body classes.\n+    """\n+\n+\n class IPatternsSettingsRenderer(Interface):\n     """ Interface for the adapter that renders the settings for patterns\n     """\ndiff --git a/plone/app/layout/globals/layout.py b/plone/app/layout/globals/layout.py\nindex 9847879..8b821c1 100644\n--- a/plone/app/layout/globals/layout.py\n+++ b/plone/app/layout/globals/layout.py\n@@ -5,6 +5,7 @@\n from Products.CMFPlone.interfaces.controlpanel import ISiteSchema\n from Products.Five.browser.metaconfigure import ViewMixinForTemplates\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n+from plone.app.layout.globals.interfaces import IBodyClassAdapter\n from plone.app.layout.globals.interfaces import ILayoutPolicy\n from plone.app.layout.globals.interfaces import IViewView\n from plone.app.layout.icons.interfaces import IContentIcon\n@@ -16,12 +17,15 @@\n from zope.browserpage.viewpagetemplatefile import (\n     ViewPageTemplateFile as ZopeViewPageTemplateFile\n )\n+from zope.component import adapter\n+from zope.component import getAdapters\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n from zope.component import queryMultiAdapter\n from zope.component import queryUtility\n from zope.interface import alsoProvides\n from zope.interface import implements\n+from zope.interface import Interface\n from zope.publisher.browser import BrowserView\n \n \n@@ -268,4 +272,30 @@ def bodyClass(self, template, view):\n         if msl or elonw:\n             body_classes.append(\'pat-markspeciallinks\')\n \n+        # Add externally defined extra body classes\n+        body_class_adapters = getAdapters(\n+            (self.context, self.request),\n+            IBodyClassAdapter\n+        )\n+        for name, body_class_adapter in body_class_adapters:\n+            extra_classes = body_class_adapter.get_classes() or []\n+            if isinstance(extra_classes, basestring):\n+                extra_classes = extra_classes.split(\' \')\n+            body_classes.extend(extra_classes)\n+\n         return \' \'.join(body_classes)\n+\n+\n+@adapter(Interface)\n+class DefaultBodyClasses(object):\n+\n+    implements(IBodyClassAdapter)\n+\n+    def __init__(self, context, request):\n+        self.context = context\n+        self.request = request\n+\n+    def get_classes(self):\n+        """Default body classes adapter.\n+        """\n+        return []\n'

Repository: plone.app.layout


Branch: refs/heads/2.5.x
Date: 2018-10-13T08:51:52-03:00
Author: Rodrigo Ferreira de Souza (rodfersou) <rodfersou@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/6d25294aff52f2be261756beef6ebb9837033aab

Add template and view arguments support to IBodyClassAdapters

Files changed:
M CHANGES.rst
M plone/app/layout/globals/layout.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 13ba161..0c1821a 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -15,7 +15,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Add template and view arguments support to IBodyClassAdapters (fixes `#158 <https://github.com/plone/plone.app.layout/issues/158>`_).\n+  [rodfersou]\n \n \n 2.5.23 (2017-01-17)\ndiff --git a/plone/app/layout/globals/layout.py b/plone/app/layout/globals/layout.py\nindex 8b821c1..aef7aa3 100644\n--- a/plone/app/layout/globals/layout.py\n+++ b/plone/app/layout/globals/layout.py\n@@ -278,7 +278,10 @@ def bodyClass(self, template, view):\n             IBodyClassAdapter\n         )\n         for name, body_class_adapter in body_class_adapters:\n-            extra_classes = body_class_adapter.get_classes() or []\n+            try:\n+                extra_classes = body_class_adapter.get_classes(template, view) or []\n+            except TypeError:  # This adapter is implemented without arguments\n+                extra_classes = body_class_adapter.get_classes() or []\n             if isinstance(extra_classes, basestring):\n                 extra_classes = extra_classes.split(' ')\n             body_classes.extend(extra_classes)\n"

Repository: plone.app.layout


Branch: refs/heads/2.5.x
Date: 2018-10-13T08:56:20-03:00
Author: Rodrigo Ferreira de Souza (rodfersou) <rodfersou@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/fbff1e6a7fa1490dea246688f59a269004451d4b

Code review

Files changed:
M plone/app/layout/globals/layout.py

b'diff --git a/plone/app/layout/globals/layout.py b/plone/app/layout/globals/layout.py\nindex aef7aa3..2483649 100644\n--- a/plone/app/layout/globals/layout.py\n+++ b/plone/app/layout/globals/layout.py\n@@ -298,7 +298,7 @@ def __init__(self, context, request):\n         self.context = context\n         self.request = request\n \n-    def get_classes(self):\n+    def get_classes(self, template, view):\n         """Default body classes adapter.\n         """\n         return []\n'

Repository: plone.app.layout


Branch: refs/heads/2.5.x
Date: 2018-10-18T22:57:08+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.layout/commit/022a709f38ca0d6a885c2ab5dc8fef98e0b05df2

Merge pull request #168 from plone/rodfersou/158-250

5.0.x - Add template and view arguments support to IBodyClassAdapters

Files changed:
M CHANGES.rst
M plone/app/layout/globals/interfaces.py
M plone/app/layout/globals/layout.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex c8ec450..0c1821a 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -10,11 +10,13 @@ Breaking changes:\n \n New features:\n \n-- *add item here*\n+- Allow addition of extra body classes via multiple IBodyClassAdapter adapter registrations without the need to overload the ILayoutPolicy view.\n+  [thet, jensens, agitator]\n \n Bug fixes:\n \n-- *add item here*\n+- Add template and view arguments support to IBodyClassAdapters (fixes `#158 <https://github.com/plone/plone.app.layout/issues/158>`_).\n+  [rodfersou]\n \n \n 2.5.23 (2017-01-17)\ndiff --git a/plone/app/layout/globals/interfaces.py b/plone/app/layout/globals/interfaces.py\nindex ed8f4c4..212264c 100644\n--- a/plone/app/layout/globals/interfaces.py\n+++ b/plone/app/layout/globals/interfaces.py\n@@ -275,6 +275,11 @@ class IViewView(Interface):\n     """\n \n \n+class IBodyClassAdapter(Interface):\n+    """Adapter interface for retrieving extra body classes.\n+    """\n+\n+\n class IPatternsSettingsRenderer(Interface):\n     """ Interface for the adapter that renders the settings for patterns\n     """\ndiff --git a/plone/app/layout/globals/layout.py b/plone/app/layout/globals/layout.py\nindex 9847879..2483649 100644\n--- a/plone/app/layout/globals/layout.py\n+++ b/plone/app/layout/globals/layout.py\n@@ -5,6 +5,7 @@\n from Products.CMFPlone.interfaces.controlpanel import ISiteSchema\n from Products.Five.browser.metaconfigure import ViewMixinForTemplates\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n+from plone.app.layout.globals.interfaces import IBodyClassAdapter\n from plone.app.layout.globals.interfaces import ILayoutPolicy\n from plone.app.layout.globals.interfaces import IViewView\n from plone.app.layout.icons.interfaces import IContentIcon\n@@ -16,12 +17,15 @@\n from zope.browserpage.viewpagetemplatefile import (\n     ViewPageTemplateFile as ZopeViewPageTemplateFile\n )\n+from zope.component import adapter\n+from zope.component import getAdapters\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n from zope.component import queryMultiAdapter\n from zope.component import queryUtility\n from zope.interface import alsoProvides\n from zope.interface import implements\n+from zope.interface import Interface\n from zope.publisher.browser import BrowserView\n \n \n@@ -268,4 +272,33 @@ def bodyClass(self, template, view):\n         if msl or elonw:\n             body_classes.append(\'pat-markspeciallinks\')\n \n+        # Add externally defined extra body classes\n+        body_class_adapters = getAdapters(\n+            (self.context, self.request),\n+            IBodyClassAdapter\n+        )\n+        for name, body_class_adapter in body_class_adapters:\n+            try:\n+                extra_classes = body_class_adapter.get_classes(template, view) or []\n+            except TypeError:  # This adapter is implemented without arguments\n+                extra_classes = body_class_adapter.get_classes() or []\n+            if isinstance(extra_classes, basestring):\n+                extra_classes = extra_classes.split(\' \')\n+            body_classes.extend(extra_classes)\n+\n         return \' \'.join(body_classes)\n+\n+\n+@adapter(Interface)\n+class DefaultBodyClasses(object):\n+\n+    implements(IBodyClassAdapter)\n+\n+    def __init__(self, context, request):\n+        self.context = context\n+        self.request = request\n+\n+    def get_classes(self, template, view):\n+        """Default body classes adapter.\n+        """\n+        return []\n'

