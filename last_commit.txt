Repository: plone.app.event


Branch: refs/heads/master
Date: 2019-08-06T12:12:37+02:00
Author: Robert Kuzma (balavec) <robert@balavec.com>
Commit: https://github.com/plone/plone.app.event/commit/cdc83d52bc90e378779d09a684b03f81e5678dd7

Fix Python2 vs. Python3 text and bytes handling in the calendar portlet.

Files changed:
A news/308.bugfix
M plone/app/event/portlets/portlet_calendar.py

b'diff --git a/news/308.bugfix b/news/308.bugfix\nnew file mode 100644\nindex 00000000..f709a607\n--- /dev/null\n+++ b/news/308.bugfix\n@@ -0,0 +1 @@\n+Fix Python2 vs. Python3 text and bytes handling in the calendar portlet.\ndiff --git a/plone/app/event/portlets/portlet_calendar.py b/plone/app/event/portlets/portlet_calendar.py\nindex 3b1c471b..fbf9dd60 100644\n--- a/plone/app/event/portlets/portlet_calendar.py\n+++ b/plone/app/event/portlets/portlet_calendar.py\n@@ -279,12 +279,16 @@ def cal_data(self):\n         return caldata\n \n     def nav_pattern_options(self, year, month):\n+        val = self.hash\n+        if isinstance(val, bytes):\n+            val = val.decode("utf-8")\n+\n         return json.dumps({\n             \'url\': \'%s/@@render-portlet?portlethash=%s&year=%s&month=%s\' % (\n                 getSite().absolute_url(),\n-                self.hash,\n+                val,\n                 year, month),\n-            \'target\': \'#portletwrapper-%s > *\' % self.hash\n+            \'target\': \'#portletwrapper-%s > *\' % val\n         })\n \n     @property\n'

Repository: plone.app.event


Branch: refs/heads/master
Date: 2019-11-06T18:49:20+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.event/commit/753869bdf2d4ad9dfc482f9eb8f392cb39492d6c

Merge pull request #309 from plone/python3-text-bytes

Fix Python2 vs. Python3 text and bytes handling in the calendar portlet

Files changed:
A news/308.bugfix
M plone/app/event/portlets/portlet_calendar.py

b'diff --git a/news/308.bugfix b/news/308.bugfix\nnew file mode 100644\nindex 00000000..f709a607\n--- /dev/null\n+++ b/news/308.bugfix\n@@ -0,0 +1 @@\n+Fix Python2 vs. Python3 text and bytes handling in the calendar portlet.\ndiff --git a/plone/app/event/portlets/portlet_calendar.py b/plone/app/event/portlets/portlet_calendar.py\nindex 3b1c471b..fbf9dd60 100644\n--- a/plone/app/event/portlets/portlet_calendar.py\n+++ b/plone/app/event/portlets/portlet_calendar.py\n@@ -279,12 +279,16 @@ def cal_data(self):\n         return caldata\n \n     def nav_pattern_options(self, year, month):\n+        val = self.hash\n+        if isinstance(val, bytes):\n+            val = val.decode("utf-8")\n+\n         return json.dumps({\n             \'url\': \'%s/@@render-portlet?portlethash=%s&year=%s&month=%s\' % (\n                 getSite().absolute_url(),\n-                self.hash,\n+                val,\n                 year, month),\n-            \'target\': \'#portletwrapper-%s > *\' % self.hash\n+            \'target\': \'#portletwrapper-%s > *\' % val\n         })\n \n     @property\n'

