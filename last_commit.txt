Repository: plone.formwidget.datetime


Branch: refs/heads/master
Date: 2019-02-08T11:39:45+01:00
Author: Bert Vanderbauwhede (batlock666) <batlock666@gmail.com>
Commit: https://github.com/plone/plone.formwidget.datetime/commit/ed2fc318d721721d32e49312e93523602a88bc27

Tuple ('', '', '', '00', '00') is also an empty value. Fix #22

Files changed:
M CHANGES.rst
M plone/formwidget/datetime/base.py
M plone/formwidget/datetime/tests/test_AbstractDatetimeWidget.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 4aafa0e..49a7e7c 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,7 +14,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Tuple ('', '', '', '00', '00') is also an empty value. Fix #22\n+  [batlock666]\n \n \n 1.3.4 (2018-04-08)\ndiff --git a/plone/formwidget/datetime/base.py b/plone/formwidget/datetime/base.py\nindex 806bd27..191783b 100644\n--- a/plone/formwidget/datetime/base.py\n+++ b/plone/formwidget/datetime/base.py\n@@ -434,6 +434,13 @@ def _dtformatter(self):\n     def _dtvalue(self, value):\n         return self._base_dtvalue(datetime, value)\n \n+    @property\n+    def formatted_value(self):\n+        if self.value in (self.empty_value, self.empty_value[:-1], None):\n+            return ''\n+        dt_value = self._dtvalue(self.value)\n+        return self.get_formatted_value(dt_value)\n+\n     @property\n     def hours(self):\n         try:\ndiff --git a/plone/formwidget/datetime/tests/test_AbstractDatetimeWidget.py b/plone/formwidget/datetime/tests/test_AbstractDatetimeWidget.py\nindex 6c93f41..39fcd19 100644\n--- a/plone/formwidget/datetime/tests/test_AbstractDatetimeWidget.py\n+++ b/plone/formwidget/datetime/tests/test_AbstractDatetimeWidget.py\n@@ -280,3 +280,13 @@ def test__dtvalue(self, datetime):\n         value = (1,2,3)\n         instance._dtvalue(value)\n         datetime.assert_called_with(1, 2, 3)\n+\n+    def test_formatted_value_value_is_empty_value(self):\n+        instance = self.createInstance()\n+\n+        self.assertEqual(instance.value, ('', '', '', '00', '00', ''))\n+        self.assertEqual(instance.formatted_value, '')\n+\n+        instance.value = instance.value[:-1]\n+        self.assertEqual(instance.value, ('', '', '', '00', '00'))\n+        self.assertEqual(instance.formatted_value, '')\n"

Repository: plone.formwidget.datetime


Branch: refs/heads/master
Date: 2019-05-22T00:45:28+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.formwidget.datetime/commit/72e66f4fd823f60a2c18801d212c4ed7ceefe8c2

Merge pull request #23 from UGentPortaal/master

Tuple ('', '', '', '00', '00') is also an empty value. Fix #22

Files changed:
M CHANGES.rst
M plone/formwidget/datetime/base.py
M plone/formwidget/datetime/tests/test_AbstractDatetimeWidget.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 4aafa0e..49a7e7c 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,7 +14,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Tuple ('', '', '', '00', '00') is also an empty value. Fix #22\n+  [batlock666]\n \n \n 1.3.4 (2018-04-08)\ndiff --git a/plone/formwidget/datetime/base.py b/plone/formwidget/datetime/base.py\nindex 806bd27..191783b 100644\n--- a/plone/formwidget/datetime/base.py\n+++ b/plone/formwidget/datetime/base.py\n@@ -434,6 +434,13 @@ def _dtformatter(self):\n     def _dtvalue(self, value):\n         return self._base_dtvalue(datetime, value)\n \n+    @property\n+    def formatted_value(self):\n+        if self.value in (self.empty_value, self.empty_value[:-1], None):\n+            return ''\n+        dt_value = self._dtvalue(self.value)\n+        return self.get_formatted_value(dt_value)\n+\n     @property\n     def hours(self):\n         try:\ndiff --git a/plone/formwidget/datetime/tests/test_AbstractDatetimeWidget.py b/plone/formwidget/datetime/tests/test_AbstractDatetimeWidget.py\nindex 6c93f41..39fcd19 100644\n--- a/plone/formwidget/datetime/tests/test_AbstractDatetimeWidget.py\n+++ b/plone/formwidget/datetime/tests/test_AbstractDatetimeWidget.py\n@@ -280,3 +280,13 @@ def test__dtvalue(self, datetime):\n         value = (1,2,3)\n         instance._dtvalue(value)\n         datetime.assert_called_with(1, 2, 3)\n+\n+    def test_formatted_value_value_is_empty_value(self):\n+        instance = self.createInstance()\n+\n+        self.assertEqual(instance.value, ('', '', '', '00', '00', ''))\n+        self.assertEqual(instance.formatted_value, '')\n+\n+        instance.value = instance.value[:-1]\n+        self.assertEqual(instance.value, ('', '', '', '00', '00'))\n+        self.assertEqual(instance.formatted_value, '')\n"

