Repository: Products.CMFPlone


Branch: refs/heads/5.1.x
Date: 2018-06-12T13:38:29+02:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/b747586f5b6d030556fdac6296ab506093766cd3

fix #2394

Files changed:
M CHANGES.rst
M Products/CMFPlone/skins/plone_login/login_next.cpy

diff --git a/CHANGES.rst b/CHANGES.rst
index 687fd4a13..923d42a66 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,6 +18,9 @@ New features:
 
 Bug fixes:
 
+- Fix https://github.com/plone/Products.CMFPlone/issues/2394, error on login after password reset.
+  [jensens, agitator]
+
 - Do not include too new upgrades when upgrading Plone Site.
   Otherwise the Plone Site ends up at a newer version that the filesystem code supports,
   giving an error when upgrading, and resulting in possibly missed upgrades later.
diff --git a/Products/CMFPlone/skins/plone_login/login_next.cpy b/Products/CMFPlone/skins/plone_login/login_next.cpy
index e5e5ba212..6ee5b4388 100644
--- a/Products/CMFPlone/skins/plone_login/login_next.cpy
+++ b/Products/CMFPlone/skins/plone_login/login_next.cpy
@@ -37,6 +37,8 @@ if came_from is not None:
                        # tests won't be able to log in via login_form
                        'localhost']:
         came_from = ''
+    if 'passwordreset' in path:
+        came_from = ''
     # It is probably a good idea in general to filter out urls outside the
     # portal. An added bonus: this fixes some problems with a Zope bug that
     # doesn't properly unmangle the VirtualHostMonster stuff when setting


Repository: Products.CMFPlone


Branch: refs/heads/5.1.x
Date: 2018-06-12T15:18:11+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/d9311a7895e852af68d5a1f4a51b809ee62f0a89

Merge pull request #2441 from plone/fix-2394

fix #2394

Files changed:
M CHANGES.rst
M Products/CMFPlone/skins/plone_login/login_next.cpy

diff --git a/CHANGES.rst b/CHANGES.rst
index 687fd4a13..923d42a66 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,6 +18,9 @@ New features:
 
 Bug fixes:
 
+- Fix https://github.com/plone/Products.CMFPlone/issues/2394, error on login after password reset.
+  [jensens, agitator]
+
 - Do not include too new upgrades when upgrading Plone Site.
   Otherwise the Plone Site ends up at a newer version that the filesystem code supports,
   giving an error when upgrading, and resulting in possibly missed upgrades later.
diff --git a/Products/CMFPlone/skins/plone_login/login_next.cpy b/Products/CMFPlone/skins/plone_login/login_next.cpy
index e5e5ba212..6ee5b4388 100644
--- a/Products/CMFPlone/skins/plone_login/login_next.cpy
+++ b/Products/CMFPlone/skins/plone_login/login_next.cpy
@@ -37,6 +37,8 @@ if came_from is not None:
                        # tests won't be able to log in via login_form
                        'localhost']:
         came_from = ''
+    if 'passwordreset' in path:
+        came_from = ''
     # It is probably a good idea in general to filter out urls outside the
     # portal. An added bonus: this fixes some problems with a Zope bug that
     # doesn't properly unmangle the VirtualHostMonster stuff when setting


