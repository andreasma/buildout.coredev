Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2019-11-01T13:24:53+01:00
Author: Érico Andrei (ericof) <ericof@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/5a86b2a4255bc5ac968e311f7f3368e8f8fb4b9f

Fixes #535. For migration tests, uninstalls plone.app.contentypes if previously installed.

Files changed:
A news/535.bugfix
M plone/app/contenttypes/testing.py

b"diff --git a/news/535.bugfix b/news/535.bugfix\nnew file mode 100644\nindex 00000000..c2e5dff7\n--- /dev/null\n+++ b/news/535.bugfix\n@@ -0,0 +1,2 @@\n+for migration tests uninstall plone.app.contenttypes if previously installed\n+[ericof]\ndiff --git a/plone/app/contenttypes/testing.py b/plone/app/contenttypes/testing.py\nindex 6d4966c7..dc93f034 100644\n--- a/plone/app/contenttypes/testing.py\n+++ b/plone/app/contenttypes/testing.py\n@@ -12,6 +12,7 @@\n from plone.app.testing import SITE_OWNER_NAME\n from plone.app.testing import SITE_OWNER_PASSWORD\n from plone.testing import z2\n+from Products.CMFPlone.utils import get_installer\n from zope.interface import alsoProvides\n \n import pkg_resources\n@@ -108,6 +109,11 @@ def setUpPloneSite(self, portal):\n         if not TEST_MIGRATION:\n             return\n \n+        # Uninstall plone.app.contenttypes if already installed\n+        qi = get_installer(portal)\n+        if qi.is_product_installed('plone.app.contenttypes'):\n+            qi.uninstall_product('plone.app.contenttypes')\n+\n         # install Products.ATContentTypes manually if profile is available\n         # (this is only needed for Plone >= 5)\n         profiles = [x['id'] for x in portal.portal_setup.listProfileInfo()]\n"

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2019-11-06T14:12:46+01:00
Author: Érico Andrei (ericof) <ericof@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/cc3f35147a25a6086ada4de232e95532343f90e9

Merge pull request #536 from plone/fix/535-remove-pac-if-already-installed

Migration tests, uninstalls plone.app.contentypes if previously installed.

Files changed:
A news/535.bugfix
M plone/app/contenttypes/testing.py

b"diff --git a/news/535.bugfix b/news/535.bugfix\nnew file mode 100644\nindex 00000000..c2e5dff7\n--- /dev/null\n+++ b/news/535.bugfix\n@@ -0,0 +1,2 @@\n+for migration tests uninstall plone.app.contenttypes if previously installed\n+[ericof]\ndiff --git a/plone/app/contenttypes/testing.py b/plone/app/contenttypes/testing.py\nindex 6d4966c7..dc93f034 100644\n--- a/plone/app/contenttypes/testing.py\n+++ b/plone/app/contenttypes/testing.py\n@@ -12,6 +12,7 @@\n from plone.app.testing import SITE_OWNER_NAME\n from plone.app.testing import SITE_OWNER_PASSWORD\n from plone.testing import z2\n+from Products.CMFPlone.utils import get_installer\n from zope.interface import alsoProvides\n \n import pkg_resources\n@@ -108,6 +109,11 @@ def setUpPloneSite(self, portal):\n         if not TEST_MIGRATION:\n             return\n \n+        # Uninstall plone.app.contenttypes if already installed\n+        qi = get_installer(portal)\n+        if qi.is_product_installed('plone.app.contenttypes'):\n+            qi.uninstall_product('plone.app.contenttypes')\n+\n         # install Products.ATContentTypes manually if profile is available\n         # (this is only needed for Plone >= 5)\n         profiles = [x['id'] for x in portal.portal_setup.listProfileInfo()]\n"

