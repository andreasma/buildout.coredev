Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2019-03-14T14:35:20+01:00
Author: Katja Suess (ksuess) <k.suess@rohberg.ch>
Commit: https://github.com/plone/plone.app.z3cform/commit/fb70060f53d659f5a5a244060558b15c5d1c5846

Adding toFieldValue method to LinkWidgetDataConverter

Files changed:
M plone/app/z3cform/converters.py

b'diff --git a/plone/app/z3cform/converters.py b/plone/app/z3cform/converters.py\nindex e4004af..bd47152 100644\n--- a/plone/app/z3cform/converters.py\n+++ b/plone/app/z3cform/converters.py\n@@ -370,6 +370,37 @@ def toWidgetValue(self, value):\n         return result\n \n \n+    def toFieldValue(self, value):\n+        """Converts from widget value to field."""\n+\n+        if not value:\n+            return self.field.missing_value\n+        print("*** LinkWidgetDataConverter ** toFieldValue {}".format(value))\n+        if type(value)==type({}):\n+            internal = value.get(\'internal\')\n+            external = value.get(\'external\')\n+            email = value.get(\'email\')\n+        else:\n+            return value\n+        if internal:\n+            url = \'${portal_url}/resolveuid/\' + internal\n+        elif email:\n+            subject = value.get(\'email_subject\')\n+            if email[:7] != \'mailto:\':\n+                email = u\'mailto:\' + email\n+            if not subject:\n+                url = email\n+            else:\n+                url = u\'{email}?subject={subject}\'.format(\n+                    email=email,\n+                    subject=subject,\n+                )\n+        else:\n+            url = external\n+        return url\n+\n+\n+\n @adapter(IBool, ISingleCheckBoxBoolWidget)\n class BoolSingleCheckboxDataConverter(BaseDataConverter):\n     """Special converter between boolean fields and single checkbox widgets.\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2019-03-14T14:40:39+01:00
Author: Katja Suess (ksuess) <k.suess@rohberg.ch>
Commit: https://github.com/plone/plone.app.z3cform/commit/c56fa35fa03e61ef625ad82334724212a3dc6d1f

Update CHANGES.rst

Files changed:
M CHANGES.rst

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex ddfa5d6..bbde449 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,7 +14,7 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- LinkFieldWidget: added converter method toFieldValue [ksuess]\n \n \n 3.0.9 (2019-01-08)\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2019-03-14T14:49:16+01:00
Author: Katja Suess (ksuess) <k.suess@rohberg.ch>
Commit: https://github.com/plone/plone.app.z3cform/commit/cd16827be8c5a9514b0543add9485e582cd06b79

code analysis

Files changed:
M plone/app/z3cform/converters.py

b'diff --git a/plone/app/z3cform/converters.py b/plone/app/z3cform/converters.py\nindex bd47152..3e24d97 100644\n--- a/plone/app/z3cform/converters.py\n+++ b/plone/app/z3cform/converters.py\n@@ -369,14 +369,12 @@ def toWidgetValue(self, value):\n                 result[\'external\'] = value\n         return result\n \n-\n     def toFieldValue(self, value):\n         """Converts from widget value to field."""\n \n         if not value:\n             return self.field.missing_value\n-        print("*** LinkWidgetDataConverter ** toFieldValue {}".format(value))\n-        if type(value)==type({}):\n+        if isinstance(value, dict):\n             internal = value.get(\'internal\')\n             external = value.get(\'external\')\n             email = value.get(\'email\')\n@@ -400,7 +398,6 @@ def toFieldValue(self, value):\n         return url\n \n \n-\n @adapter(IBool, ISingleCheckBoxBoolWidget)\n class BoolSingleCheckboxDataConverter(BaseDataConverter):\n     """Special converter between boolean fields and single checkbox widgets.\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2019-03-26T18:00:10+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.z3cform/commit/b659628c3ad193980045eb85bb6169aeac9dd8a8

Merge pull request #103 from plone/LinkFieldWidget

LinkFieldWidget in DataGridField shows error on correct value

Files changed:
M CHANGES.rst
M plone/app/z3cform/converters.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex ddfa5d6..bbde449 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,7 +14,7 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- LinkFieldWidget: added converter method toFieldValue [ksuess]\n \n \n 3.0.9 (2019-01-08)\ndiff --git a/plone/app/z3cform/converters.py b/plone/app/z3cform/converters.py\nindex e4004af..3e24d97 100644\n--- a/plone/app/z3cform/converters.py\n+++ b/plone/app/z3cform/converters.py\n@@ -369,6 +369,34 @@ def toWidgetValue(self, value):\n                 result[\'external\'] = value\n         return result\n \n+    def toFieldValue(self, value):\n+        """Converts from widget value to field."""\n+\n+        if not value:\n+            return self.field.missing_value\n+        if isinstance(value, dict):\n+            internal = value.get(\'internal\')\n+            external = value.get(\'external\')\n+            email = value.get(\'email\')\n+        else:\n+            return value\n+        if internal:\n+            url = \'${portal_url}/resolveuid/\' + internal\n+        elif email:\n+            subject = value.get(\'email_subject\')\n+            if email[:7] != \'mailto:\':\n+                email = u\'mailto:\' + email\n+            if not subject:\n+                url = email\n+            else:\n+                url = u\'{email}?subject={subject}\'.format(\n+                    email=email,\n+                    subject=subject,\n+                )\n+        else:\n+            url = external\n+        return url\n+\n \n @adapter(IBool, ISingleCheckBoxBoolWidget)\n class BoolSingleCheckboxDataConverter(BaseDataConverter):\n'

