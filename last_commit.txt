Repository: plone.app.dexterity


Branch: refs/heads/2.3.x
Date: 2018-10-06T17:04:31+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.dexterity/commit/ccac462cbcd9ea2e3e5ce169bb4a9a74e68d30ec

Release upload lock when name chooser fails.

Fixes https://github.com/plone/plone.app.dexterity/issues/276

Files changed:
A news/276.bugfix
M plone/app/dexterity/factories.py

b'diff --git a/news/276.bugfix b/news/276.bugfix\nnew file mode 100644\nindex 0000000..a941f88\n--- /dev/null\n+++ b/news/276.bugfix\n@@ -0,0 +1 @@\n+Release upload lock when name chooser fails.  [maurits]\ndiff --git a/plone/app/dexterity/factories.py b/plone/app/dexterity/factories.py\nindex 59e4569..7496f3a 100644\n--- a/plone/app/dexterity/factories.py\n+++ b/plone/app/dexterity/factories.py\n@@ -35,9 +35,8 @@ def __call__(self, name, content_type, data):\n         # otherwise I get ZPublisher.Conflict ConflictErrors\n         # when uploading multiple files\n         upload_lock.acquire()\n-\n-        newid = chooser.chooseName(name, self.context.aq_parent)\n         try:\n+            newid = chooser.chooseName(name, self.context.aq_parent)\n             transaction.begin()\n \n             # Try to determine which kind of NamedBlob we need\n'

Repository: plone.app.dexterity


Branch: refs/heads/2.3.x
Date: 2018-10-07T12:28:06+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.dexterity/commit/bee6a36958a9240c2410a2632d3c41229a252365

Merge pull request #277 from plone/fix-release-lock-23x

Release upload lock when name chooser fails. [2.3.x]

Files changed:
A news/276.bugfix
M plone/app/dexterity/factories.py

b'diff --git a/news/276.bugfix b/news/276.bugfix\nnew file mode 100644\nindex 0000000..a941f88\n--- /dev/null\n+++ b/news/276.bugfix\n@@ -0,0 +1 @@\n+Release upload lock when name chooser fails.  [maurits]\ndiff --git a/plone/app/dexterity/factories.py b/plone/app/dexterity/factories.py\nindex 59e4569..7496f3a 100644\n--- a/plone/app/dexterity/factories.py\n+++ b/plone/app/dexterity/factories.py\n@@ -35,9 +35,8 @@ def __call__(self, name, content_type, data):\n         # otherwise I get ZPublisher.Conflict ConflictErrors\n         # when uploading multiple files\n         upload_lock.acquire()\n-\n-        newid = chooser.chooseName(name, self.context.aq_parent)\n         try:\n+            newid = chooser.chooseName(name, self.context.aq_parent)\n             transaction.begin()\n \n             # Try to determine which kind of NamedBlob we need\n'

