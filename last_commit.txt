Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2018-09-04T11:57:59+02:00
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/701df20a49e051f24dddc72631cd32e583766128

Make multilingual selector more failsafe

Files changed:
M CHANGES.rst
M src/plone/app/multilingual/browser/helper_views.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 631caa3a..6801d993 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -25,6 +25,8 @@ Bug fixes:\n - Fixed tests now that Catalan has translated 'assets' into 'recursos'.\n   [maurits]\n \n+- Don't fail, if multilingual selector is called without query\n+  [tomgross]\n \n 5.2.0 (2018-04-04)\n ------------------\ndiff --git a/src/plone/app/multilingual/browser/helper_views.py b/src/plone/app/multilingual/browser/helper_views.py\nindex f36a925f..a1e75bb1 100644\n--- a/src/plone/app/multilingual/browser/helper_views.py\n+++ b/src/plone/app/multilingual/browser/helper_views.py\n@@ -154,9 +154,11 @@ def getClosestDestination(self):\n \n         # We are using TranslationManager to get the translations of a\n         # string tg\n-        manager = TranslationManager(self.tg)\n-        context = None\n-        languages = manager.get_translations()\n+        try:\n+            manager = TranslationManager(self.tg)\n+            languages = manager.get_translations()\n+        except AttributeError:\n+            languages = []\n         if len(languages) == 0:\n             # If there is no results there are no translations\n             # we move to portal root\n"

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2018-09-10T08:50:56+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/7cb4e7154495b243f9981a7f58a6301c85c70cff

Merge pull request #322 from plone/selector_failsafe

Make multilingual selector more failsafe

Files changed:
M CHANGES.rst
M src/plone/app/multilingual/browser/helper_views.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 631caa3a..6801d993 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -25,6 +25,8 @@ Bug fixes:\n - Fixed tests now that Catalan has translated 'assets' into 'recursos'.\n   [maurits]\n \n+- Don't fail, if multilingual selector is called without query\n+  [tomgross]\n \n 5.2.0 (2018-04-04)\n ------------------\ndiff --git a/src/plone/app/multilingual/browser/helper_views.py b/src/plone/app/multilingual/browser/helper_views.py\nindex f36a925f..a1e75bb1 100644\n--- a/src/plone/app/multilingual/browser/helper_views.py\n+++ b/src/plone/app/multilingual/browser/helper_views.py\n@@ -154,9 +154,11 @@ def getClosestDestination(self):\n \n         # We are using TranslationManager to get the translations of a\n         # string tg\n-        manager = TranslationManager(self.tg)\n-        context = None\n-        languages = manager.get_translations()\n+        try:\n+            manager = TranslationManager(self.tg)\n+            languages = manager.get_translations()\n+        except AttributeError:\n+            languages = []\n         if len(languages) == 0:\n             # If there is no results there are no translations\n             # we move to portal root\n"

