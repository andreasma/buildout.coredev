Repository: plone.app.layout


Branch: refs/heads/master
Date: 2018-09-04T16:32:11+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.layout/commit/1164829bf8b7c15c1b6dff6b7d0e98c46f38bea1

Failing tests showing that the byline is hidden for logged-in users

Files changed:
M plone/app/layout/viewlets/tests/test_content.py

b'diff --git a/plone/app/layout/viewlets/tests/test_content.py b/plone/app/layout/viewlets/tests/test_content.py\nindex 6fe448a..446802b 100644\n--- a/plone/app/layout/viewlets/tests/test_content.py\n+++ b/plone/app/layout/viewlets/tests/test_content.py\n@@ -78,6 +78,33 @@ def test_pub_date(self):\n         self.assertEqual(viewlet.pub_date(), None)\n \n \n+    def test_anonymous_users_see_byline_if_show_enabled(self):\n+        self.security_settings.allow_anon_views_about = True\n+        self.logout()\n+        viewlet = self._get_viewlet()\n+        self.assertTrue(viewlet.show())\n+\n+    def test_anonymous_users_dont_see_byline_if_show_disabled(self):\n+        self.security_settings.allow_anon_views_about = False\n+        self.logout()\n+        viewlet = self._get_viewlet()\n+        self.assertFalse(viewlet.show())\n+\n+    def test_logged_users_see_byline_if_show_enabled(self):\n+        self.security_settings.allow_anon_views_about = True\n+        #self.logout()\n+        viewlet = self._get_viewlet()\n+        self.assertTrue(viewlet.show())\n+\n+    def test_logged_users_see_byline_if_show_disabled(self):\n+        self.security_settings.allow_anon_views_about = False\n+        #self.logout()\n+        viewlet = self._get_viewlet()\n+        self.assertTrue(viewlet.show())\n+\n+\n+\n+\n class TestHistoryBylineViewletView(ViewletsTestCase):\n     """\n     Test the document by line viewlet\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2018-09-04T16:32:11+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.layout/commit/b3bb2bfc9d2c8d06b3803e19f87e87b63e5a4ed3

show byline for logged in users

test

Files changed:
M plone/app/layout/viewlets/content.py
M plone/app/layout/viewlets/tests/test_content.py

b"diff --git a/plone/app/layout/viewlets/content.py b/plone/app/layout/viewlets/content.py\nindex 07e262d..9651ab2 100644\n--- a/plone/app/layout/viewlets/content.py\n+++ b/plone/app/layout/viewlets/content.py\n@@ -72,7 +72,7 @@ def show(self):\n             ISecuritySchema,\n             prefix='plone',\n         )\n-        return self.anonymous and settings.allow_anon_views_about\n+        return not self.anonymous or settings.allow_anon_views_about\n \n     def creator(self):\n         return self.context.Creator()\ndiff --git a/plone/app/layout/viewlets/tests/test_content.py b/plone/app/layout/viewlets/tests/test_content.py\nindex 446802b..b8914c4 100644\n--- a/plone/app/layout/viewlets/tests/test_content.py\n+++ b/plone/app/layout/viewlets/tests/test_content.py\n@@ -92,13 +92,11 @@ def test_anonymous_users_dont_see_byline_if_show_disabled(self):\n \n     def test_logged_users_see_byline_if_show_enabled(self):\n         self.security_settings.allow_anon_views_about = True\n-        #self.logout()\n         viewlet = self._get_viewlet()\n         self.assertTrue(viewlet.show())\n \n     def test_logged_users_see_byline_if_show_disabled(self):\n         self.security_settings.allow_anon_views_about = False\n-        #self.logout()\n         viewlet = self._get_viewlet()\n         self.assertTrue(viewlet.show())\n \n"

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2018-09-04T16:33:20+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.layout/commit/60f3180365f0f2bc14960f87e676466b45494eb9

changelog

Files changed:
M CHANGES.rst

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 32873bb..e6d26c5 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -15,10 +15,14 @@ New features:\n \n Bug fixes:\n \n+- Show document byline for logged-in users. Fixes #160\n+  [erral]\n+\n - Get rid of obsolete ``X-UA-Compatible`` header.\n   [hvelarde]\n \n \n+\n 2.8.1 (2018-06-18)\n ------------------\n \n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2018-09-06T10:00:00+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/18b0c8e671c0093c663dffbe9e5784a5ced016d4

Merge pull request #161 from plone/erral-issue-160-document-byline

Fix document byline for logged-in users

Files changed:
M CHANGES.rst
M plone/app/layout/viewlets/content.py
M plone/app/layout/viewlets/tests/test_content.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 32873bb..e6d26c5 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -15,10 +15,14 @@ New features:\n \n Bug fixes:\n \n+- Show document byline for logged-in users. Fixes #160\n+  [erral]\n+\n - Get rid of obsolete ``X-UA-Compatible`` header.\n   [hvelarde]\n \n \n+\n 2.8.1 (2018-06-18)\n ------------------\n \ndiff --git a/plone/app/layout/viewlets/content.py b/plone/app/layout/viewlets/content.py\nindex 07e262d..9651ab2 100644\n--- a/plone/app/layout/viewlets/content.py\n+++ b/plone/app/layout/viewlets/content.py\n@@ -72,7 +72,7 @@ def show(self):\n             ISecuritySchema,\n             prefix=\'plone\',\n         )\n-        return self.anonymous and settings.allow_anon_views_about\n+        return not self.anonymous or settings.allow_anon_views_about\n \n     def creator(self):\n         return self.context.Creator()\ndiff --git a/plone/app/layout/viewlets/tests/test_content.py b/plone/app/layout/viewlets/tests/test_content.py\nindex 6fe448a..b8914c4 100644\n--- a/plone/app/layout/viewlets/tests/test_content.py\n+++ b/plone/app/layout/viewlets/tests/test_content.py\n@@ -78,6 +78,31 @@ def test_pub_date(self):\n         self.assertEqual(viewlet.pub_date(), None)\n \n \n+    def test_anonymous_users_see_byline_if_show_enabled(self):\n+        self.security_settings.allow_anon_views_about = True\n+        self.logout()\n+        viewlet = self._get_viewlet()\n+        self.assertTrue(viewlet.show())\n+\n+    def test_anonymous_users_dont_see_byline_if_show_disabled(self):\n+        self.security_settings.allow_anon_views_about = False\n+        self.logout()\n+        viewlet = self._get_viewlet()\n+        self.assertFalse(viewlet.show())\n+\n+    def test_logged_users_see_byline_if_show_enabled(self):\n+        self.security_settings.allow_anon_views_about = True\n+        viewlet = self._get_viewlet()\n+        self.assertTrue(viewlet.show())\n+\n+    def test_logged_users_see_byline_if_show_disabled(self):\n+        self.security_settings.allow_anon_views_about = False\n+        viewlet = self._get_viewlet()\n+        self.assertTrue(viewlet.show())\n+\n+\n+\n+\n class TestHistoryBylineViewletView(ViewletsTestCase):\n     """\n     Test the document by line viewlet\n'

