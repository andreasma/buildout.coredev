Repository: plone.app.event


Branch: refs/heads/master
Date: 2018-10-09T14:54:05+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.event/commit/9a76156d283ef4f5ca508c4b2a3d782107825e67

iCalendar categories are exepected as a comma separated string"

not as multiple entries. See https://www.kanzaki.com/docs/ical/categories.html
Needs fixed iCalendar &gt;4.0.2

Files changed:
M CHANGES.rst
M plone/app/event/ical/exporter.py
M plone/app/event/tests/test_icalendar.py
M setup.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex bcc90161..90e2c183 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,7 +14,10 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- iCalendar categories are exepected as a comma separated string, not as multiple entries.\n+  See https://www.kanzaki.com/docs/ical/categories.html\n+  Needs fixed iCalendar >4.0.2\n+  [jensens]\n \n \n 3.2.0 (2018-09-23)\ndiff --git a/plone/app/event/ical/exporter.py b/plone/app/event/ical/exporter.py\nindex 0cfc3d01..573c6a69 100644\n--- a/plone/app/event/ical/exporter.py\n+++ b/plone/app/event/ical/exporter.py\n@@ -360,8 +360,9 @@ def contact(self):\n     def categories(self):\n         ret = []\n         for cat in self.event.subjects or []:\n-            ret.append({'value': cat})\n-        return ret or None\n+            ret.append(cat)\n+        if ret:\n+            return {'value': ret}\n \n     @property\n     def geo(self):\ndiff --git a/plone/app/event/tests/test_icalendar.py b/plone/app/event/tests/test_icalendar.py\nindex f0ec703f..a479bc93 100644\n--- a/plone/app/event/tests/test_icalendar.py\n+++ b/plone/app/event/tests/test_icalendar.py\n@@ -49,7 +49,6 @@ def test_event_ical(self):\n         if six.PY3:\n             output = [i.decode('utf8') for i in output]\n         icalstr = ''.join(output)\n-\n         self.checkOrder(\n             icalstr,\n             'BEGIN:VCALENDAR',\n@@ -65,8 +64,7 @@ def test_event_ical(self):\n             'RRULE:FREQ=DAILY;COUNT=3;INTERVAL=1',\n             'RDATE;TZID=Europe/Vienna:20130509T000000',\n             'EXDATE;TZID=Europe/Vienna:20130506T000000,20140404T000000',\n-            'CATEGORIES:plone',\n-            'CATEGORIES:testing',\n+            'CATEGORIES:plone,testing',\n             'CONTACT:Auto Testdriver\\\\, +123456789\\\\, testdriver@plone.org\\\\, http://plone',  # noqa\n             ' .org',  # line longer than max length spec by icalendar\n             'CREATED;VALUE=DATE-TIME:',\n@@ -118,7 +116,6 @@ def test_portal_ical(self):\n \n         # No occurrences in export. Otherwise count would be 8.\n         self.assertEqual(icalstr.count('BEGIN:VEVENT'), 4)\n-\n         self.checkOrder(\n             icalstr,\n             'BEGIN:VCALENDAR',\n@@ -160,8 +157,7 @@ def test_portal_ical(self):\n             'RRULE:FREQ=DAILY;COUNT=3;INTERVAL=1',\n             'RDATE;TZID=Europe/Vienna:20130509T000000',\n             'EXDATE;TZID=Europe/Vienna:20130506T000000,20140404T000000',\n-            'CATEGORIES:plone',\n-            'CATEGORIES:testing',\n+            'CATEGORIES:plone,testing',\n             'CONTACT:Auto Testdriver\\\\, +123456789\\\\, testdriver@plone.org\\\\, http://plone',  # noqa\n             ' .org',\n             'CREATED;VALUE=DATE-TIME:',\ndiff --git a/setup.py b/setup.py\nindex f940c90f..8709fea0 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -51,7 +51,7 @@\n         'Products.ZCatalog',\n         'Products.statusmessages',\n         'Zope2',\n-        'icalendar > 3.0',\n+        'icalendar > 4.0.2',\n         'plone.app.contentlisting',\n         'plone.app.dexterity',\n         'plone.app.layout',\n"

