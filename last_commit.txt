Repository: plone.app.portlets


Branch: refs/heads/4.3.x
Date: 2018-05-07T11:00:05-04:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.app.portlets/commit/a40fd589ee9487352621bd174279c2d421e1905f

test against p.a.contenttypes

Files changed:
M CHANGES.rst
M plone/app/portlets/testing.py
M plone/app/portlets/tests/test_actions_portlet.py
M plone/app/portlets/tests/test_classic_portlet.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d71d948..755811e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,7 +15,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Test against plone.app.contenttypes instead of ATContentTypes.
+  [davisagli]
 
 
 4.3.2 (2018-04-03)
diff --git a/plone/app/portlets/testing.py b/plone/app/portlets/testing.py
index 79a339c..7f7e11f 100644
--- a/plone/app/portlets/testing.py
+++ b/plone/app/portlets/testing.py
@@ -17,8 +17,6 @@ class PloneAppPortlets(PloneSandboxLayer):
     defaultBases = (PLONE_FIXTURE,)
 
     def setUpZope(self, app, configurationContext):
-        z2.installProduct(app, 'Products.ATContentTypes')
-        z2.installProduct(app, 'plone.app.blob')
         z2.installProduct(app, 'plone.app.portlets')
 
         # Include testing profile
@@ -28,7 +26,7 @@ def setUpZope(self, app, configurationContext):
                        context=configurationContext)
 
     def setUpPloneSite(self, portal):
-        applyProfile(portal, 'Products.ATContentTypes:default')
+        applyProfile(portal, 'plone.app.contenttypes:default')
 
         setRoles(portal, TEST_USER_ID, ['Manager'])
         login(portal, TEST_USER_NAME)
diff --git a/plone/app/portlets/tests/test_actions_portlet.py b/plone/app/portlets/tests/test_actions_portlet.py
index 2439e84..2491e3b 100644
--- a/plone/app/portlets/tests/test_actions_portlet.py
+++ b/plone/app/portlets/tests/test_actions_portlet.py
@@ -196,7 +196,7 @@ def test_object_buttons(self):
         # Have our expected tabs ?
         expected = set([u'Cut', u'Copy', u'Rename', u'Delete'])
         got = set([unicode(link['title']) for link in output])
-        self.failUnlessEqual(got, expected)
+        self.assertTrue(expected.issubset(got))
 
     def test_category(self):
         r = self.renderer(
@@ -228,4 +228,4 @@ def test_object_buttons_with_icons(self):
         # Have our expected tabs ?
         expected = set([u'Cut', u'Copy', u'Rename', u'Delete'])
         got = set([unicode(link['title']) for link in output])
-        self.failUnlessEqual(got, expected)
+        self.assertTrue(expected.issubset(got))
diff --git a/plone/app/portlets/tests/test_classic_portlet.py b/plone/app/portlets/tests/test_classic_portlet.py
index 37ac8f9..cfd1695 100644
--- a/plone/app/portlets/tests/test_classic_portlet.py
+++ b/plone/app/portlets/tests/test_classic_portlet.py
@@ -94,7 +94,7 @@ def testPathExpression(self):
         self.assertEqual('context/portlet_recent', r.path_expression())
 
     def testRenderClassicPortlet(self):
-        r = self.renderer(assignment=classic.Assignment(template='base_view', macro='content-core'))
+        r = self.renderer(assignment=classic.Assignment(template='@@view', macro='content-core'))
         r.render()
 
 
diff --git a/setup.py b/setup.py
index b63e6d2..cddb5ae 100644
--- a/setup.py
+++ b/setup.py
@@ -31,8 +31,6 @@
     zip_safe=False,
     extras_require=dict(
         test=[
-            'Products.ATContentTypes',
-            'plone.app.blob',
             'plone.app.testing',
         ],
     ),


Repository: plone.app.portlets


Branch: refs/heads/4.3.x
Date: 2018-05-07T12:44:07-04:00
Author: David Glick (davisagli) <david.glick@plone.org>
Commit: https://github.com/plone/plone.app.portlets/commit/c5e4fd8dff6ff4b39a7f273f874a56b6864b4c85

Merge pull request #111 from plone/no-at

Test against p.a.contenttypes instead of Archetypes

Files changed:
M CHANGES.rst
M plone/app/portlets/testing.py
M plone/app/portlets/tests/test_actions_portlet.py
M plone/app/portlets/tests/test_classic_portlet.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d71d948..755811e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,7 +15,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Test against plone.app.contenttypes instead of ATContentTypes.
+  [davisagli]
 
 
 4.3.2 (2018-04-03)
diff --git a/plone/app/portlets/testing.py b/plone/app/portlets/testing.py
index 79a339c..7f7e11f 100644
--- a/plone/app/portlets/testing.py
+++ b/plone/app/portlets/testing.py
@@ -17,8 +17,6 @@ class PloneAppPortlets(PloneSandboxLayer):
     defaultBases = (PLONE_FIXTURE,)
 
     def setUpZope(self, app, configurationContext):
-        z2.installProduct(app, 'Products.ATContentTypes')
-        z2.installProduct(app, 'plone.app.blob')
         z2.installProduct(app, 'plone.app.portlets')
 
         # Include testing profile
@@ -28,7 +26,7 @@ def setUpZope(self, app, configurationContext):
                        context=configurationContext)
 
     def setUpPloneSite(self, portal):
-        applyProfile(portal, 'Products.ATContentTypes:default')
+        applyProfile(portal, 'plone.app.contenttypes:default')
 
         setRoles(portal, TEST_USER_ID, ['Manager'])
         login(portal, TEST_USER_NAME)
diff --git a/plone/app/portlets/tests/test_actions_portlet.py b/plone/app/portlets/tests/test_actions_portlet.py
index 2439e84..2491e3b 100644
--- a/plone/app/portlets/tests/test_actions_portlet.py
+++ b/plone/app/portlets/tests/test_actions_portlet.py
@@ -196,7 +196,7 @@ def test_object_buttons(self):
         # Have our expected tabs ?
         expected = set([u'Cut', u'Copy', u'Rename', u'Delete'])
         got = set([unicode(link['title']) for link in output])
-        self.failUnlessEqual(got, expected)
+        self.assertTrue(expected.issubset(got))
 
     def test_category(self):
         r = self.renderer(
@@ -228,4 +228,4 @@ def test_object_buttons_with_icons(self):
         # Have our expected tabs ?
         expected = set([u'Cut', u'Copy', u'Rename', u'Delete'])
         got = set([unicode(link['title']) for link in output])
-        self.failUnlessEqual(got, expected)
+        self.assertTrue(expected.issubset(got))
diff --git a/plone/app/portlets/tests/test_classic_portlet.py b/plone/app/portlets/tests/test_classic_portlet.py
index 37ac8f9..cfd1695 100644
--- a/plone/app/portlets/tests/test_classic_portlet.py
+++ b/plone/app/portlets/tests/test_classic_portlet.py
@@ -94,7 +94,7 @@ def testPathExpression(self):
         self.assertEqual('context/portlet_recent', r.path_expression())
 
     def testRenderClassicPortlet(self):
-        r = self.renderer(assignment=classic.Assignment(template='base_view', macro='content-core'))
+        r = self.renderer(assignment=classic.Assignment(template='@@view', macro='content-core'))
         r.render()
 
 
diff --git a/setup.py b/setup.py
index b63e6d2..cddb5ae 100644
--- a/setup.py
+++ b/setup.py
@@ -31,8 +31,6 @@
     zip_safe=False,
     extras_require=dict(
         test=[
-            'Products.ATContentTypes',
-            'plone.app.blob',
             'plone.app.testing',
         ],
     ),


