Repository: plone.app.discussion


Branch: refs/heads/master
Date: 2018-03-18T17:01:27+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.discussion/commit/71dcbf8465f17e0fcf96c52c4aeb2226a1314b75

some py3 fixes

Files changed:
M plone/app/discussion/browser/comment.py
M plone/app/discussion/browser/comments.py
M plone/app/discussion/catalog.py
M plone/app/discussion/tests/test_comments_viewlet.py

diff --git a/plone/app/discussion/browser/comment.py b/plone/app/discussion/browser/comment.py
index ab5f32dc..6497fecb 100644
--- a/plone/app/discussion/browser/comment.py
+++ b/plone/app/discussion/browser/comment.py
@@ -2,7 +2,7 @@
 from AccessControl import getSecurityManager
 from Acquisition import aq_inner
 from Acquisition import aq_parent
-from comments import CommentForm
+from .comments import CommentForm
 from plone.app.discussion import _
 from plone.registry.interfaces import IRegistry
 from plone.z3cform.layout import wrap_form
diff --git a/plone/app/discussion/browser/comments.py b/plone/app/discussion/browser/comments.py
index c8175173..2689c971 100644
--- a/plone/app/discussion/browser/comments.py
+++ b/plone/app/discussion/browser/comments.py
@@ -19,7 +19,7 @@
 from Products.CMFCore.utils import getToolByName
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
 from Products.statusmessages.interfaces import IStatusMessage
-from urllib import quote as url_quote
+from six.moves.urllib.parse import quote
 from z3c.form import button
 from z3c.form import field
 from z3c.form import form
@@ -537,7 +537,7 @@ def is_anonymous(self):
     def login_action(self):
         return '{0}/login_form?came_from={1}'.format(
             self.navigation_root_url,
-            url_quote(self.request.get('URL', '')),
+            quote(self.request.get('URL', '')),
         )
 
     def format_time(self, time):
diff --git a/plone/app/discussion/catalog.py b/plone/app/discussion/catalog.py
index 1ada61bd..97c5dc79 100644
--- a/plone/app/discussion/catalog.py
+++ b/plone/app/discussion/catalog.py
@@ -12,7 +12,6 @@
 from Products.CMFCore.interfaces import IContentish
 from Products.CMFPlone.utils import safe_unicode
 from Products.ZCatalog.interfaces import IZCatalog
-from string import join
 
 
 MAX_DESCRIPTION = 25
@@ -77,7 +76,7 @@ def creator(object):
 @indexer(IComment)
 def description(object):
     # Return the first 25 words of the comment text and append ' [...]'
-    text = join(object.getText(targetMimetype='text/plain').split()[:MAX_DESCRIPTION])
+    text = ' '.join(object.getText(targetMimetype='text/plain').split()[:MAX_DESCRIPTION])
     if len(object.getText().split()) > 25:
         text += ' [...]'
     return text
diff --git a/plone/app/discussion/tests/test_comments_viewlet.py b/plone/app/discussion/tests/test_comments_viewlet.py
index 630b237c..6f2ff235 100644
--- a/plone/app/discussion/tests/test_comments_viewlet.py
+++ b/plone/app/discussion/tests/test_comments_viewlet.py
@@ -727,7 +727,7 @@ def test_login_action(self):
         )
 
     def test_format_time(self):
-        python_time = datetime(2009, 02, 01, 23, 32, 03, 57)
+        python_time = datetime(2009, 2, 1, 23, 32, 3, 57)
         # Python Time must be utc time. There seems to be no too simple way
         # to tell datetime to be of utc time.
         # therefor, we convert the time to seconds since epoch, which seems


Repository: plone.app.discussion


Branch: refs/heads/master
Date: 2018-03-21T21:43:58+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.discussion/commit/723ec8375beaa56a15dadb31e8bb9a77d2ad8be8

fix relative imports for py3

Files changed:
M plone/app/discussion/tool.py

diff --git a/plone/app/discussion/tool.py b/plone/app/discussion/tool.py
index 902e6a6f..a10ae3c3 100644
--- a/plone/app/discussion/tool.py
+++ b/plone/app/discussion/tool.py
@@ -5,8 +5,8 @@
 
 BBB support for the old portal_discussion is provided in the bbb package.
 """
-from interfaces import IComment
-from interfaces import ICommentingTool
+from .interfaces import IComment
+from .interfaces import ICommentingTool
 from OFS.SimpleItem import SimpleItem
 from Products.CMFCore.utils import getToolByName
 from Products.CMFCore.utils import UniqueObject


Repository: plone.app.discussion


Branch: refs/heads/master
Date: 2018-04-11T14:35:57+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.discussion/commit/7894512bbfb277c4984c9657dcd18a3fe1581f01

Update CHANGES.rst

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index eec609c7..0f9dfb50 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- More Python 2 / 3 compatibility.
+  [pbauer]
 
 
 3.0.5 (2018-02-04)


Repository: plone.app.discussion


Branch: refs/heads/master
Date: 2018-04-12T08:14:11+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.discussion/commit/ac1ac4ae4a2e69071ac0b665f21dc4c1ff3f66f1

Merge pull request #130 from plone/python3

Python3

Files changed:
M CHANGES.rst
M plone/app/discussion/browser/comment.py
M plone/app/discussion/browser/comments.py
M plone/app/discussion/catalog.py
M plone/app/discussion/tests/test_comments_viewlet.py
M plone/app/discussion/tool.py

diff --git a/CHANGES.rst b/CHANGES.rst
index eec609c7..0f9dfb50 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- More Python 2 / 3 compatibility.
+  [pbauer]
 
 
 3.0.5 (2018-02-04)
diff --git a/plone/app/discussion/browser/comment.py b/plone/app/discussion/browser/comment.py
index ab5f32dc..6497fecb 100644
--- a/plone/app/discussion/browser/comment.py
+++ b/plone/app/discussion/browser/comment.py
@@ -2,7 +2,7 @@
 from AccessControl import getSecurityManager
 from Acquisition import aq_inner
 from Acquisition import aq_parent
-from comments import CommentForm
+from .comments import CommentForm
 from plone.app.discussion import _
 from plone.registry.interfaces import IRegistry
 from plone.z3cform.layout import wrap_form
diff --git a/plone/app/discussion/browser/comments.py b/plone/app/discussion/browser/comments.py
index c8175173..2689c971 100644
--- a/plone/app/discussion/browser/comments.py
+++ b/plone/app/discussion/browser/comments.py
@@ -19,7 +19,7 @@
 from Products.CMFCore.utils import getToolByName
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
 from Products.statusmessages.interfaces import IStatusMessage
-from urllib import quote as url_quote
+from six.moves.urllib.parse import quote
 from z3c.form import button
 from z3c.form import field
 from z3c.form import form
@@ -537,7 +537,7 @@ def is_anonymous(self):
     def login_action(self):
         return '{0}/login_form?came_from={1}'.format(
             self.navigation_root_url,
-            url_quote(self.request.get('URL', '')),
+            quote(self.request.get('URL', '')),
         )
 
     def format_time(self, time):
diff --git a/plone/app/discussion/catalog.py b/plone/app/discussion/catalog.py
index 1ada61bd..97c5dc79 100644
--- a/plone/app/discussion/catalog.py
+++ b/plone/app/discussion/catalog.py
@@ -12,7 +12,6 @@
 from Products.CMFCore.interfaces import IContentish
 from Products.CMFPlone.utils import safe_unicode
 from Products.ZCatalog.interfaces import IZCatalog
-from string import join
 
 
 MAX_DESCRIPTION = 25
@@ -77,7 +76,7 @@ def creator(object):
 @indexer(IComment)
 def description(object):
     # Return the first 25 words of the comment text and append ' [...]'
-    text = join(object.getText(targetMimetype='text/plain').split()[:MAX_DESCRIPTION])
+    text = ' '.join(object.getText(targetMimetype='text/plain').split()[:MAX_DESCRIPTION])
     if len(object.getText().split()) > 25:
         text += ' [...]'
     return text
diff --git a/plone/app/discussion/tests/test_comments_viewlet.py b/plone/app/discussion/tests/test_comments_viewlet.py
index 630b237c..6f2ff235 100644
--- a/plone/app/discussion/tests/test_comments_viewlet.py
+++ b/plone/app/discussion/tests/test_comments_viewlet.py
@@ -727,7 +727,7 @@ def test_login_action(self):
         )
 
     def test_format_time(self):
-        python_time = datetime(2009, 02, 01, 23, 32, 03, 57)
+        python_time = datetime(2009, 2, 1, 23, 32, 3, 57)
         # Python Time must be utc time. There seems to be no too simple way
         # to tell datetime to be of utc time.
         # therefor, we convert the time to seconds since epoch, which seems
diff --git a/plone/app/discussion/tool.py b/plone/app/discussion/tool.py
index 902e6a6f..a10ae3c3 100644
--- a/plone/app/discussion/tool.py
+++ b/plone/app/discussion/tool.py
@@ -5,8 +5,8 @@
 
 BBB support for the old portal_discussion is provided in the bbb package.
 """
-from interfaces import IComment
-from interfaces import ICommentingTool
+from .interfaces import IComment
+from .interfaces import ICommentingTool
 from OFS.SimpleItem import SimpleItem
 from Products.CMFCore.utils import getToolByName
 from Products.CMFCore.utils import UniqueObject


