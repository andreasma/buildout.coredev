Repository: plone.app.event


Branch: refs/heads/master
Date: 2018-04-01T12:10:57+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.event/commit/51b236616593ba07ec58e89f49ba400fc4ac7eb4

fix indexer for py3

Files changed:
M plone/app/event/dx/behaviors.py

diff --git a/plone/app/event/dx/behaviors.py b/plone/app/event/dx/behaviors.py
index 33564b52..b926276a 100644
--- a/plone/app/event/dx/behaviors.py
+++ b/plone/app/event/dx/behaviors.py
@@ -41,6 +41,8 @@
 from zope.schema.interfaces import IContextAwareDefaultFactory
 from plone.app.multilingual.dx.interfaces import ILanguageIndependentField
 
+import six
+
 
 def first_weekday_sun0():
     return wkday_to_mon1(first_weekday())
@@ -376,9 +378,11 @@ def searchable_text_indexer(obj):
     text += u'%s\n' % acc.description
     textvalue = acc.text
     transforms = getToolByName(obj, 'portal_transforms')
+    if six.PY2:
+        textvalue = textvalue.encode('utf8')
     body_plain = transforms.convertTo(
         'text/plain',
-        textvalue.encode('utf8'),
+        textvalue,
         mimetype='text/html',
     ).getData().strip()
     if isinstance(body_plain, str):


Repository: plone.app.event


Branch: refs/heads/master
Date: 2018-04-11T14:29:04+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.event/commit/a594bf976f1a68391776c3f94ff622e64c892815

Update CHANGES.rst

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index be8205b6..a6f4373f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,9 @@ New features:
 
 Bug fixes:
 
+- Python 3 compatibility.
+  [pbauer]
+
 - Fix future_events French translation.
   [vincentfretin]
 


Repository: plone.app.event


Branch: refs/heads/master
Date: 2018-04-11T14:29:20+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.event/commit/a2be5b65a5f09d5da99ec669b1e96dac94f4ac85

Merge pull request #280 from plone/python3

fix indexer for py3

Files changed:
M CHANGES.rst
M plone/app/event/dx/behaviors.py

diff --git a/CHANGES.rst b/CHANGES.rst
index be8205b6..a6f4373f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,9 @@ New features:
 
 Bug fixes:
 
+- Python 3 compatibility.
+  [pbauer]
+
 - Fix future_events French translation.
   [vincentfretin]
 
diff --git a/plone/app/event/dx/behaviors.py b/plone/app/event/dx/behaviors.py
index 33564b52..b926276a 100644
--- a/plone/app/event/dx/behaviors.py
+++ b/plone/app/event/dx/behaviors.py
@@ -41,6 +41,8 @@
 from zope.schema.interfaces import IContextAwareDefaultFactory
 from plone.app.multilingual.dx.interfaces import ILanguageIndependentField
 
+import six
+
 
 def first_weekday_sun0():
     return wkday_to_mon1(first_weekday())
@@ -376,9 +378,11 @@ def searchable_text_indexer(obj):
     text += u'%s\n' % acc.description
     textvalue = acc.text
     transforms = getToolByName(obj, 'portal_transforms')
+    if six.PY2:
+        textvalue = textvalue.encode('utf8')
     body_plain = transforms.convertTo(
         'text/plain',
-        textvalue.encode('utf8'),
+        textvalue,
         mimetype='text/html',
     ).getData().strip()
     if isinstance(body_plain, str):


