Repository: plone.dexterity


Branch: refs/heads/master
Date: 2019-12-27T10:59:53+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.dexterity/commit/83099ceca34c1cd75c17cc948856003ea6347639

speedup parallel threads by removing superfluos synchronization

Files changed:
A news/123.bugfix
M plone/dexterity/schema.py

b'diff --git a/news/123.bugfix b/news/123.bugfix\nnew file mode 100644\nindex 0000000..1c68bab\n--- /dev/null\n+++ b/news/123.bugfix\n@@ -0,0 +1 @@\n+Speedup (~1.6x) parallel thread execution by removing superfluos synchronization [jensens]\n\\ No newline at end of file\ndiff --git a/plone/dexterity/schema.py b/plone/dexterity/schema.py\nindex 9f0d83b..e7e5c83 100644\n--- a/plone/dexterity/schema.py\n+++ b/plone/dexterity/schema.py\n@@ -145,7 +145,6 @@ def __init__(self, cache_enabled=True):\n         self.cache_enabled = cache_enabled\n         self.invalidations = 0\n \n-    @synchronized(lock)\n     @volatile\n     def get(self, fti):\n         """main schema\n@@ -159,7 +158,6 @@ def get(self, fti):\n             except (AttributeError, ValueError):\n                 pass\n \n-    @synchronized(lock)\n     @volatile\n     def behavior_registrations(self, fti):\n         """all behavior behavior registrations of a given fti passed in as\n@@ -204,7 +202,6 @@ def behavior_registrations(self, fti):\n             registrations.append(registration)\n         return tuple(registrations)\n \n-    @synchronized(lock)\n     @volatile\n     def subtypes(self, fti):\n         """all registered marker interfaces of ftis behaviors\n@@ -220,7 +217,6 @@ def subtypes(self, fti):\n                 subtypes.append(behavior_registration.marker)\n         return tuple(subtypes)\n \n-    @synchronized(lock)\n     @volatile\n     def behavior_schema_interfaces(self, fti):\n         """behavior schema interfaces registered for the fti\n@@ -236,7 +232,6 @@ def behavior_schema_interfaces(self, fti):\n                 schemas.append(behavior_registration.interface)\n         return tuple(schemas)\n \n-    @synchronized(lock)\n     @volatile\n     def schema_interfaces(self, fti):\n         """all schema interfaces registered for the fti\n@@ -273,7 +268,6 @@ def invalidate(self, fti):\n             invalidate_cache(fti)\n             self.invalidations += 1\n \n-    @synchronized(lock)\n     @volatile\n     def modified(self, fti):\n         if fti:\n'

Repository: plone.dexterity


Branch: refs/heads/master
Date: 2019-12-28T09:10:05+01:00
Author: Timo Stollenwerk (tisto) <tisto@users.noreply.github.com>
Commit: https://github.com/plone/plone.dexterity/commit/05a6084375bcce4eab301416d1e78ecfc70eba50

Merge pull request #123 from plone/jensens-less-sync

Speedup parallel threads by removing superfluos synchronization

Files changed:
A news/123.bugfix
M plone/dexterity/schema.py

b'diff --git a/news/123.bugfix b/news/123.bugfix\nnew file mode 100644\nindex 0000000..1c68bab\n--- /dev/null\n+++ b/news/123.bugfix\n@@ -0,0 +1 @@\n+Speedup (~1.6x) parallel thread execution by removing superfluos synchronization [jensens]\n\\ No newline at end of file\ndiff --git a/plone/dexterity/schema.py b/plone/dexterity/schema.py\nindex 9f0d83b..e7e5c83 100644\n--- a/plone/dexterity/schema.py\n+++ b/plone/dexterity/schema.py\n@@ -145,7 +145,6 @@ def __init__(self, cache_enabled=True):\n         self.cache_enabled = cache_enabled\n         self.invalidations = 0\n \n-    @synchronized(lock)\n     @volatile\n     def get(self, fti):\n         """main schema\n@@ -159,7 +158,6 @@ def get(self, fti):\n             except (AttributeError, ValueError):\n                 pass\n \n-    @synchronized(lock)\n     @volatile\n     def behavior_registrations(self, fti):\n         """all behavior behavior registrations of a given fti passed in as\n@@ -204,7 +202,6 @@ def behavior_registrations(self, fti):\n             registrations.append(registration)\n         return tuple(registrations)\n \n-    @synchronized(lock)\n     @volatile\n     def subtypes(self, fti):\n         """all registered marker interfaces of ftis behaviors\n@@ -220,7 +217,6 @@ def subtypes(self, fti):\n                 subtypes.append(behavior_registration.marker)\n         return tuple(subtypes)\n \n-    @synchronized(lock)\n     @volatile\n     def behavior_schema_interfaces(self, fti):\n         """behavior schema interfaces registered for the fti\n@@ -236,7 +232,6 @@ def behavior_schema_interfaces(self, fti):\n                 schemas.append(behavior_registration.interface)\n         return tuple(schemas)\n \n-    @synchronized(lock)\n     @volatile\n     def schema_interfaces(self, fti):\n         """all schema interfaces registered for the fti\n@@ -273,7 +268,6 @@ def invalidate(self, fti):\n             invalidate_cache(fti)\n             self.invalidations += 1\n \n-    @synchronized(lock)\n     @volatile\n     def modified(self, fti):\n         if fti:\n'

