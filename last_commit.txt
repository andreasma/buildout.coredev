Repository: mockup


Branch: refs/heads/master
Date: 2018-02-02T12:48:19+01:00
Author: Cillian de Roiste (cillianderoiste) <deroiste@syslab.com>
Commit: https://github.com/plone/mockup/commit/7e9fe093079bbce7f49da115fdbc5508175df4fd

Modal performance: don't reposition after loading each img

This reverts d06669e994f5a3:

   resize/position modal again once all images are loaded,
   plone/plone.app.toolbar#98

plone.app.toolbar is obsolete, and repositioning after loading each
image can get expensive. For example, if a modal contains a
DataGridField widget with reordering enabled and 20 rows, each row
contains 4 images, so the modal is repositioned 80 times.

The issue, plone/plone.app.toolbar#98, is no longer visible, so I'm
not sure if we run into other issues by removing this code.

Files changed:
M CHANGES.rst
M mockup/patterns/modal/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 8a3fc84b..9528922c 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- add items here
+- Modal performance: don't reposition after loading each img
+  [cillianderoiste]
 
 
 2.7.0 (2018-01-27)
diff --git a/mockup/patterns/modal/pattern.js b/mockup/patterns/modal/pattern.js
index 1db2ea43..565bdfac 100644
--- a/mockup/patterns/modal/pattern.js
+++ b/mockup/patterns/modal/pattern.js
@@ -845,9 +845,6 @@ define([
       self.$modal.addClass(self.options.templateOptions.classActiveName);
       registry.scan(self.$modal);
       self.positionModal();
-      $('img', self.$modal).load(function() {
-        self.positionModal();
-      });
       $(window.parent).on('resize.plone-modal.patterns', function() {
         self.positionModal();
       });


Repository: mockup


Branch: refs/heads/master
Date: 2018-02-07T10:08:57+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/mockup/commit/62e93a3ffba5a8f29512e256ab135d968d2c251e

Merge branch 'master' into modal-performance

Files changed:
M CHANGES.rst
M mockup/js/utils.js
M mockup/tests/utils-test.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 9528922c..49d8350b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,10 @@ Bug fixes:
 - Modal performance: don't reposition after loading each img
   [cillianderoiste]
 
+- Fixing problem with parseBodyTag when txt contains
+  non ASCII chars.
+  [mamico]
+
 
 2.7.0 (2018-01-27)
 ------------------
diff --git a/mockup/js/utils.js b/mockup/js/utils.js
index 4ed97510..785e52f3 100644
--- a/mockup/js/utils.js
+++ b/mockup/js/utils.js
@@ -303,7 +303,7 @@ define([
   };
 
   var parseBodyTag = function(txt) {
-    return $((/<body[^>]*>((.|[\n\r])*)<\/body>/im).exec(txt)[0]
+    return $((/<body[^>]*>[^]*<\/body>/im).exec(txt)[0]
       .replace('<body', '<div').replace('</body>', '</div>')).eq(0).html();
   };
 
diff --git a/mockup/tests/utils-test.js b/mockup/tests/utils-test.js
index 4784cb77..0c3ed761 100644
--- a/mockup/tests/utils-test.js
+++ b/mockup/tests/utils-test.js
@@ -70,6 +70,18 @@ define([
         expect(fn).to.throwException(TypeError);
       });
 
+      it('parses the body tag\'s content from a response with multiple lines', function() {
+        var response = '<body><h1>foo</h1>\n\t<p>bar\n</p></body>',
+            html = utils.parseBodyTag(response);
+        expect(html).to.equal('<h1>foo</h1>\n\t<p>bar\n</p>');
+      });
+
+      it('parses the body tag\'s content from a response with not ASCII chars (e.g. line separator)', function() {
+        var response = '<body><p>foo ' + String.fromCharCode(8232) + ' bar</p></body>',
+            html = utils.parseBodyTag(response);
+        expect(html).to.equal('<p>foo ' + String.fromCharCode(8232) + ' bar</p>');
+      });
+
     });
 
     describe('bool', function() {


Repository: mockup


Branch: refs/heads/master
Date: 2018-04-26T12:17:22+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/mockup/commit/b5d88a875a9d19ede6e3d53ed1974b3f4d474366

Merge pull request #829 from syslabcom/modal-performance

Modal performance: don't reposition after loading each img

Files changed:
M CHANGES.rst
M mockup/patterns/modal/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 0cf93a0c..3cfa4cae 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -41,6 +41,9 @@ Bug fixes:
 
 Bug fixes:
 
+- Modal performance: don't reposition after loading each img
+  [cillianderoiste]
+
 - Fixing problem with parseBodyTag when txt contains
   non ASCII chars.
   [mamico]
diff --git a/mockup/patterns/modal/pattern.js b/mockup/patterns/modal/pattern.js
index 1db2ea43..565bdfac 100644
--- a/mockup/patterns/modal/pattern.js
+++ b/mockup/patterns/modal/pattern.js
@@ -845,9 +845,6 @@ define([
       self.$modal.addClass(self.options.templateOptions.classActiveName);
       registry.scan(self.$modal);
       self.positionModal();
-      $('img', self.$modal).load(function() {
-        self.positionModal();
-      });
       $(window.parent).on('resize.plone-modal.patterns', function() {
         self.positionModal();
       });


