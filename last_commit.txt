Repository: plone.autoform


Branch: refs/heads/master
Date: 2018-10-03T13:37:00+02:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.autoform/commit/d37bf2a9485471ced0737f8c962f8cd20e24cb5e

Remove the dummy security manager on test tear down

Refs. https://github.com/plone/Products.CMFPlone/issues/2560

Files changed:
M CHANGES.rst
M plone/autoform/tests/test_utils.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 94707d7..2a6fe6d 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,7 +14,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Remove the dummy security manager on test tear down\n+  [ale-rt]\n \n \n 1.8.0 (2018-09-26)\ndiff --git a/plone/autoform/tests/test_utils.py b/plone/autoform/tests/test_utils.py\nindex 5121e24..5fd9df0 100644\n--- a/plone/autoform/tests/test_utils.py\n+++ b/plone/autoform/tests/test_utils.py\n@@ -41,6 +41,9 @@ def checkPermission(self, perm, context):\n         self.secman = DummySecurityManager()\n         setSecurityManager(self.secman)\n \n+    def tearDown(self):\n+        noSecurityManager()\n+\n     def test_processFields_permissionChecks_no_prefix(self):\n         form = Form(None, None)\n         form.groups = ()\n'

Repository: plone.autoform


Branch: refs/heads/master
Date: 2018-10-03T13:42:02+02:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.autoform/commit/d8e74cd682e4fbf2de2c729ff7f9c6e923e0fb1b

Instead of removing the security manager reset the previously existing one

Files changed:
M plone/autoform/tests/test_utils.py

b'diff --git a/plone/autoform/tests/test_utils.py b/plone/autoform/tests/test_utils.py\nindex 5fd9df0..c5538ad 100644\n--- a/plone/autoform/tests/test_utils.py\n+++ b/plone/autoform/tests/test_utils.py\n@@ -1,6 +1,6 @@\n # -*- coding: utf-8 -*-\n-from AccessControl.SecurityManagement import noSecurityManager\n from AccessControl.SecurityManagement import setSecurityManager\n+from AccessControl.SecurityManagement import getSecurityManager\n from plone.autoform.interfaces import WRITE_PERMISSIONS_KEY\n from plone.autoform.utils import processFields\n from plone.supermodel.interfaces import FIELDSETS_KEY\n@@ -38,11 +38,12 @@ def checkPermission(self, perm, context):\n                 self.checks.append(perm)\n                 return False\n \n+        self.oldsecman = getSecurityManager()\n         self.secman = DummySecurityManager()\n         setSecurityManager(self.secman)\n \n     def tearDown(self):\n-        noSecurityManager()\n+        setSecurityManager(self.oldsecman)\n \n     def test_processFields_permissionChecks_no_prefix(self):\n         form = Form(None, None)\n'

Repository: plone.autoform


Branch: refs/heads/master
Date: 2018-10-03T17:08:23+02:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.autoform/commit/6b39d44c66fc0ef168365275e54f81ef95592c5a

Merge pull request #36 from plone/python3

Remove the dummy security manager on test tear down

Files changed:
M CHANGES.rst
M plone/autoform/tests/test_utils.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 94707d7..2a6fe6d 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,7 +14,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Remove the dummy security manager on test tear down\n+  [ale-rt]\n \n \n 1.8.0 (2018-09-26)\ndiff --git a/plone/autoform/tests/test_utils.py b/plone/autoform/tests/test_utils.py\nindex 5121e24..c5538ad 100644\n--- a/plone/autoform/tests/test_utils.py\n+++ b/plone/autoform/tests/test_utils.py\n@@ -1,6 +1,6 @@\n # -*- coding: utf-8 -*-\n-from AccessControl.SecurityManagement import noSecurityManager\n from AccessControl.SecurityManagement import setSecurityManager\n+from AccessControl.SecurityManagement import getSecurityManager\n from plone.autoform.interfaces import WRITE_PERMISSIONS_KEY\n from plone.autoform.utils import processFields\n from plone.supermodel.interfaces import FIELDSETS_KEY\n@@ -38,9 +38,13 @@ def checkPermission(self, perm, context):\n                 self.checks.append(perm)\n                 return False\n \n+        self.oldsecman = getSecurityManager()\n         self.secman = DummySecurityManager()\n         setSecurityManager(self.secman)\n \n+    def tearDown(self):\n+        setSecurityManager(self.oldsecman)\n+\n     def test_processFields_permissionChecks_no_prefix(self):\n         form = Form(None, None)\n         form.groups = ()\n'

