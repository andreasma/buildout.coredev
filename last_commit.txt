Repository: plone.app.robotframework


Branch: refs/heads/1.2.x
Date: 2019-02-08T08:03:55+01:00
Author: Jonas Baumann (jone) <jone@jone.ch>
Commit: https://github.com/plone/plone.app.robotframework/commit/125a228b93338d2f8217751672029005acf461b3

Print ZServer and XMRPC URLs on server startup.

When starting the robot server, the ports for the ZServer and for the
XMLRPC-server can be configured to 0 in order to let the operating
system choose a random open port.

When the ports are randomly chosen, it is helpful that the server
prints out the chosen ports in form of URLs, so that a caller may read
the URLs in order to connect to the servers.

Files changed:
M CHANGES.rst
M src/plone/app/robotframework/server.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 0b3dc73..4ff35db 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -10,7 +10,8 @@ Breaking changes:\n \n New features:\n \n-- *add item here*\n+- Print the ZServer and XMLRPC URLs when starting up the server.\n+  [jone]\n \n Bug fixes:\n \ndiff --git a/src/plone/app/robotframework/server.py b/src/plone/app/robotframework/server.py\nindex 76dee39..c259c3a 100644\n--- a/src/plone/app/robotframework/server.py\n+++ b/src/plone/app/robotframework/server.py\n@@ -51,6 +51,8 @@ def start(zope_layer_dotted_name):\n     listener.register_function(zsl.zodb_setup, \'zodb_setup\')\n     listener.register_function(zsl.zodb_teardown, \'zodb_teardown\')\n \n+    print_urls(zsl.zope_layer, listener)\n+\n     try:\n         listener.serve_forever()\n     finally:\n@@ -62,6 +64,25 @@ def start(zope_layer_dotted_name):\n         print(READY("Zope 2 server stopped"))\n \n \n+def print_urls(zope_layer, xmlrpc_server):\n+    """Prints the urls with the chosen ports.\n+\n+    When using a port 0, the operating system chooses an open port.\n+    When doing that it is helpful that the URLs with the chosen ports are printed to stdout.\n+    """\n+\n+    for layer in zope_layer.baseResolutionOrder:\n+        # Walk up the testing layers and look for the first zserver in order to get the\n+        # actual server name and server port.\n+        zserver = getattr(layer, \'zserver\', None)\n+        if not zserver:\n+            continue\n+        print(\'ZSERVER: http://{}:{}\'.format(zserver.server_name, zserver.server_port))\n+        break\n+\n+    print(\'XMLRPC: http://{0}:{1}\'.format(*xmlrpc_server.server_address))\n+\n+\n def start_reload(zope_layer_dotted_name, reload_paths=(\'src\',),\n                  preload_layer_dotted_name=\'plone.app.testing.PLONE_FIXTURE\',\n                  extensions=None):\n'

Repository: plone.app.robotframework


Branch: refs/heads/1.2.x
Date: 2019-02-08T13:56:58+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.robotframework/commit/2cf03e39a7d3194b694a91101266f0dfc0bac708

Merge pull request #105 from plone/jone-print-urls-1.2.x

Print ZServer and XMRPC URLs on server startup (Plone 4).

Files changed:
M CHANGES.rst
M src/plone/app/robotframework/server.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 0b3dc73..4ff35db 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -10,7 +10,8 @@ Breaking changes:\n \n New features:\n \n-- *add item here*\n+- Print the ZServer and XMLRPC URLs when starting up the server.\n+  [jone]\n \n Bug fixes:\n \ndiff --git a/src/plone/app/robotframework/server.py b/src/plone/app/robotframework/server.py\nindex 76dee39..c259c3a 100644\n--- a/src/plone/app/robotframework/server.py\n+++ b/src/plone/app/robotframework/server.py\n@@ -51,6 +51,8 @@ def start(zope_layer_dotted_name):\n     listener.register_function(zsl.zodb_setup, \'zodb_setup\')\n     listener.register_function(zsl.zodb_teardown, \'zodb_teardown\')\n \n+    print_urls(zsl.zope_layer, listener)\n+\n     try:\n         listener.serve_forever()\n     finally:\n@@ -62,6 +64,25 @@ def start(zope_layer_dotted_name):\n         print(READY("Zope 2 server stopped"))\n \n \n+def print_urls(zope_layer, xmlrpc_server):\n+    """Prints the urls with the chosen ports.\n+\n+    When using a port 0, the operating system chooses an open port.\n+    When doing that it is helpful that the URLs with the chosen ports are printed to stdout.\n+    """\n+\n+    for layer in zope_layer.baseResolutionOrder:\n+        # Walk up the testing layers and look for the first zserver in order to get the\n+        # actual server name and server port.\n+        zserver = getattr(layer, \'zserver\', None)\n+        if not zserver:\n+            continue\n+        print(\'ZSERVER: http://{}:{}\'.format(zserver.server_name, zserver.server_port))\n+        break\n+\n+    print(\'XMLRPC: http://{0}:{1}\'.format(*xmlrpc_server.server_address))\n+\n+\n def start_reload(zope_layer_dotted_name, reload_paths=(\'src\',),\n                  preload_layer_dotted_name=\'plone.app.testing.PLONE_FIXTURE\',\n                  extensions=None):\n'

