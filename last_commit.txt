Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2018-07-06T13:29:06+02:00
Author: Markus Hilbert (iham) <markus.hilbert@iham.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/b5be1358f204c6188b8e7ab81df96a51bbe9d16b

Fixed false implemented Factories and Markers for ILeadImage and IRichText.

Files changed:
M CHANGES.rst
M buildout.cfg
M plone/app/contenttypes/behaviors/configure.zcml
M plone/app/contenttypes/behaviors/leadimage.py
M plone/app/contenttypes/behaviors/richtext.py
M plone/app/contenttypes/behaviors/viewlets.py
M plone/app/contenttypes/testing.py
M plone/app/contenttypes/tests/test_collection.py
M plone/app/contenttypes/tests/test_content_profile.py
M plone/app/contenttypes/tests/test_image.py
M plone/app/contenttypes/tests/test_link.py
M plone/app/contenttypes/tests/test_migration_custom.py
M plone/app/contenttypes/tests/test_migration_topic.py
M setup.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex c72c9219..09cc6e9d 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -6,15 +6,36 @@ Changelog\n \n Breaking changes:\n \n-- *add item here*\n+- ILeadImage and IRichText behaviors now have proper "Marker"-Interfaces.\n+  This might break code in other places as\n+    ILeadImage.providedBy(<obj>) -> False\n+    ILeadImageMarker.providedBy(<obj>) -> True\n+    IRichText(<obj>).providedBy(<obj>) -> False\n+    IRichTextMarker.providedBy(<obj>) -> True\n+  [iham]\n \n New features:\n \n-- *add item here*\n+- By using correct (Marker-)Interfaces for the ILeadImage and IRichText,\n+  the factories are now working properly and can be reconfigured\n+  wherever you might need them. ZCA FTW!\n+  [iham]\n \n Bug fixes:\n \n-- *add item here*\n+- Fixed false implemented Factories and Markers for ILeadImage and IRichText.\n+  see `issue 457 <https://github.com/plone/plone.app.contenttypes/issues/476>`\n+  [iham]\n+\n+- Fixed Tests for collection and migration.\n+  see `issue <https://github.com/plone/plone.app.contenttypes/issues/477>`\n+  [iham]\n+\n+- Pinned pydocstyle as it broke buildout.\n+  [iham]\n+\n+- pep8 cleanup.\n+  [iham]\n \n \n 1.4.11 (2018-06-18)\ndiff --git a/buildout.cfg b/buildout.cfg\nindex 5027b31a..5ee40fa5 100644\n--- a/buildout.cfg\n+++ b/buildout.cfg\n@@ -2,7 +2,7 @@\n extends = http://dist.plone.org/release/5.1-latest/versions.cfg\n extensions = mr.developer\n package-name = plone.app.contenttypes\n-package-extras = [test]\n+package-extras = [test, archetypes]\n parts =\n     instance\n     test\n@@ -91,3 +91,4 @@ robotframework-selenium2library = 1.6.0\n robotsuite = 1.6.1\n selenium = 2.46.0\n coverage = 3.7.1\n+pycodestyle = 2.3.1\ndiff --git a/plone/app/contenttypes/behaviors/configure.zcml b/plone/app/contenttypes/behaviors/configure.zcml\nindex a19e2774..db083f41 100644\n--- a/plone/app/contenttypes/behaviors/configure.zcml\n+++ b/plone/app/contenttypes/behaviors/configure.zcml\n@@ -14,12 +14,12 @@\n     provides=".leadimage.ILeadImage"\n     factory=".leadimage.LeadImage"\n     for="plone.dexterity.interfaces.IDexterityContent"\n-    marker=".leadimage.ILeadImage"\n+    marker=".leadimage.ILeadImageMarker"\n     />\n \n   <browser:viewlet\n     name="contentleadimage"\n-    for=".leadimage.ILeadImage"\n+    for=".leadimage.ILeadImageMarker"\n     view="plone.app.layout.globals.interfaces.IViewView"\n     class=".viewlets.LeadImageViewlet"\n     manager="plone.app.layout.viewlets.interfaces.IAboveContentTitle"\n@@ -52,7 +52,7 @@\n     provides=".richtext.IRichText"\n     factory=".richtext.RichText"\n     for="plone.dexterity.interfaces.IDexterityContent"\n-    marker=".richtext.IRichText"\n+    marker=".richtext.IRichTextMarker"\n     />\n \n   <plone:behavior\n@@ -64,7 +64,7 @@\n \n   <browser:page\n     name="getText"\n-    for=".richtext.IRichText"\n+    for=".richtext.IRichTextMarker"\n     class=".richtext.WidgetView"\n     permission="zope2.View"\n     template="richtext_gettext.pt"\ndiff --git a/plone/app/contenttypes/behaviors/leadimage.py b/plone/app/contenttypes/behaviors/leadimage.py\nindex c11c0070..aa0ec68c 100644\n--- a/plone/app/contenttypes/behaviors/leadimage.py\n+++ b/plone/app/contenttypes/behaviors/leadimage.py\n@@ -8,6 +8,11 @@\n from zope.component import adapter\n from zope.interface import implementer\n from zope.interface import provider\n+from zope.interface import Interface\n+\n+\n+class ILeadImageMarker(Interface):\n+    pass\n \n \n @provider(IFormFieldProvider)\n@@ -32,3 +37,19 @@ class LeadImage(object):\n \n     def __init__(self, context):\n         self.context = context\n+\n+    @property\n+    def image(self):\n+        return self.context.image\n+\n+    @image.setter\n+    def image(self, value):\n+        self.context.image = value\n+\n+    @property\n+    def image_caption(self):\n+        return self.context.image_caption\n+\n+    @image_caption.setter\n+    def image_caption(self, value):\n+        self.context.image_caption = value\ndiff --git a/plone/app/contenttypes/behaviors/richtext.py b/plone/app/contenttypes/behaviors/richtext.py\nindex 2332cbf4..bb2fcebf 100644\n--- a/plone/app/contenttypes/behaviors/richtext.py\n+++ b/plone/app/contenttypes/behaviors/richtext.py\n@@ -9,9 +9,14 @@\n from plone.supermodel import model\n from zope.component import adapter\n from zope.interface import implementer\n+from zope.interface import Interface\n from zope.interface import provider\n \n \n+class IRichTextMarker(Interface):\n+    pass\n+\n+\n @provider(IFormFieldProvider)\n class IRichText(model.Schema):\n \n@@ -31,6 +36,14 @@ class RichText(object):\n     def __init__(self, context):\n         self.context = context\n \n+    @property\n+    def text(self):\n+        return self.context.text\n+\n+    @text.setter\n+    def text(self, value):\n+        self.context.text = value\n+\n \n class WidgetView(WidgetsView):\n     schema = IRichText\ndiff --git a/plone/app/contenttypes/behaviors/viewlets.py b/plone/app/contenttypes/behaviors/viewlets.py\nindex acc66efc..a6bf04d0 100644\n--- a/plone/app/contenttypes/behaviors/viewlets.py\n+++ b/plone/app/contenttypes/behaviors/viewlets.py\n@@ -1,5 +1,5 @@\n # -*- coding: utf-8 -*-\n-from plone.app.contenttypes.behaviors.leadimage import ILeadImage\n+from plone.app.contenttypes.behaviors.leadimage import ILeadImageMarker\n from plone.app.layout.viewlets import ViewletBase\n \n \n@@ -7,5 +7,5 @@ class LeadImageViewlet(ViewletBase):\n     """ A simple viewlet which renders leadimage """\n \n     def update(self):\n-        self.context = ILeadImage(self.context)\n+        self.context = ILeadImageMarker(self.context)\n         self.available = True if self.context.image else False\ndiff --git a/plone/app/contenttypes/testing.py b/plone/app/contenttypes/testing.py\nindex e78c1683..6d4966c7 100644\n--- a/plone/app/contenttypes/testing.py\n+++ b/plone/app/contenttypes/testing.py\n@@ -15,7 +15,6 @@\n from zope.interface import alsoProvides\n \n import pkg_resources\n-import unittest\n \n \n def set_browserlayer(request):\n@@ -66,11 +65,11 @@ def tearDownPloneSite(self, portal):\n \n \n try:\n+    pkg_resources.get_distribution(\'Products.ATContentTypes\')\n     import Products.ATContentTypes\n-except ImportError:\n-    TEST_MIGRATION = False\n-else:\n     TEST_MIGRATION = True\n+except pkg_resources.DistributionNotFound:\n+    TEST_MIGRATION = False\n \n \n class PloneAppContenttypesMigration(PloneSandboxLayer):\n@@ -85,7 +84,6 @@ def setUpZope(self, app, configurationContext):\n             return\n \n         # prepare installing Products.ATContentTypes\n-        import Products.ATContentTypes\n         self.loadZCML(package=Products.ATContentTypes)\n         z2.installProduct(app, \'Products.Archetypes\')\n         z2.installProduct(app, \'Products.ATContentTypes\')\ndiff --git a/plone/app/contenttypes/tests/test_collection.py b/plone/app/contenttypes/tests/test_collection.py\nindex c91dce8f..da8e6162 100644\n--- a/plone/app/contenttypes/tests/test_collection.py\n+++ b/plone/app/contenttypes/tests/test_collection.py\n@@ -396,11 +396,19 @@ def test_respect_navigation_root(self):\n                               title=\'Collection 1\')\n         collection1 = folder1[\'collection1\']\n         wrapped = ICollection_behavior(collection1)\n-        wrapped.query = [{\n-            \'i\': \'portal_type\',\n-            \'o\': \'plone.app.querystring.operation.string.is\',\n-            \'v\': \'Document\',\n-        }]\n+        wrapped.query = [\n+            {\n+                \'i\': \'portal_type\',\n+                \'o\': \'plone.app.querystring.operation.string.is\',\n+                \'v\': \'Document\',\n+            },\n+            # use a "/" path and navroot works fine!\n+            {\n+                \'i\': \'path\',\n+                \'o\': \'plone.app.querystring.operation.string.path\',\n+                \'v\': \'/\',\n+            },\n+        ]\n \n         # Check if only the item inside folder1 is returned, since it\'s a\n         # navigation root.\ndiff --git a/plone/app/contenttypes/tests/test_content_profile.py b/plone/app/contenttypes/tests/test_content_profile.py\nindex 08d8e116..befdee18 100644\n--- a/plone/app/contenttypes/tests/test_content_profile.py\n+++ b/plone/app/contenttypes/tests/test_content_profile.py\n@@ -93,7 +93,7 @@ def test_Members_portlets(self):\n         self.assertTrue(assignable_manager.getBlacklistStatus(\'context\'))\n         self.assertTrue(assignable_manager.getBlacklistStatus(\'group\'))\n         self.assertTrue(assignable_manager.getBlacklistStatus(\'content_type\'))\n-        \n+\n     def test_Members_is_private(self):\n         # Is the content object public?\n         obj = self.portal[\'Members\']\ndiff --git a/plone/app/contenttypes/tests/test_image.py b/plone/app/contenttypes/tests/test_image.py\nindex eb1fcbd9..e86bbe3b 100644\n--- a/plone/app/contenttypes/tests/test_image.py\n+++ b/plone/app/contenttypes/tests/test_image.py\n@@ -112,9 +112,10 @@ def test_svg_image(self):\n         scale = self.image.restrictedTraverse(\'@@images\')\n         self.assertRegexpMatches(\n             scale.scale(\'image\', scale=\'large\').tag(),\n-            r\'<img src="http://nohost/plone/image/@@images/[a-z0-9--]*.svg" alt="My Image" title="My Image" height="768" width="768" />\'\n+            r\'<img src="http://nohost/plone/image/@@images/[a-z0-9--]*.svg" alt="My Image" title="My Image" height="768" width="768" />\'  # noqa E501\n         )\n \n+\n class ImageFunctionalTest(unittest.TestCase):\n \n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\ndiff --git a/plone/app/contenttypes/tests/test_link.py b/plone/app/contenttypes/tests/test_link.py\nindex 4cf569fb..69e7324a 100644\n--- a/plone/app/contenttypes/tests/test_link.py\n+++ b/plone/app/contenttypes/tests/test_link.py\n@@ -173,7 +173,9 @@ def test_link_redirect_view_path_with_variable_and_parameters(self):\n         # As anonymous: redirect\n         logout()\n         self.assertTrue(view())\n-        self._assert_redirect(\'http://nohost/plone/@@search?SearchableText=Plone\')\n+        self._assert_redirect(\n+            \'http://nohost/plone/@@search?SearchableText=Plone\',\n+        )\n \n     def test_mailto_type(self):\n         self.link.remoteUrl = \'mailto:stress@test.us\'\ndiff --git a/plone/app/contenttypes/tests/test_migration_custom.py b/plone/app/contenttypes/tests/test_migration_custom.py\nindex 0e9a93f6..f9b3a68f 100644\n--- a/plone/app/contenttypes/tests/test_migration_custom.py\n+++ b/plone/app/contenttypes/tests/test_migration_custom.py\n@@ -7,9 +7,9 @@\n \n if TEST_MIGRATION:\n     from datetime import datetime\n-    from plone.app.contenttypes.migration.field_migrators import migrate_filefield\n-    from plone.app.contenttypes.migration.field_migrators import migrate_imagefield\n-    from plone.app.contenttypes.migration.field_migrators import migrate_simplefield  # noqa\n+    from plone.app.contenttypes.migration.field_migrators import migrate_filefield  # noqa E501\n+    from plone.app.contenttypes.migration.field_migrators import migrate_imagefield  # noqa E501\n+    from plone.app.contenttypes.migration.field_migrators import migrate_simplefield  # noqa E501\n     from plone.app.contenttypes.migration.utils import installTypeIfNeeded\n     from plone.app.testing import applyProfile\n     from plone.app.testing import login\ndiff --git a/plone/app/contenttypes/tests/test_migration_topic.py b/plone/app/contenttypes/tests/test_migration_topic.py\nindex c7ac2c8a..44dcb513 100644\n--- a/plone/app/contenttypes/tests/test_migration_topic.py\n+++ b/plone/app/contenttypes/tests/test_migration_topic.py\n@@ -16,7 +16,6 @@\n     from zope.component import queryUtility\n     from zope.interface import implementer\n \n-\n     @implementer(ICollection)\n     class FolderishCollection(Container):\n         """Test subclass for folderish ``Collections``.\ndiff --git a/setup.py b/setup.py\nindex 13198d80..df00e59c 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -11,10 +11,12 @@\n def read(*rnames):\n     return open(os.path.join(os.path.dirname(__file__), *rnames)).read()\n \n+\n long_description = \\\n     read(\'README.rst\') + \'\\n\\n\' + \\\n     read(\'CHANGES.rst\')\n \n+\n setup(name=\'plone.app.contenttypes\',\n       version=version,\n       description="Default content types for Plone based on Dexterity",\n'

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2018-07-06T15:27:41+02:00
Author: Markus Hilbert (iham) <markus.hilbert@iham.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/72fe89cc9358be38d78a3d0c1d525fb668e23e47

Fixed false implemented Factories and Markers for ILeadImage and IRichText.

Files changed:
M CHANGES.rst
M buildout.cfg
M plone/app/contenttypes/behaviors/configure.zcml
M plone/app/contenttypes/behaviors/leadimage.py
M plone/app/contenttypes/behaviors/richtext.py
M plone/app/contenttypes/behaviors/viewlets.py
M plone/app/contenttypes/testing.py
M plone/app/contenttypes/tests/test_collection.py
M plone/app/contenttypes/tests/test_content_profile.py
M plone/app/contenttypes/tests/test_image.py
M plone/app/contenttypes/tests/test_link.py
M plone/app/contenttypes/tests/test_migration_custom.py
M plone/app/contenttypes/tests/test_migration_topic.py
M setup.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex c72c9219..09cc6e9d 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -6,15 +6,36 @@ Changelog\n \n Breaking changes:\n \n-- *add item here*\n+- ILeadImage and IRichText behaviors now have proper "Marker"-Interfaces.\n+  This might break code in other places as\n+    ILeadImage.providedBy(<obj>) -> False\n+    ILeadImageMarker.providedBy(<obj>) -> True\n+    IRichText(<obj>).providedBy(<obj>) -> False\n+    IRichTextMarker.providedBy(<obj>) -> True\n+  [iham]\n \n New features:\n \n-- *add item here*\n+- By using correct (Marker-)Interfaces for the ILeadImage and IRichText,\n+  the factories are now working properly and can be reconfigured\n+  wherever you might need them. ZCA FTW!\n+  [iham]\n \n Bug fixes:\n \n-- *add item here*\n+- Fixed false implemented Factories and Markers for ILeadImage and IRichText.\n+  see `issue 457 <https://github.com/plone/plone.app.contenttypes/issues/476>`\n+  [iham]\n+\n+- Fixed Tests for collection and migration.\n+  see `issue <https://github.com/plone/plone.app.contenttypes/issues/477>`\n+  [iham]\n+\n+- Pinned pydocstyle as it broke buildout.\n+  [iham]\n+\n+- pep8 cleanup.\n+  [iham]\n \n \n 1.4.11 (2018-06-18)\ndiff --git a/buildout.cfg b/buildout.cfg\nindex 5027b31a..5ee40fa5 100644\n--- a/buildout.cfg\n+++ b/buildout.cfg\n@@ -2,7 +2,7 @@\n extends = http://dist.plone.org/release/5.1-latest/versions.cfg\n extensions = mr.developer\n package-name = plone.app.contenttypes\n-package-extras = [test]\n+package-extras = [test, archetypes]\n parts =\n     instance\n     test\n@@ -91,3 +91,4 @@ robotframework-selenium2library = 1.6.0\n robotsuite = 1.6.1\n selenium = 2.46.0\n coverage = 3.7.1\n+pycodestyle = 2.3.1\ndiff --git a/plone/app/contenttypes/behaviors/configure.zcml b/plone/app/contenttypes/behaviors/configure.zcml\nindex a19e2774..db083f41 100644\n--- a/plone/app/contenttypes/behaviors/configure.zcml\n+++ b/plone/app/contenttypes/behaviors/configure.zcml\n@@ -14,12 +14,12 @@\n     provides=".leadimage.ILeadImage"\n     factory=".leadimage.LeadImage"\n     for="plone.dexterity.interfaces.IDexterityContent"\n-    marker=".leadimage.ILeadImage"\n+    marker=".leadimage.ILeadImageMarker"\n     />\n \n   <browser:viewlet\n     name="contentleadimage"\n-    for=".leadimage.ILeadImage"\n+    for=".leadimage.ILeadImageMarker"\n     view="plone.app.layout.globals.interfaces.IViewView"\n     class=".viewlets.LeadImageViewlet"\n     manager="plone.app.layout.viewlets.interfaces.IAboveContentTitle"\n@@ -52,7 +52,7 @@\n     provides=".richtext.IRichText"\n     factory=".richtext.RichText"\n     for="plone.dexterity.interfaces.IDexterityContent"\n-    marker=".richtext.IRichText"\n+    marker=".richtext.IRichTextMarker"\n     />\n \n   <plone:behavior\n@@ -64,7 +64,7 @@\n \n   <browser:page\n     name="getText"\n-    for=".richtext.IRichText"\n+    for=".richtext.IRichTextMarker"\n     class=".richtext.WidgetView"\n     permission="zope2.View"\n     template="richtext_gettext.pt"\ndiff --git a/plone/app/contenttypes/behaviors/leadimage.py b/plone/app/contenttypes/behaviors/leadimage.py\nindex c11c0070..aa0ec68c 100644\n--- a/plone/app/contenttypes/behaviors/leadimage.py\n+++ b/plone/app/contenttypes/behaviors/leadimage.py\n@@ -8,6 +8,11 @@\n from zope.component import adapter\n from zope.interface import implementer\n from zope.interface import provider\n+from zope.interface import Interface\n+\n+\n+class ILeadImageMarker(Interface):\n+    pass\n \n \n @provider(IFormFieldProvider)\n@@ -32,3 +37,19 @@ class LeadImage(object):\n \n     def __init__(self, context):\n         self.context = context\n+\n+    @property\n+    def image(self):\n+        return self.context.image\n+\n+    @image.setter\n+    def image(self, value):\n+        self.context.image = value\n+\n+    @property\n+    def image_caption(self):\n+        return self.context.image_caption\n+\n+    @image_caption.setter\n+    def image_caption(self, value):\n+        self.context.image_caption = value\ndiff --git a/plone/app/contenttypes/behaviors/richtext.py b/plone/app/contenttypes/behaviors/richtext.py\nindex 2332cbf4..bb2fcebf 100644\n--- a/plone/app/contenttypes/behaviors/richtext.py\n+++ b/plone/app/contenttypes/behaviors/richtext.py\n@@ -9,9 +9,14 @@\n from plone.supermodel import model\n from zope.component import adapter\n from zope.interface import implementer\n+from zope.interface import Interface\n from zope.interface import provider\n \n \n+class IRichTextMarker(Interface):\n+    pass\n+\n+\n @provider(IFormFieldProvider)\n class IRichText(model.Schema):\n \n@@ -31,6 +36,14 @@ class RichText(object):\n     def __init__(self, context):\n         self.context = context\n \n+    @property\n+    def text(self):\n+        return self.context.text\n+\n+    @text.setter\n+    def text(self, value):\n+        self.context.text = value\n+\n \n class WidgetView(WidgetsView):\n     schema = IRichText\ndiff --git a/plone/app/contenttypes/behaviors/viewlets.py b/plone/app/contenttypes/behaviors/viewlets.py\nindex acc66efc..a6bf04d0 100644\n--- a/plone/app/contenttypes/behaviors/viewlets.py\n+++ b/plone/app/contenttypes/behaviors/viewlets.py\n@@ -1,5 +1,5 @@\n # -*- coding: utf-8 -*-\n-from plone.app.contenttypes.behaviors.leadimage import ILeadImage\n+from plone.app.contenttypes.behaviors.leadimage import ILeadImageMarker\n from plone.app.layout.viewlets import ViewletBase\n \n \n@@ -7,5 +7,5 @@ class LeadImageViewlet(ViewletBase):\n     """ A simple viewlet which renders leadimage """\n \n     def update(self):\n-        self.context = ILeadImage(self.context)\n+        self.context = ILeadImageMarker(self.context)\n         self.available = True if self.context.image else False\ndiff --git a/plone/app/contenttypes/testing.py b/plone/app/contenttypes/testing.py\nindex e78c1683..6d4966c7 100644\n--- a/plone/app/contenttypes/testing.py\n+++ b/plone/app/contenttypes/testing.py\n@@ -15,7 +15,6 @@\n from zope.interface import alsoProvides\n \n import pkg_resources\n-import unittest\n \n \n def set_browserlayer(request):\n@@ -66,11 +65,11 @@ def tearDownPloneSite(self, portal):\n \n \n try:\n+    pkg_resources.get_distribution(\'Products.ATContentTypes\')\n     import Products.ATContentTypes\n-except ImportError:\n-    TEST_MIGRATION = False\n-else:\n     TEST_MIGRATION = True\n+except pkg_resources.DistributionNotFound:\n+    TEST_MIGRATION = False\n \n \n class PloneAppContenttypesMigration(PloneSandboxLayer):\n@@ -85,7 +84,6 @@ def setUpZope(self, app, configurationContext):\n             return\n \n         # prepare installing Products.ATContentTypes\n-        import Products.ATContentTypes\n         self.loadZCML(package=Products.ATContentTypes)\n         z2.installProduct(app, \'Products.Archetypes\')\n         z2.installProduct(app, \'Products.ATContentTypes\')\ndiff --git a/plone/app/contenttypes/tests/test_collection.py b/plone/app/contenttypes/tests/test_collection.py\nindex c91dce8f..da8e6162 100644\n--- a/plone/app/contenttypes/tests/test_collection.py\n+++ b/plone/app/contenttypes/tests/test_collection.py\n@@ -396,11 +396,19 @@ def test_respect_navigation_root(self):\n                               title=\'Collection 1\')\n         collection1 = folder1[\'collection1\']\n         wrapped = ICollection_behavior(collection1)\n-        wrapped.query = [{\n-            \'i\': \'portal_type\',\n-            \'o\': \'plone.app.querystring.operation.string.is\',\n-            \'v\': \'Document\',\n-        }]\n+        wrapped.query = [\n+            {\n+                \'i\': \'portal_type\',\n+                \'o\': \'plone.app.querystring.operation.string.is\',\n+                \'v\': \'Document\',\n+            },\n+            # use a "/" path and navroot works fine!\n+            {\n+                \'i\': \'path\',\n+                \'o\': \'plone.app.querystring.operation.string.path\',\n+                \'v\': \'/\',\n+            },\n+        ]\n \n         # Check if only the item inside folder1 is returned, since it\'s a\n         # navigation root.\ndiff --git a/plone/app/contenttypes/tests/test_content_profile.py b/plone/app/contenttypes/tests/test_content_profile.py\nindex 08d8e116..befdee18 100644\n--- a/plone/app/contenttypes/tests/test_content_profile.py\n+++ b/plone/app/contenttypes/tests/test_content_profile.py\n@@ -93,7 +93,7 @@ def test_Members_portlets(self):\n         self.assertTrue(assignable_manager.getBlacklistStatus(\'context\'))\n         self.assertTrue(assignable_manager.getBlacklistStatus(\'group\'))\n         self.assertTrue(assignable_manager.getBlacklistStatus(\'content_type\'))\n-        \n+\n     def test_Members_is_private(self):\n         # Is the content object public?\n         obj = self.portal[\'Members\']\ndiff --git a/plone/app/contenttypes/tests/test_image.py b/plone/app/contenttypes/tests/test_image.py\nindex eb1fcbd9..e86bbe3b 100644\n--- a/plone/app/contenttypes/tests/test_image.py\n+++ b/plone/app/contenttypes/tests/test_image.py\n@@ -112,9 +112,10 @@ def test_svg_image(self):\n         scale = self.image.restrictedTraverse(\'@@images\')\n         self.assertRegexpMatches(\n             scale.scale(\'image\', scale=\'large\').tag(),\n-            r\'<img src="http://nohost/plone/image/@@images/[a-z0-9--]*.svg" alt="My Image" title="My Image" height="768" width="768" />\'\n+            r\'<img src="http://nohost/plone/image/@@images/[a-z0-9--]*.svg" alt="My Image" title="My Image" height="768" width="768" />\'  # noqa E501\n         )\n \n+\n class ImageFunctionalTest(unittest.TestCase):\n \n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\ndiff --git a/plone/app/contenttypes/tests/test_link.py b/plone/app/contenttypes/tests/test_link.py\nindex 4cf569fb..69e7324a 100644\n--- a/plone/app/contenttypes/tests/test_link.py\n+++ b/plone/app/contenttypes/tests/test_link.py\n@@ -173,7 +173,9 @@ def test_link_redirect_view_path_with_variable_and_parameters(self):\n         # As anonymous: redirect\n         logout()\n         self.assertTrue(view())\n-        self._assert_redirect(\'http://nohost/plone/@@search?SearchableText=Plone\')\n+        self._assert_redirect(\n+            \'http://nohost/plone/@@search?SearchableText=Plone\',\n+        )\n \n     def test_mailto_type(self):\n         self.link.remoteUrl = \'mailto:stress@test.us\'\ndiff --git a/plone/app/contenttypes/tests/test_migration_custom.py b/plone/app/contenttypes/tests/test_migration_custom.py\nindex 0e9a93f6..f9b3a68f 100644\n--- a/plone/app/contenttypes/tests/test_migration_custom.py\n+++ b/plone/app/contenttypes/tests/test_migration_custom.py\n@@ -7,9 +7,9 @@\n \n if TEST_MIGRATION:\n     from datetime import datetime\n-    from plone.app.contenttypes.migration.field_migrators import migrate_filefield\n-    from plone.app.contenttypes.migration.field_migrators import migrate_imagefield\n-    from plone.app.contenttypes.migration.field_migrators import migrate_simplefield  # noqa\n+    from plone.app.contenttypes.migration.field_migrators import migrate_filefield  # noqa E501\n+    from plone.app.contenttypes.migration.field_migrators import migrate_imagefield  # noqa E501\n+    from plone.app.contenttypes.migration.field_migrators import migrate_simplefield  # noqa E501\n     from plone.app.contenttypes.migration.utils import installTypeIfNeeded\n     from plone.app.testing import applyProfile\n     from plone.app.testing import login\ndiff --git a/plone/app/contenttypes/tests/test_migration_topic.py b/plone/app/contenttypes/tests/test_migration_topic.py\nindex c7ac2c8a..44dcb513 100644\n--- a/plone/app/contenttypes/tests/test_migration_topic.py\n+++ b/plone/app/contenttypes/tests/test_migration_topic.py\n@@ -16,7 +16,6 @@\n     from zope.component import queryUtility\n     from zope.interface import implementer\n \n-\n     @implementer(ICollection)\n     class FolderishCollection(Container):\n         """Test subclass for folderish ``Collections``.\ndiff --git a/setup.py b/setup.py\nindex 13198d80..df00e59c 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -11,10 +11,12 @@\n def read(*rnames):\n     return open(os.path.join(os.path.dirname(__file__), *rnames)).read()\n \n+\n long_description = \\\n     read(\'README.rst\') + \'\\n\\n\' + \\\n     read(\'CHANGES.rst\')\n \n+\n setup(name=\'plone.app.contenttypes\',\n       version=version,\n       description="Default content types for Plone based on Dexterity",\n'

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2018-07-09T14:03:05+02:00
Author: Markus Hilbert (iham) <markus.hilbert@iham.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/de44954838b637a01473e0bc6271bc6e34ea8635

ILeadImage and IRichText behaviors now have proper "Marker"-Interfaces.

Files changed:
M CHANGES.rst
M plone/app/contenttypes/behaviors/configure.zcml
M plone/app/contenttypes/behaviors/leadimage.py
M plone/app/contenttypes/behaviors/richtext.py
M plone/app/contenttypes/behaviors/viewlets.py
M plone/app/contenttypes/profiles/default/types/Collection.xml
M plone/app/contenttypes/profiles/default/types/Document.xml
M plone/app/contenttypes/profiles/default/types/Event.xml
M plone/app/contenttypes/profiles/default/types/News_Item.xml
M plone/app/contenttypes/tests/test_behaviors_leadimage.py
M plone/app/contenttypes/tests/test_behaviors_richtext.py
M plone/app/contenttypes/tests/test_collection.py
M plone/app/contenttypes/tests/test_document.py
M plone/app/contenttypes/tests/test_event.py
M plone/app/contenttypes/tests/test_news_item.py
M plone/app/contenttypes/upgrades.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 09cc6e9d..3d683f9a 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -7,11 +7,16 @@ Changelog\n Breaking changes:\n \n - ILeadImage and IRichText behaviors now have proper "Marker"-Interfaces.\n-  This might break code in other places as\n-    ILeadImage.providedBy(<obj>) -> False\n-    ILeadImageMarker.providedBy(<obj>) -> True\n-    IRichText(<obj>).providedBy(<obj>) -> False\n-    IRichTextMarker.providedBy(<obj>) -> True\n+  As this was only possible by renaming the schema adapter to *Behavior to\n+  not break with implementations inside the collective, the FTI-behavior-definition\n+  has changed\n+    \'plone.app.contenttypes.behaviors.leadimage.ILeadImage\'\n+    becomes\n+    \'plone.app.contenttypes.behaviors.leadimage.ILeadImageBehavior\'\n+    and\n+    \'plone.app.contenttypes.behaviors.richtext.IRichText\'\n+    becomes\n+    \'plone.app.contenttypes.behaviors.richtext.IRichTextBehavior\'\n   [iham]\n \n New features:\ndiff --git a/plone/app/contenttypes/behaviors/configure.zcml b/plone/app/contenttypes/behaviors/configure.zcml\nindex db083f41..69cb53fb 100644\n--- a/plone/app/contenttypes/behaviors/configure.zcml\n+++ b/plone/app/contenttypes/behaviors/configure.zcml\n@@ -11,15 +11,15 @@\n     name="plone.leadimage"\n     title="Lead Image"\n     description="Adds image and image caption fields"\n-    provides=".leadimage.ILeadImage"\n+    provides=".leadimage.ILeadImageBehavior"\n     factory=".leadimage.LeadImage"\n     for="plone.dexterity.interfaces.IDexterityContent"\n-    marker=".leadimage.ILeadImageMarker"\n+    marker=".leadimage.ILeadImage"\n     />\n \n   <browser:viewlet\n     name="contentleadimage"\n-    for=".leadimage.ILeadImageMarker"\n+    for=".leadimage.ILeadImage"\n     view="plone.app.layout.globals.interfaces.IViewView"\n     class=".viewlets.LeadImageViewlet"\n     manager="plone.app.layout.viewlets.interfaces.IAboveContentTitle"\n@@ -49,10 +49,10 @@\n     name="plone.richtext"\n     title="RichText"\n     description="Adds richtext behavior"\n-    provides=".richtext.IRichText"\n+    provides=".richtext.IRichTextBehavior"\n     factory=".richtext.RichText"\n     for="plone.dexterity.interfaces.IDexterityContent"\n-    marker=".richtext.IRichTextMarker"\n+    marker=".richtext.IRichText"\n     />\n \n   <plone:behavior\n@@ -64,7 +64,7 @@\n \n   <browser:page\n     name="getText"\n-    for=".richtext.IRichTextMarker"\n+    for=".richtext.IRichText"\n     class=".richtext.WidgetView"\n     permission="zope2.View"\n     template="richtext_gettext.pt"\ndiff --git a/plone/app/contenttypes/behaviors/leadimage.py b/plone/app/contenttypes/behaviors/leadimage.py\nindex aa0ec68c..f7bebbdd 100644\n--- a/plone/app/contenttypes/behaviors/leadimage.py\n+++ b/plone/app/contenttypes/behaviors/leadimage.py\n@@ -11,12 +11,12 @@\n from zope.interface import Interface\n \n \n-class ILeadImageMarker(Interface):\n+class ILeadImage(Interface):\n     pass\n \n \n @provider(IFormFieldProvider)\n-class ILeadImage(model.Schema):\n+class ILeadImageBehavior(model.Schema):\n \n     image = namedfile.NamedBlobImage(\n         title=_(u\'label_leadimage\', default=u\'Lead Image\'),\n@@ -31,7 +31,7 @@ class ILeadImage(model.Schema):\n     )\n \n \n-@implementer(ILeadImage)\n+@implementer(ILeadImageBehavior)\n @adapter(IDexterityContent)\n class LeadImage(object):\n \ndiff --git a/plone/app/contenttypes/behaviors/richtext.py b/plone/app/contenttypes/behaviors/richtext.py\nindex bb2fcebf..c89857d5 100644\n--- a/plone/app/contenttypes/behaviors/richtext.py\n+++ b/plone/app/contenttypes/behaviors/richtext.py\n@@ -13,12 +13,12 @@\n from zope.interface import provider\n \n \n-class IRichTextMarker(Interface):\n+class IRichText(Interface):\n     pass\n \n \n @provider(IFormFieldProvider)\n-class IRichText(model.Schema):\n+class IRichTextBehavior(model.Schema):\n \n     text = RichTextField(\n         title=_(u\'Text\'),\n@@ -29,7 +29,7 @@ class IRichText(model.Schema):\n     model.primary(\'text\')\n \n \n-@implementer(IRichText)\n+@implementer(IRichTextBehavior)\n @adapter(IDexterityContent)\n class RichText(object):\n \ndiff --git a/plone/app/contenttypes/behaviors/viewlets.py b/plone/app/contenttypes/behaviors/viewlets.py\nindex a6bf04d0..acc66efc 100644\n--- a/plone/app/contenttypes/behaviors/viewlets.py\n+++ b/plone/app/contenttypes/behaviors/viewlets.py\n@@ -1,5 +1,5 @@\n # -*- coding: utf-8 -*-\n-from plone.app.contenttypes.behaviors.leadimage import ILeadImageMarker\n+from plone.app.contenttypes.behaviors.leadimage import ILeadImage\n from plone.app.layout.viewlets import ViewletBase\n \n \n@@ -7,5 +7,5 @@ class LeadImageViewlet(ViewletBase):\n     """ A simple viewlet which renders leadimage """\n \n     def update(self):\n-        self.context = ILeadImageMarker(self.context)\n+        self.context = ILeadImage(self.context)\n         self.available = True if self.context.image else False\ndiff --git a/plone/app/contenttypes/profiles/default/types/Collection.xml b/plone/app/contenttypes/profiles/default/types/Collection.xml\nindex 384d3e5f..dd4ddea0 100644\n--- a/plone/app/contenttypes/profiles/default/types/Collection.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Collection.xml\n@@ -38,7 +38,7 @@\n     <element value="plone.app.dexterity.behaviors.id.IShortName"/>\n     <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n     <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n+    <element value="plone.app.contenttypes.behaviors.richtext.IRichTextBehavior"/>\n     <element value="plone.app.relationfield.behavior.IRelatedItems"/>\n     <element value="plone.app.lockingbehavior.behaviors.ILocking" />\n   </property>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Document.xml b/plone/app/contenttypes/profiles/default/types/Document.xml\nindex 29c558d4..e23152da 100644\n--- a/plone/app/contenttypes/profiles/default/types/Document.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Document.xml\n@@ -37,7 +37,7 @@\n     <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n     <element value="plone.app.dexterity.behaviors.id.IShortName"/>\n     <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n+    <element value="plone.app.contenttypes.behaviors.richtext.IRichTextBehavior"/>\n     <element value="plone.app.relationfield.behavior.IRelatedItems"/>\n     <element value="plone.app.versioningbehavior.behaviors.IVersionable" />\n     <element value="plone.app.contenttypes.behaviors.tableofcontents.ITableOfContents"/>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Event.xml b/plone/app/contenttypes/profiles/default/types/Event.xml\nindex 8e092b5e..676a7b57 100644\n--- a/plone/app/contenttypes/profiles/default/types/Event.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Event.xml\n@@ -39,7 +39,7 @@\n     <element value="plone.app.event.dx.behaviors.IEventContact"/>\n     <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n     <element value="plone.app.content.interfaces.INameFromTitle"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n+    <element value="plone.app.contenttypes.behaviors.richtext.IRichTextBehavior"/>\n     <element value="plone.app.dexterity.behaviors.discussion.IAllowDiscussion"/>\n     <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n     <element value="plone.app.dexterity.behaviors.id.IShortName"/>\ndiff --git a/plone/app/contenttypes/profiles/default/types/News_Item.xml b/plone/app/contenttypes/profiles/default/types/News_Item.xml\nindex 25791664..aab2baea 100644\n--- a/plone/app/contenttypes/profiles/default/types/News_Item.xml\n+++ b/plone/app/contenttypes/profiles/default/types/News_Item.xml\n@@ -33,13 +33,13 @@\n   <!-- Enabled behaviors -->\n   <property name="behaviors" purge="false">\n     <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n+    <element value="plone.app.contenttypes.behaviors.richtext.IRichTextBehavior"/>\n     <element value="plone.app.content.interfaces.INameFromTitle"/>\n     <element value="plone.app.dexterity.behaviors.discussion.IAllowDiscussion"/>\n     <element value="plone.app.dexterity.behaviors.id.IShortName"/>\n     <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n     <element value="plone.app.relationfield.behavior.IRelatedItems"/>\n-    <element value="plone.app.contenttypes.behaviors.leadimage.ILeadImage"/>\n+    <element value="plone.app.contenttypes.behaviors.leadimage.ILeadImageBehavior"/>\n     <element value="plone.app.versioningbehavior.behaviors.IVersionable" />\n     <element value="plone.app.lockingbehavior.behaviors.ILocking" />\n   </property>\ndiff --git a/plone/app/contenttypes/tests/test_behaviors_leadimage.py b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\nindex 55fa50c3..f397118f 100644\n--- a/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n+++ b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n@@ -28,7 +28,7 @@ def setUp(self):\n         self.portal.portal_types._setObject(\'leadimagefolder\', fti)\n         fti.klass = \'plone.dexterity.content.Container\'\n         fti.behaviors = (\n-            \'plone.app.contenttypes.behaviors.leadimage.ILeadImage\',\n+            \'plone.app.contenttypes.behaviors.leadimage.ILeadImageBehavior\',\n         )\n         self.fti = fti\n         alsoProvides(self.portal.REQUEST, IPloneAppContenttypesLayer)\n@@ -60,12 +60,12 @@ def test_lead_image_viewlet_shows_up(self):\n         # Image upload\n         file_path = os.path.join(os.path.dirname(__file__), \'image.jpg\')\n         file_ctl = self.browser.getControl(\n-            name=\'form.widgets.ILeadImage.image\'\n+            name=\'form.widgets.ILeadImageBehavior.image\'\n         )\n         file_ctl.add_file(io.FileIO(file_path), \'image/png\', \'image.jpg\')\n         # Image caption\n         self.browser.getControl(\n-            name=\'form.widgets.ILeadImage.image_caption\'\n+            name=\'form.widgets.ILeadImageBehavior.image_caption\'\n         ).value = \'My image caption\'\n         # Submit form\n         self.browser.getControl(\'Save\').click()\ndiff --git a/plone/app/contenttypes/tests/test_behaviors_richtext.py b/plone/app/contenttypes/tests/test_behaviors_richtext.py\nindex 0f838c1d..d61220e0 100644\n--- a/plone/app/contenttypes/tests/test_behaviors_richtext.py\n+++ b/plone/app/contenttypes/tests/test_behaviors_richtext.py\n@@ -30,7 +30,7 @@ class RichTextBehaviorFunctionalTest(RichTextBase, unittest.TestCase):\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     _behaviors = (\n-        \'plone.app.contenttypes.behaviors.richtext.IRichText\',)\n+        \'plone.app.contenttypes.behaviors.richtext.IRichTextBehavior\',)\n     _portal_type = \'SomeDocument\'\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_collection.py b/plone/app/contenttypes/tests/test_collection.py\nindex da8e6162..5377c749 100644\n--- a/plone/app/contenttypes/tests/test_collection.py\n+++ b/plone/app/contenttypes/tests/test_collection.py\n@@ -194,7 +194,7 @@ def test_add_collection(self):\n         browser.getControl(name=widget).value = \'My collection\'\n         widget = \'form.widgets.IDublinCore.description\'\n         browser.getControl(name=widget).value = \'This is my collection.\'\n-        widget = \'form.widgets.IRichText.text\'\n+        widget = \'form.widgets.IRichTextBehavior.text\'\n         browser.getControl(name=widget).value = \'Lorem Ipsum\'\n         widget = \'form.widgets.IShortName.id\'\n         browser.getControl(name=widget).value = \'my-special-collection\'\ndiff --git a/plone/app/contenttypes/tests/test_document.py b/plone/app/contenttypes/tests/test_document.py\nindex 5e4e49c5..62c79f87 100644\n--- a/plone/app/contenttypes/tests/test_document.py\n+++ b/plone/app/contenttypes/tests/test_document.py\n@@ -106,7 +106,7 @@ def test_add_document(self):\n         self.browser.getControl(name=widget).value = \'My document\'\n         widget = \'form.widgets.IDublinCore.description\'\n         self.browser.getControl(name=widget).value = \'This is my document.\'\n-        widget = \'form.widgets.IRichText.text\'\n+        widget = \'form.widgets.IRichTextBehavior.text\'\n         self.browser.getControl(name=widget).value = \'Lorem Ipsum\'\n         widget = \'form.widgets.IShortName.id\'\n         self.browser.getControl(name=widget).value = \'my-special-document\'\ndiff --git a/plone/app/contenttypes/tests/test_event.py b/plone/app/contenttypes/tests/test_event.py\nindex 1897a6eb..f0c50f64 100644\n--- a/plone/app/contenttypes/tests/test_event.py\n+++ b/plone/app/contenttypes/tests/test_event.py\n@@ -105,7 +105,7 @@ def test_add_event(self):\n             name=\'form.widgets.IDublinCore.description\'\n         ).value = \'This is my event.\'\n         self.browser.getControl(\n-            name=\'form.widgets.IRichText.text\'\n+            name=\'form.widgets.IRichTextBehavior.text\'\n         ).value = \'Lorem Ipsum\'\n         self.browser.getControl(\n             name=\'form.widgets.IEventBasic.start\'\ndiff --git a/plone/app/contenttypes/tests/test_news_item.py b/plone/app/contenttypes/tests/test_news_item.py\nindex 49c2e0e5..b1277ab6 100644\n--- a/plone/app/contenttypes/tests/test_news_item.py\n+++ b/plone/app/contenttypes/tests/test_news_item.py\n@@ -130,7 +130,7 @@ def test_add_news_item(self):\n             .value = \'This is my news item.\'\n         self.browser.getControl(name=\'form.widgets.IShortName.id\')\\\n             .value = \'\'\n-        self.browser.getControl(name=\'form.widgets.IRichText.text\')\\\n+        self.browser.getControl(name=\'form.widgets.IRichTextBehavior.text\')\\\n             .value = \'Lorem Ipsum\'\n         self.browser.getControl(\'Save\').click()\n \ndiff --git a/plone/app/contenttypes/upgrades.py b/plone/app/contenttypes/upgrades.py\nindex 26b8fa81..19c83819 100644\n--- a/plone/app/contenttypes/upgrades.py\n+++ b/plone/app/contenttypes/upgrades.py\n@@ -103,7 +103,7 @@ def enable_collection_behavior(context):\n def migrate_to_richtext(context):\n     """Update fti\'s to add RichText behaviors and remove old text-fields."""\n \n-    behavior = \'plone.app.contenttypes.behaviors.richtext.IRichText\'\n+    behavior = \'plone.app.contenttypes.behaviors.richtext.IRichTextBehavior\'\n     types = [\n         \'Document\',\n         \'News Item\',\n'

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2018-07-11T12:25:43+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/e349dca5002f2b5437dfecba2bd46a3b4bc86d98

Merge pull request #480 from plone/issue_476

Fixed false implemented Factories and Markers for

Files changed:
M CHANGES.rst
M buildout.cfg
M plone/app/contenttypes/behaviors/configure.zcml
M plone/app/contenttypes/behaviors/leadimage.py
M plone/app/contenttypes/behaviors/richtext.py
M plone/app/contenttypes/profiles/default/types/Collection.xml
M plone/app/contenttypes/profiles/default/types/Document.xml
M plone/app/contenttypes/profiles/default/types/Event.xml
M plone/app/contenttypes/profiles/default/types/News_Item.xml
M plone/app/contenttypes/testing.py
M plone/app/contenttypes/tests/test_behaviors_leadimage.py
M plone/app/contenttypes/tests/test_behaviors_richtext.py
M plone/app/contenttypes/tests/test_collection.py
M plone/app/contenttypes/tests/test_content_profile.py
M plone/app/contenttypes/tests/test_document.py
M plone/app/contenttypes/tests/test_event.py
M plone/app/contenttypes/tests/test_image.py
M plone/app/contenttypes/tests/test_link.py
M plone/app/contenttypes/tests/test_migration_custom.py
M plone/app/contenttypes/tests/test_migration_topic.py
M plone/app/contenttypes/tests/test_news_item.py
M plone/app/contenttypes/upgrades.py
M setup.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex c72c9219..3d683f9a 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -6,15 +6,41 @@ Changelog\n \n Breaking changes:\n \n-- *add item here*\n+- ILeadImage and IRichText behaviors now have proper "Marker"-Interfaces.\n+  As this was only possible by renaming the schema adapter to *Behavior to\n+  not break with implementations inside the collective, the FTI-behavior-definition\n+  has changed\n+    \'plone.app.contenttypes.behaviors.leadimage.ILeadImage\'\n+    becomes\n+    \'plone.app.contenttypes.behaviors.leadimage.ILeadImageBehavior\'\n+    and\n+    \'plone.app.contenttypes.behaviors.richtext.IRichText\'\n+    becomes\n+    \'plone.app.contenttypes.behaviors.richtext.IRichTextBehavior\'\n+  [iham]\n \n New features:\n \n-- *add item here*\n+- By using correct (Marker-)Interfaces for the ILeadImage and IRichText,\n+  the factories are now working properly and can be reconfigured\n+  wherever you might need them. ZCA FTW!\n+  [iham]\n \n Bug fixes:\n \n-- *add item here*\n+- Fixed false implemented Factories and Markers for ILeadImage and IRichText.\n+  see `issue 457 <https://github.com/plone/plone.app.contenttypes/issues/476>`\n+  [iham]\n+\n+- Fixed Tests for collection and migration.\n+  see `issue <https://github.com/plone/plone.app.contenttypes/issues/477>`\n+  [iham]\n+\n+- Pinned pydocstyle as it broke buildout.\n+  [iham]\n+\n+- pep8 cleanup.\n+  [iham]\n \n \n 1.4.11 (2018-06-18)\ndiff --git a/buildout.cfg b/buildout.cfg\nindex 5027b31a..5ee40fa5 100644\n--- a/buildout.cfg\n+++ b/buildout.cfg\n@@ -2,7 +2,7 @@\n extends = http://dist.plone.org/release/5.1-latest/versions.cfg\n extensions = mr.developer\n package-name = plone.app.contenttypes\n-package-extras = [test]\n+package-extras = [test, archetypes]\n parts =\n     instance\n     test\n@@ -91,3 +91,4 @@ robotframework-selenium2library = 1.6.0\n robotsuite = 1.6.1\n selenium = 2.46.0\n coverage = 3.7.1\n+pycodestyle = 2.3.1\ndiff --git a/plone/app/contenttypes/behaviors/configure.zcml b/plone/app/contenttypes/behaviors/configure.zcml\nindex a19e2774..69cb53fb 100644\n--- a/plone/app/contenttypes/behaviors/configure.zcml\n+++ b/plone/app/contenttypes/behaviors/configure.zcml\n@@ -11,7 +11,7 @@\n     name="plone.leadimage"\n     title="Lead Image"\n     description="Adds image and image caption fields"\n-    provides=".leadimage.ILeadImage"\n+    provides=".leadimage.ILeadImageBehavior"\n     factory=".leadimage.LeadImage"\n     for="plone.dexterity.interfaces.IDexterityContent"\n     marker=".leadimage.ILeadImage"\n@@ -49,7 +49,7 @@\n     name="plone.richtext"\n     title="RichText"\n     description="Adds richtext behavior"\n-    provides=".richtext.IRichText"\n+    provides=".richtext.IRichTextBehavior"\n     factory=".richtext.RichText"\n     for="plone.dexterity.interfaces.IDexterityContent"\n     marker=".richtext.IRichText"\ndiff --git a/plone/app/contenttypes/behaviors/leadimage.py b/plone/app/contenttypes/behaviors/leadimage.py\nindex c11c0070..f7bebbdd 100644\n--- a/plone/app/contenttypes/behaviors/leadimage.py\n+++ b/plone/app/contenttypes/behaviors/leadimage.py\n@@ -8,10 +8,15 @@\n from zope.component import adapter\n from zope.interface import implementer\n from zope.interface import provider\n+from zope.interface import Interface\n+\n+\n+class ILeadImage(Interface):\n+    pass\n \n \n @provider(IFormFieldProvider)\n-class ILeadImage(model.Schema):\n+class ILeadImageBehavior(model.Schema):\n \n     image = namedfile.NamedBlobImage(\n         title=_(u\'label_leadimage\', default=u\'Lead Image\'),\n@@ -26,9 +31,25 @@ class ILeadImage(model.Schema):\n     )\n \n \n-@implementer(ILeadImage)\n+@implementer(ILeadImageBehavior)\n @adapter(IDexterityContent)\n class LeadImage(object):\n \n     def __init__(self, context):\n         self.context = context\n+\n+    @property\n+    def image(self):\n+        return self.context.image\n+\n+    @image.setter\n+    def image(self, value):\n+        self.context.image = value\n+\n+    @property\n+    def image_caption(self):\n+        return self.context.image_caption\n+\n+    @image_caption.setter\n+    def image_caption(self, value):\n+        self.context.image_caption = value\ndiff --git a/plone/app/contenttypes/behaviors/richtext.py b/plone/app/contenttypes/behaviors/richtext.py\nindex 2332cbf4..c89857d5 100644\n--- a/plone/app/contenttypes/behaviors/richtext.py\n+++ b/plone/app/contenttypes/behaviors/richtext.py\n@@ -9,11 +9,16 @@\n from plone.supermodel import model\n from zope.component import adapter\n from zope.interface import implementer\n+from zope.interface import Interface\n from zope.interface import provider\n \n \n+class IRichText(Interface):\n+    pass\n+\n+\n @provider(IFormFieldProvider)\n-class IRichText(model.Schema):\n+class IRichTextBehavior(model.Schema):\n \n     text = RichTextField(\n         title=_(u\'Text\'),\n@@ -24,13 +29,21 @@ class IRichText(model.Schema):\n     model.primary(\'text\')\n \n \n-@implementer(IRichText)\n+@implementer(IRichTextBehavior)\n @adapter(IDexterityContent)\n class RichText(object):\n \n     def __init__(self, context):\n         self.context = context\n \n+    @property\n+    def text(self):\n+        return self.context.text\n+\n+    @text.setter\n+    def text(self, value):\n+        self.context.text = value\n+\n \n class WidgetView(WidgetsView):\n     schema = IRichText\ndiff --git a/plone/app/contenttypes/profiles/default/types/Collection.xml b/plone/app/contenttypes/profiles/default/types/Collection.xml\nindex 384d3e5f..dd4ddea0 100644\n--- a/plone/app/contenttypes/profiles/default/types/Collection.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Collection.xml\n@@ -38,7 +38,7 @@\n     <element value="plone.app.dexterity.behaviors.id.IShortName"/>\n     <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n     <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n+    <element value="plone.app.contenttypes.behaviors.richtext.IRichTextBehavior"/>\n     <element value="plone.app.relationfield.behavior.IRelatedItems"/>\n     <element value="plone.app.lockingbehavior.behaviors.ILocking" />\n   </property>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Document.xml b/plone/app/contenttypes/profiles/default/types/Document.xml\nindex 29c558d4..e23152da 100644\n--- a/plone/app/contenttypes/profiles/default/types/Document.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Document.xml\n@@ -37,7 +37,7 @@\n     <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n     <element value="plone.app.dexterity.behaviors.id.IShortName"/>\n     <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n+    <element value="plone.app.contenttypes.behaviors.richtext.IRichTextBehavior"/>\n     <element value="plone.app.relationfield.behavior.IRelatedItems"/>\n     <element value="plone.app.versioningbehavior.behaviors.IVersionable" />\n     <element value="plone.app.contenttypes.behaviors.tableofcontents.ITableOfContents"/>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Event.xml b/plone/app/contenttypes/profiles/default/types/Event.xml\nindex 8e092b5e..676a7b57 100644\n--- a/plone/app/contenttypes/profiles/default/types/Event.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Event.xml\n@@ -39,7 +39,7 @@\n     <element value="plone.app.event.dx.behaviors.IEventContact"/>\n     <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n     <element value="plone.app.content.interfaces.INameFromTitle"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n+    <element value="plone.app.contenttypes.behaviors.richtext.IRichTextBehavior"/>\n     <element value="plone.app.dexterity.behaviors.discussion.IAllowDiscussion"/>\n     <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n     <element value="plone.app.dexterity.behaviors.id.IShortName"/>\ndiff --git a/plone/app/contenttypes/profiles/default/types/News_Item.xml b/plone/app/contenttypes/profiles/default/types/News_Item.xml\nindex 25791664..aab2baea 100644\n--- a/plone/app/contenttypes/profiles/default/types/News_Item.xml\n+++ b/plone/app/contenttypes/profiles/default/types/News_Item.xml\n@@ -33,13 +33,13 @@\n   <!-- Enabled behaviors -->\n   <property name="behaviors" purge="false">\n     <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n+    <element value="plone.app.contenttypes.behaviors.richtext.IRichTextBehavior"/>\n     <element value="plone.app.content.interfaces.INameFromTitle"/>\n     <element value="plone.app.dexterity.behaviors.discussion.IAllowDiscussion"/>\n     <element value="plone.app.dexterity.behaviors.id.IShortName"/>\n     <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n     <element value="plone.app.relationfield.behavior.IRelatedItems"/>\n-    <element value="plone.app.contenttypes.behaviors.leadimage.ILeadImage"/>\n+    <element value="plone.app.contenttypes.behaviors.leadimage.ILeadImageBehavior"/>\n     <element value="plone.app.versioningbehavior.behaviors.IVersionable" />\n     <element value="plone.app.lockingbehavior.behaviors.ILocking" />\n   </property>\ndiff --git a/plone/app/contenttypes/testing.py b/plone/app/contenttypes/testing.py\nindex e78c1683..6d4966c7 100644\n--- a/plone/app/contenttypes/testing.py\n+++ b/plone/app/contenttypes/testing.py\n@@ -15,7 +15,6 @@\n from zope.interface import alsoProvides\n \n import pkg_resources\n-import unittest\n \n \n def set_browserlayer(request):\n@@ -66,11 +65,11 @@ def tearDownPloneSite(self, portal):\n \n \n try:\n+    pkg_resources.get_distribution(\'Products.ATContentTypes\')\n     import Products.ATContentTypes\n-except ImportError:\n-    TEST_MIGRATION = False\n-else:\n     TEST_MIGRATION = True\n+except pkg_resources.DistributionNotFound:\n+    TEST_MIGRATION = False\n \n \n class PloneAppContenttypesMigration(PloneSandboxLayer):\n@@ -85,7 +84,6 @@ def setUpZope(self, app, configurationContext):\n             return\n \n         # prepare installing Products.ATContentTypes\n-        import Products.ATContentTypes\n         self.loadZCML(package=Products.ATContentTypes)\n         z2.installProduct(app, \'Products.Archetypes\')\n         z2.installProduct(app, \'Products.ATContentTypes\')\ndiff --git a/plone/app/contenttypes/tests/test_behaviors_leadimage.py b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\nindex 55fa50c3..f397118f 100644\n--- a/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n+++ b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n@@ -28,7 +28,7 @@ def setUp(self):\n         self.portal.portal_types._setObject(\'leadimagefolder\', fti)\n         fti.klass = \'plone.dexterity.content.Container\'\n         fti.behaviors = (\n-            \'plone.app.contenttypes.behaviors.leadimage.ILeadImage\',\n+            \'plone.app.contenttypes.behaviors.leadimage.ILeadImageBehavior\',\n         )\n         self.fti = fti\n         alsoProvides(self.portal.REQUEST, IPloneAppContenttypesLayer)\n@@ -60,12 +60,12 @@ def test_lead_image_viewlet_shows_up(self):\n         # Image upload\n         file_path = os.path.join(os.path.dirname(__file__), \'image.jpg\')\n         file_ctl = self.browser.getControl(\n-            name=\'form.widgets.ILeadImage.image\'\n+            name=\'form.widgets.ILeadImageBehavior.image\'\n         )\n         file_ctl.add_file(io.FileIO(file_path), \'image/png\', \'image.jpg\')\n         # Image caption\n         self.browser.getControl(\n-            name=\'form.widgets.ILeadImage.image_caption\'\n+            name=\'form.widgets.ILeadImageBehavior.image_caption\'\n         ).value = \'My image caption\'\n         # Submit form\n         self.browser.getControl(\'Save\').click()\ndiff --git a/plone/app/contenttypes/tests/test_behaviors_richtext.py b/plone/app/contenttypes/tests/test_behaviors_richtext.py\nindex 0f838c1d..d61220e0 100644\n--- a/plone/app/contenttypes/tests/test_behaviors_richtext.py\n+++ b/plone/app/contenttypes/tests/test_behaviors_richtext.py\n@@ -30,7 +30,7 @@ class RichTextBehaviorFunctionalTest(RichTextBase, unittest.TestCase):\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     _behaviors = (\n-        \'plone.app.contenttypes.behaviors.richtext.IRichText\',)\n+        \'plone.app.contenttypes.behaviors.richtext.IRichTextBehavior\',)\n     _portal_type = \'SomeDocument\'\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_collection.py b/plone/app/contenttypes/tests/test_collection.py\nindex c91dce8f..5377c749 100644\n--- a/plone/app/contenttypes/tests/test_collection.py\n+++ b/plone/app/contenttypes/tests/test_collection.py\n@@ -194,7 +194,7 @@ def test_add_collection(self):\n         browser.getControl(name=widget).value = \'My collection\'\n         widget = \'form.widgets.IDublinCore.description\'\n         browser.getControl(name=widget).value = \'This is my collection.\'\n-        widget = \'form.widgets.IRichText.text\'\n+        widget = \'form.widgets.IRichTextBehavior.text\'\n         browser.getControl(name=widget).value = \'Lorem Ipsum\'\n         widget = \'form.widgets.IShortName.id\'\n         browser.getControl(name=widget).value = \'my-special-collection\'\n@@ -396,11 +396,19 @@ def test_respect_navigation_root(self):\n                               title=\'Collection 1\')\n         collection1 = folder1[\'collection1\']\n         wrapped = ICollection_behavior(collection1)\n-        wrapped.query = [{\n-            \'i\': \'portal_type\',\n-            \'o\': \'plone.app.querystring.operation.string.is\',\n-            \'v\': \'Document\',\n-        }]\n+        wrapped.query = [\n+            {\n+                \'i\': \'portal_type\',\n+                \'o\': \'plone.app.querystring.operation.string.is\',\n+                \'v\': \'Document\',\n+            },\n+            # use a "/" path and navroot works fine!\n+            {\n+                \'i\': \'path\',\n+                \'o\': \'plone.app.querystring.operation.string.path\',\n+                \'v\': \'/\',\n+            },\n+        ]\n \n         # Check if only the item inside folder1 is returned, since it\'s a\n         # navigation root.\ndiff --git a/plone/app/contenttypes/tests/test_content_profile.py b/plone/app/contenttypes/tests/test_content_profile.py\nindex 08d8e116..befdee18 100644\n--- a/plone/app/contenttypes/tests/test_content_profile.py\n+++ b/plone/app/contenttypes/tests/test_content_profile.py\n@@ -93,7 +93,7 @@ def test_Members_portlets(self):\n         self.assertTrue(assignable_manager.getBlacklistStatus(\'context\'))\n         self.assertTrue(assignable_manager.getBlacklistStatus(\'group\'))\n         self.assertTrue(assignable_manager.getBlacklistStatus(\'content_type\'))\n-        \n+\n     def test_Members_is_private(self):\n         # Is the content object public?\n         obj = self.portal[\'Members\']\ndiff --git a/plone/app/contenttypes/tests/test_document.py b/plone/app/contenttypes/tests/test_document.py\nindex 5e4e49c5..62c79f87 100644\n--- a/plone/app/contenttypes/tests/test_document.py\n+++ b/plone/app/contenttypes/tests/test_document.py\n@@ -106,7 +106,7 @@ def test_add_document(self):\n         self.browser.getControl(name=widget).value = \'My document\'\n         widget = \'form.widgets.IDublinCore.description\'\n         self.browser.getControl(name=widget).value = \'This is my document.\'\n-        widget = \'form.widgets.IRichText.text\'\n+        widget = \'form.widgets.IRichTextBehavior.text\'\n         self.browser.getControl(name=widget).value = \'Lorem Ipsum\'\n         widget = \'form.widgets.IShortName.id\'\n         self.browser.getControl(name=widget).value = \'my-special-document\'\ndiff --git a/plone/app/contenttypes/tests/test_event.py b/plone/app/contenttypes/tests/test_event.py\nindex 1897a6eb..f0c50f64 100644\n--- a/plone/app/contenttypes/tests/test_event.py\n+++ b/plone/app/contenttypes/tests/test_event.py\n@@ -105,7 +105,7 @@ def test_add_event(self):\n             name=\'form.widgets.IDublinCore.description\'\n         ).value = \'This is my event.\'\n         self.browser.getControl(\n-            name=\'form.widgets.IRichText.text\'\n+            name=\'form.widgets.IRichTextBehavior.text\'\n         ).value = \'Lorem Ipsum\'\n         self.browser.getControl(\n             name=\'form.widgets.IEventBasic.start\'\ndiff --git a/plone/app/contenttypes/tests/test_image.py b/plone/app/contenttypes/tests/test_image.py\nindex eb1fcbd9..e86bbe3b 100644\n--- a/plone/app/contenttypes/tests/test_image.py\n+++ b/plone/app/contenttypes/tests/test_image.py\n@@ -112,9 +112,10 @@ def test_svg_image(self):\n         scale = self.image.restrictedTraverse(\'@@images\')\n         self.assertRegexpMatches(\n             scale.scale(\'image\', scale=\'large\').tag(),\n-            r\'<img src="http://nohost/plone/image/@@images/[a-z0-9--]*.svg" alt="My Image" title="My Image" height="768" width="768" />\'\n+            r\'<img src="http://nohost/plone/image/@@images/[a-z0-9--]*.svg" alt="My Image" title="My Image" height="768" width="768" />\'  # noqa E501\n         )\n \n+\n class ImageFunctionalTest(unittest.TestCase):\n \n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\ndiff --git a/plone/app/contenttypes/tests/test_link.py b/plone/app/contenttypes/tests/test_link.py\nindex 4cf569fb..69e7324a 100644\n--- a/plone/app/contenttypes/tests/test_link.py\n+++ b/plone/app/contenttypes/tests/test_link.py\n@@ -173,7 +173,9 @@ def test_link_redirect_view_path_with_variable_and_parameters(self):\n         # As anonymous: redirect\n         logout()\n         self.assertTrue(view())\n-        self._assert_redirect(\'http://nohost/plone/@@search?SearchableText=Plone\')\n+        self._assert_redirect(\n+            \'http://nohost/plone/@@search?SearchableText=Plone\',\n+        )\n \n     def test_mailto_type(self):\n         self.link.remoteUrl = \'mailto:stress@test.us\'\ndiff --git a/plone/app/contenttypes/tests/test_migration_custom.py b/plone/app/contenttypes/tests/test_migration_custom.py\nindex 0e9a93f6..f9b3a68f 100644\n--- a/plone/app/contenttypes/tests/test_migration_custom.py\n+++ b/plone/app/contenttypes/tests/test_migration_custom.py\n@@ -7,9 +7,9 @@\n \n if TEST_MIGRATION:\n     from datetime import datetime\n-    from plone.app.contenttypes.migration.field_migrators import migrate_filefield\n-    from plone.app.contenttypes.migration.field_migrators import migrate_imagefield\n-    from plone.app.contenttypes.migration.field_migrators import migrate_simplefield  # noqa\n+    from plone.app.contenttypes.migration.field_migrators import migrate_filefield  # noqa E501\n+    from plone.app.contenttypes.migration.field_migrators import migrate_imagefield  # noqa E501\n+    from plone.app.contenttypes.migration.field_migrators import migrate_simplefield  # noqa E501\n     from plone.app.contenttypes.migration.utils import installTypeIfNeeded\n     from plone.app.testing import applyProfile\n     from plone.app.testing import login\ndiff --git a/plone/app/contenttypes/tests/test_migration_topic.py b/plone/app/contenttypes/tests/test_migration_topic.py\nindex c7ac2c8a..44dcb513 100644\n--- a/plone/app/contenttypes/tests/test_migration_topic.py\n+++ b/plone/app/contenttypes/tests/test_migration_topic.py\n@@ -16,7 +16,6 @@\n     from zope.component import queryUtility\n     from zope.interface import implementer\n \n-\n     @implementer(ICollection)\n     class FolderishCollection(Container):\n         """Test subclass for folderish ``Collections``.\ndiff --git a/plone/app/contenttypes/tests/test_news_item.py b/plone/app/contenttypes/tests/test_news_item.py\nindex 49c2e0e5..b1277ab6 100644\n--- a/plone/app/contenttypes/tests/test_news_item.py\n+++ b/plone/app/contenttypes/tests/test_news_item.py\n@@ -130,7 +130,7 @@ def test_add_news_item(self):\n             .value = \'This is my news item.\'\n         self.browser.getControl(name=\'form.widgets.IShortName.id\')\\\n             .value = \'\'\n-        self.browser.getControl(name=\'form.widgets.IRichText.text\')\\\n+        self.browser.getControl(name=\'form.widgets.IRichTextBehavior.text\')\\\n             .value = \'Lorem Ipsum\'\n         self.browser.getControl(\'Save\').click()\n \ndiff --git a/plone/app/contenttypes/upgrades.py b/plone/app/contenttypes/upgrades.py\nindex 26b8fa81..19c83819 100644\n--- a/plone/app/contenttypes/upgrades.py\n+++ b/plone/app/contenttypes/upgrades.py\n@@ -103,7 +103,7 @@ def enable_collection_behavior(context):\n def migrate_to_richtext(context):\n     """Update fti\'s to add RichText behaviors and remove old text-fields."""\n \n-    behavior = \'plone.app.contenttypes.behaviors.richtext.IRichText\'\n+    behavior = \'plone.app.contenttypes.behaviors.richtext.IRichTextBehavior\'\n     types = [\n         \'Document\',\n         \'News Item\',\ndiff --git a/setup.py b/setup.py\nindex 13198d80..df00e59c 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -11,10 +11,12 @@\n def read(*rnames):\n     return open(os.path.join(os.path.dirname(__file__), *rnames)).read()\n \n+\n long_description = \\\n     read(\'README.rst\') + \'\\n\\n\' + \\\n     read(\'CHANGES.rst\')\n \n+\n setup(name=\'plone.app.contenttypes\',\n       version=version,\n       description="Default content types for Plone based on Dexterity",\n'

