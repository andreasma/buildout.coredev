Repository: Products.CMFPlone


Branch: refs/heads/5.1.x
Date: 2019-02-20T10:34:24+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/9c2d279b3c0d606171d8b98bd4340c5b701e1339

Only check once if ATCT is available

Otherwise the call to check if the distribution is available is done on every single call to ``getOAI``, which can be potentially hundreds of times per request. 

Fixes https://github.com/plone/Products.CMFPlone/issues/2765

Files changed:
M Products/CMFPlone/PloneBaseTool.py

b"diff --git a/Products/CMFPlone/PloneBaseTool.py b/Products/CMFPlone/PloneBaseTool.py\nindex 63ca0f6bdc..5021f12b5a 100644\n--- a/Products/CMFPlone/PloneBaseTool.py\n+++ b/Products/CMFPlone/PloneBaseTool.py\n@@ -29,7 +29,7 @@ def initializeTFC():\n         try:\n             pkg_resources.get_distribution('Products.ATContentTypes')\n         except pkg_resources.DistributionNotFound:\n-            pass\n+            TempFolderClass = False\n         else:\n             from Products.ATContentTypes.tool.factory import TempFolder\n             TempFolderClass = TempFolder\n"

Repository: Products.CMFPlone


Branch: refs/heads/5.1.x
Date: 2019-02-20T10:34:26+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/24c600a44f2c64c48686f509fc07c91ab93622cd

Add news entry

Files changed:
A news/2765.bugfix

b'diff --git a/news/2765.bugfix b/news/2765.bugfix\nnew file mode 100644\nindex 0000000000..614f3c7adb\n--- /dev/null\n+++ b/news/2765.bugfix\n@@ -0,0 +1,2 @@\n+Check only once if Products.ATContentTypes is available.\n+[gforcada]\n'

Repository: Products.CMFPlone


Branch: refs/heads/5.1.x
Date: 2019-02-20T16:34:27+01:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/ea6f1a32e61e82b091bc9dc5cb620b7bb383f501

Merge pull request #2768 from plone/backport-gforcada-patch-1

[5.1] Only check once if ATCT is available

Files changed:
A news/2765.bugfix
M Products/CMFPlone/PloneBaseTool.py

b"diff --git a/Products/CMFPlone/PloneBaseTool.py b/Products/CMFPlone/PloneBaseTool.py\nindex 63ca0f6bdc..5021f12b5a 100644\n--- a/Products/CMFPlone/PloneBaseTool.py\n+++ b/Products/CMFPlone/PloneBaseTool.py\n@@ -29,7 +29,7 @@ def initializeTFC():\n         try:\n             pkg_resources.get_distribution('Products.ATContentTypes')\n         except pkg_resources.DistributionNotFound:\n-            pass\n+            TempFolderClass = False\n         else:\n             from Products.ATContentTypes.tool.factory import TempFolder\n             TempFolderClass = TempFolder\ndiff --git a/news/2765.bugfix b/news/2765.bugfix\nnew file mode 100644\nindex 0000000000..614f3c7adb\n--- /dev/null\n+++ b/news/2765.bugfix\n@@ -0,0 +1,2 @@\n+Check only once if Products.ATContentTypes is available.\n+[gforcada]\n"

