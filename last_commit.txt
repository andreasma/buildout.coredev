Repository: Products.PortalTransforms


Branch: refs/heads/master
Date: 2018-05-08T09:13:39-04:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/Products.PortalTransforms/commit/1c334408fd21bdde95c8a2f3ed5402ce777804d1

stop using ATTestCase

Files changed:
M CHANGES.rst
M Products/PortalTransforms/tests/test_engine.py
M Products/PortalTransforms/tests/test_graph.py
M Products/PortalTransforms/tests/test_intelligenttext.py
M Products/PortalTransforms/tests/test_transforms.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 0855598..f8fd6b5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,9 @@ Bug fixes:
 - Start fixing startup in py3
   [ale-rt, pbauer]
 
+- Stop using ATTestCase for tests.
+  [davisagli]
+
 
 3.1.2 (2018-02-05)
 ------------------
diff --git a/Products/PortalTransforms/tests/test_engine.py b/Products/PortalTransforms/tests/test_engine.py
index d34c26c..7ad6e66 100644
--- a/Products/PortalTransforms/tests/test_engine.py
+++ b/Products/PortalTransforms/tests/test_engine.py
@@ -1,13 +1,13 @@
 # -*- coding: utf-8 -*-
-from Products.Archetypes.tests.atsitetestcase import ATSiteTestCase
+from Products.CMFPlone.utils import _createObjectByType
 from Products.PortalTransforms.chain import chain
 from Products.PortalTransforms.interfaces import ITransform
+from Products.PortalTransforms.testing import PRODUCTS_PORTALTRANSFORMS_INTEGRATION_TESTING
 from Products.PortalTransforms.utils import TransformException
+from six.moves import urllib
 from zope.interface import implementer
-
 import re
-
-from six.moves import urllib
+import unittest
 
 
 class BaseTransform:
@@ -114,10 +114,14 @@ class BadTransformWildcardOutput(BaseTransform):
     output = 'text/*'
 
 
-class TestEngine(ATSiteTestCase):
+class TestEngine(unittest.TestCase):
 
-    def afterSetUp(self):
-        ATSiteTestCase.afterSetUp(self)
+    layer = PRODUCTS_PORTALTRANSFORMS_INTEGRATION_TESTING
+
+    def setUp(self):
+        self.portal = self.layer['portal']
+        _createObjectByType('Folder', self.portal, id='folder')
+        self.folder = self.portal.folder
         self.engine = self.portal.portal_transforms
         self.data = '<b>foo</b>'
         for mt in self.engine._policies.keys():
@@ -301,10 +305,3 @@ def testCacheWithVHost(self):
         self.assertEqual(
             out.getData(), '<a href="http://otherhost">vhost link</a>',
             out.getData())
-
-
-def test_suite():
-    from unittest import TestSuite, makeSuite
-    suite = TestSuite()
-    suite.addTest(makeSuite(TestEngine))
-    return suite
diff --git a/Products/PortalTransforms/tests/test_graph.py b/Products/PortalTransforms/tests/test_graph.py
index e697c07..e41586a 100644
--- a/Products/PortalTransforms/tests/test_graph.py
+++ b/Products/PortalTransforms/tests/test_graph.py
@@ -1,15 +1,17 @@
 # -*- coding: utf-8 -*-
-from Products.Archetypes.tests.atsitetestcase import ATSiteTestCase
-from utils import input_file_path
-
+from Products.PortalTransforms.testing import PRODUCTS_PORTALTRANSFORMS_INTEGRATION_TESTING
+from .utils import input_file_path
+import unittest
 
 FILE_PATH = input_file_path("demo1.pdf")
 
 
-class TestGraph(ATSiteTestCase):
+class TestGraph(unittest.TestCase):
+
+    layer = PRODUCTS_PORTALTRANSFORMS_INTEGRATION_TESTING
 
-    def afterSetUp(self):
-        ATSiteTestCase.afterSetUp(self)
+    def setUp(self):
+        self.portal = self.layer['portal']
         self.engine = self.portal.portal_transforms
 
     def testGraph(self):
@@ -107,10 +109,3 @@ def testIdentity(self):
         converted = self.engine.convertTo(
             'text/plain', 'Some text', mimetype='text/plain')
         self.assertEqual(orig, str(converted))
-
-
-def test_suite():
-    from unittest import TestSuite, makeSuite
-    suite = TestSuite()
-    suite.addTest(makeSuite(TestGraph))
-    return suite
diff --git a/Products/PortalTransforms/tests/test_intelligenttext.py b/Products/PortalTransforms/tests/test_intelligenttext.py
index 55dc448..cda59fe 100644
--- a/Products/PortalTransforms/tests/test_intelligenttext.py
+++ b/Products/PortalTransforms/tests/test_intelligenttext.py
@@ -1,11 +1,14 @@
 # -*- coding: utf-8 -*-
-from Products.Archetypes.tests.atsitetestcase import ATSiteTestCase
+from Products.PortalTransforms.testing import PRODUCTS_PORTALTRANSFORMS_INTEGRATION_TESTING
+import unittest
 
 
-class TransformTestCase(ATSiteTestCase):
+class TransformTestCase(unittest.TestCase):
 
-    def afterSetUp(self):
-        ATSiteTestCase.afterSetUp(self)
+    layer = PRODUCTS_PORTALTRANSFORMS_INTEGRATION_TESTING
+
+    def setUp(self):
+        self.portal = self.layer['portal']
         self.transforms = self.portal.portal_transforms
 
 
diff --git a/Products/PortalTransforms/tests/test_transforms.py b/Products/PortalTransforms/tests/test_transforms.py
index 5cd1fb1..a55910b 100644
--- a/Products/PortalTransforms/tests/test_transforms.py
+++ b/Products/PortalTransforms/tests/test_transforms.py
@@ -21,11 +21,11 @@
 from Products.PortalTransforms.transforms.textile_to_html import HAS_TEXTILE
 from zope.component import getUtility
 
-from utils import input_file_path
-from utils import load
-from utils import matching_inputs
-from utils import normalize_html
-from utils import output_file_path
+from .utils import input_file_path
+from .utils import load
+from .utils import matching_inputs
+from .utils import normalize_html
+from .utils import output_file_path
 from xml.sax.saxutils import unescape
 
 import itertools
diff --git a/setup.py b/setup.py
index 5ed739c..ddb2124 100644
--- a/setup.py
+++ b/setup.py
@@ -33,7 +33,6 @@
       extras_require=dict(
           test=[
               'zope.testing',
-              'Products.Archetypes [test]',
               'Pillow',
           ],
       ),


Repository: Products.PortalTransforms


Branch: refs/heads/master
Date: 2018-05-08T23:30:54+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/Products.PortalTransforms/commit/47316879ac1be5ac9169299f6ed2a410797b3880

Merge pull request #33 from plone/no-at

stop using ATSiteTestCase

Files changed:
M CHANGES.rst
M Products/PortalTransforms/tests/test_engine.py
M Products/PortalTransforms/tests/test_graph.py
M Products/PortalTransforms/tests/test_intelligenttext.py
M Products/PortalTransforms/tests/test_transforms.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 0855598..f8fd6b5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,9 @@ Bug fixes:
 - Start fixing startup in py3
   [ale-rt, pbauer]
 
+- Stop using ATTestCase for tests.
+  [davisagli]
+
 
 3.1.2 (2018-02-05)
 ------------------
diff --git a/Products/PortalTransforms/tests/test_engine.py b/Products/PortalTransforms/tests/test_engine.py
index d34c26c..7ad6e66 100644
--- a/Products/PortalTransforms/tests/test_engine.py
+++ b/Products/PortalTransforms/tests/test_engine.py
@@ -1,13 +1,13 @@
 # -*- coding: utf-8 -*-
-from Products.Archetypes.tests.atsitetestcase import ATSiteTestCase
+from Products.CMFPlone.utils import _createObjectByType
 from Products.PortalTransforms.chain import chain
 from Products.PortalTransforms.interfaces import ITransform
+from Products.PortalTransforms.testing import PRODUCTS_PORTALTRANSFORMS_INTEGRATION_TESTING
 from Products.PortalTransforms.utils import TransformException
+from six.moves import urllib
 from zope.interface import implementer
-
 import re
-
-from six.moves import urllib
+import unittest
 
 
 class BaseTransform:
@@ -114,10 +114,14 @@ class BadTransformWildcardOutput(BaseTransform):
     output = 'text/*'
 
 
-class TestEngine(ATSiteTestCase):
+class TestEngine(unittest.TestCase):
 
-    def afterSetUp(self):
-        ATSiteTestCase.afterSetUp(self)
+    layer = PRODUCTS_PORTALTRANSFORMS_INTEGRATION_TESTING
+
+    def setUp(self):
+        self.portal = self.layer['portal']
+        _createObjectByType('Folder', self.portal, id='folder')
+        self.folder = self.portal.folder
         self.engine = self.portal.portal_transforms
         self.data = '<b>foo</b>'
         for mt in self.engine._policies.keys():
@@ -301,10 +305,3 @@ def testCacheWithVHost(self):
         self.assertEqual(
             out.getData(), '<a href="http://otherhost">vhost link</a>',
             out.getData())
-
-
-def test_suite():
-    from unittest import TestSuite, makeSuite
-    suite = TestSuite()
-    suite.addTest(makeSuite(TestEngine))
-    return suite
diff --git a/Products/PortalTransforms/tests/test_graph.py b/Products/PortalTransforms/tests/test_graph.py
index e697c07..e41586a 100644
--- a/Products/PortalTransforms/tests/test_graph.py
+++ b/Products/PortalTransforms/tests/test_graph.py
@@ -1,15 +1,17 @@
 # -*- coding: utf-8 -*-
-from Products.Archetypes.tests.atsitetestcase import ATSiteTestCase
-from utils import input_file_path
-
+from Products.PortalTransforms.testing import PRODUCTS_PORTALTRANSFORMS_INTEGRATION_TESTING
+from .utils import input_file_path
+import unittest
 
 FILE_PATH = input_file_path("demo1.pdf")
 
 
-class TestGraph(ATSiteTestCase):
+class TestGraph(unittest.TestCase):
+
+    layer = PRODUCTS_PORTALTRANSFORMS_INTEGRATION_TESTING
 
-    def afterSetUp(self):
-        ATSiteTestCase.afterSetUp(self)
+    def setUp(self):
+        self.portal = self.layer['portal']
         self.engine = self.portal.portal_transforms
 
     def testGraph(self):
@@ -107,10 +109,3 @@ def testIdentity(self):
         converted = self.engine.convertTo(
             'text/plain', 'Some text', mimetype='text/plain')
         self.assertEqual(orig, str(converted))
-
-
-def test_suite():
-    from unittest import TestSuite, makeSuite
-    suite = TestSuite()
-    suite.addTest(makeSuite(TestGraph))
-    return suite
diff --git a/Products/PortalTransforms/tests/test_intelligenttext.py b/Products/PortalTransforms/tests/test_intelligenttext.py
index 55dc448..cda59fe 100644
--- a/Products/PortalTransforms/tests/test_intelligenttext.py
+++ b/Products/PortalTransforms/tests/test_intelligenttext.py
@@ -1,11 +1,14 @@
 # -*- coding: utf-8 -*-
-from Products.Archetypes.tests.atsitetestcase import ATSiteTestCase
+from Products.PortalTransforms.testing import PRODUCTS_PORTALTRANSFORMS_INTEGRATION_TESTING
+import unittest
 
 
-class TransformTestCase(ATSiteTestCase):
+class TransformTestCase(unittest.TestCase):
 
-    def afterSetUp(self):
-        ATSiteTestCase.afterSetUp(self)
+    layer = PRODUCTS_PORTALTRANSFORMS_INTEGRATION_TESTING
+
+    def setUp(self):
+        self.portal = self.layer['portal']
         self.transforms = self.portal.portal_transforms
 
 
diff --git a/Products/PortalTransforms/tests/test_transforms.py b/Products/PortalTransforms/tests/test_transforms.py
index 5cd1fb1..a55910b 100644
--- a/Products/PortalTransforms/tests/test_transforms.py
+++ b/Products/PortalTransforms/tests/test_transforms.py
@@ -21,11 +21,11 @@
 from Products.PortalTransforms.transforms.textile_to_html import HAS_TEXTILE
 from zope.component import getUtility
 
-from utils import input_file_path
-from utils import load
-from utils import matching_inputs
-from utils import normalize_html
-from utils import output_file_path
+from .utils import input_file_path
+from .utils import load
+from .utils import matching_inputs
+from .utils import normalize_html
+from .utils import output_file_path
 from xml.sax.saxutils import unescape
 
 import itertools
diff --git a/setup.py b/setup.py
index 5ed739c..ddb2124 100644
--- a/setup.py
+++ b/setup.py
@@ -33,7 +33,6 @@
       extras_require=dict(
           test=[
               'zope.testing',
-              'Products.Archetypes [test]',
               'Pillow',
           ],
       ),


