Repository: mockup


Branch: refs/heads/master
Date: 2018-06-19T15:51:05-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/mockup/commit/d8a387d50b4c428044de5ffb5b221bb2f3b9c5dd

tinymce: Do not include content.min.css as part of the bundle fixes gh-838

Files changed:
M CHANGES.rst
M mockup/patterns/tinymce/less/pattern.tinymce.less

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex a25f9b73..28225e8c 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -19,6 +19,9 @@ New features:\n \n Bug fixes:\n \n+- tinymce: Do not include content.min.css as part of the bundle\n+  [frapell]\n+\n - pat-contentloader: Add \'content-load-error\' to other exit-cases too. Clean up classes on initialization.\n   [thet]\n \ndiff --git a/mockup/patterns/tinymce/less/pattern.tinymce.less b/mockup/patterns/tinymce/less/pattern.tinymce.less\nindex a692438f..15633442 100644\n--- a/mockup/patterns/tinymce/less/pattern.tinymce.less\n+++ b/mockup/patterns/tinymce/less/pattern.tinymce.less\n@@ -1,5 +1,4 @@\n-@import (css) "@{bowerPath}tinymce-builded/js/tinymce/skins/lightgray/skin.min.css";\n-@import (css) "@{bowerPath}tinymce-builded/js/tinymce/skins/lightgray/content.min.css";\n+@import (inline) "@{bowerPath}tinymce-builded/js/tinymce/skins/lightgray/skin.min.css";\n @import (inline) "@{bowerPath}tinymce-builded/js/tinymce/plugins/visualblocks/css/visualblocks.css";\n @import "@{mockupPath}/modal/pattern.modal.less";\n @import "@{mockupPath}/autotoc/pattern.autotoc.less";\n'

Repository: mockup


Branch: refs/heads/master
Date: 2018-06-28T23:26:28+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/mockup/commit/e2f68411fd47631827820a42900a1c13616bc7fe

fix tinymce tests

due to a issue in country specific language handling introduced in #849

Files changed:
M mockup/js/i18n.js
M mockup/patterns/tinymce/pattern.js
M mockup/tests/i18n-test.js

b"diff --git a/mockup/js/i18n.js b/mockup/js/i18n.js\nindex bb2d338f..0fcb380a 100644\n--- a/mockup/js/i18n.js\n+++ b/mockup/js/i18n.js\n@@ -18,7 +18,7 @@ define([\n     if (!self.baseUrl) {\n       self.baseUrl = '/plonejsi18n';\n     }\n-    self.currentLanguage = $('html').attr('lang') || 'en-us';\n+    self.currentLanguage = $('html').attr('lang') || 'en';\n \n     // Fix for country specific languages\n     if (self.currentLanguage.split('-').length > 1) {\ndiff --git a/mockup/patterns/tinymce/pattern.js b/mockup/patterns/tinymce/pattern.js\nindex 96a7b813..ff3783ab 100644\n--- a/mockup/patterns/tinymce/pattern.js\n+++ b/mockup/patterns/tinymce/pattern.js\n@@ -290,7 +290,7 @@ define([\n       var self = this;\n       var i18n = new I18n();\n       var lang = i18n.currentLanguage;\n-      if (lang !== 'en-us' && self.options.tiny.language !== 'en') {\n+      if (lang !== 'en' && self.options.tiny.language !== 'en') {\n         tinymce.baseURL = self.options.loadingBaseUrl;\n         // does the expected language exist?\n         $.ajax({\ndiff --git a/mockup/tests/i18n-test.js b/mockup/tests/i18n-test.js\nindex e50eb993..392e6a40 100644\n--- a/mockup/tests/i18n-test.js\n+++ b/mockup/tests/i18n-test.js\n@@ -84,6 +84,28 @@ define([\n         expect(_('foo')).to.be('bar');\n         server.restore();\n       });\n+\n+      it('handles country specific translations', function() {\n+        var i18n = new I18n();\n+        var server = sinon.fakeServer.create();\n+        server.autoRespond = true;\n+        var clock = sinon.useFakeTimers();\n+\n+        server.respondWith('GET', /plonejsi18n/, function (xhr) {\n+          xhr.respond(200, { 'Content-Type': 'application/json' }, JSON.stringify({\n+            foo: 'bar-us',\n+          }));\n+        });\n+        i18n.configure({\n+          currentLanguage: 'en-us',\n+          baseUrl: '/plonejsi18n'\n+        });\n+        i18n.loadCatalog('foobar-us');\n+        clock.tick(500);\n+        var _ = i18n.MessageFactory('foobar-us');\n+        expect(_('foo')).to.be('bar-us');\n+        server.restore();\n+      });\n     });\n \n   });\n"

Repository: mockup


Branch: refs/heads/master
Date: 2018-06-29T15:07:38-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/mockup/commit/2c92b54a703d12e388a0d0c94470f75b116bdeb0

Merge pull request #854 from plone/issue-838

tinymce: Do not include content.min.css as part of the bundle

Files changed:
M CHANGES.rst
M mockup/js/i18n.js
M mockup/patterns/tinymce/less/pattern.tinymce.less
M mockup/patterns/tinymce/pattern.js
M mockup/tests/i18n-test.js

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex bf192988..56c817e2 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -48,6 +48,9 @@ New features:\n \n Bug fixes:\n \n+- tinymce: Do not include content.min.css as part of the bundle\n+  [frapell]\n+\n - pat-contentloader: Add \'content-load-error\' to other exit-cases too. Clean up classes on initialization.\n   [thet]\n \ndiff --git a/mockup/js/i18n.js b/mockup/js/i18n.js\nindex bb2d338f..0fcb380a 100644\n--- a/mockup/js/i18n.js\n+++ b/mockup/js/i18n.js\n@@ -18,7 +18,7 @@ define([\n     if (!self.baseUrl) {\n       self.baseUrl = \'/plonejsi18n\';\n     }\n-    self.currentLanguage = $(\'html\').attr(\'lang\') || \'en-us\';\n+    self.currentLanguage = $(\'html\').attr(\'lang\') || \'en\';\n \n     // Fix for country specific languages\n     if (self.currentLanguage.split(\'-\').length > 1) {\ndiff --git a/mockup/patterns/tinymce/less/pattern.tinymce.less b/mockup/patterns/tinymce/less/pattern.tinymce.less\nindex a692438f..15633442 100644\n--- a/mockup/patterns/tinymce/less/pattern.tinymce.less\n+++ b/mockup/patterns/tinymce/less/pattern.tinymce.less\n@@ -1,5 +1,4 @@\n-@import (css) "@{bowerPath}tinymce-builded/js/tinymce/skins/lightgray/skin.min.css";\n-@import (css) "@{bowerPath}tinymce-builded/js/tinymce/skins/lightgray/content.min.css";\n+@import (inline) "@{bowerPath}tinymce-builded/js/tinymce/skins/lightgray/skin.min.css";\n @import (inline) "@{bowerPath}tinymce-builded/js/tinymce/plugins/visualblocks/css/visualblocks.css";\n @import "@{mockupPath}/modal/pattern.modal.less";\n @import "@{mockupPath}/autotoc/pattern.autotoc.less";\ndiff --git a/mockup/patterns/tinymce/pattern.js b/mockup/patterns/tinymce/pattern.js\nindex 96a7b813..ff3783ab 100644\n--- a/mockup/patterns/tinymce/pattern.js\n+++ b/mockup/patterns/tinymce/pattern.js\n@@ -290,7 +290,7 @@ define([\n       var self = this;\n       var i18n = new I18n();\n       var lang = i18n.currentLanguage;\n-      if (lang !== \'en-us\' && self.options.tiny.language !== \'en\') {\n+      if (lang !== \'en\' && self.options.tiny.language !== \'en\') {\n         tinymce.baseURL = self.options.loadingBaseUrl;\n         // does the expected language exist?\n         $.ajax({\ndiff --git a/mockup/tests/i18n-test.js b/mockup/tests/i18n-test.js\nindex e50eb993..392e6a40 100644\n--- a/mockup/tests/i18n-test.js\n+++ b/mockup/tests/i18n-test.js\n@@ -84,6 +84,28 @@ define([\n         expect(_(\'foo\')).to.be(\'bar\');\n         server.restore();\n       });\n+\n+      it(\'handles country specific translations\', function() {\n+        var i18n = new I18n();\n+        var server = sinon.fakeServer.create();\n+        server.autoRespond = true;\n+        var clock = sinon.useFakeTimers();\n+\n+        server.respondWith(\'GET\', /plonejsi18n/, function (xhr) {\n+          xhr.respond(200, { \'Content-Type\': \'application/json\' }, JSON.stringify({\n+            foo: \'bar-us\',\n+          }));\n+        });\n+        i18n.configure({\n+          currentLanguage: \'en-us\',\n+          baseUrl: \'/plonejsi18n\'\n+        });\n+        i18n.loadCatalog(\'foobar-us\');\n+        clock.tick(500);\n+        var _ = i18n.MessageFactory(\'foobar-us\');\n+        expect(_(\'foo\')).to.be(\'bar-us\');\n+        server.restore();\n+      });\n     });\n \n   });\n'

