Repository: plone.portlet.static


Branch: refs/heads/master
Date: 2018-06-14T10:15:36+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.portlet.static/commit/3c22c9288400e295c33a4ac2d4fe3fe70e8a6db1

fix static portlet for py (last failing test is due to plone.outputfilter)

Files changed:
M plone/portlet/static/static.py

b'diff --git a/plone/portlet/static/static.py b/plone/portlet/static/static.py\nindex b533e88..35ca86d 100644\n--- a/plone/portlet/static/static.py\n+++ b/plone/portlet/static/static.py\n@@ -1,8 +1,5 @@\n # -*- coding: utf-8 -*-\n from Acquisition import aq_inner\n-from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.utils import getFSVersionTuple\n-from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from plone.app.portlets.portlets import base\n from plone.app.textfield import RichText\n from plone.app.textfield.value import RichTextValue\n@@ -11,9 +8,14 @@\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.portlet.static import PloneMessageFactory as _\n from plone.portlets.interfaces import IPortletDataProvider\n+from Products.CMFCore.utils import getToolByName\n+from Products.CMFPlone.utils import getFSVersionTuple\n+from Products.CMFPlone.utils import safe_unicode\n+from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope import schema\n from zope.component import getUtility\n from zope.interface import implementer\n+\n import logging\n import re\n import six\n@@ -164,14 +166,15 @@ def transformed(self, mt=\'text/x-html-safe\'):\n             # utf-8 text. There were bugs in earlier versions of this portlet\n             # which stored text directly as sent by the browser, which could\n             # be any encoding in the world.\n-            orig = six.text_type(orig, \'utf-8\', \'ignore\')\n+            orig = safe_unicode(orig)\n             logger.warn(\n-                "Static portlet at %s has stored non-six.text_type text. "\n+                "Static portlet at %s has not stored text/unicode. "\n                 "Assuming utf-8 encoding." % context.absolute_url()\n             )\n \n-        # Portal transforms needs encoded strings\n-        orig = orig.encode(\'utf-8\')\n+        # Portal transforms on py2 needs encoded strings\n+        if six.PY2 and isinstance(orig, six.text_type):\n+            orig = orig.encode(\'utf-8\')\n \n         transformer = getToolByName(context, \'portal_transforms\')\n         transformer_context = context\n@@ -185,9 +188,7 @@ def transformed(self, mt=\'text/x-html-safe\'):\n                                      context=transformer_context, mimetype=\'text/html\')\n         result = data.getData()\n         if result:\n-            if isinstance(result, str):\n-                return six.text_type(result, \'utf-8\')\n-            return result\n+            return safe_unicode(result)\n         return None\n \n \n'

Repository: plone.portlet.static


Branch: refs/heads/master
Date: 2018-09-20T22:18:29+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.portlet.static/commit/c868bffedf1074a9774084505787f47d0cf8d3dc

add changenote and classifiers

Files changed:
M CHANGES.rst
M setup.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex d88a3d6..89a29af 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -15,7 +15,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Fix static portlet for py3\n+  [pbauer]\n \n \n 3.1.2 (2018-02-05)\ndiff --git a/setup.py b/setup.py\nindex a83cbc2..243600c 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -25,11 +25,14 @@ def read(*rnames):\n         "Framework :: Plone",\n         "Framework :: Plone :: 5.0",\n         "Framework :: Plone :: 5.1",\n+        "Framework :: Plone :: 5.2",\n         "Framework :: Zope2",\n         "License :: OSI Approved :: GNU General Public License v2 (GPLv2)",\n         "Operating System :: OS Independent",\n         "Programming Language :: Python",\n         "Programming Language :: Python :: 2.7",\n+        "Programming Language :: Python :: 3.6",\n+        "Programming Language :: Python :: 3.7",\n     ],\n     keywords=\'plone portlet static\',\n     author=\'Plone Foundation\',\n'

Repository: plone.portlet.static


Branch: refs/heads/master
Date: 2018-09-21T07:33:57+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.portlet.static/commit/2efdbd35c7b5cf0f8afea8cf35ceb1174d8b80bf

Merge pull request #16 from plone/python3

fix static portlet for py3

Files changed:
M CHANGES.rst
M plone/portlet/static/static.py
M setup.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex d88a3d6..89a29af 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -15,7 +15,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Fix static portlet for py3\n+  [pbauer]\n \n \n 3.1.2 (2018-02-05)\ndiff --git a/plone/portlet/static/static.py b/plone/portlet/static/static.py\nindex b533e88..35ca86d 100644\n--- a/plone/portlet/static/static.py\n+++ b/plone/portlet/static/static.py\n@@ -1,8 +1,5 @@\n # -*- coding: utf-8 -*-\n from Acquisition import aq_inner\n-from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.utils import getFSVersionTuple\n-from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from plone.app.portlets.portlets import base\n from plone.app.textfield import RichText\n from plone.app.textfield.value import RichTextValue\n@@ -11,9 +8,14 @@\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.portlet.static import PloneMessageFactory as _\n from plone.portlets.interfaces import IPortletDataProvider\n+from Products.CMFCore.utils import getToolByName\n+from Products.CMFPlone.utils import getFSVersionTuple\n+from Products.CMFPlone.utils import safe_unicode\n+from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope import schema\n from zope.component import getUtility\n from zope.interface import implementer\n+\n import logging\n import re\n import six\n@@ -164,14 +166,15 @@ def transformed(self, mt=\'text/x-html-safe\'):\n             # utf-8 text. There were bugs in earlier versions of this portlet\n             # which stored text directly as sent by the browser, which could\n             # be any encoding in the world.\n-            orig = six.text_type(orig, \'utf-8\', \'ignore\')\n+            orig = safe_unicode(orig)\n             logger.warn(\n-                "Static portlet at %s has stored non-six.text_type text. "\n+                "Static portlet at %s has not stored text/unicode. "\n                 "Assuming utf-8 encoding." % context.absolute_url()\n             )\n \n-        # Portal transforms needs encoded strings\n-        orig = orig.encode(\'utf-8\')\n+        # Portal transforms on py2 needs encoded strings\n+        if six.PY2 and isinstance(orig, six.text_type):\n+            orig = orig.encode(\'utf-8\')\n \n         transformer = getToolByName(context, \'portal_transforms\')\n         transformer_context = context\n@@ -185,9 +188,7 @@ def transformed(self, mt=\'text/x-html-safe\'):\n                                      context=transformer_context, mimetype=\'text/html\')\n         result = data.getData()\n         if result:\n-            if isinstance(result, str):\n-                return six.text_type(result, \'utf-8\')\n-            return result\n+            return safe_unicode(result)\n         return None\n \n \ndiff --git a/setup.py b/setup.py\nindex a83cbc2..243600c 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -25,11 +25,14 @@ def read(*rnames):\n         "Framework :: Plone",\n         "Framework :: Plone :: 5.0",\n         "Framework :: Plone :: 5.1",\n+        "Framework :: Plone :: 5.2",\n         "Framework :: Zope2",\n         "License :: OSI Approved :: GNU General Public License v2 (GPLv2)",\n         "Operating System :: OS Independent",\n         "Programming Language :: Python",\n         "Programming Language :: Python :: 2.7",\n+        "Programming Language :: Python :: 3.6",\n+        "Programming Language :: Python :: 3.7",\n     ],\n     keywords=\'plone portlet static\',\n     author=\'Plone Foundation\',\n'

