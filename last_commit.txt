Repository: plone.app.robotframework


Branch: refs/heads/master
Date: 2019-11-20T16:48:58+01:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.robotframework/commit/e79bd78402640a74ef44ce4c086cbc31e05e713c

Remove deprecation warnings

Files changed:
A news/116.bugfix
M src/plone/app/robotframework/i18n.py
M src/plone/app/robotframework/server.py
M src/plone/app/robotframework/testing.py
M src/plone/app/robotframework/tests/test_robotfixture.py
M src/plone/app/robotframework/variables.py

b'diff --git a/news/116.bugfix b/news/116.bugfix\nnew file mode 100644\nindex 0000000..865a87f\n--- /dev/null\n+++ b/news/116.bugfix\n@@ -0,0 +1 @@\n+Remove deprecation warnings [ale-rt]\ndiff --git a/src/plone/app/robotframework/i18n.py b/src/plone/app/robotframework/i18n.py\nindex 1e18b77..f07392c 100644\n--- a/src/plone/app/robotframework/i18n.py\n+++ b/src/plone/app/robotframework/i18n.py\n@@ -2,7 +2,6 @@\n from plone.app.robotframework.remote import RemoteLibrary\n from plone.app.robotframework.utils import disableCSRFProtection\n from plone.registry.interfaces import IRegistry\n-from Products.CMFPlone.interfaces import ILanguageSchema\n from zope.component import getUtility\n from zope.globalrequest import getRequest\n from zope.i18n import translate\n@@ -10,6 +9,13 @@\n import os\n \n \n+try:\n+    from plone.i18n.interfaces import ILanguageSchema\n+except ImportError:\n+    # BBB for Plone 5.1, remove with Plone 6\n+    from Products.CMFPlone.interfaces import ILanguageSchema\n+\n+\n class I18N(RemoteLibrary):\n \n     def set_default_language(self, language=None):\ndiff --git a/src/plone/app/robotframework/server.py b/src/plone/app/robotframework/server.py\nindex ea7ff95..4ab5222 100644\n--- a/src/plone/app/robotframework/server.py\n+++ b/src/plone/app/robotframework/server.py\n@@ -22,6 +22,12 @@\n     from plone.app.robotframework.reload import Watcher\n     HAS_RELOAD = True\n \n+try:\n+    from plone.testing.zope import WSGIServer\n+except ImportError:\n+    # Plone 5.1 compatibility, remove in Plone 6\n+    from plone.testing.z2 import ZServer as WSGIServer\n+\n \n HAS_DEBUG_MODE = False\n HAS_VERBOSE_CONSOLE = False\n@@ -129,8 +135,7 @@ def start_reload(zope_layer_dotted_name, reload_paths=(\'src\',),\n         socket.gethostbyaddr = lambda x: time.sleep(0.5) or (ZSERVER_HOST,)\n \n     # Setting smaller asyncore poll timeout will speed up restart a bit\n-    import plone.testing.z2\n-    plone.testing.z2.ZServer.timeout = 0.5\n+    WSGIServer.timeout = 0.5\n \n     zsl.amend_zope_server(zope_layer_dotted_name)\n \ndiff --git a/src/plone/app/robotframework/testing.py b/src/plone/app/robotframework/testing.py\nindex 74705e4..74ce372 100644\n--- a/src/plone/app/robotframework/testing.py\n+++ b/src/plone/app/robotframework/testing.py\n@@ -17,7 +17,6 @@\n from plone.app.testing import PloneSandboxLayer\n from plone.app.testing import ploneSite\n from plone.testing import Layer\n-from plone.testing import z2\n from Products.MailHost.interfaces import IMailHost\n from robot.libraries.BuiltIn import BuiltIn\n from zope.component import getSiteManager\n@@ -36,6 +35,19 @@\n else:\n     HAS_SPEAKJS = True\n \n+try:\n+    from plone.testing import zope as zope_testing\n+except ImportError:\n+    # Plone 5.1 compatibility, remove in Plone 6\n+    from plone.testing import z2 as zope_testing\n+\n+\n+try:\n+    from plone.testing.zope import WSGI_SERVER_FIXTURE\n+except ImportError:\n+    # Plone 5.1 compatibility, remove in Plone 6\n+    from plone.testing.z2 import ZSERVER_FIXTURE as WSGI_SERVER_FIXTURE\n+\n \n class SimplePublicationLayer(Layer):\n     defaultBases = (PLONE_FIXTURE,)\n@@ -157,13 +169,13 @@ def tearDown(self):\n     bases=(\n         SIMPLE_PUBLICATION_FIXTURE,\n         REMOTE_LIBRARY_BUNDLE_FIXTURE,\n-        z2.ZSERVER_FIXTURE,\n+        WSGI_SERVER_FIXTURE,\n     ),\n     name="RemoteLibrary:Robot",\n )\n \n AUTOLOGIN_ROBOT_TESTING = FunctionalTesting(\n-    bases=(AUTOLOGIN_LIBRARY_FIXTURE, z2.ZSERVER_FIXTURE),\n+    bases=(AUTOLOGIN_LIBRARY_FIXTURE, WSGI_SERVER_FIXTURE),\n     name="AutoLogin:Robot",\n )\n \n@@ -171,7 +183,7 @@ def tearDown(self):\n     bases=(\n         SIMPLE_PUBLICATION_FIXTURE,\n         REMOTE_LIBRARY_BUNDLE_FIXTURE,\n-        z2.ZSERVER_FIXTURE,\n+        WSGI_SERVER_FIXTURE,\n     ),\n     name="SimplePublication:Robot",\n )\n@@ -180,7 +192,7 @@ def tearDown(self):\n     bases=(\n         SIMPLE_PUBLICATION_WITH_TYPES_FIXTURE,\n         REMOTE_LIBRARY_BUNDLE_FIXTURE,\n-        z2.ZSERVER_FIXTURE,\n+        WSGI_SERVER_FIXTURE,\n     ),\n     name="SimplePublicationWithTypes:Robot",\n )\n@@ -243,7 +255,7 @@ def setUpZope(self, app, configurationContext):\n         for name in self._get_robot_variable(\'INSTALL_PRODUCTS\'):\n             if name not in sys.modules:\n                 __import__(name)\n-            z2.installProduct(app, name)\n+            zope_testing.installProduct(app, name)\n             self[\'state\'].append(name)\n \n     def setUpPloneSite(self, portal):\n@@ -282,7 +294,7 @@ class Value:\n     bases=(\n         PLONE_ROBOT_FIXTURE,\n         REMOTE_LIBRARY_BUNDLE_FIXTURE,\n-        z2.ZSERVER_FIXTURE,\n+        WSGI_SERVER_FIXTURE,\n     ), name="Plone:Robot"\n )\n \n@@ -313,7 +325,7 @@ def setUp(self):\n             MOCK_MAILHOST_FIXTURE,\n             SIMPLE_PUBLICATION_FIXTURE,\n             REMOTE_LIBRARY_BUNDLE_FIXTURE,\n-            z2.ZSERVER_FIXTURE,\n+            WSGI_SERVER_FIXTURE,\n         ),\n         name="SpeakJS:Robot",\n     )\ndiff --git a/src/plone/app/robotframework/tests/test_robotfixture.py b/src/plone/app/robotframework/tests/test_robotfixture.py\nindex fa746b6..5ddca64 100644\n--- a/src/plone/app/robotframework/tests/test_robotfixture.py\n+++ b/src/plone/app/robotframework/tests/test_robotfixture.py\n@@ -1,14 +1,24 @@\n # -*- coding: utf-8 -*-\n+from plone.app.robotframework.testing import PloneRobotFixture\n+from plone.app.robotframework.testing import REMOTE_LIBRARY_BUNDLE_FIXTURE\n+from plone.testing import layered\n+\n import os\n+import robotsuite\n import unittest\n \n-import robotsuite\n-from plone.testing import z2\n-from plone.testing.z2 import FunctionalTesting\n-from plone.testing import layered\n \n-from plone.app.robotframework.testing import PloneRobotFixture\n-from plone.app.robotframework.testing import REMOTE_LIBRARY_BUNDLE_FIXTURE\n+try:\n+    from plone.testing.zope import FunctionalTesting\n+except ImportError:\n+    # Plone 5.1 compatibility, remove in Plone 6\n+    from plone.testing.z2 import FunctionalTesting\n+\n+try:\n+    from plone.testing.zope import WSGI_SERVER_FIXTURE\n+except ImportError:\n+    # Plone 5.1 compatibility, remove in Plone 6\n+    from plone.testing.z2 import ZSERVER_FIXTURE as WSGI_SERVER_FIXTURE\n \n \n class CustomPloneRobotFixture(PloneRobotFixture):\n@@ -32,7 +42,7 @@ def tearDown(self):\n     bases=(\n         PLONE_ROBOT_FIXTURE,\n         REMOTE_LIBRARY_BUNDLE_FIXTURE,\n-        z2.ZSERVER_FIXTURE,\n+        WSGI_SERVER_FIXTURE,\n     ),\n     name="Plone:Robot"\n )\ndiff --git a/src/plone/app/robotframework/variables.py b/src/plone/app/robotframework/variables.py\nindex e28fa8b..7cbed24 100644\n--- a/src/plone/app/robotframework/variables.py\n+++ b/src/plone/app/robotframework/variables.py\n@@ -1,9 +1,16 @@\n-from plone.testing.z2 import ZSERVER_FIXTURE\n+# coding=utf-8\n import os\n import pkg_resources\n \n-ZOPE_HOST = ZSERVER_FIXTURE.host\n-ZOPE_PORT = ZSERVER_FIXTURE.port\n+\n+try:\n+    from plone.testing.zope import WSGI_SERVER_FIXTURE\n+except ImportError:\n+    # Plone 5.1 compatibility, remove in Plone 6\n+    from plone.testing.z2 import ZSERVER_FIXTURE as WSGI_SERVER_FIXTURE\n+\n+ZOPE_HOST = WSGI_SERVER_FIXTURE.host\n+ZOPE_PORT = WSGI_SERVER_FIXTURE.port\n \n CMFPLONE_VERSION = pkg_resources.get_distribution(\'Products.CMFPlone\').version\n if CMFPLONE_VERSION.startswith(\'4.\'):\n'

Repository: plone.app.robotframework


Branch: refs/heads/master
Date: 2019-11-21T10:49:51+01:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.robotframework/commit/599edefeb82d9ac80b00f5dd40333cc2aa3805d6

Merge pull request #117 from plone/116-remove-deprecation

Remove deprecation warnings

Files changed:
A news/116.bugfix
M src/plone/app/robotframework/i18n.py
M src/plone/app/robotframework/server.py
M src/plone/app/robotframework/testing.py
M src/plone/app/robotframework/tests/test_robotfixture.py
M src/plone/app/robotframework/variables.py

b'diff --git a/news/116.bugfix b/news/116.bugfix\nnew file mode 100644\nindex 0000000..865a87f\n--- /dev/null\n+++ b/news/116.bugfix\n@@ -0,0 +1 @@\n+Remove deprecation warnings [ale-rt]\ndiff --git a/src/plone/app/robotframework/i18n.py b/src/plone/app/robotframework/i18n.py\nindex 1e18b77..f07392c 100644\n--- a/src/plone/app/robotframework/i18n.py\n+++ b/src/plone/app/robotframework/i18n.py\n@@ -2,7 +2,6 @@\n from plone.app.robotframework.remote import RemoteLibrary\n from plone.app.robotframework.utils import disableCSRFProtection\n from plone.registry.interfaces import IRegistry\n-from Products.CMFPlone.interfaces import ILanguageSchema\n from zope.component import getUtility\n from zope.globalrequest import getRequest\n from zope.i18n import translate\n@@ -10,6 +9,13 @@\n import os\n \n \n+try:\n+    from plone.i18n.interfaces import ILanguageSchema\n+except ImportError:\n+    # BBB for Plone 5.1, remove with Plone 6\n+    from Products.CMFPlone.interfaces import ILanguageSchema\n+\n+\n class I18N(RemoteLibrary):\n \n     def set_default_language(self, language=None):\ndiff --git a/src/plone/app/robotframework/server.py b/src/plone/app/robotframework/server.py\nindex ea7ff95..4ab5222 100644\n--- a/src/plone/app/robotframework/server.py\n+++ b/src/plone/app/robotframework/server.py\n@@ -22,6 +22,12 @@\n     from plone.app.robotframework.reload import Watcher\n     HAS_RELOAD = True\n \n+try:\n+    from plone.testing.zope import WSGIServer\n+except ImportError:\n+    # Plone 5.1 compatibility, remove in Plone 6\n+    from plone.testing.z2 import ZServer as WSGIServer\n+\n \n HAS_DEBUG_MODE = False\n HAS_VERBOSE_CONSOLE = False\n@@ -129,8 +135,7 @@ def start_reload(zope_layer_dotted_name, reload_paths=(\'src\',),\n         socket.gethostbyaddr = lambda x: time.sleep(0.5) or (ZSERVER_HOST,)\n \n     # Setting smaller asyncore poll timeout will speed up restart a bit\n-    import plone.testing.z2\n-    plone.testing.z2.ZServer.timeout = 0.5\n+    WSGIServer.timeout = 0.5\n \n     zsl.amend_zope_server(zope_layer_dotted_name)\n \ndiff --git a/src/plone/app/robotframework/testing.py b/src/plone/app/robotframework/testing.py\nindex 74705e4..74ce372 100644\n--- a/src/plone/app/robotframework/testing.py\n+++ b/src/plone/app/robotframework/testing.py\n@@ -17,7 +17,6 @@\n from plone.app.testing import PloneSandboxLayer\n from plone.app.testing import ploneSite\n from plone.testing import Layer\n-from plone.testing import z2\n from Products.MailHost.interfaces import IMailHost\n from robot.libraries.BuiltIn import BuiltIn\n from zope.component import getSiteManager\n@@ -36,6 +35,19 @@\n else:\n     HAS_SPEAKJS = True\n \n+try:\n+    from plone.testing import zope as zope_testing\n+except ImportError:\n+    # Plone 5.1 compatibility, remove in Plone 6\n+    from plone.testing import z2 as zope_testing\n+\n+\n+try:\n+    from plone.testing.zope import WSGI_SERVER_FIXTURE\n+except ImportError:\n+    # Plone 5.1 compatibility, remove in Plone 6\n+    from plone.testing.z2 import ZSERVER_FIXTURE as WSGI_SERVER_FIXTURE\n+\n \n class SimplePublicationLayer(Layer):\n     defaultBases = (PLONE_FIXTURE,)\n@@ -157,13 +169,13 @@ def tearDown(self):\n     bases=(\n         SIMPLE_PUBLICATION_FIXTURE,\n         REMOTE_LIBRARY_BUNDLE_FIXTURE,\n-        z2.ZSERVER_FIXTURE,\n+        WSGI_SERVER_FIXTURE,\n     ),\n     name="RemoteLibrary:Robot",\n )\n \n AUTOLOGIN_ROBOT_TESTING = FunctionalTesting(\n-    bases=(AUTOLOGIN_LIBRARY_FIXTURE, z2.ZSERVER_FIXTURE),\n+    bases=(AUTOLOGIN_LIBRARY_FIXTURE, WSGI_SERVER_FIXTURE),\n     name="AutoLogin:Robot",\n )\n \n@@ -171,7 +183,7 @@ def tearDown(self):\n     bases=(\n         SIMPLE_PUBLICATION_FIXTURE,\n         REMOTE_LIBRARY_BUNDLE_FIXTURE,\n-        z2.ZSERVER_FIXTURE,\n+        WSGI_SERVER_FIXTURE,\n     ),\n     name="SimplePublication:Robot",\n )\n@@ -180,7 +192,7 @@ def tearDown(self):\n     bases=(\n         SIMPLE_PUBLICATION_WITH_TYPES_FIXTURE,\n         REMOTE_LIBRARY_BUNDLE_FIXTURE,\n-        z2.ZSERVER_FIXTURE,\n+        WSGI_SERVER_FIXTURE,\n     ),\n     name="SimplePublicationWithTypes:Robot",\n )\n@@ -243,7 +255,7 @@ def setUpZope(self, app, configurationContext):\n         for name in self._get_robot_variable(\'INSTALL_PRODUCTS\'):\n             if name not in sys.modules:\n                 __import__(name)\n-            z2.installProduct(app, name)\n+            zope_testing.installProduct(app, name)\n             self[\'state\'].append(name)\n \n     def setUpPloneSite(self, portal):\n@@ -282,7 +294,7 @@ class Value:\n     bases=(\n         PLONE_ROBOT_FIXTURE,\n         REMOTE_LIBRARY_BUNDLE_FIXTURE,\n-        z2.ZSERVER_FIXTURE,\n+        WSGI_SERVER_FIXTURE,\n     ), name="Plone:Robot"\n )\n \n@@ -313,7 +325,7 @@ def setUp(self):\n             MOCK_MAILHOST_FIXTURE,\n             SIMPLE_PUBLICATION_FIXTURE,\n             REMOTE_LIBRARY_BUNDLE_FIXTURE,\n-            z2.ZSERVER_FIXTURE,\n+            WSGI_SERVER_FIXTURE,\n         ),\n         name="SpeakJS:Robot",\n     )\ndiff --git a/src/plone/app/robotframework/tests/test_robotfixture.py b/src/plone/app/robotframework/tests/test_robotfixture.py\nindex fa746b6..5ddca64 100644\n--- a/src/plone/app/robotframework/tests/test_robotfixture.py\n+++ b/src/plone/app/robotframework/tests/test_robotfixture.py\n@@ -1,14 +1,24 @@\n # -*- coding: utf-8 -*-\n+from plone.app.robotframework.testing import PloneRobotFixture\n+from plone.app.robotframework.testing import REMOTE_LIBRARY_BUNDLE_FIXTURE\n+from plone.testing import layered\n+\n import os\n+import robotsuite\n import unittest\n \n-import robotsuite\n-from plone.testing import z2\n-from plone.testing.z2 import FunctionalTesting\n-from plone.testing import layered\n \n-from plone.app.robotframework.testing import PloneRobotFixture\n-from plone.app.robotframework.testing import REMOTE_LIBRARY_BUNDLE_FIXTURE\n+try:\n+    from plone.testing.zope import FunctionalTesting\n+except ImportError:\n+    # Plone 5.1 compatibility, remove in Plone 6\n+    from plone.testing.z2 import FunctionalTesting\n+\n+try:\n+    from plone.testing.zope import WSGI_SERVER_FIXTURE\n+except ImportError:\n+    # Plone 5.1 compatibility, remove in Plone 6\n+    from plone.testing.z2 import ZSERVER_FIXTURE as WSGI_SERVER_FIXTURE\n \n \n class CustomPloneRobotFixture(PloneRobotFixture):\n@@ -32,7 +42,7 @@ def tearDown(self):\n     bases=(\n         PLONE_ROBOT_FIXTURE,\n         REMOTE_LIBRARY_BUNDLE_FIXTURE,\n-        z2.ZSERVER_FIXTURE,\n+        WSGI_SERVER_FIXTURE,\n     ),\n     name="Plone:Robot"\n )\ndiff --git a/src/plone/app/robotframework/variables.py b/src/plone/app/robotframework/variables.py\nindex e28fa8b..7cbed24 100644\n--- a/src/plone/app/robotframework/variables.py\n+++ b/src/plone/app/robotframework/variables.py\n@@ -1,9 +1,16 @@\n-from plone.testing.z2 import ZSERVER_FIXTURE\n+# coding=utf-8\n import os\n import pkg_resources\n \n-ZOPE_HOST = ZSERVER_FIXTURE.host\n-ZOPE_PORT = ZSERVER_FIXTURE.port\n+\n+try:\n+    from plone.testing.zope import WSGI_SERVER_FIXTURE\n+except ImportError:\n+    # Plone 5.1 compatibility, remove in Plone 6\n+    from plone.testing.z2 import ZSERVER_FIXTURE as WSGI_SERVER_FIXTURE\n+\n+ZOPE_HOST = WSGI_SERVER_FIXTURE.host\n+ZOPE_PORT = WSGI_SERVER_FIXTURE.port\n \n CMFPLONE_VERSION = pkg_resources.get_distribution(\'Products.CMFPlone\').version\n if CMFPLONE_VERSION.startswith(\'4.\'):\n'

