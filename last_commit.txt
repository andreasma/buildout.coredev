Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2019-04-29T16:35:35+02:00
Author: Markus Hilbert (iham) <markus.hilbert@iham.at>
Commit: https://github.com/plone/plone.app.upgrade/commit/3ab3081516bdd5cb51f96df569764b8b62016ce3

Moved dotted named behaviors to named behaviors.

Files changed:
A news/204.bugfix
M plone/app/upgrade/v52/configure.zcml
M plone/app/upgrade/v52/final.py

b'diff --git a/news/204.bugfix b/news/204.bugfix\nnew file mode 100644\nindex 00000000..3548a9e8\n--- /dev/null\n+++ b/news/204.bugfix\n@@ -0,0 +1,2 @@\n+Moved dotted named behaviors to named behaviors.\n+[iham]\n\\ No newline at end of file\ndiff --git a/plone/app/upgrade/v52/configure.zcml b/plone/app/upgrade/v52/configure.zcml\nindex 843dace1..86af2e4a 100644\n--- a/plone/app/upgrade/v52/configure.zcml\n+++ b/plone/app/upgrade/v52/configure.zcml\n@@ -61,6 +61,12 @@\n             handler=".final.rebuild_redirections"\n             />\n \n+        <gs:upgradeStep\n+            title="Move from dotted behaviors to named behaviors."\n+            description=""\n+            handler=".final.move_dotted_to_named_behaviors"\n+            />\n+\n     </gs:upgradeSteps>\n \n </configure>\ndiff --git a/plone/app/upgrade/v52/final.py b/plone/app/upgrade/v52/final.py\nindex 6170cb9b..5caadcb7 100644\n--- a/plone/app/upgrade/v52/final.py\n+++ b/plone/app/upgrade/v52/final.py\n@@ -27,3 +27,33 @@ def rebuild_redirections(context):\n     )\n     storage._rebuild()\n     logger.info(\'Done rebuilding redirections.\')\n+\n+\n+def move_dotted_to_named_behaviors(context):\n+    """named behaviors are better then dotted behaviors > let\'s move them."""\n+    from plone import api\n+    from plone.behavior.registration import lookup_behavior_registration\n+    from plone.dexterity.interfaces import IDexterityFTI\n+\n+    ptt = api.portal.get_tool(\'portal_types\')\n+\n+    ftis = [fti for fti in ptt.objectValues() if IDexterityFTI.providedBy(fti)]\n+\n+    for fti in ftis:\n+        behaviors = []\n+        for behavior in fti.behaviors:\n+            behavior_registration = lookup_behavior_registration(behavior)\n+            behaviors.append(behavior_registration.name)\n+            logger.info(\n+                \'moved "{dotted}" to "{named}"\'.format(\n+                    dotted=behavior,\n+                    named=behavior_registration.name,\n+                ))\n+        fti.behaviors = tuple(behaviors)\n+        logger.info(\n+            \'converted dotted behaviors of {ct} to named behaviors.\'.format(\n+                ct=fti.title,\n+            ),\n+        )\n+\n+    logger.info(\'Done moving dotted to named behaviors.\')\n\\ No newline at end of file\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2019-05-01T16:06:30+02:00
Author: Markus Hilbert (iham) <markus.hilbert@iham.at>
Commit: https://github.com/plone/plone.app.upgrade/commit/4d880329d4fb595cc7b9daabf3b8e34c21425ef1

Moved dotted named behaviors to named behaviors.

Files changed:
M plone/app/upgrade/v52/final.py

b'diff --git a/plone/app/upgrade/v52/final.py b/plone/app/upgrade/v52/final.py\nindex 5caadcb7..6ebfd6fb 100644\n--- a/plone/app/upgrade/v52/final.py\n+++ b/plone/app/upgrade/v52/final.py\n@@ -43,15 +43,26 @@ def move_dotted_to_named_behaviors(context):\n         behaviors = []\n         for behavior in fti.behaviors:\n             behavior_registration = lookup_behavior_registration(behavior)\n-            behaviors.append(behavior_registration.name)\n-            logger.info(\n-                \'moved "{dotted}" to "{named}"\'.format(\n-                    dotted=behavior,\n-                    named=behavior_registration.name,\n-                ))\n+            named_behavior = behavior_registration.name\n+            if named_behavior:\n+                behaviors.append(behavior_registration.name)\n+                logger.info(\n+                    \'Moved "{dotted}" to "{named}"\'.format(\n+                        dotted=behavior,\n+                        named=behavior_registration.name,\n+                    ),\n+                )\n+            else:\n+                behaviors.append(behavior)\n+                logger.info(\n+                    \'"{dotted}" has no name registered. \'\n+                    \'kept it dotted.\'.format(\n+                        dotted=behavior,\n+                    ),\n+                )\n         fti.behaviors = tuple(behaviors)\n         logger.info(\n-            \'converted dotted behaviors of {ct} to named behaviors.\'.format(\n+            \'Converted dotted behaviors of {ct} to named behaviors.\'.format(\n                 ct=fti.title,\n             ),\n         )\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2019-05-01T16:11:49+02:00
Author: Markus Hilbert (iham) <markus.hilbert@iham.at>
Commit: https://github.com/plone/plone.app.upgrade/commit/f00b3857acbf0caf0304522d01ce5f70f34e2b36

code cleanup.

Files changed:
M plone/app/upgrade/v52/final.py

b'diff --git a/plone/app/upgrade/v52/final.py b/plone/app/upgrade/v52/final.py\nindex 6ebfd6fb..c466ae21 100644\n--- a/plone/app/upgrade/v52/final.py\n+++ b/plone/app/upgrade/v52/final.py\n@@ -45,11 +45,11 @@ def move_dotted_to_named_behaviors(context):\n             behavior_registration = lookup_behavior_registration(behavior)\n             named_behavior = behavior_registration.name\n             if named_behavior:\n-                behaviors.append(behavior_registration.name)\n+                behaviors.append(named_behavior)\n                 logger.info(\n                     \'Moved "{dotted}" to "{named}"\'.format(\n                         dotted=behavior,\n-                        named=behavior_registration.name,\n+                        named=named_behavior,\n                     ),\n                 )\n             else:\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2019-05-02T11:18:22+02:00
Author: Markus Hilbert (iham) <markus.hilbert@iham.at>
Commit: https://github.com/plone/plone.app.upgrade/commit/df112dfa01a190523160a2d39214185995cc8a5b

added more verbosity in logger info.

Files changed:
M plone/app/upgrade/v52/final.py

b'diff --git a/plone/app/upgrade/v52/final.py b/plone/app/upgrade/v52/final.py\nindex c466ae21..ded00e0d 100644\n--- a/plone/app/upgrade/v52/final.py\n+++ b/plone/app/upgrade/v52/final.py\n@@ -46,12 +46,19 @@ def move_dotted_to_named_behaviors(context):\n             named_behavior = behavior_registration.name\n             if named_behavior:\n                 behaviors.append(named_behavior)\n-                logger.info(\n-                    \'Moved "{dotted}" to "{named}"\'.format(\n-                        dotted=behavior,\n-                        named=named_behavior,\n-                    ),\n-                )\n+                if named_behavior == behavior:\n+                    logger.info(\n+                        \'Behavior "{behavior}" already named.\'.format(\n+                            behavior=behavior,\n+                        ),\n+                    )\n+                else:\n+                    logger.info(\n+                        \'Moved "{dotted}" to "{named}"\'.format(\n+                            dotted=behavior,\n+                            named=named_behavior,\n+                        ),\n+                    )\n             else:\n                 behaviors.append(behavior)\n                 logger.info(\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2019-05-02T13:42:20+02:00
Author: Markus Hilbert (iham) <markus.hilbert@iham.at>
Commit: https://github.com/plone/plone.app.upgrade/commit/660f32bf531216f6b0d9345814d05f5fe01cb347

Merge pull request #205 from plone/issue_204

Moved dotted named behaviors to named behaviors.

Files changed:
A news/204.bugfix
M plone/app/upgrade/v52/configure.zcml
M plone/app/upgrade/v52/final.py

b'diff --git a/news/204.bugfix b/news/204.bugfix\nnew file mode 100644\nindex 00000000..3548a9e8\n--- /dev/null\n+++ b/news/204.bugfix\n@@ -0,0 +1,2 @@\n+Moved dotted named behaviors to named behaviors.\n+[iham]\n\\ No newline at end of file\ndiff --git a/plone/app/upgrade/v52/configure.zcml b/plone/app/upgrade/v52/configure.zcml\nindex 843dace1..86af2e4a 100644\n--- a/plone/app/upgrade/v52/configure.zcml\n+++ b/plone/app/upgrade/v52/configure.zcml\n@@ -61,6 +61,12 @@\n             handler=".final.rebuild_redirections"\n             />\n \n+        <gs:upgradeStep\n+            title="Move from dotted behaviors to named behaviors."\n+            description=""\n+            handler=".final.move_dotted_to_named_behaviors"\n+            />\n+\n     </gs:upgradeSteps>\n \n </configure>\ndiff --git a/plone/app/upgrade/v52/final.py b/plone/app/upgrade/v52/final.py\nindex 6170cb9b..ded00e0d 100644\n--- a/plone/app/upgrade/v52/final.py\n+++ b/plone/app/upgrade/v52/final.py\n@@ -27,3 +27,51 @@ def rebuild_redirections(context):\n     )\n     storage._rebuild()\n     logger.info(\'Done rebuilding redirections.\')\n+\n+\n+def move_dotted_to_named_behaviors(context):\n+    """named behaviors are better then dotted behaviors > let\'s move them."""\n+    from plone import api\n+    from plone.behavior.registration import lookup_behavior_registration\n+    from plone.dexterity.interfaces import IDexterityFTI\n+\n+    ptt = api.portal.get_tool(\'portal_types\')\n+\n+    ftis = [fti for fti in ptt.objectValues() if IDexterityFTI.providedBy(fti)]\n+\n+    for fti in ftis:\n+        behaviors = []\n+        for behavior in fti.behaviors:\n+            behavior_registration = lookup_behavior_registration(behavior)\n+            named_behavior = behavior_registration.name\n+            if named_behavior:\n+                behaviors.append(named_behavior)\n+                if named_behavior == behavior:\n+                    logger.info(\n+                        \'Behavior "{behavior}" already named.\'.format(\n+                            behavior=behavior,\n+                        ),\n+                    )\n+                else:\n+                    logger.info(\n+                        \'Moved "{dotted}" to "{named}"\'.format(\n+                            dotted=behavior,\n+                            named=named_behavior,\n+                        ),\n+                    )\n+            else:\n+                behaviors.append(behavior)\n+                logger.info(\n+                    \'"{dotted}" has no name registered. \'\n+                    \'kept it dotted.\'.format(\n+                        dotted=behavior,\n+                    ),\n+                )\n+        fti.behaviors = tuple(behaviors)\n+        logger.info(\n+            \'Converted dotted behaviors of {ct} to named behaviors.\'.format(\n+                ct=fti.title,\n+            ),\n+        )\n+\n+    logger.info(\'Done moving dotted to named behaviors.\')\n\\ No newline at end of file\n'

