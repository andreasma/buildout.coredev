Repository: plone.schema


Branch: refs/heads/master
Date: 2018-06-22T17:59:49+02:00
Author: Victor Fernandez de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.schema/commit/117e057a6189c31dcd276c8d21b124f3a6691b9d

Add a new JSONSchema Field for using it in the p.restapi @tiles endpoint.

Files changed:
A plone/schema/json.py
M setup.py

b'diff --git a/plone/schema/json.py b/plone/schema/json.py\nnew file mode 100644\nindex 0000000..325ebda\n--- /dev/null\n+++ b/plone/schema/json.py\n@@ -0,0 +1,47 @@\n+from plone.schema import _\n+from zope.interface import Attribute\n+from zope.interface import implementer\n+from zope.schema.interfaces import IField\n+from zope.schema import Field\n+from zope.schema._bootstrapinterfaces import WrongType\n+from zope.schema.interfaces import WrongContainedType\n+\n+import json\n+import jsonschema\n+\n+\n+DEFAULT_JSON_SCHEMA = json.dumps({\n+    \'type\': \'object\',\n+    \'properties\': {}\n+})\n+\n+\n+class IJSONField(IField):\n+    """A text field that stores A JSON."""\n+\n+    schema = Attribute(\n+        "schema",\n+        _("The JSON schema string serialization.")\n+    )\n+\n+\n+@implementer(IJSONField)\n+class JSONField(Field):\n+\n+    def __init__(self, schema=DEFAULT_JSON_SCHEMA, **kw):\n+        if not isinstance(schema, str):\n+            raise WrongType\n+\n+        try:\n+            self.json_schema = json.loads(schema)\n+        except ValueError:\n+            raise WrongType\n+        super(JSONField, self).__init__(**kw)\n+\n+    def _validate(self, value):\n+        super(JSONField, self)._validate(value)\n+\n+        try:\n+            jsonschema.validate(value, self.json_schema)\n+        except jsonschema.ValidationError as e:\n+            raise WrongContainedType(e.message, self.__name__)\ndiff --git a/setup.py b/setup.py\nindex 6e336e7..006d564 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -32,6 +32,7 @@\n     install_requires=[\n         \'setuptools\',\n         \'plone.app.z3cform\',\n+        \'jsonschema\',\n         \'z3c.form\',\n         \'zope.component\',\n         \'zope.i18nmessageid\',\n'

Repository: plone.schema


Branch: refs/heads/master
Date: 2018-06-23T00:54:50+02:00
Author: Victor Fernandez de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.schema/commit/4744c774febbe171503e5e128d8cb01f3765ba62

Rename module for not colision with json

Files changed:
A plone/schema/jsonfield.py
M plone/schema/__init__.py
D plone/schema/json.py

b'diff --git a/plone/schema/__init__.py b/plone/schema/__init__.py\nindex 20f9636..2cf35ac 100644\n--- a/plone/schema/__init__.py\n+++ b/plone/schema/__init__.py\n@@ -8,6 +8,9 @@\n from .path import Path\n from .path import IPath\n \n+from .jsonfield import JSONField\n+from .jsonfield import IJSONField\n+\n # zope.schema convenience imports\n from zope.schema._field import ASCII\n from zope.schema._field import ASCIILine\ndiff --git a/plone/schema/json.py b/plone/schema/jsonfield.py\nsimilarity index 100%\nrename from plone/schema/json.py\nrename to plone/schema/jsonfield.py\nindex 325ebda..008ab66 100644\n--- a/plone/schema/json.py\n+++ b/plone/schema/jsonfield.py\n@@ -1,9 +1,9 @@\n from plone.schema import _\n from zope.interface import Attribute\n from zope.interface import implementer\n-from zope.schema.interfaces import IField\n from zope.schema import Field\n from zope.schema._bootstrapinterfaces import WrongType\n+from zope.schema.interfaces import IField\n from zope.schema.interfaces import WrongContainedType\n \n import json\n'

Repository: plone.schema


Branch: refs/heads/master
Date: 2018-06-23T00:56:34+02:00
Author: Victor Fernandez de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.schema/commit/c7e13dfa1c8e6a014b4e31089788c92030418322

Add Changelog

Files changed:
M CHANGES.rst

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex de5bbe1..75c7330 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -3,7 +3,8 @@\n \n New:\n \n-- *add item here*\n+- Add new JSONField, JSONSchema auto validated.\n+  [sneridagh]\n \n Fixes:\n \n'

Repository: plone.schema


Branch: refs/heads/master
Date: 2018-06-23T10:27:52+02:00
Author: Timo Stollenwerk (tisto) <tisto@users.noreply.github.com>
Commit: https://github.com/plone/plone.schema/commit/0fa62ba28c96ff563b7951bc91034f454ef0983a

Merge pull request #3 from plone/newjsonschemafield

Newjsonschemafield

Files changed:
A plone/schema/jsonfield.py
M CHANGES.rst
M plone/schema/__init__.py
M setup.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex de5bbe1..75c7330 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -3,7 +3,8 @@\n \n New:\n \n-- *add item here*\n+- Add new JSONField, JSONSchema auto validated.\n+  [sneridagh]\n \n Fixes:\n \ndiff --git a/plone/schema/__init__.py b/plone/schema/__init__.py\nindex 20f9636..2cf35ac 100644\n--- a/plone/schema/__init__.py\n+++ b/plone/schema/__init__.py\n@@ -8,6 +8,9 @@\n from .path import Path\n from .path import IPath\n \n+from .jsonfield import JSONField\n+from .jsonfield import IJSONField\n+\n # zope.schema convenience imports\n from zope.schema._field import ASCII\n from zope.schema._field import ASCIILine\ndiff --git a/plone/schema/jsonfield.py b/plone/schema/jsonfield.py\nnew file mode 100644\nindex 0000000..008ab66\n--- /dev/null\n+++ b/plone/schema/jsonfield.py\n@@ -0,0 +1,47 @@\n+from plone.schema import _\n+from zope.interface import Attribute\n+from zope.interface import implementer\n+from zope.schema import Field\n+from zope.schema._bootstrapinterfaces import WrongType\n+from zope.schema.interfaces import IField\n+from zope.schema.interfaces import WrongContainedType\n+\n+import json\n+import jsonschema\n+\n+\n+DEFAULT_JSON_SCHEMA = json.dumps({\n+    \'type\': \'object\',\n+    \'properties\': {}\n+})\n+\n+\n+class IJSONField(IField):\n+    """A text field that stores A JSON."""\n+\n+    schema = Attribute(\n+        "schema",\n+        _("The JSON schema string serialization.")\n+    )\n+\n+\n+@implementer(IJSONField)\n+class JSONField(Field):\n+\n+    def __init__(self, schema=DEFAULT_JSON_SCHEMA, **kw):\n+        if not isinstance(schema, str):\n+            raise WrongType\n+\n+        try:\n+            self.json_schema = json.loads(schema)\n+        except ValueError:\n+            raise WrongType\n+        super(JSONField, self).__init__(**kw)\n+\n+    def _validate(self, value):\n+        super(JSONField, self)._validate(value)\n+\n+        try:\n+            jsonschema.validate(value, self.json_schema)\n+        except jsonschema.ValidationError as e:\n+            raise WrongContainedType(e.message, self.__name__)\ndiff --git a/setup.py b/setup.py\nindex 6e336e7..006d564 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -32,6 +32,7 @@\n     install_requires=[\n         \'setuptools\',\n         \'plone.app.z3cform\',\n+        \'jsonschema\',\n         \'z3c.form\',\n         \'zope.component\',\n         \'zope.i18nmessageid\',\n'

