Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2018-05-07T20:53:46+01:00
Author: Matthew Wilkes (MatthewWilkes) <git@matthewwilkes.name>
Commit: https://github.com/plone/plone.app.z3cform/commit/1fa3ed7a7bf4fe8f4aad7cd847ed3382fa00c53f

Change the RichTextWidget to use unicode

This fixes rendering errors when instantiating the pattern under
Python3 as lxml expects unicode or ascii.

Files changed:
M CHANGES.rst
M plone/app/z3cform/widget.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c1b535e..8c091ba 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,7 +18,7 @@ Bug fixes:
   [allusa]
 
 - Prepare for Python 2 / 3 compatibility
-  [pbauer]
+  [pbauer, MatthewWilkes]
 
 
 3.0.4 (2018-02-04)
diff --git a/plone/app/z3cform/widget.py b/plone/app/z3cform/widget.py
index 3f62c61..1dc6174 100644
--- a/plone/app/z3cform/widget.py
+++ b/plone/app/z3cform/widget.py
@@ -609,10 +609,8 @@ def pattern(self):
     def _base_args(self):
         args = super(RichTextWidget, self)._base_args()
         args['name'] = self.name
-        value = self.value and self.value.raw_encoded or ''
-        value = (self.request.get(self.field.getName(), value))
-        if six.PY2:
-            value = value.decode('utf-8')
+        value = self.value and self.value.raw or u''
+        value = self.request.get(self.name, value)
         args['value'] = value
 
         args.setdefault('pattern_options', {})


Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2018-05-07T20:26:49-04:00
Author: David Glick (davisagli) <david.glick@plone.org>
Commit: https://github.com/plone/plone.app.z3cform/commit/e12b6821ec1c6b4c57ce908b2ee599a98f4ace4d

Merge pull request #89 from plone/richtext-encoding

Change the RichTextWidget to use unicode

Files changed:
M CHANGES.rst
M plone/app/z3cform/widget.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c1b535e..8c091ba 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,7 +18,7 @@ Bug fixes:
   [allusa]
 
 - Prepare for Python 2 / 3 compatibility
-  [pbauer]
+  [pbauer, MatthewWilkes]
 
 
 3.0.4 (2018-02-04)
diff --git a/plone/app/z3cform/widget.py b/plone/app/z3cform/widget.py
index 3f62c61..1dc6174 100644
--- a/plone/app/z3cform/widget.py
+++ b/plone/app/z3cform/widget.py
@@ -609,10 +609,8 @@ def pattern(self):
     def _base_args(self):
         args = super(RichTextWidget, self)._base_args()
         args['name'] = self.name
-        value = self.value and self.value.raw_encoded or ''
-        value = (self.request.get(self.field.getName(), value))
-        if six.PY2:
-            value = value.decode('utf-8')
+        value = self.value and self.value.raw or u''
+        value = self.request.get(self.name, value)
         args['value'] = value
 
         args.setdefault('pattern_options', {})


