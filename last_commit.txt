Repository: plone.app.testing


Branch: refs/heads/master
Date: 2020-02-11T17:25:09+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.testing/commit/78514da0165c6ea34fc08174bd0b682287b706ff

fixes for Zope 4.2.1

Files changed:
M src/plone/app/testing/helpers.rst
M src/plone/app/testing/layers.rst

b'diff --git a/src/plone/app/testing/helpers.rst b/src/plone/app/testing/helpers.rst\nindex b4742ec..7f1eac5 100644\n--- a/src/plone/app/testing/helpers.rst\n+++ b/src/plone/app/testing/helpers.rst\n@@ -237,7 +237,7 @@ We\'ll now tear down just the ``HELPER_DEMOS_INTEGRATION_TESTING`` layer. At this\n point, we should still have a Plone site, but none of the persistent or\n component architecture changes from our layer.\n \n-    >>> runner.tear_down_unneeded(options, [l for l in setupLayers if l not in (HELPER_DEMOS_INTEGRATION_TESTING, HELPER_DEMOS_FIXTURE,)], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [l for l in setupLayers if l not in (HELPER_DEMOS_INTEGRATION_TESTING, HELPER_DEMOS_FIXTURE,)], setupLayers, [])\n     Tear down plone.app.testing.layers.HelperDemos:Integration in ... seconds.\n     Tear down...HelperDemos in ... seconds.\n \n@@ -254,7 +254,7 @@ component architecture changes from our layer.\n \n Let\'s tear down the rest of the layers too.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\n     Tear down plone.testing.zca.LayerCleanup in ... seconds.\n@@ -397,7 +397,7 @@ We\'ll now tear down just the ``MY_INTEGRATION_TESTING`` layer. At this\n point, we should still have a Plone site, but none of the changes from our\n layer.\n \n-    >>> runner.tear_down_unneeded(options, [l for l in setupLayers if l not in (MY_INTEGRATION_TESTING, MY_FIXTURE)], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [l for l in setupLayers if l not in (MY_INTEGRATION_TESTING, MY_FIXTURE)], setupLayers, [])\n     Tear down plone.app.testing.layers.MyLayer:Integration in ... seconds.\n \n     >>> queryUtility(Interface, name="dummy1") is None\n@@ -436,7 +436,7 @@ layer.\n \n Let\'s tear down the rest of the layers too.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\n     Tear down plone.testing.zca.LayerCleanup in ... seconds.\ndiff --git a/src/plone/app/testing/layers.rst b/src/plone/app/testing/layers.rst\nindex 8304321..602931a 100644\n--- a/src/plone/app/testing/layers.rst\n+++ b/src/plone/app/testing/layers.rst\n@@ -98,7 +98,7 @@ There is no default workflow or content:\n \n Layer tear-down resets the environment.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\n     Tear down plone.testing.zca.LayerCleanup in ... seconds.\n@@ -186,7 +186,7 @@ And the component site has been reset:\n \n Layer tear-down resets the environment.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.Plone:Integration in ... seconds.\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\n@@ -266,7 +266,7 @@ Along with the rest of the state:\n \n Layer tear-down resets the environment.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.Plone:Functional in ... seconds.\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\n@@ -367,7 +367,7 @@ Test tear-down does nothing beyond what the base layers do.\n \n When the server is torn down, the ZServer thread is stopped.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.Plone:WSGIServer in ... seconds.\n     Tear down plone.testing.zope.WSGIServer in ... seconds.\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n@@ -469,7 +469,7 @@ When the test is torn down the original MaiHost is restored:\n     ...\n     AttributeError: \'RequestContainer\' object has no attribute \'messages\'\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.MockMailHostLayer in ... seconds.\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\n'

Repository: plone.app.testing


Branch: refs/heads/master
Date: 2020-02-12T14:15:36+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.testing/commit/993e2fefbe58ea8585d5b01989c700b525d2a150

fixes for Zope 4.2.1

Files changed:
M src/plone/app/testing/helpers.rst
M src/plone/app/testing/layers.rst

b'diff --git a/src/plone/app/testing/helpers.rst b/src/plone/app/testing/helpers.rst\nindex b4742ec..7f1eac5 100644\n--- a/src/plone/app/testing/helpers.rst\n+++ b/src/plone/app/testing/helpers.rst\n@@ -237,7 +237,7 @@ We\'ll now tear down just the ``HELPER_DEMOS_INTEGRATION_TESTING`` layer. At this\n point, we should still have a Plone site, but none of the persistent or\n component architecture changes from our layer.\n \n-    >>> runner.tear_down_unneeded(options, [l for l in setupLayers if l not in (HELPER_DEMOS_INTEGRATION_TESTING, HELPER_DEMOS_FIXTURE,)], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [l for l in setupLayers if l not in (HELPER_DEMOS_INTEGRATION_TESTING, HELPER_DEMOS_FIXTURE,)], setupLayers, [])\n     Tear down plone.app.testing.layers.HelperDemos:Integration in ... seconds.\n     Tear down...HelperDemos in ... seconds.\n \n@@ -254,7 +254,7 @@ component architecture changes from our layer.\n \n Let\'s tear down the rest of the layers too.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\n     Tear down plone.testing.zca.LayerCleanup in ... seconds.\n@@ -397,7 +397,7 @@ We\'ll now tear down just the ``MY_INTEGRATION_TESTING`` layer. At this\n point, we should still have a Plone site, but none of the changes from our\n layer.\n \n-    >>> runner.tear_down_unneeded(options, [l for l in setupLayers if l not in (MY_INTEGRATION_TESTING, MY_FIXTURE)], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [l for l in setupLayers if l not in (MY_INTEGRATION_TESTING, MY_FIXTURE)], setupLayers, [])\n     Tear down plone.app.testing.layers.MyLayer:Integration in ... seconds.\n \n     >>> queryUtility(Interface, name="dummy1") is None\n@@ -436,7 +436,7 @@ layer.\n \n Let\'s tear down the rest of the layers too.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\n     Tear down plone.testing.zca.LayerCleanup in ... seconds.\ndiff --git a/src/plone/app/testing/layers.rst b/src/plone/app/testing/layers.rst\nindex 3603707..3989062 100644\n--- a/src/plone/app/testing/layers.rst\n+++ b/src/plone/app/testing/layers.rst\n@@ -98,7 +98,7 @@ There is no default workflow or content:\n \n Layer tear-down resets the environment.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\n     Tear down plone.testing.zca.LayerCleanup in ... seconds.\n@@ -186,7 +186,7 @@ And the component site has been reset:\n \n Layer tear-down resets the environment.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.Plone:Integration in ... seconds.\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\n@@ -266,7 +266,7 @@ Along with the rest of the state:\n \n Layer tear-down resets the environment.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.Plone:Functional in ... seconds.\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\n@@ -367,7 +367,7 @@ Test tear-down does nothing beyond what the base layers do.\n \n When the server is torn down, the ZServer thread is stopped.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.Plone:WSGIServer in ... seconds.\n     Tear down plone.testing.zope.WSGIServer in ... seconds.\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n@@ -472,7 +472,7 @@ and the registry is cleaned up:\n \n     >>> registry["plone.email_from_address"]\n     >>> registry["plone.email_from_name"]\n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.MockMailHostLayer in ... seconds.\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\n'

Repository: plone.app.testing


Branch: refs/heads/master
Date: 2020-02-12T15:41:32+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.testing/commit/48608c67ef6245504843e159a03970315dbc64b4

Merge remote-tracking branch 'remotes/origin/zope-4.2.1' into zope-4.2.1

Files changed:
M news/62.bugfix
M src/plone/app/testing/layers.py
M src/plone/app/testing/layers.rst

b'diff --git a/news/62.bugfix b/news/62.bugfix\nindex 4a8304d..ec5183e 100644\n--- a/news/62.bugfix\n+++ b/news/62.bugfix\n@@ -1 +1 @@\n-Properly configure the mail sender setting the appropriate registry records (Fixes #62)\n+MockMailHostLayer configures the mail sender setting the appropriate registry records (Fixes #62)\ndiff --git a/src/plone/app/testing/layers.py b/src/plone/app/testing/layers.py\nindex b6d8a96..a250b21 100644\n--- a/src/plone/app/testing/layers.py\n+++ b/src/plone/app/testing/layers.py\n@@ -388,28 +388,43 @@ def testSetUp(self):\n         with zope.zopeApp() as app:\n             portal = app[PLONE_SITE_ID]\n             registry = getUtility(IRegistry, context=portal)\n+\n             if not registry["plone.email_from_address"]:\n+                portal._original_email_address = registry["plone.email_from_address"]  # noqa: E501\n                 registry["plone.email_from_address"] = "noreply@example.com"\n+\n             if not registry["plone.email_from_name"]:\n+                portal._original_email_name = registry["plone.email_from_name"]\n                 registry["plone.email_from_name"] = u"Plone site"\n+\n             portal._original_MailHost = portal.MailHost\n             portal.MailHost = mailhost = MockMailHost(\'MailHost\')\n+\n             sm = getSiteManager(context=portal)\n             sm.unregisterUtility(provided=IMailHost)\n             sm.registerUtility(mailhost, provided=IMailHost)\n \n     def testTearDown(self):\n+\n         with zope.zopeApp() as app:\n             portal = app[PLONE_SITE_ID]\n-            _o_mailhost = getattr(portal, \'_original_MailHost\', None)\n-            if _o_mailhost:\n-                portal.MailHost = portal._original_MailHost\n-                sm = getSiteManager(context=portal)\n-                sm.unregisterUtility(provided=IMailHost)\n-                sm.registerUtility(\n-                    aq_base(portal._original_MailHost),\n-                    provided=IMailHost\n-                )\n+            registry = getUtility(IRegistry, context=portal)\n+\n+            portal.MailHost = portal._original_MailHost\n+\n+            sm = getSiteManager(context=portal)\n+            sm.unregisterUtility(provided=IMailHost)\n+            sm.registerUtility(aq_base(portal.MailHost), provided=IMailHost)\n+\n+            if hasattr(portal, "_original_email_name"):\n+                registry["plone.email_from_name"] = portal._original_email_name\n+                delattr(portal, "_original_email_name")\n+\n+            if hasattr(portal, "_original_email_address"):\n+                registry["plone.email_from_address"] = portal._original_email_address  # noqa: E501\n+                delattr(portal, "_original_email_address")\n+\n+            delattr(portal, "_original_MailHost")\n \n \n MOCK_MAILHOST_FIXTURE = MockMailHostLayer()\ndiff --git a/src/plone/app/testing/layers.rst b/src/plone/app/testing/layers.rst\nindex 602931a..3989062 100644\n--- a/src/plone/app/testing/layers.rst\n+++ b/src/plone/app/testing/layers.rst\n@@ -457,7 +457,8 @@ The list can be reset:\n     ...     portal.MailHost.messages\n     []\n \n-When the test is torn down the original MaiHost is restored:\n+When the test is torn down the original MaiHost is restored\n+and the registry is cleaned up:\n \n     >>> layers.MOCK_MAILHOST_FIXTURE.testTearDown()\n     >>> zope.STARTUP.testTearDown()\n@@ -469,6 +470,8 @@ When the test is torn down the original MaiHost is restored:\n     ...\n     AttributeError: \'RequestContainer\' object has no attribute \'messages\'\n \n+    >>> registry["plone.email_from_address"]\n+    >>> registry["plone.email_from_name"]\n     >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.MockMailHostLayer in ... seconds.\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n'

Repository: plone.app.testing


Branch: refs/heads/master
Date: 2020-02-14T14:06:18+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.testing/commit/7013434f2f0e35d683a8fbea0ff36ea9a4ef29d5

doc changes

Files changed:
A news/68.bugfix

b'diff --git a/news/68.bugfix b/news/68.bugfix\nnew file mode 100644\nindex 0000000..c018db7\n--- /dev/null\n+++ b/news/68.bugfix\n@@ -0,0 +1,2 @@\n+Fix tests when using zope.testrunner internals since its version 5.1.\n+[jensens]\n\\ No newline at end of file\n'

Repository: plone.app.testing


Branch: refs/heads/master
Date: 2020-02-14T14:15:45+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.testing/commit/d622d5e8baa0156b87954f180ee9e6844d0bb997

test 3.7/3.8, drop 3.5

Files changed:
M .travis.yml
M tox.ini

b'diff --git a/.travis.yml b/.travis.yml\nindex bf7811c..e76161f 100644\n--- a/.travis.yml\n+++ b/.travis.yml\n@@ -8,14 +8,18 @@ matrix:\n           env: TOXENV=lint-py27\n         - python: "3.6"\n           env: TOXENV=lint-py36\n+        - python: "3.7"\n+          env: TOXENV=lint-py37\n+        - python: "3.8"\n+          env: TOXENV=lint-py38\n         - python: "2.7"\n           env: TOXENV=py27\n-        - python: "3.5"\n-          env: TOXENV=py35\n         - python: "3.6"\n           env: TOXENV=py36\n         - python: "3.7"\n           env: TOXENV=py37\n+        - python: "3.8"\n+          env: TOXENV=py38\n \n install:\n     - travis_retry pip install -U tox coveralls coverage\ndiff --git a/tox.ini b/tox.ini\nindex 2c3eb24..0817a80 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -3,11 +3,13 @@ envlist =\n     py27,\n     py36,\n     py37,\n+    py38,\n     coverage-report,\n     docs,\n     lint-py27,\n     lint-py36,\n     lint-py37,\n+    lint-py38,\n \n minversion = 1.9\n \n@@ -115,7 +117,14 @@ commands = {[lint]commands}\n whitelist_externals = {[lint]whitelist_externals}\n \n [testenv:lint-py37]\n-basepython = python3.6\n+basepython = python3.7\n+skip_install = true\n+deps = {[lint]deps}\n+commands = {[lint]commands}\n+whitelist_externals = {[lint]whitelist_externals}\n+\n+[testenv:lint-py38]\n+basepython = python3.8\n skip_install = true\n deps = {[lint]deps}\n commands = {[lint]commands}\n'

Repository: plone.app.testing


Branch: refs/heads/master
Date: 2020-02-14T17:39:28+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.testing/commit/51573af0a0f6b52e3511534a3dcaf537726ac1f7

Merge pull request #68 from plone/zope-4.2.1

fixes for Zope 4.2.1

Files changed:
A news/68.bugfix
M .travis.yml
M src/plone/app/testing/helpers.rst
M src/plone/app/testing/layers.rst
M tox.ini

b'diff --git a/.travis.yml b/.travis.yml\nindex bf7811c..e76161f 100644\n--- a/.travis.yml\n+++ b/.travis.yml\n@@ -8,14 +8,18 @@ matrix:\n           env: TOXENV=lint-py27\n         - python: "3.6"\n           env: TOXENV=lint-py36\n+        - python: "3.7"\n+          env: TOXENV=lint-py37\n+        - python: "3.8"\n+          env: TOXENV=lint-py38\n         - python: "2.7"\n           env: TOXENV=py27\n-        - python: "3.5"\n-          env: TOXENV=py35\n         - python: "3.6"\n           env: TOXENV=py36\n         - python: "3.7"\n           env: TOXENV=py37\n+        - python: "3.8"\n+          env: TOXENV=py38\n \n install:\n     - travis_retry pip install -U tox coveralls coverage\ndiff --git a/news/68.bugfix b/news/68.bugfix\nnew file mode 100644\nindex 0000000..c018db7\n--- /dev/null\n+++ b/news/68.bugfix\n@@ -0,0 +1,2 @@\n+Fix tests when using zope.testrunner internals since its version 5.1.\n+[jensens]\n\\ No newline at end of file\ndiff --git a/src/plone/app/testing/helpers.rst b/src/plone/app/testing/helpers.rst\nindex b4742ec..7f1eac5 100644\n--- a/src/plone/app/testing/helpers.rst\n+++ b/src/plone/app/testing/helpers.rst\n@@ -237,7 +237,7 @@ We\'ll now tear down just the ``HELPER_DEMOS_INTEGRATION_TESTING`` layer. At this\n point, we should still have a Plone site, but none of the persistent or\n component architecture changes from our layer.\n \n-    >>> runner.tear_down_unneeded(options, [l for l in setupLayers if l not in (HELPER_DEMOS_INTEGRATION_TESTING, HELPER_DEMOS_FIXTURE,)], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [l for l in setupLayers if l not in (HELPER_DEMOS_INTEGRATION_TESTING, HELPER_DEMOS_FIXTURE,)], setupLayers, [])\n     Tear down plone.app.testing.layers.HelperDemos:Integration in ... seconds.\n     Tear down...HelperDemos in ... seconds.\n \n@@ -254,7 +254,7 @@ component architecture changes from our layer.\n \n Let\'s tear down the rest of the layers too.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\n     Tear down plone.testing.zca.LayerCleanup in ... seconds.\n@@ -397,7 +397,7 @@ We\'ll now tear down just the ``MY_INTEGRATION_TESTING`` layer. At this\n point, we should still have a Plone site, but none of the changes from our\n layer.\n \n-    >>> runner.tear_down_unneeded(options, [l for l in setupLayers if l not in (MY_INTEGRATION_TESTING, MY_FIXTURE)], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [l for l in setupLayers if l not in (MY_INTEGRATION_TESTING, MY_FIXTURE)], setupLayers, [])\n     Tear down plone.app.testing.layers.MyLayer:Integration in ... seconds.\n \n     >>> queryUtility(Interface, name="dummy1") is None\n@@ -436,7 +436,7 @@ layer.\n \n Let\'s tear down the rest of the layers too.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\n     Tear down plone.testing.zca.LayerCleanup in ... seconds.\ndiff --git a/src/plone/app/testing/layers.rst b/src/plone/app/testing/layers.rst\nindex 3603707..3989062 100644\n--- a/src/plone/app/testing/layers.rst\n+++ b/src/plone/app/testing/layers.rst\n@@ -98,7 +98,7 @@ There is no default workflow or content:\n \n Layer tear-down resets the environment.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\n     Tear down plone.testing.zca.LayerCleanup in ... seconds.\n@@ -186,7 +186,7 @@ And the component site has been reset:\n \n Layer tear-down resets the environment.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.Plone:Integration in ... seconds.\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\n@@ -266,7 +266,7 @@ Along with the rest of the state:\n \n Layer tear-down resets the environment.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.Plone:Functional in ... seconds.\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\n@@ -367,7 +367,7 @@ Test tear-down does nothing beyond what the base layers do.\n \n When the server is torn down, the ZServer thread is stopped.\n \n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.Plone:WSGIServer in ... seconds.\n     Tear down plone.testing.zope.WSGIServer in ... seconds.\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n@@ -472,7 +472,7 @@ and the registry is cleaned up:\n \n     >>> registry["plone.email_from_address"]\n     >>> registry["plone.email_from_name"]\n-    >>> runner.tear_down_unneeded(options, [], setupLayers)\n+    >>> runner.tear_down_unneeded(options, [], setupLayers, [])\n     Tear down plone.app.testing.layers.MockMailHostLayer in ... seconds.\n     Tear down plone.app.testing.layers.PloneFixture in ... seconds.\n     Tear down plone.testing.zope.Startup in ... seconds.\ndiff --git a/tox.ini b/tox.ini\nindex 2c3eb24..0817a80 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -3,11 +3,13 @@ envlist =\n     py27,\n     py36,\n     py37,\n+    py38,\n     coverage-report,\n     docs,\n     lint-py27,\n     lint-py36,\n     lint-py37,\n+    lint-py38,\n \n minversion = 1.9\n \n@@ -115,7 +117,14 @@ commands = {[lint]commands}\n whitelist_externals = {[lint]whitelist_externals}\n \n [testenv:lint-py37]\n-basepython = python3.6\n+basepython = python3.7\n+skip_install = true\n+deps = {[lint]deps}\n+commands = {[lint]commands}\n+whitelist_externals = {[lint]whitelist_externals}\n+\n+[testenv:lint-py38]\n+basepython = python3.8\n skip_install = true\n deps = {[lint]deps}\n commands = {[lint]commands}\n'

