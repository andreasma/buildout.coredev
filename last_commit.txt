Repository: Products.PortalTransforms


Branch: refs/heads/master
Date: 2018-10-17T11:15:44+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.PortalTransforms/commit/d3080eb113ecc572de46426aeacdd3bb1f92f516

use safe_nativestring to transform before html.fromstring

Files changed:
A news/38.bugfix
M Products/PortalTransforms/transforms/safe_html.py

b"diff --git a/Products/PortalTransforms/transforms/safe_html.py b/Products/PortalTransforms/transforms/safe_html.py\nindex d9d7884..807ee74 100644\n--- a/Products/PortalTransforms/transforms/safe_html.py\n+++ b/Products/PortalTransforms/transforms/safe_html.py\n@@ -3,6 +3,7 @@\n import six\n \n from Products.CMFPlone.interfaces import IFilterSchema\n+from Products.CMFPlone.utils import safe_encode\n from Products.PortalTransforms.interfaces import ITransform\n from Products.PortalTransforms.libtransforms.utils import bodyfinder\n from lxml import etree\n@@ -2398,10 +2399,8 @@ def convert(self, orig, data, **kwargs):\n     def scrub_html(self, orig):\n         # append html tag to create a dummy parent for the tree\n         html_parser = html.HTMLParser(encoding='utf-8')\n-        if isinstance(orig, six.binary_type):\n-            tag = b'<html'\n-        else:\n-            tag = '<html'\n+        orig = safe_encode(orig)\n+        tag = b'<html'\n         if tag in orig.lower():\n             # full html\n             tree = html.fromstring(orig, parser=html_parser)\ndiff --git a/news/38.bugfix b/news/38.bugfix\nnew file mode 100644\nindex 0000000..11a9f12\n--- /dev/null\n+++ b/news/38.bugfix\n@@ -0,0 +1 @@\n+fix scrub_html when passing unicode [pbauer]\n\\ No newline at end of file\n"

Repository: Products.PortalTransforms


Branch: refs/heads/master
Date: 2018-10-17T11:16:16+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.PortalTransforms/commit/21af9be0460e7e7218dc6b25e57b038729789dc2

Merge pull request #36 from plone/python3

fix scrub_html when passing unicode

Files changed:
A news/38.bugfix
M Products/PortalTransforms/transforms/safe_html.py

b"diff --git a/Products/PortalTransforms/transforms/safe_html.py b/Products/PortalTransforms/transforms/safe_html.py\nindex d9d7884..807ee74 100644\n--- a/Products/PortalTransforms/transforms/safe_html.py\n+++ b/Products/PortalTransforms/transforms/safe_html.py\n@@ -3,6 +3,7 @@\n import six\n \n from Products.CMFPlone.interfaces import IFilterSchema\n+from Products.CMFPlone.utils import safe_encode\n from Products.PortalTransforms.interfaces import ITransform\n from Products.PortalTransforms.libtransforms.utils import bodyfinder\n from lxml import etree\n@@ -2398,10 +2399,8 @@ def convert(self, orig, data, **kwargs):\n     def scrub_html(self, orig):\n         # append html tag to create a dummy parent for the tree\n         html_parser = html.HTMLParser(encoding='utf-8')\n-        if isinstance(orig, six.binary_type):\n-            tag = b'<html'\n-        else:\n-            tag = '<html'\n+        orig = safe_encode(orig)\n+        tag = b'<html'\n         if tag in orig.lower():\n             # full html\n             tree = html.fromstring(orig, parser=html_parser)\ndiff --git a/news/38.bugfix b/news/38.bugfix\nnew file mode 100644\nindex 0000000..11a9f12\n--- /dev/null\n+++ b/news/38.bugfix\n@@ -0,0 +1 @@\n+fix scrub_html when passing unicode [pbauer]\n\\ No newline at end of file\n"

