Repository: plone.app.event


Branch: refs/heads/master
Date: 2019-02-15T12:07:25+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.event/commit/dbeca8ec0a360ee6b1e141f97068834918d82047

close files in tests

Files changed:
M plone/app/event/tests/test_icalendar.py

b"diff --git a/plone/app/event/tests/test_icalendar.py b/plone/app/event/tests/test_icalendar.py\nindex a479bc93..a279ab75 100644\n--- a/plone/app/event/tests/test_icalendar.py\n+++ b/plone/app/event/tests/test_icalendar.py\n@@ -289,8 +289,9 @@ def test_import_from_ics(self):\n         impfolder = self.portal.impfolder1\n \n         directory = os.path.dirname(__file__)\n-        icsfile = open(os.path.join(directory, 'icaltest.ics'), 'rb').read()\n-        res = ical_import(impfolder, icsfile, self.event_type)\n+        with open(os.path.join(directory, 'icaltest.ics'), 'rb') as icsfile:\n+            icsdata = icsfile.read()\n+        res = ical_import(impfolder, icsdata, self.event_type)\n \n         self.assertEqual(res['count'], 5)\n         self.assertEqual(len(impfolder.contentIds()), 5)\n@@ -403,15 +404,17 @@ def test_import_from_ics__no_sync(self):\n         impfolder = self.portal.impfolder2\n \n         directory = os.path.dirname(__file__)\n-        icsfile = open(os.path.join(directory, 'icaltest.ics'), 'rb').read()\n+        with open(os.path.join(directory, 'icaltest.ics'), 'rb') as icsfile:\n+            icsdata = icsfile.read()\n+\n+        res = ical_import(impfolder, icsdata, self.event_type)\n \n-        res = ical_import(impfolder, icsfile, self.event_type)\n         self.assertEqual(res['count'], 5)\n \n         e11 = impfolder['e1']\n         suid1 = IEventAccessor(e11).sync_uid\n \n-        res = ical_import(impfolder, icsfile, self.event_type,\n+        res = ical_import(impfolder, icsdata, self.event_type,\n                           sync_strategy=base.SYNC_NONE)\n         self.assertEqual(res['count'], 5)\n \n@@ -428,16 +431,17 @@ def test_import_from_ics__sync_keep_mine(self):\n         impfolder = self.portal.impfolder3\n \n         directory = os.path.dirname(__file__)\n-        icsfile = open(os.path.join(directory, 'icaltest.ics'), 'rb').read()\n+        with open(os.path.join(directory, 'icaltest.ics'), 'rb') as icsfile:\n+            icsdata = icsfile.read()\n \n-        res = ical_import(impfolder, icsfile, self.event_type)\n+        res = ical_import(impfolder, icsdata, self.event_type)\n         self.assertEqual(res['count'], 5)\n \n         e1a = IEventAccessor(impfolder.e1)\n         mod1 = e1a.last_modified\n         suid1 = e1a.sync_uid\n \n-        res = ical_import(impfolder, icsfile, self.event_type,\n+        res = ical_import(impfolder, icsdata, self.event_type,\n                           sync_strategy=base.SYNC_KEEP_MINE)\n         self.assertEqual(res['count'], 0)\n         e1a = IEventAccessor(impfolder.e1)\n@@ -457,10 +461,13 @@ def test_import_from_ics__sync_drop_older(self):\n         impfolder = self.portal.impfolder4\n \n         directory = os.path.dirname(__file__)\n-        icsfile = open(os.path.join(directory, 'icaltest.ics'), 'rb').read()\n-        icsfile2 = open(os.path.join(directory, 'icaltest2.ics'), 'rb').read()\n+        with open(os.path.join(directory, 'icaltest.ics'), 'rb') as icsfile:\n+            icsdata1 = icsfile.read()\n+\n+        with open(os.path.join(directory, 'icaltest2.ics'), 'rb') as icsfile:\n+            icsdata2 = icsfile.read()\n \n-        res = ical_import(impfolder, icsfile, self.event_type)\n+        res = ical_import(impfolder, icsdata1, self.event_type)\n         self.assertEqual(res['count'], 5)\n \n         e1a = IEventAccessor(impfolder.e1)\n@@ -471,7 +478,7 @@ def test_import_from_ics__sync_drop_older(self):\n         start1 = e1a.start\n         end1 = e1a.end\n \n-        res = ical_import(impfolder, icsfile2, self.event_type,\n+        res = ical_import(impfolder, icsdata2, self.event_type,\n                           sync_strategy=base.SYNC_KEEP_NEWER)\n         self.assertEqual(res['count'], 4)\n         e1a = IEventAccessor(impfolder.e1)\n@@ -499,10 +506,14 @@ def test_import_from_ics__sync_keep_theirs(self):\n         impfolder = self.portal.impfolder5\n \n         directory = os.path.dirname(__file__)\n-        icsfile = open(os.path.join(directory, 'icaltest.ics'), 'rb').read()\n-        icsfile2 = open(os.path.join(directory, 'icaltest2.ics'), 'rb').read()\n \n-        res = ical_import(impfolder, icsfile, self.event_type)\n+        with open(os.path.join(directory, 'icaltest.ics'), 'rb') as icsfile:\n+            icsdata1 = icsfile.read()\n+\n+        with open(os.path.join(directory, 'icaltest2.ics'), 'rb') as icsfile:\n+            icsdata2 = icsfile.read()\n+\n+        res = ical_import(impfolder, icsdata1, self.event_type)\n         self.assertEqual(res['count'], 5)\n \n         e1a = IEventAccessor(impfolder.e1)\n@@ -520,7 +531,7 @@ def test_import_from_ics__sync_keep_theirs(self):\n         start21 = e2a.start\n         end21 = e2a.end\n \n-        res = ical_import(impfolder, icsfile2, self.event_type,\n+        res = ical_import(impfolder, icsdata2, self.event_type,\n                           sync_strategy=base.SYNC_KEEP_THEIRS)\n         self.assertEqual(res['count'], 5)\n \n"

Repository: plone.app.event


Branch: refs/heads/master
Date: 2019-02-21T07:58:48+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.event/commit/d7d1155781b7df6b00fa7eb982b2de78254975c5

add changelog

Files changed:
A news/300.bugfix

b'diff --git a/news/300.bugfix b/news/300.bugfix\nnew file mode 100644\nindex 00000000..412f6ef6\n--- /dev/null\n+++ b/news/300.bugfix\n@@ -0,0 +1 @@\n+Close files in tests\n\\ No newline at end of file\n'

Repository: plone.app.event


Branch: refs/heads/master
Date: 2019-02-21T07:59:12+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.event/commit/e87103b99ec47386cdf0704e3be48c49ca00a92d

Merge pull request #300 from plone/close_files

close files in tests

Files changed:
A news/300.bugfix
M plone/app/event/tests/test_icalendar.py

b"diff --git a/news/300.bugfix b/news/300.bugfix\nnew file mode 100644\nindex 00000000..412f6ef6\n--- /dev/null\n+++ b/news/300.bugfix\n@@ -0,0 +1 @@\n+Close files in tests\n\\ No newline at end of file\ndiff --git a/plone/app/event/tests/test_icalendar.py b/plone/app/event/tests/test_icalendar.py\nindex a479bc93..a279ab75 100644\n--- a/plone/app/event/tests/test_icalendar.py\n+++ b/plone/app/event/tests/test_icalendar.py\n@@ -289,8 +289,9 @@ def test_import_from_ics(self):\n         impfolder = self.portal.impfolder1\n \n         directory = os.path.dirname(__file__)\n-        icsfile = open(os.path.join(directory, 'icaltest.ics'), 'rb').read()\n-        res = ical_import(impfolder, icsfile, self.event_type)\n+        with open(os.path.join(directory, 'icaltest.ics'), 'rb') as icsfile:\n+            icsdata = icsfile.read()\n+        res = ical_import(impfolder, icsdata, self.event_type)\n \n         self.assertEqual(res['count'], 5)\n         self.assertEqual(len(impfolder.contentIds()), 5)\n@@ -403,15 +404,17 @@ def test_import_from_ics__no_sync(self):\n         impfolder = self.portal.impfolder2\n \n         directory = os.path.dirname(__file__)\n-        icsfile = open(os.path.join(directory, 'icaltest.ics'), 'rb').read()\n+        with open(os.path.join(directory, 'icaltest.ics'), 'rb') as icsfile:\n+            icsdata = icsfile.read()\n+\n+        res = ical_import(impfolder, icsdata, self.event_type)\n \n-        res = ical_import(impfolder, icsfile, self.event_type)\n         self.assertEqual(res['count'], 5)\n \n         e11 = impfolder['e1']\n         suid1 = IEventAccessor(e11).sync_uid\n \n-        res = ical_import(impfolder, icsfile, self.event_type,\n+        res = ical_import(impfolder, icsdata, self.event_type,\n                           sync_strategy=base.SYNC_NONE)\n         self.assertEqual(res['count'], 5)\n \n@@ -428,16 +431,17 @@ def test_import_from_ics__sync_keep_mine(self):\n         impfolder = self.portal.impfolder3\n \n         directory = os.path.dirname(__file__)\n-        icsfile = open(os.path.join(directory, 'icaltest.ics'), 'rb').read()\n+        with open(os.path.join(directory, 'icaltest.ics'), 'rb') as icsfile:\n+            icsdata = icsfile.read()\n \n-        res = ical_import(impfolder, icsfile, self.event_type)\n+        res = ical_import(impfolder, icsdata, self.event_type)\n         self.assertEqual(res['count'], 5)\n \n         e1a = IEventAccessor(impfolder.e1)\n         mod1 = e1a.last_modified\n         suid1 = e1a.sync_uid\n \n-        res = ical_import(impfolder, icsfile, self.event_type,\n+        res = ical_import(impfolder, icsdata, self.event_type,\n                           sync_strategy=base.SYNC_KEEP_MINE)\n         self.assertEqual(res['count'], 0)\n         e1a = IEventAccessor(impfolder.e1)\n@@ -457,10 +461,13 @@ def test_import_from_ics__sync_drop_older(self):\n         impfolder = self.portal.impfolder4\n \n         directory = os.path.dirname(__file__)\n-        icsfile = open(os.path.join(directory, 'icaltest.ics'), 'rb').read()\n-        icsfile2 = open(os.path.join(directory, 'icaltest2.ics'), 'rb').read()\n+        with open(os.path.join(directory, 'icaltest.ics'), 'rb') as icsfile:\n+            icsdata1 = icsfile.read()\n+\n+        with open(os.path.join(directory, 'icaltest2.ics'), 'rb') as icsfile:\n+            icsdata2 = icsfile.read()\n \n-        res = ical_import(impfolder, icsfile, self.event_type)\n+        res = ical_import(impfolder, icsdata1, self.event_type)\n         self.assertEqual(res['count'], 5)\n \n         e1a = IEventAccessor(impfolder.e1)\n@@ -471,7 +478,7 @@ def test_import_from_ics__sync_drop_older(self):\n         start1 = e1a.start\n         end1 = e1a.end\n \n-        res = ical_import(impfolder, icsfile2, self.event_type,\n+        res = ical_import(impfolder, icsdata2, self.event_type,\n                           sync_strategy=base.SYNC_KEEP_NEWER)\n         self.assertEqual(res['count'], 4)\n         e1a = IEventAccessor(impfolder.e1)\n@@ -499,10 +506,14 @@ def test_import_from_ics__sync_keep_theirs(self):\n         impfolder = self.portal.impfolder5\n \n         directory = os.path.dirname(__file__)\n-        icsfile = open(os.path.join(directory, 'icaltest.ics'), 'rb').read()\n-        icsfile2 = open(os.path.join(directory, 'icaltest2.ics'), 'rb').read()\n \n-        res = ical_import(impfolder, icsfile, self.event_type)\n+        with open(os.path.join(directory, 'icaltest.ics'), 'rb') as icsfile:\n+            icsdata1 = icsfile.read()\n+\n+        with open(os.path.join(directory, 'icaltest2.ics'), 'rb') as icsfile:\n+            icsdata2 = icsfile.read()\n+\n+        res = ical_import(impfolder, icsdata1, self.event_type)\n         self.assertEqual(res['count'], 5)\n \n         e1a = IEventAccessor(impfolder.e1)\n@@ -520,7 +531,7 @@ def test_import_from_ics__sync_keep_theirs(self):\n         start21 = e2a.start\n         end21 = e2a.end\n \n-        res = ical_import(impfolder, icsfile2, self.event_type,\n+        res = ical_import(impfolder, icsdata2, self.event_type,\n                           sync_strategy=base.SYNC_KEEP_THEIRS)\n         self.assertEqual(res['count'], 5)\n \n"

