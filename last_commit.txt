Repository: Products.CMFDynamicViewFTI


Branch: refs/heads/master
Date: 2018-05-07T12:19:41-04:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/Products.CMFDynamicViewFTI/commit/4c1e05c96d2c4ce9ba4c01ce664859b5e6ae74c4

Test against plone.app.contenttypes fixture instead of Archetypes

Files changed:
M CHANGES.rst
M Products/CMFDynamicViewFTI/profiles/sample_types/types/DynDocument.xml
M Products/CMFDynamicViewFTI/tests/CMFDVFTITestCase.py
M Products/CMFDynamicViewFTI/tests/test_fti.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 3d32032..4385138 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,9 @@ Bug fixes:
 - Fix adapter lookup on Python 3.
   [ale-rt]
 
+- Test using plone.app.contenttypes instead of Archetypes.
+  [davisagli]
+
 4.1.7 (2018-03-12)
 ------------------
 
diff --git a/Products/CMFDynamicViewFTI/profiles/sample_types/types/DynDocument.xml b/Products/CMFDynamicViewFTI/profiles/sample_types/types/DynDocument.xml
index c4e15c2..38b87b1 100644
--- a/Products/CMFDynamicViewFTI/profiles/sample_types/types/DynDocument.xml
+++ b/Products/CMFDynamicViewFTI/profiles/sample_types/types/DynDocument.xml
@@ -13,7 +13,7 @@
  <property name="global_allow">True</property>
  <property name="filter_content_types">True</property>
  <property name="allowed_content_types"/>
- <property name="default_view">document_view</property>
+ <property name="default_view">index_html</property>
  <property name="view_methods">
   <element value="document_view"/>
   <element value="custom_view"/>
diff --git a/Products/CMFDynamicViewFTI/tests/CMFDVFTITestCase.py b/Products/CMFDynamicViewFTI/tests/CMFDVFTITestCase.py
index 9f80f9f..3ddb24a 100644
--- a/Products/CMFDynamicViewFTI/tests/CMFDVFTITestCase.py
+++ b/Products/CMFDynamicViewFTI/tests/CMFDVFTITestCase.py
@@ -1,16 +1,18 @@
 # -*- coding: utf-8 -*-
-#
-# CMFDVFTITestCase
-#
 from plone.app import testing
-from plone.app.testing import bbb
+from plone.app.testing import PLONE_FIXTURE
+from plone.app.testing import PloneSandboxLayer
+from plone.app.testing.bbb import PloneTestCase
 from Products.CMFCore.interfaces import ISiteRoot
+from Products.CMFPlone.utils import _createObjectByType
 from Products.GenericSetup import EXTENSION, profile_registry
+import transaction
+import unittest
 
 
-class PloneTestCaseFixture(bbb.PloneTestCaseFixture):
+class CMFDynamicViewFTIFixture(PloneSandboxLayer):
 
-    defaultBases = (bbb.PTC_FIXTURE, )
+    defaultBases = (PLONE_FIXTURE, )
 
     def setUpZope(self, app, configurationContext):
         profile_registry.registerProfile(
@@ -29,17 +31,28 @@ def setUpZope(self, app, configurationContext):
     def setUpPloneSite(self, portal):
         self.applyProfile(portal, 'CMFDynamicViewFTI:CMFDVFTI_sampletypes')
 
+
     def tearDownZope(self, app):
         pass
 
-CDV_FIXTURE = PloneTestCaseFixture()
+CDV_FIXTURE = CMFDynamicViewFTIFixture()
 CDV_FUNCTIONAL_TESTING = testing.FunctionalTesting(
     bases=(CDV_FIXTURE, ), name='CMFDynamicViewFTI Testing:Functional')
 
 
-class CMFDVFTITestCase(bbb.PloneTestCase):
+class CMFDVFTITestCase(PloneTestCase):
     """This is a stub now, but in case you want to try
        something fancy on Your Branch (tm), put it here.
     """
 
+    def setUp(self):
+        """Set up before each test."""
+        self.beforeSetUp()
+        self.app = self.layer['app']
+        self.portal = self.layer['portal']
+        _createObjectByType('DynFolder', self.portal, id='folder')
+        self.folder = self.portal.folder
+        transaction.commit()
+        self.afterSetUp()
+
     layer = CDV_FUNCTIONAL_TESTING
diff --git a/Products/CMFDynamicViewFTI/tests/test_fti.py b/Products/CMFDynamicViewFTI/tests/test_fti.py
index 21a3953..215b1a7 100644
--- a/Products/CMFDynamicViewFTI/tests/test_fti.py
+++ b/Products/CMFDynamicViewFTI/tests/test_fti.py
@@ -1,7 +1,6 @@
 # -*- coding: utf-8 -*-
 from plone.app.testing import TEST_USER_NAME
 from plone.app.testing import TEST_USER_PASSWORD
-from Products.Archetypes.atapi import StringField
 from Products.CMFCore.interfaces import ITypeInformation
 from Products.CMFCore.utils import getToolByName
 from Products.CMFDynamicViewFTI.fti import DynamicViewTypeInformation
@@ -215,17 +214,14 @@ def afterSetUp(self):
     def test_FolderEmptyLayoutBug(self):
         response = self.publish(
             self.dynfolder_path + '/view',
-            basic=self.basic
+            basic=self.basic,
         )
         self.assertEqual(response.getStatus(), 200)
 
     def test_DocumentEmptyLayoutBug(self):
-        # add a text field to dyndocument which is not present
-        # but needed for the standard view
-        self.dyndocument.Schema().addField(StringField('text'))
         response = self.publish(
             self.dyndocument_path + '/view',
-            basic=self.basic
+            basic=self.basic,
         )
         self.assertEqual(response.getStatus(), 200)
 
diff --git a/setup.py b/setup.py
index aac036f..6a15850 100644
--- a/setup.py
+++ b/setup.py
@@ -39,7 +39,6 @@
             'plone.app.contentmenu',
             'zope.publisher',
             'plone.app.testing >= 4.2.5',
-            'Products.Archetypes',
         ]
     ),
     install_requires=[


Repository: Products.CMFDynamicViewFTI


Branch: refs/heads/master
Date: 2018-05-07T12:22:57-04:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/Products.CMFDynamicViewFTI/commit/cab4896ea83db0cc270e791289cfd980a6610f07

backwards incompatible

Files changed:
M CHANGES.rst
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4385138..dd9f61b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -1,11 +1,14 @@
 Changelog
 =========
 
-4.1.8 (unreleased)
+5.0.0 (unreleased)
 ------------------
 
 Breaking changes:
 
+- Test using plone.app.contenttypes instead of Archetypes.
+  [davisagli]
+
 - *add item here*
 
 New features:
@@ -17,8 +20,6 @@ Bug fixes:
 - Fix adapter lookup on Python 3.
   [ale-rt]
 
-- Test using plone.app.contenttypes instead of Archetypes.
-  [davisagli]
 
 4.1.7 (2018-03-12)
 ------------------
diff --git a/setup.py b/setup.py
index 6a15850..c4533d5 100644
--- a/setup.py
+++ b/setup.py
@@ -2,7 +2,7 @@
 from setuptools import find_packages
 from setuptools import setup
 
-version = '4.1.8.dev0'
+version = '5.0.0.dev0'
 
 long_description = open("README.rst").read()
 long_description += "\n"


Repository: Products.CMFDynamicViewFTI


Branch: refs/heads/master
Date: 2018-05-08T13:36:37+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/Products.CMFDynamicViewFTI/commit/841d84bbe88bf80db8fa1171cb9d2e41d0631130

Merge pull request #14 from plone/no-at

Test against plone.app.contenttypes fixture instead of Archetypes

Files changed:
M CHANGES.rst
M Products/CMFDynamicViewFTI/profiles/sample_types/types/DynDocument.xml
M Products/CMFDynamicViewFTI/tests/CMFDVFTITestCase.py
M Products/CMFDynamicViewFTI/tests/test_fti.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 3d32032..dd9f61b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -1,11 +1,14 @@
 Changelog
 =========
 
-4.1.8 (unreleased)
+5.0.0 (unreleased)
 ------------------
 
 Breaking changes:
 
+- Test using plone.app.contenttypes instead of Archetypes.
+  [davisagli]
+
 - *add item here*
 
 New features:
@@ -17,6 +20,7 @@ Bug fixes:
 - Fix adapter lookup on Python 3.
   [ale-rt]
 
+
 4.1.7 (2018-03-12)
 ------------------
 
diff --git a/Products/CMFDynamicViewFTI/profiles/sample_types/types/DynDocument.xml b/Products/CMFDynamicViewFTI/profiles/sample_types/types/DynDocument.xml
index c4e15c2..38b87b1 100644
--- a/Products/CMFDynamicViewFTI/profiles/sample_types/types/DynDocument.xml
+++ b/Products/CMFDynamicViewFTI/profiles/sample_types/types/DynDocument.xml
@@ -13,7 +13,7 @@
  <property name="global_allow">True</property>
  <property name="filter_content_types">True</property>
  <property name="allowed_content_types"/>
- <property name="default_view">document_view</property>
+ <property name="default_view">index_html</property>
  <property name="view_methods">
   <element value="document_view"/>
   <element value="custom_view"/>
diff --git a/Products/CMFDynamicViewFTI/tests/CMFDVFTITestCase.py b/Products/CMFDynamicViewFTI/tests/CMFDVFTITestCase.py
index 9f80f9f..3ddb24a 100644
--- a/Products/CMFDynamicViewFTI/tests/CMFDVFTITestCase.py
+++ b/Products/CMFDynamicViewFTI/tests/CMFDVFTITestCase.py
@@ -1,16 +1,18 @@
 # -*- coding: utf-8 -*-
-#
-# CMFDVFTITestCase
-#
 from plone.app import testing
-from plone.app.testing import bbb
+from plone.app.testing import PLONE_FIXTURE
+from plone.app.testing import PloneSandboxLayer
+from plone.app.testing.bbb import PloneTestCase
 from Products.CMFCore.interfaces import ISiteRoot
+from Products.CMFPlone.utils import _createObjectByType
 from Products.GenericSetup import EXTENSION, profile_registry
+import transaction
+import unittest
 
 
-class PloneTestCaseFixture(bbb.PloneTestCaseFixture):
+class CMFDynamicViewFTIFixture(PloneSandboxLayer):
 
-    defaultBases = (bbb.PTC_FIXTURE, )
+    defaultBases = (PLONE_FIXTURE, )
 
     def setUpZope(self, app, configurationContext):
         profile_registry.registerProfile(
@@ -29,17 +31,28 @@ def setUpZope(self, app, configurationContext):
     def setUpPloneSite(self, portal):
         self.applyProfile(portal, 'CMFDynamicViewFTI:CMFDVFTI_sampletypes')
 
+
     def tearDownZope(self, app):
         pass
 
-CDV_FIXTURE = PloneTestCaseFixture()
+CDV_FIXTURE = CMFDynamicViewFTIFixture()
 CDV_FUNCTIONAL_TESTING = testing.FunctionalTesting(
     bases=(CDV_FIXTURE, ), name='CMFDynamicViewFTI Testing:Functional')
 
 
-class CMFDVFTITestCase(bbb.PloneTestCase):
+class CMFDVFTITestCase(PloneTestCase):
     """This is a stub now, but in case you want to try
        something fancy on Your Branch (tm), put it here.
     """
 
+    def setUp(self):
+        """Set up before each test."""
+        self.beforeSetUp()
+        self.app = self.layer['app']
+        self.portal = self.layer['portal']
+        _createObjectByType('DynFolder', self.portal, id='folder')
+        self.folder = self.portal.folder
+        transaction.commit()
+        self.afterSetUp()
+
     layer = CDV_FUNCTIONAL_TESTING
diff --git a/Products/CMFDynamicViewFTI/tests/test_fti.py b/Products/CMFDynamicViewFTI/tests/test_fti.py
index 21a3953..215b1a7 100644
--- a/Products/CMFDynamicViewFTI/tests/test_fti.py
+++ b/Products/CMFDynamicViewFTI/tests/test_fti.py
@@ -1,7 +1,6 @@
 # -*- coding: utf-8 -*-
 from plone.app.testing import TEST_USER_NAME
 from plone.app.testing import TEST_USER_PASSWORD
-from Products.Archetypes.atapi import StringField
 from Products.CMFCore.interfaces import ITypeInformation
 from Products.CMFCore.utils import getToolByName
 from Products.CMFDynamicViewFTI.fti import DynamicViewTypeInformation
@@ -215,17 +214,14 @@ def afterSetUp(self):
     def test_FolderEmptyLayoutBug(self):
         response = self.publish(
             self.dynfolder_path + '/view',
-            basic=self.basic
+            basic=self.basic,
         )
         self.assertEqual(response.getStatus(), 200)
 
     def test_DocumentEmptyLayoutBug(self):
-        # add a text field to dyndocument which is not present
-        # but needed for the standard view
-        self.dyndocument.Schema().addField(StringField('text'))
         response = self.publish(
             self.dyndocument_path + '/view',
-            basic=self.basic
+            basic=self.basic,
         )
         self.assertEqual(response.getStatus(), 200)
 
diff --git a/setup.py b/setup.py
index aac036f..c4533d5 100644
--- a/setup.py
+++ b/setup.py
@@ -2,7 +2,7 @@
 from setuptools import find_packages
 from setuptools import setup
 
-version = '4.1.8.dev0'
+version = '5.0.0.dev0'
 
 long_description = open("README.rst").read()
 long_description += "\n"
@@ -39,7 +39,6 @@
             'plone.app.contentmenu',
             'zope.publisher',
             'plone.app.testing >= 4.2.5',
-            'Products.Archetypes',
         ]
     ),
     install_requires=[


