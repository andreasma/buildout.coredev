Repository: plone.app.imaging


Branch: refs/heads/2.0.x
Date: 2019-09-27T13:11:47+03:00
Author: Alin Voinea (avoinea) <contact@avoinea.com>
Commit: https://github.com/plone/plone.app.imaging/commit/369bcc5f61e27a9d7f3df3ee05c4c30ebbded87d

Fix IOError: cannot write mode RGBA as JPEG

Files changed:
M src/plone/app/imaging/monkey.py

b"diff --git a/src/plone/app/imaging/monkey.py b/src/plone/app/imaging/monkey.py\nindex a99a7bc..a5b7090 100644\n--- a/src/plone/app/imaging/monkey.py\n+++ b/src/plone/app/imaging/monkey.py\n@@ -109,6 +109,12 @@ def scale(self, data, w, h, default_format='PNG'):\n     # for GIF, could also use image.format in ('GIF','PNG')\n     if original_mode == 'P' and img_format == 'GIF':\n         image = image.convert('P')\n+\n+    # Avoid - IOError: cannot write mode RGBA as JPEG\n+    # See https://github.com/python-pillow/Pillow/issues/2609#issuecomment-313841918\n+    if original_mode in ('CMYK', 'RGBA', 'LA') and target_format in ('JPG', 'JPEG'):\n+        target_format = 'PNG'\n+\n     thumbnail_file = StringIO()\n     # quality parameter doesn't affect lossless formats\n     image.save(thumbnail_file, target_format, quality=pil_quality, progressive=True)\n"

Repository: plone.app.imaging


Branch: refs/heads/2.0.x
Date: 2019-09-27T13:13:18+03:00
Author: Alin Voinea (avoinea) <contact@avoinea.com>
Commit: https://github.com/plone/plone.app.imaging/commit/2e305c3962ff13c79044885ff29a52d065c75d46

Update CHANGES

Files changed:
M CHANGES.rst

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 69fa1c8..ef05ceb 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,7 +14,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Fix IOError: cannot write mode RGBA as JPEG on ImageField scale\n+  [avoinea]\n \n \n 2.0.7 (2018-02-05)\n'

Repository: plone.app.imaging


Branch: refs/heads/2.0.x
Date: 2019-09-30T09:25:31+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.imaging/commit/4c949ad5e8c8fd0958e112b5c392123f4b944182

Merge pull request #39 from eea/2.0.x

2.0.x - Fix IOError: cannot write mode RGBA as JPEG

Files changed:
M CHANGES.rst
M src/plone/app/imaging/monkey.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 69fa1c8..ef05ceb 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,7 +14,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Fix IOError: cannot write mode RGBA as JPEG on ImageField scale\n+  [avoinea]\n \n \n 2.0.7 (2018-02-05)\ndiff --git a/src/plone/app/imaging/monkey.py b/src/plone/app/imaging/monkey.py\nindex a99a7bc..a5b7090 100644\n--- a/src/plone/app/imaging/monkey.py\n+++ b/src/plone/app/imaging/monkey.py\n@@ -109,6 +109,12 @@ def scale(self, data, w, h, default_format='PNG'):\n     # for GIF, could also use image.format in ('GIF','PNG')\n     if original_mode == 'P' and img_format == 'GIF':\n         image = image.convert('P')\n+\n+    # Avoid - IOError: cannot write mode RGBA as JPEG\n+    # See https://github.com/python-pillow/Pillow/issues/2609#issuecomment-313841918\n+    if original_mode in ('CMYK', 'RGBA', 'LA') and target_format in ('JPG', 'JPEG'):\n+        target_format = 'PNG'\n+\n     thumbnail_file = StringIO()\n     # quality parameter doesn't affect lossless formats\n     image.save(thumbnail_file, target_format, quality=pil_quality, progressive=True)\n"

