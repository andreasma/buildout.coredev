Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2019-10-10T11:55:03+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/5842f0aadd76de30bed323417d7a4c739907eb4a

upgrade step for Plone 5.1

Files changed:
A plone/app/upgrade/v51/profiles/to_517/registry.xml
M plone/app/upgrade/v51/configure.zcml
M plone/app/upgrade/v51/final.py
M plone/app/upgrade/v51/profiles.zcml

b'diff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml\nindex ed16c26d..dc05e70c 100644\n--- a/plone/app/upgrade/v51/configure.zcml\n+++ b/plone/app/upgrade/v51/configure.zcml\n@@ -297,7 +297,7 @@ Add image scaling options to image handling control panel.\n         <gs:upgradeStep\n             title="Miscellaneous"\n             description=""\n-            handler="..utils.null_upgrade_step"\n+            handler=".final.to_517"\n             />\n \n     </gs:upgradeSteps>\ndiff --git a/plone/app/upgrade/v51/final.py b/plone/app/upgrade/v51/final.py\nindex 1866708a..d04629c1 100644\n--- a/plone/app/upgrade/v51/final.py\n+++ b/plone/app/upgrade/v51/final.py\n@@ -1,5 +1,6 @@\n # -*- coding: utf-8 -*-\n from plone.app.upgrade.utils import cleanUpSkinsTool\n+from plone.app.upgrade.utils import loadMigrationProfile\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from zExceptions import BadRequest\n@@ -62,3 +63,8 @@ def remove_old_PAE_rescources(context):  # noqa\n         resources.value.remove(\'resource-plone-app-event-event-js\')\n     if u\'resource-plone-app-event-event-css\' in resources.value:\n         resources.value.remove(\'resource-plone-app-event-event-css\')\n+\n+\n+def to517(context):\n+    """5.1.6 -> 5.1.7"""\n+    loadMigrationProfile(context, \'profile-plone.app.upgrade.v51:to517\')\ndiff --git a/plone/app/upgrade/v51/profiles.zcml b/plone/app/upgrade/v51/profiles.zcml\nindex 9e715261..f121b411 100644\n--- a/plone/app/upgrade/v51/profiles.zcml\n+++ b/plone/app/upgrade/v51/profiles.zcml\n@@ -112,4 +112,13 @@\n       for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       />\n+\n+  <genericsetup:registerProfile\n+      name="to517"\n+      title="Upgrade profile for Plone 5.1.6 to Plone 5.1.7"\n+      description=""\n+      directory="profiles/to_517"\n+      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      />\n </configure>\ndiff --git a/plone/app/upgrade/v51/profiles/to_517/registry.xml b/plone/app/upgrade/v51/profiles/to_517/registry.xml\nnew file mode 100644\nindex 00000000..1156921b\n--- /dev/null\n+++ b/plone/app/upgrade/v51/profiles/to_517/registry.xml\n@@ -0,0 +1,8 @@\n+<?xml version=\'1.0\' encoding=\'UTF-8\'?>\n+<registry>\n+  <records interface="Products.CMFPlone.interfaces.controlpanel.ITypesSchema" prefix="plone">\n+    <value key="default_page_types" purge="false">\n+      <element>Collection</element>\n+    </value>\n+  </records>\n+</registry>\n\\ No newline at end of file\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2019-10-10T11:55:07+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/d893f5312a2fe6788d243f45f21a94576c4d30b1

upgrade step for Plone 5.2

Files changed:
A plone/app/upgrade/v52/profiles/to_521/registry.xml
M plone/app/upgrade/v52/configure.zcml
M plone/app/upgrade/v52/final.py
M plone/app/upgrade/v52/profiles.zcml

b'diff --git a/plone/app/upgrade/v52/configure.zcml b/plone/app/upgrade/v52/configure.zcml\nindex 1493fedd..3211f95c 100644\n--- a/plone/app/upgrade/v52/configure.zcml\n+++ b/plone/app/upgrade/v52/configure.zcml\n@@ -133,7 +133,7 @@\n         <gs:upgradeStep\n             title="Miscellaneous"\n             description=""\n-            handler="..utils.null_upgrade_step"\n+            handler=".final.to_521"\n             />\n \n     </gs:upgradeSteps>\ndiff --git a/plone/app/upgrade/v52/final.py b/plone/app/upgrade/v52/final.py\nindex 09042a35..a869a3ba 100644\n--- a/plone/app/upgrade/v52/final.py\n+++ b/plone/app/upgrade/v52/final.py\n@@ -1,4 +1,5 @@\n # -*- coding: utf-8 -*-\n+from plone.app.upgrade.utils import loadMigrationProfile\n from plone.registry.interfaces import IRegistry\n from zope.component import getUtility\n \n@@ -111,3 +112,7 @@ def change_interface_on_lang_registry_records(context):\n             "Change registry key \'{0}\' to new interface.".format(old_key)\n         )\n         record.field.interfaceName = NEW_PREFIX\n+\n+def to521(context):\n+    """5.2.0 -> 5.2.1"""\n+    loadMigrationProfile(context, \'profile-plone.app.upgrade.v52:to521\')\ndiff --git a/plone/app/upgrade/v52/profiles.zcml b/plone/app/upgrade/v52/profiles.zcml\nindex 13b5e817..16c30c03 100644\n--- a/plone/app/upgrade/v52/profiles.zcml\n+++ b/plone/app/upgrade/v52/profiles.zcml\n@@ -39,4 +39,14 @@\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       />\n \n+  <genericsetup:registerProfile\n+      name="to521"\n+      title="Upgrade profile for Plone 5.2 to Plone 5.2.1"\n+      description=""\n+      directory="profiles/to_521"\n+      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      />\n+\n+\n </configure>\ndiff --git a/plone/app/upgrade/v52/profiles/to_521/registry.xml b/plone/app/upgrade/v52/profiles/to_521/registry.xml\nnew file mode 100644\nindex 00000000..1156921b\n--- /dev/null\n+++ b/plone/app/upgrade/v52/profiles/to_521/registry.xml\n@@ -0,0 +1,8 @@\n+<?xml version=\'1.0\' encoding=\'UTF-8\'?>\n+<registry>\n+  <records interface="Products.CMFPlone.interfaces.controlpanel.ITypesSchema" prefix="plone">\n+    <value key="default_page_types" purge="false">\n+      <element>Collection</element>\n+    </value>\n+  </records>\n+</registry>\n\\ No newline at end of file\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2019-10-10T11:55:07+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/af82c738c1c8d52bca5d64b56312b9ff376f0a23

changelog

Files changed:
A news/216.bugfix

b'diff --git a/news/216.bugfix b/news/216.bugfix\nnew file mode 100644\nindex 00000000..41a9e581\n--- /dev/null\n+++ b/news/216.bugfix\n@@ -0,0 +1,2 @@\n+Add Collection to the default_page_types setting\n+[erral]\n\\ No newline at end of file\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2019-10-15T22:43:12+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.upgrade/commit/bdecbe23bf97c44e6b40b07e49182dd82fc567e3

Fixed to517 and to521 handler name.

This can easily go wrong.  After this fix:
- The profile directory is to_517.
- The profile id is to517.
- The upgrade function name is to517.
I would prefer that the directory is also called to517, but we have always spelled these with an underscore.
It might be okay to start doing this differently.

Files changed:
M plone/app/upgrade/v51/configure.zcml
M plone/app/upgrade/v52/configure.zcml

b'diff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml\nindex dc05e70c..94873e1a 100644\n--- a/plone/app/upgrade/v51/configure.zcml\n+++ b/plone/app/upgrade/v51/configure.zcml\n@@ -297,7 +297,7 @@ Add image scaling options to image handling control panel.\n         <gs:upgradeStep\n             title="Miscellaneous"\n             description=""\n-            handler=".final.to_517"\n+            handler=".final.to517"\n             />\n \n     </gs:upgradeSteps>\ndiff --git a/plone/app/upgrade/v52/configure.zcml b/plone/app/upgrade/v52/configure.zcml\nindex 3211f95c..ce754111 100644\n--- a/plone/app/upgrade/v52/configure.zcml\n+++ b/plone/app/upgrade/v52/configure.zcml\n@@ -133,7 +133,7 @@\n         <gs:upgradeStep\n             title="Miscellaneous"\n             description=""\n-            handler=".final.to_521"\n+            handler=".final.to521"\n             />\n \n     </gs:upgradeSteps>\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2019-10-15T23:52:22+02:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/plone.app.upgrade/commit/2493fe212068192dc63dd6ed498d1deff86e7121

Merge pull request #217 from plone/erral-issue-216

add Collection to the default_page_types setting

Files changed:
A news/216.bugfix
A plone/app/upgrade/v51/profiles/to_517/registry.xml
A plone/app/upgrade/v52/profiles/to_521/registry.xml
M plone/app/upgrade/v51/configure.zcml
M plone/app/upgrade/v51/final.py
M plone/app/upgrade/v51/profiles.zcml
M plone/app/upgrade/v52/configure.zcml
M plone/app/upgrade/v52/final.py
M plone/app/upgrade/v52/profiles.zcml

b'diff --git a/news/216.bugfix b/news/216.bugfix\nnew file mode 100644\nindex 00000000..41a9e581\n--- /dev/null\n+++ b/news/216.bugfix\n@@ -0,0 +1,2 @@\n+Add Collection to the default_page_types setting\n+[erral]\n\\ No newline at end of file\ndiff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml\nindex ed16c26d..94873e1a 100644\n--- a/plone/app/upgrade/v51/configure.zcml\n+++ b/plone/app/upgrade/v51/configure.zcml\n@@ -297,7 +297,7 @@ Add image scaling options to image handling control panel.\n         <gs:upgradeStep\n             title="Miscellaneous"\n             description=""\n-            handler="..utils.null_upgrade_step"\n+            handler=".final.to517"\n             />\n \n     </gs:upgradeSteps>\ndiff --git a/plone/app/upgrade/v51/final.py b/plone/app/upgrade/v51/final.py\nindex 1866708a..d04629c1 100644\n--- a/plone/app/upgrade/v51/final.py\n+++ b/plone/app/upgrade/v51/final.py\n@@ -1,5 +1,6 @@\n # -*- coding: utf-8 -*-\n from plone.app.upgrade.utils import cleanUpSkinsTool\n+from plone.app.upgrade.utils import loadMigrationProfile\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from zExceptions import BadRequest\n@@ -62,3 +63,8 @@ def remove_old_PAE_rescources(context):  # noqa\n         resources.value.remove(\'resource-plone-app-event-event-js\')\n     if u\'resource-plone-app-event-event-css\' in resources.value:\n         resources.value.remove(\'resource-plone-app-event-event-css\')\n+\n+\n+def to517(context):\n+    """5.1.6 -> 5.1.7"""\n+    loadMigrationProfile(context, \'profile-plone.app.upgrade.v51:to517\')\ndiff --git a/plone/app/upgrade/v51/profiles.zcml b/plone/app/upgrade/v51/profiles.zcml\nindex 9e715261..f121b411 100644\n--- a/plone/app/upgrade/v51/profiles.zcml\n+++ b/plone/app/upgrade/v51/profiles.zcml\n@@ -112,4 +112,13 @@\n       for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       />\n+\n+  <genericsetup:registerProfile\n+      name="to517"\n+      title="Upgrade profile for Plone 5.1.6 to Plone 5.1.7"\n+      description=""\n+      directory="profiles/to_517"\n+      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      />\n </configure>\ndiff --git a/plone/app/upgrade/v51/profiles/to_517/registry.xml b/plone/app/upgrade/v51/profiles/to_517/registry.xml\nnew file mode 100644\nindex 00000000..1156921b\n--- /dev/null\n+++ b/plone/app/upgrade/v51/profiles/to_517/registry.xml\n@@ -0,0 +1,8 @@\n+<?xml version=\'1.0\' encoding=\'UTF-8\'?>\n+<registry>\n+  <records interface="Products.CMFPlone.interfaces.controlpanel.ITypesSchema" prefix="plone">\n+    <value key="default_page_types" purge="false">\n+      <element>Collection</element>\n+    </value>\n+  </records>\n+</registry>\n\\ No newline at end of file\ndiff --git a/plone/app/upgrade/v52/configure.zcml b/plone/app/upgrade/v52/configure.zcml\nindex 1493fedd..ce754111 100644\n--- a/plone/app/upgrade/v52/configure.zcml\n+++ b/plone/app/upgrade/v52/configure.zcml\n@@ -133,7 +133,7 @@\n         <gs:upgradeStep\n             title="Miscellaneous"\n             description=""\n-            handler="..utils.null_upgrade_step"\n+            handler=".final.to521"\n             />\n \n     </gs:upgradeSteps>\ndiff --git a/plone/app/upgrade/v52/final.py b/plone/app/upgrade/v52/final.py\nindex 09042a35..a869a3ba 100644\n--- a/plone/app/upgrade/v52/final.py\n+++ b/plone/app/upgrade/v52/final.py\n@@ -1,4 +1,5 @@\n # -*- coding: utf-8 -*-\n+from plone.app.upgrade.utils import loadMigrationProfile\n from plone.registry.interfaces import IRegistry\n from zope.component import getUtility\n \n@@ -111,3 +112,7 @@ def change_interface_on_lang_registry_records(context):\n             "Change registry key \'{0}\' to new interface.".format(old_key)\n         )\n         record.field.interfaceName = NEW_PREFIX\n+\n+def to521(context):\n+    """5.2.0 -> 5.2.1"""\n+    loadMigrationProfile(context, \'profile-plone.app.upgrade.v52:to521\')\ndiff --git a/plone/app/upgrade/v52/profiles.zcml b/plone/app/upgrade/v52/profiles.zcml\nindex 13b5e817..16c30c03 100644\n--- a/plone/app/upgrade/v52/profiles.zcml\n+++ b/plone/app/upgrade/v52/profiles.zcml\n@@ -39,4 +39,14 @@\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       />\n \n+  <genericsetup:registerProfile\n+      name="to521"\n+      title="Upgrade profile for Plone 5.2 to Plone 5.2.1"\n+      description=""\n+      directory="profiles/to_521"\n+      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      />\n+\n+\n </configure>\ndiff --git a/plone/app/upgrade/v52/profiles/to_521/registry.xml b/plone/app/upgrade/v52/profiles/to_521/registry.xml\nnew file mode 100644\nindex 00000000..1156921b\n--- /dev/null\n+++ b/plone/app/upgrade/v52/profiles/to_521/registry.xml\n@@ -0,0 +1,8 @@\n+<?xml version=\'1.0\' encoding=\'UTF-8\'?>\n+<registry>\n+  <records interface="Products.CMFPlone.interfaces.controlpanel.ITypesSchema" prefix="plone">\n+    <value key="default_page_types" purge="false">\n+      <element>Collection</element>\n+    </value>\n+  </records>\n+</registry>\n\\ No newline at end of file\n'

