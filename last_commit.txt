Repository: plone.app.versioningbehavior


Branch: refs/heads/master
Date: 2018-10-17T10:11:22+02:00
Author: Gil Forcada (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.versioningbehavior/commit/1277e50edad33a2703091ab02f6cadbe9ee91ab4

Drop zope.app.intid dependency

Files changed:
M CHANGES.rst
M plone/app/versioningbehavior/tests/test_modifiers.py
M setup.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 24d2105..a81df80 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,8 +14,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n-\n+- Remove (testing) dependency on zope.app.intid.\n+  [gforcada]\n \n 1.3.4 (2018-09-25)\n ------------------\ndiff --git a/plone/app/versioningbehavior/tests/test_modifiers.py b/plone/app/versioningbehavior/tests/test_modifiers.py\nindex 1a3c38e..56c27dd 100644\n--- a/plone/app/versioningbehavior/tests/test_modifiers.py\n+++ b/plone/app/versioningbehavior/tests/test_modifiers.py\n@@ -18,11 +18,11 @@\n from z3c.relationfield.schema import RelationChoice\n from z3c.relationfield.schema import RelationList\n from ZODB.interfaces import IBlob\n-from zope.app.intid.interfaces import IIntIds\n from zope.component import getUtility\n from zope.configuration import xmlconfig\n from zope.interface import alsoProvides\n from zope.interface import Interface\n+from zope.intid.interfaces import IIntIds\n \n import unittest\n \n@@ -210,10 +210,6 @@ def testRelations(self):\n         )\n         self.portal.portal_types._setObject('RelationsType', rel_fti)\n \n-        # Setup IIntIds utility which is required for relations to work\n-        from five.intid import site\n-        from zope.app.intid.interfaces import IIntIds\n-        site.add_intids(self.portal)\n         intids = getUtility(IIntIds)\n \n         source = createContentInContainer(self.portal, 'RelationsType')\n@@ -284,9 +280,6 @@ def register_RelationsType(self):\n         )\n         self.portal.portal_types._setObject('RelationsType', rel_fti)\n \n-        # Setup IIntIds utility which is required for relations to work\n-        site.add_intids(self.portal)\n-\n     def testRelationsInBehaviors(self):\n         self.register_RelationsType()\n         intids = getUtility(IIntIds)\ndiff --git a/setup.py b/setup.py\nindex 1aa4ec7..d659f80 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -15,7 +15,6 @@\n     'plone.app.dexterity',\n     'plone.app.testing',\n     'plone.namedfile[blobs]',\n-    'zope.app.intid',\n ]\n \n setup(\n"

Repository: plone.app.versioningbehavior


Branch: refs/heads/master
Date: 2018-10-17T10:32:49+02:00
Author: Markus Hilbert (iham) <markus.hilbert@iham.at>
Commit: https://github.com/plone/plone.app.versioningbehavior/commit/3639dd596f3d00f5edc1c347c0fb60b6df8cbafd

Made writing Blob less aggressive. (issue #42)

Files changed:
M CHANGES.rst
M plone/app/versioningbehavior/modifiers.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex a81df80..bc48890 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,6 +14,9 @@ New features:\n \n Bug fixes:\n \n+- Made writing Blob less aggressive.(issue #42)\n+  [iham]\n+\n - Remove (testing) dependency on zope.app.intid.\n   [gforcada]\n \ndiff --git a/plone/app/versioningbehavior/modifiers.py b/plone/app/versioningbehavior/modifiers.py\nindex 5e53e2f..1be71f4 100644\n--- a/plone/app/versioningbehavior/modifiers.py\n+++ b/plone/app/versioningbehavior/modifiers.py\n@@ -171,7 +171,9 @@ def reattachReferencedAttributes(self, obj, attrs_dict):\n             fname = name.split(\'.\')[-1]\n             field = iface.get(fname)\n             if field is not None:  # Field may have been removed from schema\n-                field.get(iface(obj))._blob = blob\n+                adapted_field = field.get(iface(obj))\n+                if adapted_field:\n+                    adapted_field._blob = blob\n \n     def getOnCloneModifiers(self, obj):\n         """Removes references to blobs.\n'

Repository: plone.app.versioningbehavior


Branch: refs/heads/master
Date: 2018-10-17T10:33:29+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.versioningbehavior/commit/9ee67806844d294eb7fdd73b396a36b8b9cb95df

Merge branch 'master' into issue_42

Files changed:


b''

Repository: plone.app.versioningbehavior


Branch: refs/heads/master
Date: 2018-10-23T10:31:56+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.versioningbehavior/commit/d71b8a6094c827d99e97ab875c9f6c373322215e

Merge pull request #43 from plone/issue_42

Made writing Blob less aggressive. (issue #42)

Files changed:
M CHANGES.rst
M plone/app/versioningbehavior/modifiers.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex a81df80..bc48890 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,6 +14,9 @@ New features:\n \n Bug fixes:\n \n+- Made writing Blob less aggressive.(issue #42)\n+  [iham]\n+\n - Remove (testing) dependency on zope.app.intid.\n   [gforcada]\n \ndiff --git a/plone/app/versioningbehavior/modifiers.py b/plone/app/versioningbehavior/modifiers.py\nindex 5e53e2f..1be71f4 100644\n--- a/plone/app/versioningbehavior/modifiers.py\n+++ b/plone/app/versioningbehavior/modifiers.py\n@@ -171,7 +171,9 @@ def reattachReferencedAttributes(self, obj, attrs_dict):\n             fname = name.split(\'.\')[-1]\n             field = iface.get(fname)\n             if field is not None:  # Field may have been removed from schema\n-                field.get(iface(obj))._blob = blob\n+                adapted_field = field.get(iface(obj))\n+                if adapted_field:\n+                    adapted_field._blob = blob\n \n     def getOnCloneModifiers(self, obj):\n         """Removes references to blobs.\n'

