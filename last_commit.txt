Repository: plone.protect


Branch: refs/heads/master
Date: 2018-03-15T11:36:10+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.protect/commit/a18cc99ba88cdc3c777801de317eb0072d1787a7

fix exec call

Files changed:
M plone/protect/utils.py

diff --git a/plone/protect/utils.py b/plone/protect/utils.py
index 4f79ed7..7914216 100644
--- a/plone/protect/utils.py
+++ b/plone/protect/utils.py
@@ -61,10 +61,10 @@ def _curried(*args, **kw):
         facade_globs = dict(_curried=_curried, _default=_default)
         try:
             name = callable.__name__
-            exec _buildFacade(name, spec, callable.__doc__) in facade_globs
+            exec(_buildFacade(name, spec, callable.__doc__) in facade_globs)
         except TypeError:  # BBB: Zope 2.10
             name = '_facade'
-            exec _buildFacade(spec, callable.__doc__) in facade_globs
+            exec(_buildFacade(spec, callable.__doc__) in facade_globs)
         return facade_globs[name]
 
 


Repository: plone.protect


Branch: refs/heads/master
Date: 2018-03-18T14:54:05+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.protect/commit/7edf02d3b16e5c6b03e1288ba1cecfe9bcb4761f

make webdav patch conditional

Files changed:
M plone/protect/configure.zcml

diff --git a/plone/protect/configure.zcml b/plone/protect/configure.zcml
index 0f7f711..b79abe8 100644
--- a/plone/protect/configure.zcml
+++ b/plone/protect/configure.zcml
@@ -53,6 +53,7 @@
     <include package="collective.monkeypatcher" />
 
     <monkey:patch
+        zcml:condition="installed webdav.Lockable"
         description="Special handling for write on read Zope2 locking issues"
         class="webdav.Lockable.LockableItem"
         original="wl_lockmapping"


Repository: plone.protect


Branch: refs/heads/master
Date: 2018-03-21T22:11:10+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.protect/commit/61ed3b605c0373d40c96982e2da84dc12a2855ac

py3 fixes

Files changed:
M plone/protect/utils.py

diff --git a/plone/protect/utils.py b/plone/protect/utils.py
index 7914216..1d09829 100644
--- a/plone/protect/utils.py
+++ b/plone/protect/utils.py
@@ -34,7 +34,7 @@ def __call__(self, callable):
 
         arglen = len(args)
         if defaults is not None:
-            defaults = zip(args[arglen - len(defaults):], defaults)
+            defaults = list(zip(args[arglen - len(defaults):], defaults))
             arglen -= len(defaults)
 
         def _curried(*args, **kw):
@@ -59,12 +59,8 @@ def _curried(*args, **kw):
 
         # Build a facade, with a reference to our locally-scoped _curried
         facade_globs = dict(_curried=_curried, _default=_default)
-        try:
-            name = callable.__name__
-            exec(_buildFacade(name, spec, callable.__doc__) in facade_globs)
-        except TypeError:  # BBB: Zope 2.10
-            name = '_facade'
-            exec(_buildFacade(spec, callable.__doc__) in facade_globs)
+        name = callable.__name__
+        exec(_buildFacade(name, spec, callable.__doc__), facade_globs)
         return facade_globs[name]
 
 


Repository: plone.protect


Branch: refs/heads/master
Date: 2018-03-22T00:39:48+01:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.protect/commit/2521dd78b81710c16a7735c16b8434ebcdedb3f1

Changelog line

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index a760865..fdbbfd4 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- More Python 2 / 3 compatibility
+  [pbauer]
 
 
 3.1.2 (2018-02-02)


Repository: plone.protect


Branch: refs/heads/master
Date: 2018-03-22T08:57:43+01:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.protect/commit/e72bdb55d185b31e20159ab4ad652b7cf9609e42

Merge pull request #72 from plone/python3

Python3

Files changed:
M CHANGES.rst
M plone/protect/configure.zcml
M plone/protect/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index a760865..fdbbfd4 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- More Python 2 / 3 compatibility
+  [pbauer]
 
 
 3.1.2 (2018-02-02)
diff --git a/plone/protect/configure.zcml b/plone/protect/configure.zcml
index 0f7f711..b79abe8 100644
--- a/plone/protect/configure.zcml
+++ b/plone/protect/configure.zcml
@@ -53,6 +53,7 @@
     <include package="collective.monkeypatcher" />
 
     <monkey:patch
+        zcml:condition="installed webdav.Lockable"
         description="Special handling for write on read Zope2 locking issues"
         class="webdav.Lockable.LockableItem"
         original="wl_lockmapping"
diff --git a/plone/protect/utils.py b/plone/protect/utils.py
index 4f79ed7..1d09829 100644
--- a/plone/protect/utils.py
+++ b/plone/protect/utils.py
@@ -34,7 +34,7 @@ def __call__(self, callable):
 
         arglen = len(args)
         if defaults is not None:
-            defaults = zip(args[arglen - len(defaults):], defaults)
+            defaults = list(zip(args[arglen - len(defaults):], defaults))
             arglen -= len(defaults)
 
         def _curried(*args, **kw):
@@ -59,12 +59,8 @@ def _curried(*args, **kw):
 
         # Build a facade, with a reference to our locally-scoped _curried
         facade_globs = dict(_curried=_curried, _default=_default)
-        try:
-            name = callable.__name__
-            exec _buildFacade(name, spec, callable.__doc__) in facade_globs
-        except TypeError:  # BBB: Zope 2.10
-            name = '_facade'
-            exec _buildFacade(spec, callable.__doc__) in facade_globs
+        name = callable.__name__
+        exec(_buildFacade(name, spec, callable.__doc__), facade_globs)
         return facade_globs[name]
 
 


