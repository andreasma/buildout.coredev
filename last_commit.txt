Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2018-03-08T23:51:21+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.upgrade/commit/19e4f1d01f2de762eaeddad3743f4d34a83f1fc0

Rename retina_scales to highpixeldensity_scales.

Fixes https://github.com/plone/Products.CMFPlone/issues/2331

Files changed:
A plone/app/upgrade/v51/profiles/to_511/registry.xml
M CHANGES.rst
M plone/app/upgrade/v51/configure.zcml
M plone/app/upgrade/v51/profiles.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index bac58cea..ddc7d1aa 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,10 @@ New features:
 
 Bug fixes:
 
+- Rename retina_scales to highpixeldensity_scales.
+  Fixes `issue 2331 <https://github.com/plone/Products.CMFPlone/issues/2331>`_.
+  [maurits]
+
 - Hide our 'products' from installation for both CMFQuickInstallerTool and CMFPlone.
   [maurits]
 
diff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml
index acb2bc1d..6bf4c472 100644
--- a/plone/app/upgrade/v51/configure.zcml
+++ b/plone/app/upgrade/v51/configure.zcml
@@ -212,10 +212,10 @@ Add image scaling options to image handling control panel.
         destination="5111"
         profile="Products.CMFPlone:plone">
 
-        <gs:upgradeStep
-            title="Miscellaneous"
-            description=""
-            handler="..utils.null_upgrade_step"
+        <gs:upgradeDepends
+            title="Run to511 upgrade profile."
+            description="Rename retina_scales to highpixeldensity_scales."
+            import_profile="plone.app.upgrade.v51:to511"
             />
 
     </gs:upgradeSteps>
diff --git a/plone/app/upgrade/v51/profiles.zcml b/plone/app/upgrade/v51/profiles.zcml
index d2f18cc1..860171c1 100644
--- a/plone/app/upgrade/v51/profiles.zcml
+++ b/plone/app/upgrade/v51/profiles.zcml
@@ -59,4 +59,13 @@
       provides="Products.GenericSetup.interfaces.EXTENSION"
       />
 
+  <genericsetup:registerProfile
+      name="to511"
+      title="Upgrade profile for Plone 5.1 to Plone 5.1.1"
+      description=""
+      directory="profiles/to_511"
+      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"
+      provides="Products.GenericSetup.interfaces.EXTENSION"
+      />
+
 </configure>
diff --git a/plone/app/upgrade/v51/profiles/to_511/registry.xml b/plone/app/upgrade/v51/profiles/to_511/registry.xml
new file mode 100644
index 00000000..37e49957
--- /dev/null
+++ b/plone/app/upgrade/v51/profiles/to_511/registry.xml
@@ -0,0 +1,8 @@
+<?xml version="1.0"?>
+<registry>
+
+  <!-- Rename retina_scales to highpixeldensity_scales. -->
+  <records interface="Products.CMFPlone.interfaces.IImagingSchema"
+           prefix="plone" />
+
+</registry>


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2018-03-10T10:09:15+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/c99b60b54feca8a56e11363218ee8faadebc302d

Merge pull request #152 from plone/retina-rename-issue-2331

Rename retina_scales to highpixeldensity_scales.

Files changed:
A plone/app/upgrade/v51/profiles/to_511/registry.xml
M CHANGES.rst
M plone/app/upgrade/v51/configure.zcml
M plone/app/upgrade/v51/profiles.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index bac58cea..ddc7d1aa 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,10 @@ New features:
 
 Bug fixes:
 
+- Rename retina_scales to highpixeldensity_scales.
+  Fixes `issue 2331 <https://github.com/plone/Products.CMFPlone/issues/2331>`_.
+  [maurits]
+
 - Hide our 'products' from installation for both CMFQuickInstallerTool and CMFPlone.
   [maurits]
 
diff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml
index acb2bc1d..6bf4c472 100644
--- a/plone/app/upgrade/v51/configure.zcml
+++ b/plone/app/upgrade/v51/configure.zcml
@@ -212,10 +212,10 @@ Add image scaling options to image handling control panel.
         destination="5111"
         profile="Products.CMFPlone:plone">
 
-        <gs:upgradeStep
-            title="Miscellaneous"
-            description=""
-            handler="..utils.null_upgrade_step"
+        <gs:upgradeDepends
+            title="Run to511 upgrade profile."
+            description="Rename retina_scales to highpixeldensity_scales."
+            import_profile="plone.app.upgrade.v51:to511"
             />
 
     </gs:upgradeSteps>
diff --git a/plone/app/upgrade/v51/profiles.zcml b/plone/app/upgrade/v51/profiles.zcml
index d2f18cc1..860171c1 100644
--- a/plone/app/upgrade/v51/profiles.zcml
+++ b/plone/app/upgrade/v51/profiles.zcml
@@ -59,4 +59,13 @@
       provides="Products.GenericSetup.interfaces.EXTENSION"
       />
 
+  <genericsetup:registerProfile
+      name="to511"
+      title="Upgrade profile for Plone 5.1 to Plone 5.1.1"
+      description=""
+      directory="profiles/to_511"
+      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"
+      provides="Products.GenericSetup.interfaces.EXTENSION"
+      />
+
 </configure>
diff --git a/plone/app/upgrade/v51/profiles/to_511/registry.xml b/plone/app/upgrade/v51/profiles/to_511/registry.xml
new file mode 100644
index 00000000..37e49957
--- /dev/null
+++ b/plone/app/upgrade/v51/profiles/to_511/registry.xml
@@ -0,0 +1,8 @@
+<?xml version="1.0"?>
+<registry>
+
+  <!-- Rename retina_scales to highpixeldensity_scales. -->
+  <records interface="Products.CMFPlone.interfaces.IImagingSchema"
+           prefix="plone" />
+
+</registry>


