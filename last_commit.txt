Repository: plone.app.debugtoolbar


Branch: refs/heads/master
Date: 2019-02-23T11:02:09+01:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.debugtoolbar/commit/4e1f73b97a97834398d802c3bd897ac57fba7454

Do not break when portal_css or portal_javascript are missing

Fixes #23

Files changed:
A news/23.bugfix
M src/plone/app/debugtoolbar/browser/theme.pt
M src/plone/app/debugtoolbar/browser/theme.py

b'diff --git a/news/23.bugfix b/news/23.bugfix\nnew file mode 100644\nindex 0000000..0a5e0f8\n--- /dev/null\n+++ b/news/23.bugfix\n@@ -0,0 +1,2 @@\n+Do not break when portal_css or portal_javascript are missing\n+[ale-rt]\ndiff --git a/src/plone/app/debugtoolbar/browser/theme.pt b/src/plone/app/debugtoolbar/browser/theme.pt\nindex 9f2a59c..1083fa0 100644\n--- a/src/plone/app/debugtoolbar/browser/theme.pt\n+++ b/src/plone/app/debugtoolbar/browser/theme.pt\n@@ -40,7 +40,7 @@\n                     <div tal:repeat="layer view/layers"><code tal:content="layer/__identifier__" /></div>\n                 </td>\n             </tr>\n-            <tr>\n+            <tr tal:condition="nocall:view/css">\n                 <td tal:define="debugMode view/css/getDebugMode">\n                     <span i18n:translate="">CSS composition</span>\n                     <span class="label warning" tal:condition="debugMode" i18n:translate="">Debug mode</span>\n@@ -85,7 +85,7 @@\n                     </ul>\n                 </td>\n             </tr>\n-            <tr>\n+            <tr tal:condition="nocall:view/js">\n                 <td tal:define="debugMode view/js/getDebugMode">\n                     <span i18n:translate="">JavaScript composition</span>\n                     <span class="label warning" tal:condition="debugMode" i18n:translate="">Debug mode</span>\n@@ -131,7 +131,7 @@\n                 </td>\n             </tr>\n         </tbody>\n-    </table>    \n+    </table>\n \n </div>\n </html>\ndiff --git a/src/plone/app/debugtoolbar/browser/theme.py b/src/plone/app/debugtoolbar/browser/theme.py\nindex cc9b0d2..d2614da 100644\n--- a/src/plone/app/debugtoolbar/browser/theme.py\n+++ b/src/plone/app/debugtoolbar/browser/theme.py\n@@ -1,5 +1,4 @@\n # -*- coding: utf-8 -*-\n-from zope.interface import Interface\n from zope.interface import directlyProvidedBy\n from zope.component import queryUtility\n from zope.viewlet.viewlet import ViewletBase\n@@ -11,7 +10,7 @@\n class ThemeViewlet(ViewletBase):\n \n     def update(self):\n-        \n+\n         skins = getToolByName(self.context, \'portal_skins\')\n         url = getToolByName(self.context, \'portal_url\')\n \n@@ -23,12 +22,12 @@ def update(self):\n \n         # CMF skin\n         self.themeName = self.request.get(requestVariable, defaultSkin)\n-        self.skinPaths = dict(skins.getSkinPaths()).get(self.themeName, \'\').split(\',\')\n+        self.skinPaths = dict(skins.getSkinPaths()).get(self.themeName, \'\').split(\',\')  # noqa: E501\n \n         # Browser layers\n         self.themeLayer = queryUtility(IBrowserSkinType, name=self.themeName)\n         self.layers = list(directlyProvidedBy(self.request).flattened())\n \n         # CSS/JS composition\n-        self.css = getToolByName(self.context, \'portal_css\')\n-        self.js = getToolByName(self.context, \'portal_javascripts\')\n\\ No newline at end of file\n+        self.css = getToolByName(self.context, \'portal_css\', None)\n+        self.js = getToolByName(self.context, \'portal_javascripts\', None)\n'

Repository: plone.app.debugtoolbar


Branch: refs/heads/master
Date: 2019-03-01T01:29:41+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.debugtoolbar/commit/e19f451252664b2d55fbd54511fbe72a2ce74475

Merge pull request #24 from plone/23-fix-debugtoolbar

Do not break when portal_css or portal_javascript are missing

Files changed:
A news/23.bugfix
M src/plone/app/debugtoolbar/browser/theme.pt
M src/plone/app/debugtoolbar/browser/theme.py

b'diff --git a/news/23.bugfix b/news/23.bugfix\nnew file mode 100644\nindex 0000000..0a5e0f8\n--- /dev/null\n+++ b/news/23.bugfix\n@@ -0,0 +1,2 @@\n+Do not break when portal_css or portal_javascript are missing\n+[ale-rt]\ndiff --git a/src/plone/app/debugtoolbar/browser/theme.pt b/src/plone/app/debugtoolbar/browser/theme.pt\nindex 9f2a59c..1083fa0 100644\n--- a/src/plone/app/debugtoolbar/browser/theme.pt\n+++ b/src/plone/app/debugtoolbar/browser/theme.pt\n@@ -40,7 +40,7 @@\n                     <div tal:repeat="layer view/layers"><code tal:content="layer/__identifier__" /></div>\n                 </td>\n             </tr>\n-            <tr>\n+            <tr tal:condition="nocall:view/css">\n                 <td tal:define="debugMode view/css/getDebugMode">\n                     <span i18n:translate="">CSS composition</span>\n                     <span class="label warning" tal:condition="debugMode" i18n:translate="">Debug mode</span>\n@@ -85,7 +85,7 @@\n                     </ul>\n                 </td>\n             </tr>\n-            <tr>\n+            <tr tal:condition="nocall:view/js">\n                 <td tal:define="debugMode view/js/getDebugMode">\n                     <span i18n:translate="">JavaScript composition</span>\n                     <span class="label warning" tal:condition="debugMode" i18n:translate="">Debug mode</span>\n@@ -131,7 +131,7 @@\n                 </td>\n             </tr>\n         </tbody>\n-    </table>    \n+    </table>\n \n </div>\n </html>\ndiff --git a/src/plone/app/debugtoolbar/browser/theme.py b/src/plone/app/debugtoolbar/browser/theme.py\nindex cc9b0d2..d2614da 100644\n--- a/src/plone/app/debugtoolbar/browser/theme.py\n+++ b/src/plone/app/debugtoolbar/browser/theme.py\n@@ -1,5 +1,4 @@\n # -*- coding: utf-8 -*-\n-from zope.interface import Interface\n from zope.interface import directlyProvidedBy\n from zope.component import queryUtility\n from zope.viewlet.viewlet import ViewletBase\n@@ -11,7 +10,7 @@\n class ThemeViewlet(ViewletBase):\n \n     def update(self):\n-        \n+\n         skins = getToolByName(self.context, \'portal_skins\')\n         url = getToolByName(self.context, \'portal_url\')\n \n@@ -23,12 +22,12 @@ def update(self):\n \n         # CMF skin\n         self.themeName = self.request.get(requestVariable, defaultSkin)\n-        self.skinPaths = dict(skins.getSkinPaths()).get(self.themeName, \'\').split(\',\')\n+        self.skinPaths = dict(skins.getSkinPaths()).get(self.themeName, \'\').split(\',\')  # noqa: E501\n \n         # Browser layers\n         self.themeLayer = queryUtility(IBrowserSkinType, name=self.themeName)\n         self.layers = list(directlyProvidedBy(self.request).flattened())\n \n         # CSS/JS composition\n-        self.css = getToolByName(self.context, \'portal_css\')\n-        self.js = getToolByName(self.context, \'portal_javascripts\')\n\\ No newline at end of file\n+        self.css = getToolByName(self.context, \'portal_css\', None)\n+        self.js = getToolByName(self.context, \'portal_javascripts\', None)\n'

