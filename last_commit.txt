Repository: Products.CMFEditions


Branch: refs/heads/master
Date: 2018-03-14T14:41:54+01:00
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/Products.CMFEditions/commit/50defeee233676f0e957d573a28c019c30f48e58

Allow enable versioning per content item

Files changed:
M CHANGES.rst
M Products/CMFEditions/CopyModifyMergeRepositoryTool.py
M Products/CMFEditions/ZVCStorageTool.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c8684cf..e73c62f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,13 +10,17 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Allow disabling versioning per object
+  https://github.com/plone/Products.CMFPlone/issues/2341
+  [tomgross]
 
 Bug fixes:
 
 - Make imports Python 3 compatible
   [ale-rt]
 
+- Don't depend on ZODB version 3 directly
+  [tomgross]
 
 3.1.1 (2018-02-05)
 ------------------
diff --git a/Products/CMFEditions/CopyModifyMergeRepositoryTool.py b/Products/CMFEditions/CopyModifyMergeRepositoryTool.py
index bad72b1..e941a0f 100644
--- a/Products/CMFEditions/CopyModifyMergeRepositoryTool.py
+++ b/Products/CMFEditions/CopyModifyMergeRepositoryTool.py
@@ -21,8 +21,6 @@
 # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 #########################################################################
 """Copy Modify Merge Repository implementation.
-
-$Id: CopyModifyMergeRepositoryTool.py,v 1.20 2005/06/24 11:42:01 gregweb Exp $
 """
 
 from AccessControl import ClassSecurityInfo
@@ -138,6 +136,9 @@ def _migrateVersionPolicies(self):
     def isVersionable(self, obj):
         """See interface.
         """
+        if hasattr(aq_base(obj), 'versioning_enabled') \
+                and not getattr(obj, 'versioning_enabled'):
+            return False
         return obj.portal_type in self.getVersionableContentTypes()
 
     security.declarePublic('getVersionableContentTypes')
diff --git a/Products/CMFEditions/ZVCStorageTool.py b/Products/CMFEditions/ZVCStorageTool.py
index 3d68373..74ae411 100644
--- a/Products/CMFEditions/ZVCStorageTool.py
+++ b/Products/CMFEditions/ZVCStorageTool.py
@@ -21,7 +21,6 @@
 #########################################################################
 """Histories Storage using ZVC
 
-$Id: ZVCStorageTool.py,v 1.18 2005/03/11 11:05:12 varun-rastogi Exp $
 """
 __version__ = "$Revision: 1.18 $"
 
diff --git a/setup.py b/setup.py
index e5e9cca..5cf1c7b 100644
--- a/setup.py
+++ b/setup.py
@@ -52,7 +52,6 @@
         'Acquisition',
         'DateTime',
         'transaction',
-        'ZODB3>=3.9.0',  # blob support
         'Zope2',
     ],
     entry_points="""


Repository: Products.CMFEditions


Branch: refs/heads/master
Date: 2018-03-18T18:24:40+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFEditions/commit/1be0f35878aa4bfdad385790f45037d110cf7f1d

Merge pull request #51 from plone/tg_individual_flag

Allow enable versioning per content item

Files changed:
M CHANGES.rst
M Products/CMFEditions/CopyModifyMergeRepositoryTool.py
M Products/CMFEditions/ZVCStorageTool.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c8684cf..e73c62f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,13 +10,17 @@ Breaking changes:
 
 New features:
 
-- *add item here*
+- Allow disabling versioning per object
+  https://github.com/plone/Products.CMFPlone/issues/2341
+  [tomgross]
 
 Bug fixes:
 
 - Make imports Python 3 compatible
   [ale-rt]
 
+- Don't depend on ZODB version 3 directly
+  [tomgross]
 
 3.1.1 (2018-02-05)
 ------------------
diff --git a/Products/CMFEditions/CopyModifyMergeRepositoryTool.py b/Products/CMFEditions/CopyModifyMergeRepositoryTool.py
index bad72b1..e941a0f 100644
--- a/Products/CMFEditions/CopyModifyMergeRepositoryTool.py
+++ b/Products/CMFEditions/CopyModifyMergeRepositoryTool.py
@@ -21,8 +21,6 @@
 # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 #########################################################################
 """Copy Modify Merge Repository implementation.
-
-$Id: CopyModifyMergeRepositoryTool.py,v 1.20 2005/06/24 11:42:01 gregweb Exp $
 """
 
 from AccessControl import ClassSecurityInfo
@@ -138,6 +136,9 @@ def _migrateVersionPolicies(self):
     def isVersionable(self, obj):
         """See interface.
         """
+        if hasattr(aq_base(obj), 'versioning_enabled') \
+                and not getattr(obj, 'versioning_enabled'):
+            return False
         return obj.portal_type in self.getVersionableContentTypes()
 
     security.declarePublic('getVersionableContentTypes')
diff --git a/Products/CMFEditions/ZVCStorageTool.py b/Products/CMFEditions/ZVCStorageTool.py
index 3d68373..74ae411 100644
--- a/Products/CMFEditions/ZVCStorageTool.py
+++ b/Products/CMFEditions/ZVCStorageTool.py
@@ -21,7 +21,6 @@
 #########################################################################
 """Histories Storage using ZVC
 
-$Id: ZVCStorageTool.py,v 1.18 2005/03/11 11:05:12 varun-rastogi Exp $
 """
 __version__ = "$Revision: 1.18 $"
 
diff --git a/setup.py b/setup.py
index e5e9cca..5cf1c7b 100644
--- a/setup.py
+++ b/setup.py
@@ -52,7 +52,6 @@
         'Acquisition',
         'DateTime',
         'transaction',
-        'ZODB3>=3.9.0',  # blob support
         'Zope2',
     ],
     entry_points="""


