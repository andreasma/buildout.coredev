Repository: Products.CMFPlone


Branch: refs/heads/5.1.x
Date: 2018-07-10T18:17:53+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/121436f37a7aaa6cbff84ee5b0222095d296ea73

add test to show problem of #2469, Subobjects are indexing attributes of parent

Files changed:
M CHANGES.rst
M Products/CMFPlone/tests/testCatalogTool.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 19fa7b337..692e26ff7 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -18,7 +18,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Add test for issue #2469.\n+  [jensens]\n \n \n 5.1.3 (2018-06-22)\ndiff --git a/Products/CMFPlone/tests/testCatalogTool.py b/Products/CMFPlone/tests/testCatalogTool.py\nindex c64e08ff4..fdf695cc8 100644\n--- a/Products/CMFPlone/tests/testCatalogTool.py\n+++ b/Products/CMFPlone/tests/testCatalogTool.py\n@@ -339,6 +339,20 @@ def testClearFindAndRebuildKeepsModificationDate(self):\n         self.assertEqual(self.folder.doc.modified(), DateTime(0))\n         self.assertEqual(len(self.catalog(modified=DateTime(0))), 1)\n \n+    def test_acquired_attributes_are_not_indexed(self):\n+        # create an index for foo:\n+        # from Products.PluginIndexes.FieldIndex.FieldIndex import FieldIndex\n+        self.catalog.addIndex('foo', 'FieldIndex')\n+\n+        # create attribute foo on folder and index on both, folder and\n+        # contained\n+        self.folder.foo = 'FOO'\n+        self.catalog.clearFindAndRebuild()\n+\n+        # lets see if we have one result for folder, but nothing for doc:\n+        brains = self.catalog(foo='FOO')\n+        self.assertEqual(len(brains), 1)\n+\n \n class TestCatalogSearching(PloneTestCase):\n \n"

Repository: Products.CMFPlone


Branch: refs/heads/5.1.x
Date: 2018-07-11T12:01:04+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/064c6a78d0fa7ecb9ff1ba0750aa281476601667

Merge pull request #2470 from plone/fix-2469

Add test for #2469

Files changed:
M CHANGES.rst
M Products/CMFPlone/tests/testCatalogTool.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 19fa7b337..692e26ff7 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -18,7 +18,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Add test for issue #2469.\n+  [jensens]\n \n \n 5.1.3 (2018-06-22)\ndiff --git a/Products/CMFPlone/tests/testCatalogTool.py b/Products/CMFPlone/tests/testCatalogTool.py\nindex c64e08ff4..fdf695cc8 100644\n--- a/Products/CMFPlone/tests/testCatalogTool.py\n+++ b/Products/CMFPlone/tests/testCatalogTool.py\n@@ -339,6 +339,20 @@ def testClearFindAndRebuildKeepsModificationDate(self):\n         self.assertEqual(self.folder.doc.modified(), DateTime(0))\n         self.assertEqual(len(self.catalog(modified=DateTime(0))), 1)\n \n+    def test_acquired_attributes_are_not_indexed(self):\n+        # create an index for foo:\n+        # from Products.PluginIndexes.FieldIndex.FieldIndex import FieldIndex\n+        self.catalog.addIndex('foo', 'FieldIndex')\n+\n+        # create attribute foo on folder and index on both, folder and\n+        # contained\n+        self.folder.foo = 'FOO'\n+        self.catalog.clearFindAndRebuild()\n+\n+        # lets see if we have one result for folder, but nothing for doc:\n+        brains = self.catalog(foo='FOO')\n+        self.assertEqual(len(brains), 1)\n+\n \n class TestCatalogSearching(PloneTestCase):\n \n"

