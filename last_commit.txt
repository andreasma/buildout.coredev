Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2019-02-10T18:32:51+01:00
Author: Wolfgang Thomas (pysailor) <thomas@syslab.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/d468e3d5203b98f0441b4df7b02777f9354e0db1

add a test for the upgrade step created in #191

Files changed:
M plone/app/upgrade/v52/tests.py

b"diff --git a/plone/app/upgrade/v52/tests.py b/plone/app/upgrade/v52/tests.py\nindex 313bed46..543d3951 100644\n--- a/plone/app/upgrade/v52/tests.py\n+++ b/plone/app/upgrade/v52/tests.py\n@@ -1,14 +1,32 @@\n # -*- coding: utf-8 -*-\n-\n-from plone.app.upgrade.utils import plone_version\n-from plone.testing.z2 import Browser\n+from pkg_resources import get_distribution\n+from pkg_resources import parse_version\n+from plone.app.testing import PLONE_INTEGRATION_TESTING\n+from Products.CMFCore.utils import getToolByName\n \n import unittest\n \n \n+class UpgradeMemberData51to52Test(unittest.TestCase):\n+    layer = PLONE_INTEGRATION_TESTING\n+\n+    def test_rebuild_member_data(self):\n+        portal = self.layer['portal']\n+        from plone.app.upgrade.v52.alphas import rebuild_memberdata\n+        rebuild_memberdata(portal)\n+        tool = getToolByName(portal, 'portal_memberdata')\n+        self.assertIn(\n+            'test_user_1_', tool._members.keys())\n+\n+\n def test_suite():\n-    # Skip these tests on Plone 4\n-    if plone_version <= '5.0':\n+    # Skip these tests on Plone > 5.2a1\n+    plone_version = get_distribution('Products.CMFPlone').version\n+    if not parse_version(plone_version) >= parse_version('5.2a1'):\n         return unittest.TestSuite()\n+\n     suite = unittest.TestSuite()\n+    suite.addTest(\n+        unittest.makeSuite(UpgradeMemberData51to52Test),\n+    )\n     return suite\n"

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2019-02-10T22:37:22+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/c8bd74991cd7c329cf1b4843f0fab841d26f2738

Merge pull request #194 from plone/191-test

Add a test for the upgrade step created in #191

Files changed:
M plone/app/upgrade/v52/tests.py

b"diff --git a/plone/app/upgrade/v52/tests.py b/plone/app/upgrade/v52/tests.py\nindex 313bed46..543d3951 100644\n--- a/plone/app/upgrade/v52/tests.py\n+++ b/plone/app/upgrade/v52/tests.py\n@@ -1,14 +1,32 @@\n # -*- coding: utf-8 -*-\n-\n-from plone.app.upgrade.utils import plone_version\n-from plone.testing.z2 import Browser\n+from pkg_resources import get_distribution\n+from pkg_resources import parse_version\n+from plone.app.testing import PLONE_INTEGRATION_TESTING\n+from Products.CMFCore.utils import getToolByName\n \n import unittest\n \n \n+class UpgradeMemberData51to52Test(unittest.TestCase):\n+    layer = PLONE_INTEGRATION_TESTING\n+\n+    def test_rebuild_member_data(self):\n+        portal = self.layer['portal']\n+        from plone.app.upgrade.v52.alphas import rebuild_memberdata\n+        rebuild_memberdata(portal)\n+        tool = getToolByName(portal, 'portal_memberdata')\n+        self.assertIn(\n+            'test_user_1_', tool._members.keys())\n+\n+\n def test_suite():\n-    # Skip these tests on Plone 4\n-    if plone_version <= '5.0':\n+    # Skip these tests on Plone > 5.2a1\n+    plone_version = get_distribution('Products.CMFPlone').version\n+    if not parse_version(plone_version) >= parse_version('5.2a1'):\n         return unittest.TestSuite()\n+\n     suite = unittest.TestSuite()\n+    suite.addTest(\n+        unittest.makeSuite(UpgradeMemberData51to52Test),\n+    )\n     return suite\n"

