Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2018-10-02T12:14:56+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.upgrade/commit/a86041737eff7bb8deb3541633a90b5918ea00fe

migrate GopipIndex

Files changed:
M plone/app/upgrade/v52/alphas.py

b"diff --git a/plone/app/upgrade/v52/alphas.py b/plone/app/upgrade/v52/alphas.py\nindex 972ee8a7..4aa8bd0c 100644\n--- a/plone/app/upgrade/v52/alphas.py\n+++ b/plone/app/upgrade/v52/alphas.py\n@@ -1,6 +1,7 @@\n # -*- coding: utf-8 -*-\n from plone.app.upgrade.utils import cleanUpSkinsTool\n from plone.app.upgrade.utils import loadMigrationProfile\n+from plone.folder.nogopip import manage_addGopipIndex\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from zope.component import getUtility\n@@ -11,13 +12,27 @@\n logger = logging.getLogger('plone.app.upgrade')\n \n \n-def to52alpha1(context):\n-    loadMigrationProfile(context, 'profile-plone.app.upgrade.v52:to52alpha1')\n-    portal = getToolByName(context, 'portal_url').getPortalObject()\n-    cleanUpSkinsTool(portal)\n-\n+def cleanup_resources():\n     registry = getUtility(IRegistry)\n     record = 'plone.bundles/plone-legacy.resources'\n     resources = registry.records[record]\n+    \n     if u'jquery-highlightsearchterms' in resources.value:\n         resources.value.remove(u'jquery-highlightsearchterms')\n+\n+\n+def migrate_gopipindex(context):\n+    # GopipIndex class has moved from p.a.folder to p.folder\n+    # just remove and reinstall the index\n+    catalog = getToolByName(context, 'portal_catalog')\n+    catalog.manage_delIndex('getObjPositionInParent')\n+    manage_addGopipIndex(catalog, 'getObjPositionInParent')\n+\n+\n+def to52alpha1(context):\n+    loadMigrationProfile(context, 'profile-plone.app.upgrade.v52:to52alpha1')\n+    portal = getToolByName(context, 'portal_url').getPortalObject()\n+    cleanUpSkinsTool(portal)\n+\n+    cleanup_resources()\n+    migrate_gopipindex(context)\n"

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2018-10-02T12:16:36+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.upgrade/commit/3eb0eb467c9e455a537321c0bcb8dfccbb97ba1f

add changelog

Files changed:
A news/177.bugfix

b'diff --git a/news/177.bugfix b/news/177.bugfix\nnew file mode 100644\nindex 00000000..e1b50cd3\n--- /dev/null\n+++ b/news/177.bugfix\n@@ -0,0 +1,3 @@\n+migrate GopipIndex which has moved from p.a.folder to p.folder\n+\n+[petschki]\n\\ No newline at end of file\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2018-10-02T13:20:24+02:00
Author: Peter Mathis (petschki) <petschki@users.noreply.github.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/3c5f7895efaf76179a0477dcdb7bc0b534f99f5b

Merge pull request #177 from plone/migrate-gopipindex

migrate GopipIndex for Plone 5.2

Files changed:
A news/177.bugfix
M plone/app/upgrade/v52/alphas.py

b"diff --git a/news/177.bugfix b/news/177.bugfix\nnew file mode 100644\nindex 00000000..e1b50cd3\n--- /dev/null\n+++ b/news/177.bugfix\n@@ -0,0 +1,3 @@\n+migrate GopipIndex which has moved from p.a.folder to p.folder\n+\n+[petschki]\n\\ No newline at end of file\ndiff --git a/plone/app/upgrade/v52/alphas.py b/plone/app/upgrade/v52/alphas.py\nindex 972ee8a7..4aa8bd0c 100644\n--- a/plone/app/upgrade/v52/alphas.py\n+++ b/plone/app/upgrade/v52/alphas.py\n@@ -1,6 +1,7 @@\n # -*- coding: utf-8 -*-\n from plone.app.upgrade.utils import cleanUpSkinsTool\n from plone.app.upgrade.utils import loadMigrationProfile\n+from plone.folder.nogopip import manage_addGopipIndex\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from zope.component import getUtility\n@@ -11,13 +12,27 @@\n logger = logging.getLogger('plone.app.upgrade')\n \n \n-def to52alpha1(context):\n-    loadMigrationProfile(context, 'profile-plone.app.upgrade.v52:to52alpha1')\n-    portal = getToolByName(context, 'portal_url').getPortalObject()\n-    cleanUpSkinsTool(portal)\n-\n+def cleanup_resources():\n     registry = getUtility(IRegistry)\n     record = 'plone.bundles/plone-legacy.resources'\n     resources = registry.records[record]\n+    \n     if u'jquery-highlightsearchterms' in resources.value:\n         resources.value.remove(u'jquery-highlightsearchterms')\n+\n+\n+def migrate_gopipindex(context):\n+    # GopipIndex class has moved from p.a.folder to p.folder\n+    # just remove and reinstall the index\n+    catalog = getToolByName(context, 'portal_catalog')\n+    catalog.manage_delIndex('getObjPositionInParent')\n+    manage_addGopipIndex(catalog, 'getObjPositionInParent')\n+\n+\n+def to52alpha1(context):\n+    loadMigrationProfile(context, 'profile-plone.app.upgrade.v52:to52alpha1')\n+    portal = getToolByName(context, 'portal_url').getPortalObject()\n+    cleanUpSkinsTool(portal)\n+\n+    cleanup_resources()\n+    migrate_gopipindex(context)\n"

