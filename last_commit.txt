Repository: plone.recipe.zope2instance


Branch: refs/heads/4.x
Date: 2018-04-20T15:59:48+02:00
Author: Ida Ebkes (ida) <contact@ida-ebkes.eu>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/efe95f657e6cc8538529d8aec7eaa1b656f8cc62

Regard 'parsed_version' of setuptools &gt; 38.7.0 does not return iterable anymore, fixes #37.

Files changed:
M CHANGES.rst
M src/plone/recipe/zope2instance/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 8a6c728..a25da44 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,7 +18,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Regard 'parsed_version' of setuptools > 38.7.0 does not return
+  iterable anymore, fixes #37.
+  [ida]
 
 
 4.3 (2017-06-28)
diff --git a/src/plone/recipe/zope2instance/__init__.py b/src/plone/recipe/zope2instance/__init__.py
index 62ad36c..08d31d6 100644
--- a/src/plone/recipe/zope2instance/__init__.py
+++ b/src/plone/recipe/zope2instance/__init__.py
@@ -110,6 +110,13 @@ def install(self, update=False):
             # Which Zope2 version do we have?
             dist = pkg_resources.get_distribution('Zope2')
             parsed = dist.parsed_version
+            # Starting from version >= 37.8.0 pkg_resources of setuptools
+            # does not return an iterable anymore with 'parsed_version',
+            # instead a class-object is returned. Let's re-parse that, to
+            # support setuptools > 37.8.0, while keeping backwards-compat:
+            if not isinstance(parsed, tuple):
+                parsed = parsed.base_version.split('.')
+
             major, minor = parsed[0:2]
             major = int(major)
             # We support creating instances for 2.12, 2.13 and 4.0


Repository: plone.recipe.zope2instance


Branch: refs/heads/4.x
Date: 2018-04-23T15:12:06+02:00
Author: Godefroid Chapelle (gotcha) <gotcha@bubblenet.be>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/2e19e1d283d01d6594b1b66992b1d5849ba417e0

Be more defensive

Files changed:
M src/plone/recipe/zope2instance/__init__.py

diff --git a/src/plone/recipe/zope2instance/__init__.py b/src/plone/recipe/zope2instance/__init__.py
index 08d31d6..2c901fa 100644
--- a/src/plone/recipe/zope2instance/__init__.py
+++ b/src/plone/recipe/zope2instance/__init__.py
@@ -114,7 +114,8 @@ def install(self, update=False):
             # does not return an iterable anymore with 'parsed_version',
             # instead a class-object is returned. Let's re-parse that, to
             # support setuptools > 37.8.0, while keeping backwards-compat:
-            if not isinstance(parsed, tuple):
+            if (not isinstance(parsed, tuple)
+                and hasattr(parsed, "base_version")):
                 parsed = parsed.base_version.split('.')
 
             major, minor = parsed[0:2]


Repository: plone.recipe.zope2instance


Branch: refs/heads/4.x
Date: 2018-04-23T16:52:09+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/8b98f2c1b9532c4c995db8fcc2cf783da2b085d1

Merge pull request #41 from plone/4.x-fix37

Fix #37

Files changed:
M CHANGES.rst
M src/plone/recipe/zope2instance/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 8a6c728..a25da44 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,7 +18,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Regard 'parsed_version' of setuptools > 38.7.0 does not return
+  iterable anymore, fixes #37.
+  [ida]
 
 
 4.3 (2017-06-28)
diff --git a/src/plone/recipe/zope2instance/__init__.py b/src/plone/recipe/zope2instance/__init__.py
index 62ad36c..2c901fa 100644
--- a/src/plone/recipe/zope2instance/__init__.py
+++ b/src/plone/recipe/zope2instance/__init__.py
@@ -110,6 +110,14 @@ def install(self, update=False):
             # Which Zope2 version do we have?
             dist = pkg_resources.get_distribution('Zope2')
             parsed = dist.parsed_version
+            # Starting from version >= 37.8.0 pkg_resources of setuptools
+            # does not return an iterable anymore with 'parsed_version',
+            # instead a class-object is returned. Let's re-parse that, to
+            # support setuptools > 37.8.0, while keeping backwards-compat:
+            if (not isinstance(parsed, tuple)
+                and hasattr(parsed, "base_version")):
+                parsed = parsed.base_version.split('.')
+
             major, minor = parsed[0:2]
             major = int(major)
             # We support creating instances for 2.12, 2.13 and 4.0


