Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2018-08-08T13:50:16+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.multilingual/commit/1dd5574f102389476711ec02b188af02382d9e4a

Make plone.app.controlpanel dependency optional

Files changed:
M CHANGES.rst
M src/plone/app/multilingual/browser/configure.zcml
M src/plone/app/multilingual/browser/controlpanel.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex fa02b482..631caa3a 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -10,7 +10,8 @@ Breaking changes:\n \n New features:\n \n-- *add item here*\n+- Make plone.app.controlpanel optional (no longer there in Plone 5.2).\n+  [jensens]\n \n Bug fixes:\n \ndiff --git a/src/plone/app/multilingual/browser/configure.zcml b/src/plone/app/multilingual/browser/configure.zcml\nindex cbe747a6..3cb5f8b0 100644\n--- a/src/plone/app/multilingual/browser/configure.zcml\n+++ b/src/plone/app/multilingual/browser/configure.zcml\n@@ -104,6 +104,7 @@\n \n   <!-- Notices Viewlets -->\n   <browser:viewlet\n+      zcml:condition="installed plone.app.controlpanel"\n       name="plone.app.multilingual.supported-languages-notice"\n       for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n       view="plone.app.controlpanel.interfaces.IPloneControlPanelView"\n@@ -112,6 +113,16 @@\n       template="templates/languages-notice.pt"\n       layer="..interfaces.IPloneAppMultilingualInstalled"\n       permission="cmf.ManagePortal"/>\n+  <browser:viewlet\n+      zcml:condition="not-installed plone.app.controlpanel"\n+      name="plone.app.multilingual.supported-languages-notice"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      view="Products.CMFPlone.interfaces.controlpanel.IPloneControlPanelView"\n+      manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n+      class=".viewlets.OneLanguageConfiguredNoticeViewlet"\n+      template="templates/languages-notice.pt"\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      permission="cmf.ManagePortal"/>\n \n   <!-- It comes from a translation DX -->\n   <browser:viewlet\ndiff --git a/src/plone/app/multilingual/browser/controlpanel.py b/src/plone/app/multilingual/browser/controlpanel.py\nindex c2acb172..612e8fd1 100644\n--- a/src/plone/app/multilingual/browser/controlpanel.py\n+++ b/src/plone/app/multilingual/browser/controlpanel.py\n@@ -6,7 +6,7 @@\n from plone.app.registry.browser import controlpanel\n from plone.app.uuid.utils import uuidToObject\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.controlpanel.browser.language import LanguageControlPanelForm\n+from Products.CMFPlone.controlpanel.browser.language import LanguageControlPanelForm  # noqa\n from Products.CMFPlone.interfaces import ILanguage\n from Products.Five import BrowserView\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2018-08-09T18:17:57+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.multilingual/commit/030d409028afa1490ffc8b9d1ed024cdc2df5d00

Merge pull request #321 from plone/jensens/make-p.a.controlpanel-optional

Make plone.app.controlpanel dependency optional

Files changed:
M CHANGES.rst
M src/plone/app/multilingual/browser/configure.zcml
M src/plone/app/multilingual/browser/controlpanel.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex fa02b482..631caa3a 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -10,7 +10,8 @@ Breaking changes:\n \n New features:\n \n-- *add item here*\n+- Make plone.app.controlpanel optional (no longer there in Plone 5.2).\n+  [jensens]\n \n Bug fixes:\n \ndiff --git a/src/plone/app/multilingual/browser/configure.zcml b/src/plone/app/multilingual/browser/configure.zcml\nindex cbe747a6..3cb5f8b0 100644\n--- a/src/plone/app/multilingual/browser/configure.zcml\n+++ b/src/plone/app/multilingual/browser/configure.zcml\n@@ -104,6 +104,7 @@\n \n   <!-- Notices Viewlets -->\n   <browser:viewlet\n+      zcml:condition="installed plone.app.controlpanel"\n       name="plone.app.multilingual.supported-languages-notice"\n       for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n       view="plone.app.controlpanel.interfaces.IPloneControlPanelView"\n@@ -112,6 +113,16 @@\n       template="templates/languages-notice.pt"\n       layer="..interfaces.IPloneAppMultilingualInstalled"\n       permission="cmf.ManagePortal"/>\n+  <browser:viewlet\n+      zcml:condition="not-installed plone.app.controlpanel"\n+      name="plone.app.multilingual.supported-languages-notice"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      view="Products.CMFPlone.interfaces.controlpanel.IPloneControlPanelView"\n+      manager="plone.app.layout.viewlets.interfaces.IAboveContent"\n+      class=".viewlets.OneLanguageConfiguredNoticeViewlet"\n+      template="templates/languages-notice.pt"\n+      layer="..interfaces.IPloneAppMultilingualInstalled"\n+      permission="cmf.ManagePortal"/>\n \n   <!-- It comes from a translation DX -->\n   <browser:viewlet\ndiff --git a/src/plone/app/multilingual/browser/controlpanel.py b/src/plone/app/multilingual/browser/controlpanel.py\nindex c2acb172..612e8fd1 100644\n--- a/src/plone/app/multilingual/browser/controlpanel.py\n+++ b/src/plone/app/multilingual/browser/controlpanel.py\n@@ -6,7 +6,7 @@\n from plone.app.registry.browser import controlpanel\n from plone.app.uuid.utils import uuidToObject\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.controlpanel.browser.language import LanguageControlPanelForm\n+from Products.CMFPlone.controlpanel.browser.language import LanguageControlPanelForm  # noqa\n from Products.CMFPlone.interfaces import ILanguage\n from Products.Five import BrowserView\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n'

