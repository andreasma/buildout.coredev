Repository: plone.app.portlets


Branch: refs/heads/4.3.x
Date: 2018-03-12T12:48:14-04:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.app.portlets/commit/6ffda200b3111185865d59a3f344782b05bfbfb6

also catch NotFound while traversing portlet add views

Files changed:
M CHANGES.rst
M plone/app/portlets/browser/editmanager.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 50817a5..1c18d31 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,10 @@ New features:
 
 Bug fixes:
 
+- Catch NotFound while trying to traverse to portlet add views
+  to check permission.
+  [davisagli]
+
 - *add item here*
 
 
diff --git a/plone/app/portlets/browser/editmanager.py b/plone/app/portlets/browser/editmanager.py
index 20a779b..92f0d72 100644
--- a/plone/app/portlets/browser/editmanager.py
+++ b/plone/app/portlets/browser/editmanager.py
@@ -24,6 +24,7 @@
 from Acquisition.interfaces import IAcquirer
 
 from AccessControl import Unauthorized
+from zExceptions import NotFound
 
 from Products.Five.browser import BrowserView
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
@@ -38,6 +39,7 @@
 
 from plone.portlets.interfaces import IPortletAssignmentSettings
 
+
 @implementer(IPortletManagerRenderer)
 class EditPortletManagerRenderer(Explicit):
     """Render a portlet manager in edit mode.
@@ -162,7 +164,7 @@ def check_permission(p):
                 addview = addview[1:]
             try:
                 self.context.restrictedTraverse(str(addview))
-            except (AttributeError, KeyError, Unauthorized,):
+            except (AttributeError, KeyError, Unauthorized, NotFound):
                 return False
             return True
 


Repository: plone.app.portlets


Branch: refs/heads/4.3.x
Date: 2018-03-12T14:34:24-04:00
Author: David Glick (davisagli) <david.glick@plone.org>
Commit: https://github.com/plone/plone.app.portlets/commit/ae125dedd8c3ac1839d12a0bbf993abfdb0112f9

Merge pull request #108 from plone/davisagli-traversal

also catch NotFound while traversing portlet add views

Files changed:
M CHANGES.rst
M plone/app/portlets/browser/editmanager.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 50817a5..1c18d31 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,6 +15,10 @@ New features:
 
 Bug fixes:
 
+- Catch NotFound while trying to traverse to portlet add views
+  to check permission.
+  [davisagli]
+
 - *add item here*
 
 
diff --git a/plone/app/portlets/browser/editmanager.py b/plone/app/portlets/browser/editmanager.py
index 20a779b..92f0d72 100644
--- a/plone/app/portlets/browser/editmanager.py
+++ b/plone/app/portlets/browser/editmanager.py
@@ -24,6 +24,7 @@
 from Acquisition.interfaces import IAcquirer
 
 from AccessControl import Unauthorized
+from zExceptions import NotFound
 
 from Products.Five.browser import BrowserView
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
@@ -38,6 +39,7 @@
 
 from plone.portlets.interfaces import IPortletAssignmentSettings
 
+
 @implementer(IPortletManagerRenderer)
 class EditPortletManagerRenderer(Explicit):
     """Render a portlet manager in edit mode.
@@ -162,7 +164,7 @@ def check_permission(p):
                 addview = addview[1:]
             try:
                 self.context.restrictedTraverse(str(addview))
-            except (AttributeError, KeyError, Unauthorized,):
+            except (AttributeError, KeyError, Unauthorized, NotFound):
                 return False
             return True
 


