Repository: Products.CMFDynamicViewFTI


Branch: refs/heads/master
Date: 2018-04-28T23:04:31+02:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/Products.CMFDynamicViewFTI/commit/4b72020b9d3643c05d890c10511f09085c6b79df

Fix adapter lookup on Python 3

Files changed:
M CHANGES.rst
M Products/CMFDynamicViewFTI/browserdefault.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 64a10cb..3d32032 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,15 +14,15 @@ New features:
 
 Bug fixes:
 
-- *add item here*
-
+- Fix adapter lookup on Python 3.
+  [ale-rt]
 
 4.1.7 (2018-03-12)
 ------------------
 
 Bug fixes:
 
-- Fix missing ClassType in Python 33
+- Fix missing ClassType in Python 3
 
 
 4.1.6 (2018-01-30)
diff --git a/Products/CMFDynamicViewFTI/browserdefault.py b/Products/CMFDynamicViewFTI/browserdefault.py
index 4a3c2ff..bc9b5f4 100644
--- a/Products/CMFDynamicViewFTI/browserdefault.py
+++ b/Products/CMFDynamicViewFTI/browserdefault.py
@@ -16,8 +16,11 @@
 from Products.CMFDynamicViewFTI.interfaces import ISelectableBrowserDefault
 from Products.CMFDynamicViewFTI.permissions import ModifyViewTemplate
 from zope.browsermenu.interfaces import IBrowserMenu
-from zope.component import getSiteManager, getUtility
-from zope.interface import Interface, implementer, providedBy
+from zope.component import getSiteManager
+from zope.component import getUtility
+from zope.interface import implementer
+from zope.interface import Interface
+from zope.interface import providedBy
 
 import six
 
@@ -201,6 +204,8 @@ def getAvailableLayouts(self):
         spec = (providedBy(self), providedBy(self.REQUEST))
         gsm = getSiteManager()
         for mid in method_ids:
+            if not isinstance(mid, six.string_types):
+                mid = mid.decode()
             factory = gsm.adapters.lookup(spec, Interface, mid)
             if factory is not None:
                 menu = getUtility(


Repository: Products.CMFDynamicViewFTI


Branch: refs/heads/master
Date: 2018-05-02T13:24:35+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFDynamicViewFTI/commit/b381f97e292ab6ebad33fe78a92ade3c6d74b652

Merge pull request #13 from plone/python3

Fix adapter lookup on Python 3

Files changed:
M CHANGES.rst
M Products/CMFDynamicViewFTI/browserdefault.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 64a10cb..3d32032 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,15 +14,15 @@ New features:
 
 Bug fixes:
 
-- *add item here*
-
+- Fix adapter lookup on Python 3.
+  [ale-rt]
 
 4.1.7 (2018-03-12)
 ------------------
 
 Bug fixes:
 
-- Fix missing ClassType in Python 33
+- Fix missing ClassType in Python 3
 
 
 4.1.6 (2018-01-30)
diff --git a/Products/CMFDynamicViewFTI/browserdefault.py b/Products/CMFDynamicViewFTI/browserdefault.py
index 4a3c2ff..bc9b5f4 100644
--- a/Products/CMFDynamicViewFTI/browserdefault.py
+++ b/Products/CMFDynamicViewFTI/browserdefault.py
@@ -16,8 +16,11 @@
 from Products.CMFDynamicViewFTI.interfaces import ISelectableBrowserDefault
 from Products.CMFDynamicViewFTI.permissions import ModifyViewTemplate
 from zope.browsermenu.interfaces import IBrowserMenu
-from zope.component import getSiteManager, getUtility
-from zope.interface import Interface, implementer, providedBy
+from zope.component import getSiteManager
+from zope.component import getUtility
+from zope.interface import implementer
+from zope.interface import Interface
+from zope.interface import providedBy
 
 import six
 
@@ -201,6 +204,8 @@ def getAvailableLayouts(self):
         spec = (providedBy(self), providedBy(self.REQUEST))
         gsm = getSiteManager()
         for mid in method_ids:
+            if not isinstance(mid, six.string_types):
+                mid = mid.decode()
             factory = gsm.adapters.lookup(spec, Interface, mid)
             if factory is not None:
                 menu = getUtility(


