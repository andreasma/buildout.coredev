Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2019-04-08T13:39:54+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.dexterity/commit/9452bfb899fdb91445b5276cb97bf500d4fc45b9

IWidgetsLayer-&gt;IPloneFormLayer and IFieldPermissionChecker from plone.app.z3cform

Files changed:
A news/268.feature
M plone/app/dexterity/factories.py
M plone/app/dexterity/permissions.py
M plone/app/dexterity/tests/test_permissions.py

b"diff --git a/news/268.feature b/news/268.feature\nnew file mode 100644\nindex 0000000..b12ea31\n--- /dev/null\n+++ b/news/268.feature\n@@ -0,0 +1,3 @@\n+``IWidgetsLayer`` is no longer needed, use ``IPloneFormLayer`` instead.\n+Import ``IFieldPermissionChecker`` from ``plone.app.z3cform`` instead of ``plone.app.widgets``.\n+[jensens]\ndiff --git a/plone/app/dexterity/factories.py b/plone/app/dexterity/factories.py\nindex ce89521..0499e07 100644\n--- a/plone/app/dexterity/factories.py\n+++ b/plone/app/dexterity/factories.py\n@@ -11,8 +11,6 @@\n from zope.container.interfaces import INameChooser\n from zope.interface import implementer\n \n-import transaction\n-\n \n upload_lock = allocate_lock()\n \ndiff --git a/plone/app/dexterity/permissions.py b/plone/app/dexterity/permissions.py\nindex 4e3355a..f10d334 100644\n--- a/plone/app/dexterity/permissions.py\n+++ b/plone/app/dexterity/permissions.py\n@@ -1,7 +1,7 @@\n # -*- coding: utf-8 -*-\n from AccessControl import getSecurityManager\n-from plone.app.widgets.interfaces import IFieldPermissionChecker\n-from plone.app.widgets.interfaces import IWidgetsLayer\n+from plone.app.z3cform.interfaces import IFieldPermissionChecker\n+from plone.app.z3cform.interfaces import IPloneFormLayer\n from plone.autoform.interfaces import WIDGETS_KEY\n from plone.autoform.interfaces import WRITE_PERMISSIONS_KEY\n from plone.autoform.utils import resolveDottedName\n@@ -21,7 +21,7 @@\n import six\n \n \n-@implementer(IWidgetsLayer)\n+@implementer(IPloneFormLayer)\n class MockRequest(TestRequest):\n     pass\n \ndiff --git a/plone/app/dexterity/tests/test_permissions.py b/plone/app/dexterity/tests/test_permissions.py\nindex 355fc1b..62e6545 100644\n--- a/plone/app/dexterity/tests/test_permissions.py\n+++ b/plone/app/dexterity/tests/test_permissions.py\n@@ -4,7 +4,7 @@\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n-from plone.app.widgets.interfaces import IWidgetsLayer\n+from plone.app.z3cform.interfaces import IPloneFormLayer\n from plone.app.widgets.testing import PLONEAPPWIDGETS_DX_INTEGRATION_TESTING\n from plone.autoform.interfaces import WIDGETS_KEY\n from plone.autoform.interfaces import WRITE_PERMISSIONS_KEY\n@@ -52,6 +52,7 @@ class IMockSchema(Interface):\n     custom_widget_field = schema.TextLine()\n     adapted_widget_field = schema.TextLine()\n \n+\n IMockSchema.setTaggedValue(WRITE_PERMISSIONS_KEY, {\n     'allowed_field': u'zope2.View',\n     'disallowed_field': u'zope2.ViewManagementScreens',\n@@ -66,14 +67,14 @@ class IMockSchema(Interface):\n def _enable_custom_widget(field):\n     provideAdapter(\n         _custom_field_widget,\n-        adapts=(getSpecification(field), IWidgetsLayer),\n+        adapts=(getSpecification(field), IPloneFormLayer),\n         provides=IFieldWidget\n     )\n \n \n def _disable_custom_widget(field):\n     base.unregisterAdapter(\n-        required=(getSpecification(field), IWidgetsLayer, ),\n+        required=(getSpecification(field), IPloneFormLayer, ),\n         provided=IFieldWidget,\n     )\n \n"

Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2019-04-09T10:27:22+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.dexterity/commit/acb7c6a1c6b534010df2540e0262871a46190ff7

Merge pull request #286 from plone/jensens/fixPloneFormLayer

reflect moves from plone.app.widgets to plone.app.z3cform

Files changed:
A news/268.feature
M plone/app/dexterity/factories.py
M plone/app/dexterity/permissions.py
M plone/app/dexterity/tests/test_permissions.py

b"diff --git a/news/268.feature b/news/268.feature\nnew file mode 100644\nindex 0000000..b12ea31\n--- /dev/null\n+++ b/news/268.feature\n@@ -0,0 +1,3 @@\n+``IWidgetsLayer`` is no longer needed, use ``IPloneFormLayer`` instead.\n+Import ``IFieldPermissionChecker`` from ``plone.app.z3cform`` instead of ``plone.app.widgets``.\n+[jensens]\ndiff --git a/plone/app/dexterity/factories.py b/plone/app/dexterity/factories.py\nindex ce89521..0499e07 100644\n--- a/plone/app/dexterity/factories.py\n+++ b/plone/app/dexterity/factories.py\n@@ -11,8 +11,6 @@\n from zope.container.interfaces import INameChooser\n from zope.interface import implementer\n \n-import transaction\n-\n \n upload_lock = allocate_lock()\n \ndiff --git a/plone/app/dexterity/permissions.py b/plone/app/dexterity/permissions.py\nindex 4e3355a..f10d334 100644\n--- a/plone/app/dexterity/permissions.py\n+++ b/plone/app/dexterity/permissions.py\n@@ -1,7 +1,7 @@\n # -*- coding: utf-8 -*-\n from AccessControl import getSecurityManager\n-from plone.app.widgets.interfaces import IFieldPermissionChecker\n-from plone.app.widgets.interfaces import IWidgetsLayer\n+from plone.app.z3cform.interfaces import IFieldPermissionChecker\n+from plone.app.z3cform.interfaces import IPloneFormLayer\n from plone.autoform.interfaces import WIDGETS_KEY\n from plone.autoform.interfaces import WRITE_PERMISSIONS_KEY\n from plone.autoform.utils import resolveDottedName\n@@ -21,7 +21,7 @@\n import six\n \n \n-@implementer(IWidgetsLayer)\n+@implementer(IPloneFormLayer)\n class MockRequest(TestRequest):\n     pass\n \ndiff --git a/plone/app/dexterity/tests/test_permissions.py b/plone/app/dexterity/tests/test_permissions.py\nindex 355fc1b..62e6545 100644\n--- a/plone/app/dexterity/tests/test_permissions.py\n+++ b/plone/app/dexterity/tests/test_permissions.py\n@@ -4,7 +4,7 @@\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import TEST_USER_NAME\n-from plone.app.widgets.interfaces import IWidgetsLayer\n+from plone.app.z3cform.interfaces import IPloneFormLayer\n from plone.app.widgets.testing import PLONEAPPWIDGETS_DX_INTEGRATION_TESTING\n from plone.autoform.interfaces import WIDGETS_KEY\n from plone.autoform.interfaces import WRITE_PERMISSIONS_KEY\n@@ -52,6 +52,7 @@ class IMockSchema(Interface):\n     custom_widget_field = schema.TextLine()\n     adapted_widget_field = schema.TextLine()\n \n+\n IMockSchema.setTaggedValue(WRITE_PERMISSIONS_KEY, {\n     'allowed_field': u'zope2.View',\n     'disallowed_field': u'zope2.ViewManagementScreens',\n@@ -66,14 +67,14 @@ class IMockSchema(Interface):\n def _enable_custom_widget(field):\n     provideAdapter(\n         _custom_field_widget,\n-        adapts=(getSpecification(field), IWidgetsLayer),\n+        adapts=(getSpecification(field), IPloneFormLayer),\n         provides=IFieldWidget\n     )\n \n \n def _disable_custom_widget(field):\n     base.unregisterAdapter(\n-        required=(getSpecification(field), IWidgetsLayer, ),\n+        required=(getSpecification(field), IPloneFormLayer, ),\n         provided=IFieldWidget,\n     )\n \n"

