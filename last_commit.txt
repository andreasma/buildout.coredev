Repository: plone.testing


Branch: refs/heads/master
Date: 2019-12-02T17:01:44+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.testing/commit/fd4da39dcaef9736012d028d12d7be1158e587e8

Fix issue with test-setup with ZServer 4.0.2

Files changed:
A news/69.bugfix
M src/plone/testing/zserver.py

b'diff --git a/news/69.bugfix b/news/69.bugfix\nnew file mode 100644\nindex 0000000..b0f8e29\n--- /dev/null\n+++ b/news/69.bugfix\n@@ -0,0 +1,2 @@\n+Fix issue with test-setup when using ZServer 4.0.2.\n+[pbauer]\n\\ No newline at end of file\ndiff --git a/src/plone/testing/zserver.py b/src/plone/testing/zserver.py\nindex e719ddb..a9879e2 100644\n--- a/src/plone/testing/zserver.py\n+++ b/src/plone/testing/zserver.py\n@@ -110,17 +110,16 @@ def setUpThreads(self):\n \n         # We can\'t use setNumberOfThreads() because that function self-\n         # destructs, literally, when called.\n-\n-        import ZServer.PubCore\n-        self._zserverThreads = ZServer.PubCore._n\n-        ZServer.PubCore._n = self.threads\n+        from ZServer.Zope2.Startup import config\n+        self._zserverThreads = config.ZSERVER_THREADS\n+        config.ZSERVER_THREADS = self.threads\n \n     def tearDownThreads(self):\n         """Reset the ZServer thread count.\n         """\n \n-        import ZServer.PubCore\n-        ZServer.PubCore._n = self._zserverThreads\n+        from ZServer.Zope2.Startup import config\n+        config.ZSERVER_THREADS = self._zserverThreads\n         del self._zserverThreads\n \n     def setUpApp(self):\n'

Repository: plone.testing


Branch: refs/heads/master
Date: 2019-12-02T19:10:17+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.testing/commit/481b6b8cdd9dfbc6d1616a0bda054c85f73b4801

Merge pull request #70 from plone/fix_setUpThreads

Fix issue with test-setup with ZServer 4.0.2

Files changed:
A news/69.bugfix
M src/plone/testing/zserver.py

b'diff --git a/news/69.bugfix b/news/69.bugfix\nnew file mode 100644\nindex 0000000..b0f8e29\n--- /dev/null\n+++ b/news/69.bugfix\n@@ -0,0 +1,2 @@\n+Fix issue with test-setup when using ZServer 4.0.2.\n+[pbauer]\n\\ No newline at end of file\ndiff --git a/src/plone/testing/zserver.py b/src/plone/testing/zserver.py\nindex e719ddb..a9879e2 100644\n--- a/src/plone/testing/zserver.py\n+++ b/src/plone/testing/zserver.py\n@@ -110,17 +110,16 @@ def setUpThreads(self):\n \n         # We can\'t use setNumberOfThreads() because that function self-\n         # destructs, literally, when called.\n-\n-        import ZServer.PubCore\n-        self._zserverThreads = ZServer.PubCore._n\n-        ZServer.PubCore._n = self.threads\n+        from ZServer.Zope2.Startup import config\n+        self._zserverThreads = config.ZSERVER_THREADS\n+        config.ZSERVER_THREADS = self.threads\n \n     def tearDownThreads(self):\n         """Reset the ZServer thread count.\n         """\n \n-        import ZServer.PubCore\n-        ZServer.PubCore._n = self._zserverThreads\n+        from ZServer.Zope2.Startup import config\n+        config.ZSERVER_THREADS = self._zserverThreads\n         del self._zserverThreads\n \n     def setUpApp(self):\n'

