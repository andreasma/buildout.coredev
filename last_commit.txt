Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2019-11-01T01:11:56+01:00
Author: mauro (mamico) <mauro.amico@unibo.it>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/64f11662d05f652c54d135c9e78bb97320717896

string format for script initialization

Files changed:
M src/plone/recipe/zope2instance/recipe.py
M src/plone/recipe/zope2instance/tests/zope2instance.txt

b'diff --git a/src/plone/recipe/zope2instance/recipe.py b/src/plone/recipe/zope2instance/recipe.py\nindex 6619dd3..a7e8739 100644\n--- a/src/plone/recipe/zope2instance/recipe.py\n+++ b/src/plone/recipe/zope2instance/recipe.py\n@@ -85,9 +85,6 @@ def __init__(self, buildout, name, options):\n         )\n         options[\'bin-directory\'] = buildout[\'buildout\'][\'bin-directory\']\n \n-        if \'initialization\' not in options:\n-            options[\'initialization\'] = \'\'\n-\n         if \'scripts\' in options:\n             if options[\'scripts\'] == \'\':\n                 options[\'scripts\'] = \'\'  # suppress script generation.\n@@ -104,6 +101,10 @@ def __init__(self, buildout, name, options):\n         else:\n             self._relative_paths = \'\'\n \n+        if \'initialization\' not in options:\n+            options[\'initialization\'] = \'\'\n+        options[\'initialization\'] = options[\'initialization\'] % options\n+\n         self._include_site_packages = options.get(\n             \'include-site-packages\',\n             buildout[\'buildout\'].get(\'include-site-packages\', \'false\')\n@@ -888,14 +889,13 @@ def _install_scripts(self, dest, working_set, reqs=(), interpreter=None,\n                 script_arguments=script_arguments,\n             )\n         else:\n-            initialization = options[\'initialization\'] % options\n             return zc.buildout.easy_install.scripts(\n                 dest=dest,\n                 reqs=reqs,\n                 working_set=working_set,\n                 executable=options[\'executable\'],\n                 extra_paths=extra_paths,\n-                initialization=initialization,\n+                initialization=options[\'initialization\'],\n                 arguments=script_arguments,\n                 interpreter=interpreter,\n                 relative_paths=self._relative_paths,)\ndiff --git a/src/plone/recipe/zope2instance/tests/zope2instance.txt b/src/plone/recipe/zope2instance/tests/zope2instance.txt\nindex 3cbd660..97ae20d 100644\n--- a/src/plone/recipe/zope2instance/tests/zope2instance.txt\n+++ b/src/plone/recipe/zope2instance/tests/zope2instance.txt\n@@ -1704,10 +1704,10 @@ code to the initialization process.\n     ...\n     ... [instance]\n     ... recipe = plone.recipe.zope2instance\n-    ... eggs =\n+    ... eggs = waitress\n     ... user = me:me\n     ... initialization =\n-    ...     print(\'Initialization complete!\')\n+    ...     print(\'Initialization complete! Hello %%(user)s!\')\n     ... \'\'\' % options)\n \n Let\'s run it::\n@@ -1722,7 +1722,11 @@ We should see the given initialization commands included in the instance\n script::\n \n     >>> instance = open(os.path.join(sample_buildout, \'bin\', \'instance\')).read()\n-    >>> "print(\'Initialization complete!\')" in instance\n+    >>> "print(\'Initialization complete! Hello me:me!\')" in instance\n+    True\n+\n+    >>> waitress = open(os.path.join(sample_buildout, \'bin\', \'waitress-serve\')).read()\n+    >>> "print(\'Initialization complete! Hello me:me!\')" in waitress\n     True\n \n \n'

Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2019-11-01T01:21:48+01:00
Author: mauro (mamico) <mauro.amico@unibo.it>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/45e8157ea821d321f99ee46bb39550e9aee469a7

changelog

Files changed:
A news/130.bugfix

b'diff --git a/news/130.bugfix b/news/130.bugfix\nnew file mode 100644\nindex 0000000..abb10b1\n--- /dev/null\n+++ b/news/130.bugfix\n@@ -0,0 +1,2 @@\n+for initialization option, string format works for instance console script not for the others\n+[mamico]\n'

Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2019-11-01T10:58:31+01:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/0fa1deb1c9b426b7dbd87471eb330400c291d699

Merge pull request #130 from mamico/master

string format for initialization option

Files changed:
A news/130.bugfix
M src/plone/recipe/zope2instance/recipe.py
M src/plone/recipe/zope2instance/tests/zope2instance.txt

b'diff --git a/news/130.bugfix b/news/130.bugfix\nnew file mode 100644\nindex 0000000..abb10b1\n--- /dev/null\n+++ b/news/130.bugfix\n@@ -0,0 +1,2 @@\n+for initialization option, string format works for instance console script not for the others\n+[mamico]\ndiff --git a/src/plone/recipe/zope2instance/recipe.py b/src/plone/recipe/zope2instance/recipe.py\nindex 6619dd3..a7e8739 100644\n--- a/src/plone/recipe/zope2instance/recipe.py\n+++ b/src/plone/recipe/zope2instance/recipe.py\n@@ -85,9 +85,6 @@ def __init__(self, buildout, name, options):\n         )\n         options[\'bin-directory\'] = buildout[\'buildout\'][\'bin-directory\']\n \n-        if \'initialization\' not in options:\n-            options[\'initialization\'] = \'\'\n-\n         if \'scripts\' in options:\n             if options[\'scripts\'] == \'\':\n                 options[\'scripts\'] = \'\'  # suppress script generation.\n@@ -104,6 +101,10 @@ def __init__(self, buildout, name, options):\n         else:\n             self._relative_paths = \'\'\n \n+        if \'initialization\' not in options:\n+            options[\'initialization\'] = \'\'\n+        options[\'initialization\'] = options[\'initialization\'] % options\n+\n         self._include_site_packages = options.get(\n             \'include-site-packages\',\n             buildout[\'buildout\'].get(\'include-site-packages\', \'false\')\n@@ -888,14 +889,13 @@ def _install_scripts(self, dest, working_set, reqs=(), interpreter=None,\n                 script_arguments=script_arguments,\n             )\n         else:\n-            initialization = options[\'initialization\'] % options\n             return zc.buildout.easy_install.scripts(\n                 dest=dest,\n                 reqs=reqs,\n                 working_set=working_set,\n                 executable=options[\'executable\'],\n                 extra_paths=extra_paths,\n-                initialization=initialization,\n+                initialization=options[\'initialization\'],\n                 arguments=script_arguments,\n                 interpreter=interpreter,\n                 relative_paths=self._relative_paths,)\ndiff --git a/src/plone/recipe/zope2instance/tests/zope2instance.txt b/src/plone/recipe/zope2instance/tests/zope2instance.txt\nindex 3cbd660..97ae20d 100644\n--- a/src/plone/recipe/zope2instance/tests/zope2instance.txt\n+++ b/src/plone/recipe/zope2instance/tests/zope2instance.txt\n@@ -1704,10 +1704,10 @@ code to the initialization process.\n     ...\n     ... [instance]\n     ... recipe = plone.recipe.zope2instance\n-    ... eggs =\n+    ... eggs = waitress\n     ... user = me:me\n     ... initialization =\n-    ...     print(\'Initialization complete!\')\n+    ...     print(\'Initialization complete! Hello %%(user)s!\')\n     ... \'\'\' % options)\n \n Let\'s run it::\n@@ -1722,7 +1722,11 @@ We should see the given initialization commands included in the instance\n script::\n \n     >>> instance = open(os.path.join(sample_buildout, \'bin\', \'instance\')).read()\n-    >>> "print(\'Initialization complete!\')" in instance\n+    >>> "print(\'Initialization complete! Hello me:me!\')" in instance\n+    True\n+\n+    >>> waitress = open(os.path.join(sample_buildout, \'bin\', \'waitress-serve\')).read()\n+    >>> "print(\'Initialization complete! Hello me:me!\')" in waitress\n     True\n \n \n'

