Repository: plone.folder


Branch: refs/heads/master
Date: 2018-03-16T09:42:19+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.folder/commit/8d1a4913685b96cd4ad6ac5ce442f5d65120302d

make ZServer optional

Files changed:
M src/plone/folder/ordered.py
M src/plone/folder/tests/test_webdav.py

diff --git a/src/plone/folder/ordered.py b/src/plone/folder/ordered.py
index 9c45488..00d1046 100644
--- a/src/plone/folder/ordered.py
+++ b/src/plone/folder/ordered.py
@@ -11,12 +11,22 @@
 from Products.CMFCore.permissions import ModifyPortalContent
 from Products.CMFCore.PortalFolder import PortalFolderBase
 from Products.ZCatalog.Lazy import LazyMap
-from webdav.NullResource import NullResource
 from zope.annotation.interfaces import IAttributeAnnotatable
 from zope.component import getAdapter
 from zope.component import queryAdapter
 from zope.interface import implementer
 
+import pkg_resources
+
+HAS_ZSERVER = True
+try:
+    dist = pkg_resources.get_distribution('ZServer')
+except pkg_resources.DistributionNotFound:
+    HAS_ZSERVER = False
+
+if HAS_ZSERVER:
+    from webdav.NullResource import NullResource
+
 
 @implementer(IOrderedContainer, IOrderableFolder, IAttributeAnnotatable)
 class OrderedBTreeFolderBase(BTreeFolder2Base):
@@ -220,8 +230,8 @@ def __getitem__(self, key):
         if hasattr(self, 'REQUEST'):
             request = self.REQUEST
             method = request.get('REQUEST_METHOD', 'GET')
-            if (getattr(request, 'maybe_webdav_client', False) and
-               method not in ('GET', 'POST')):
+            if (HAS_ZSERVER and getattr(request, 'maybe_webdav_client', False)
+               and method not in ('GET', 'POST')):
                 return NullResource(self, key, request).__of__(self)
         raise KeyError(key)
 
diff --git a/src/plone/folder/tests/test_webdav.py b/src/plone/folder/tests/test_webdav.py
index e93e1c0..b0ec249 100644
--- a/src/plone/folder/tests/test_webdav.py
+++ b/src/plone/folder/tests/test_webdav.py
@@ -3,11 +3,20 @@
 from plone.folder.ordered import CMFOrderedBTreeFolderBase
 from plone.folder.testing import PLONEFOLDER_INTEGRATION_TESTING
 from plone.folder.tests.utils import DummyObject
-from webdav.NullResource import NullResource
 from zope.publisher.browser import TestRequest
 
+import pkg_resources
 import unittest
 
+HAS_ZSERVER = True
+try:
+    dist = pkg_resources.get_distribution('ZServer')
+except pkg_resources.DistributionNotFound:
+    HAS_ZSERVER = False
+
+if HAS_ZSERVER:
+    from webdav.NullResource import NullResource
+
 
 class TestRequestContainer(Explicit):
 
@@ -36,6 +45,7 @@ def test_getitem_not_dav_request(self):
         except KeyError:
             pass
 
+    @unittest.skipUnless(HAS_ZSERVER)
     def test_getitem_dav_request(self):
         root = TestRequestContainer()
         folder = CMFOrderedBTreeFolderBase("f1").__of__(root)


Repository: plone.folder


Branch: refs/heads/master
Date: 2018-05-05T15:14:39+02:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.folder/commit/db15991ba9b3b9b7fb1d4d04cf018e453694ef54

Add comment to skipUnless

Files changed:
M src/plone/folder/tests/test_webdav.py

diff --git a/src/plone/folder/tests/test_webdav.py b/src/plone/folder/tests/test_webdav.py
index b0ec249..42d9f87 100644
--- a/src/plone/folder/tests/test_webdav.py
+++ b/src/plone/folder/tests/test_webdav.py
@@ -8,6 +8,7 @@
 import pkg_resources
 import unittest
 
+
 HAS_ZSERVER = True
 try:
     dist = pkg_resources.get_distribution('ZServer')
@@ -45,7 +46,7 @@ def test_getitem_not_dav_request(self):
         except KeyError:
             pass
 
-    @unittest.skipUnless(HAS_ZSERVER)
+    @unittest.skipUnless(HAS_ZSERVER, 'ZServer is optional')
     def test_getitem_dav_request(self):
         root = TestRequestContainer()
         folder = CMFOrderedBTreeFolderBase("f1").__of__(root)


Repository: plone.folder


Branch: refs/heads/master
Date: 2018-05-05T15:16:30+02:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.folder/commit/a151332a6e302c530eb0868f5d9998d926c74187

Added a changelog line

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index ba3a1fb..ff5c973 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,7 +15,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- More Python 2 / 3 compatibility
+  [pbauer, ale-rt]
 
 
 1.0.10 (2018-01-30)


Repository: plone.folder


Branch: refs/heads/master
Date: 2018-05-05T18:01:23+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.folder/commit/bc91595a291d5a93a191927da0531333f71d2b3e

Merge pull request #7 from plone/zserver

Zserver

Files changed:
M CHANGES.rst
M src/plone/folder/ordered.py
M src/plone/folder/tests/test_webdav.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4b5a6a1..8cd08ef 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -15,7 +15,8 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- More Python 2 / 3 compatibility
+  [pbauer, ale-rt]
 
 
 1.0.11 (2018-04-08)
diff --git a/src/plone/folder/ordered.py b/src/plone/folder/ordered.py
index 9c45488..00d1046 100644
--- a/src/plone/folder/ordered.py
+++ b/src/plone/folder/ordered.py
@@ -11,12 +11,22 @@
 from Products.CMFCore.permissions import ModifyPortalContent
 from Products.CMFCore.PortalFolder import PortalFolderBase
 from Products.ZCatalog.Lazy import LazyMap
-from webdav.NullResource import NullResource
 from zope.annotation.interfaces import IAttributeAnnotatable
 from zope.component import getAdapter
 from zope.component import queryAdapter
 from zope.interface import implementer
 
+import pkg_resources
+
+HAS_ZSERVER = True
+try:
+    dist = pkg_resources.get_distribution('ZServer')
+except pkg_resources.DistributionNotFound:
+    HAS_ZSERVER = False
+
+if HAS_ZSERVER:
+    from webdav.NullResource import NullResource
+
 
 @implementer(IOrderedContainer, IOrderableFolder, IAttributeAnnotatable)
 class OrderedBTreeFolderBase(BTreeFolder2Base):
@@ -220,8 +230,8 @@ def __getitem__(self, key):
         if hasattr(self, 'REQUEST'):
             request = self.REQUEST
             method = request.get('REQUEST_METHOD', 'GET')
-            if (getattr(request, 'maybe_webdav_client', False) and
-               method not in ('GET', 'POST')):
+            if (HAS_ZSERVER and getattr(request, 'maybe_webdav_client', False)
+               and method not in ('GET', 'POST')):
                 return NullResource(self, key, request).__of__(self)
         raise KeyError(key)
 
diff --git a/src/plone/folder/tests/test_webdav.py b/src/plone/folder/tests/test_webdav.py
index d764b71..593eda9 100644
--- a/src/plone/folder/tests/test_webdav.py
+++ b/src/plone/folder/tests/test_webdav.py
@@ -3,12 +3,22 @@
 from plone.folder.ordered import CMFOrderedBTreeFolderBase
 from plone.folder.testing import PLONEFOLDER_INTEGRATION_TESTING
 from plone.folder.tests.utils import DummyObject
-from webdav.NullResource import NullResource
 from zope.publisher.browser import TestRequest
 
+import pkg_resources
 import unittest
 
 
+HAS_ZSERVER = True
+try:
+    dist = pkg_resources.get_distribution('ZServer')
+except pkg_resources.DistributionNotFound:
+    HAS_ZSERVER = False
+
+if HAS_ZSERVER:
+    from webdav.NullResource import NullResource
+
+
 class TestRequestContainer(Explicit):
 
     REQUEST = TestRequest()
@@ -36,6 +46,7 @@ def test_getitem_not_dav_request(self):
         except KeyError:
             pass
 
+    @unittest.skipUnless(HAS_ZSERVER, 'ZServer is optional')
     def test_getitem_dav_request(self):
         root = TestRequestContainer()
         folder = CMFOrderedBTreeFolderBase("f1").__of__(root)


