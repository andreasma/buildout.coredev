Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2019-05-02T16:33:28+02:00
Author: Markus Hilbert (iham) <markus.hilbert@iham.at>
Commit: https://github.com/plone/plone.app.iterate/commit/d3a31d624d46cd51b4477255d7484f938492b0f3

Made removing of versioning behaviors less strict (named vs dotted).

Files changed:
A news/71.bugfix
M plone/app/iterate/testing.py

b'diff --git a/news/71.bugfix b/news/71.bugfix\nnew file mode 100644\nindex 0000000..7684b6f\n--- /dev/null\n+++ b/news/71.bugfix\n@@ -0,0 +1 @@\n+Made removing of versioning behaviors less strict (named vs dotted). [iham]\n\\ No newline at end of file\ndiff --git a/plone/app/iterate/testing.py b/plone/app/iterate/testing.py\nindex d645ced..6cb7c8b 100644\n--- a/plone/app/iterate/testing.py\n+++ b/plone/app/iterate/testing.py\n@@ -143,13 +143,25 @@ def setUpPloneSite(self, portal):\n         """Setup Plone Site with Addons."""\n         super(DexPloneAppIterateLayer, self).setUpPloneSite(portal)\n         applyProfile(portal, \'plone.app.iterate:default\')\n+        # with named AND dotted behaviors we need to take care of both\n+        versioning_behavior = set(\n+            [\n+                \'plone.app.versioningbehavior.behaviors.IVersionable\',\n+                \'plone.versioning\',\n+            ],\n+        )\n \n         # Disable automatic versioning of core content types\n         for name in (\'Document\', \'Event\', \'Link\', \'News Item\'):\n             fti = portal.portal_types[name]\n-            behaviors = list(fti.behaviors)\n-            behaviors.remove(\'plone.app.versioningbehavior.behaviors.IVersionable\')\n-            fti.behaviors = tuple(behaviors)\n+            # write back the behaviors without the versioning behaviors\n+            # using a Set to keep it simple\n+            # a = set((1,2,3))\n+            # b = set([2,4])\n+            # res = tuple(a.difference(b)) >> (1,3)\n+            fti.behaviors = tuple(\n+                set(fti.behaviors).difference(versioning_behavior),\n+            )\n \n \n PLONEAPPITERATEDEX_FIXTURE = DexPloneAppIterateLayer()\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2019-05-02T21:02:33+02:00
Author: Markus Hilbert (iham) <markus.hilbert@iham.at>
Commit: https://github.com/plone/plone.app.iterate/commit/8ebb904b9bdcd451dd2f400827863b2c83e8417f

Merge pull request #72 from plone/issue_71

Made removing of versioning behaviors less strict (named vs dotted).

Files changed:
A news/71.bugfix
M plone/app/iterate/testing.py

b'diff --git a/news/71.bugfix b/news/71.bugfix\nnew file mode 100644\nindex 0000000..7684b6f\n--- /dev/null\n+++ b/news/71.bugfix\n@@ -0,0 +1 @@\n+Made removing of versioning behaviors less strict (named vs dotted). [iham]\n\\ No newline at end of file\ndiff --git a/plone/app/iterate/testing.py b/plone/app/iterate/testing.py\nindex d645ced..6cb7c8b 100644\n--- a/plone/app/iterate/testing.py\n+++ b/plone/app/iterate/testing.py\n@@ -143,13 +143,25 @@ def setUpPloneSite(self, portal):\n         """Setup Plone Site with Addons."""\n         super(DexPloneAppIterateLayer, self).setUpPloneSite(portal)\n         applyProfile(portal, \'plone.app.iterate:default\')\n+        # with named AND dotted behaviors we need to take care of both\n+        versioning_behavior = set(\n+            [\n+                \'plone.app.versioningbehavior.behaviors.IVersionable\',\n+                \'plone.versioning\',\n+            ],\n+        )\n \n         # Disable automatic versioning of core content types\n         for name in (\'Document\', \'Event\', \'Link\', \'News Item\'):\n             fti = portal.portal_types[name]\n-            behaviors = list(fti.behaviors)\n-            behaviors.remove(\'plone.app.versioningbehavior.behaviors.IVersionable\')\n-            fti.behaviors = tuple(behaviors)\n+            # write back the behaviors without the versioning behaviors\n+            # using a Set to keep it simple\n+            # a = set((1,2,3))\n+            # b = set([2,4])\n+            # res = tuple(a.difference(b)) >> (1,3)\n+            fti.behaviors = tuple(\n+                set(fti.behaviors).difference(versioning_behavior),\n+            )\n \n \n PLONEAPPITERATEDEX_FIXTURE = DexPloneAppIterateLayer()\n'

