Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2019-10-27T11:54:59+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/fa31f9c99b2dbfbd7a5f61e9b843a37d0190bae9

Add ``upgrade_static_resources`` util for applying and pending upgrades of plone.staticresources.

Files changed:
A news/218.bugfix
M plone/app/upgrade/utils.py
M plone/app/upgrade/v52/configure.zcml
M plone/app/upgrade/v52/profiles/to_521/registry.xml

b'diff --git a/news/218.bugfix b/news/218.bugfix\nnew file mode 100644\nindex 00000000..63d956a7\n--- /dev/null\n+++ b/news/218.bugfix\n@@ -0,0 +1,2 @@\n+Add ``upgrade_static_resources`` util for applying and pending upgrades of plone.staticresources.\n+[thet]\ndiff --git a/plone/app/upgrade/utils.py b/plone/app/upgrade/utils.py\nindex bb17fdba..922410c3 100644\n--- a/plone/app/upgrade/utils.py\n+++ b/plone/app/upgrade/utils.py\n@@ -39,6 +39,11 @@ def null_upgrade_step(tool):\n     pass\n \n \n+def upgrade_static_resources(tool):\n+    """ Upgrades all pending plone.staticresources upgrade steps """\n+    tool.upgradeProfile(\'plone.staticresources:default\')\n+\n+\n def safeEditProperty(obj, key, value, data_type=\'string\'):\n     """ An add or edit function, surprisingly useful :) """\n     if obj.hasProperty(key):\ndiff --git a/plone/app/upgrade/v52/configure.zcml b/plone/app/upgrade/v52/configure.zcml\nindex ce754111..53eb9742 100644\n--- a/plone/app/upgrade/v52/configure.zcml\n+++ b/plone/app/upgrade/v52/configure.zcml\n@@ -135,6 +135,11 @@\n             description=""\n             handler=".final.to521"\n             />\n+        <gs:upgradeStep\n+            title="Upgrade static resources"\n+            description=""\n+            handler="..utils.upgrade_static_resources"\n+            />\n \n     </gs:upgradeSteps>\n \ndiff --git a/plone/app/upgrade/v52/profiles/to_521/registry.xml b/plone/app/upgrade/v52/profiles/to_521/registry.xml\nindex 1156921b..009bfefd 100644\n--- a/plone/app/upgrade/v52/profiles/to_521/registry.xml\n+++ b/plone/app/upgrade/v52/profiles/to_521/registry.xml\n@@ -5,4 +5,4 @@\n       <element>Collection</element>\n     </value>\n   </records>\n-</registry>\n\\ No newline at end of file\n+</registry>\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2019-10-28T12:52:54+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/46948c947ee859facf4dd829816ef0bae1045be6

Merge pull request #218 from plone/thet-2969

Add ``upgrade_static_resources`` util for applying and pending upgrades of plone.staticresources.

Files changed:
A news/218.bugfix
M plone/app/upgrade/utils.py
M plone/app/upgrade/v52/configure.zcml
M plone/app/upgrade/v52/profiles/to_521/registry.xml

b'diff --git a/news/218.bugfix b/news/218.bugfix\nnew file mode 100644\nindex 00000000..63d956a7\n--- /dev/null\n+++ b/news/218.bugfix\n@@ -0,0 +1,2 @@\n+Add ``upgrade_static_resources`` util for applying and pending upgrades of plone.staticresources.\n+[thet]\ndiff --git a/plone/app/upgrade/utils.py b/plone/app/upgrade/utils.py\nindex bb17fdba..922410c3 100644\n--- a/plone/app/upgrade/utils.py\n+++ b/plone/app/upgrade/utils.py\n@@ -39,6 +39,11 @@ def null_upgrade_step(tool):\n     pass\n \n \n+def upgrade_static_resources(tool):\n+    """ Upgrades all pending plone.staticresources upgrade steps """\n+    tool.upgradeProfile(\'plone.staticresources:default\')\n+\n+\n def safeEditProperty(obj, key, value, data_type=\'string\'):\n     """ An add or edit function, surprisingly useful :) """\n     if obj.hasProperty(key):\ndiff --git a/plone/app/upgrade/v52/configure.zcml b/plone/app/upgrade/v52/configure.zcml\nindex ce754111..53eb9742 100644\n--- a/plone/app/upgrade/v52/configure.zcml\n+++ b/plone/app/upgrade/v52/configure.zcml\n@@ -135,6 +135,11 @@\n             description=""\n             handler=".final.to521"\n             />\n+        <gs:upgradeStep\n+            title="Upgrade static resources"\n+            description=""\n+            handler="..utils.upgrade_static_resources"\n+            />\n \n     </gs:upgradeSteps>\n \ndiff --git a/plone/app/upgrade/v52/profiles/to_521/registry.xml b/plone/app/upgrade/v52/profiles/to_521/registry.xml\nindex 1156921b..009bfefd 100644\n--- a/plone/app/upgrade/v52/profiles/to_521/registry.xml\n+++ b/plone/app/upgrade/v52/profiles/to_521/registry.xml\n@@ -5,4 +5,4 @@\n       <element>Collection</element>\n     </value>\n   </records>\n-</registry>\n\\ No newline at end of file\n+</registry>\n'

