Repository: plone.app.contenttypes


Branch: refs/heads/1.4.x
Date: 2018-10-09T09:10:22+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.contenttypes/commit/733cc07c8bdf2e5a10b3414d100f37e1489bd815

Revert the breaking lead image and richt text behavior change.

This is not good for 1.4.x (Plone 5.1).
See https://github.com/plone/plone.app.contenttypes/pull/480

Files changed:
M CHANGES.rst
M plone/app/contenttypes/behaviors/configure.zcml
M plone/app/contenttypes/behaviors/leadimage.py
M plone/app/contenttypes/behaviors/richtext.py
M plone/app/contenttypes/profiles/default/types/Collection.xml
M plone/app/contenttypes/profiles/default/types/Document.xml
M plone/app/contenttypes/profiles/default/types/Event.xml
M plone/app/contenttypes/profiles/default/types/News_Item.xml
M plone/app/contenttypes/testing.py
M plone/app/contenttypes/tests/test_behaviors_leadimage.py
M plone/app/contenttypes/tests/test_behaviors_richtext.py
M plone/app/contenttypes/tests/test_collection.py
M plone/app/contenttypes/tests/test_document.py
M plone/app/contenttypes/tests/test_event.py
M plone/app/contenttypes/tests/test_link.py
M plone/app/contenttypes/tests/test_migration_custom.py
M plone/app/contenttypes/tests/test_migration_topic.py
M plone/app/contenttypes/tests/test_news_item.py
M plone/app/contenttypes/upgrades.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 6e060f4b..815cc38a 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,7 +14,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Really revert breaking behavior marker interface changes in 1.4.12.\n+  [maurits]\n \n \n 1.4.14 (2018-10-03)\ndiff --git a/plone/app/contenttypes/behaviors/configure.zcml b/plone/app/contenttypes/behaviors/configure.zcml\nindex 69cb53fb..a19e2774 100644\n--- a/plone/app/contenttypes/behaviors/configure.zcml\n+++ b/plone/app/contenttypes/behaviors/configure.zcml\n@@ -11,7 +11,7 @@\n     name="plone.leadimage"\n     title="Lead Image"\n     description="Adds image and image caption fields"\n-    provides=".leadimage.ILeadImageBehavior"\n+    provides=".leadimage.ILeadImage"\n     factory=".leadimage.LeadImage"\n     for="plone.dexterity.interfaces.IDexterityContent"\n     marker=".leadimage.ILeadImage"\n@@ -49,7 +49,7 @@\n     name="plone.richtext"\n     title="RichText"\n     description="Adds richtext behavior"\n-    provides=".richtext.IRichTextBehavior"\n+    provides=".richtext.IRichText"\n     factory=".richtext.RichText"\n     for="plone.dexterity.interfaces.IDexterityContent"\n     marker=".richtext.IRichText"\ndiff --git a/plone/app/contenttypes/behaviors/leadimage.py b/plone/app/contenttypes/behaviors/leadimage.py\nindex f7bebbdd..c11c0070 100644\n--- a/plone/app/contenttypes/behaviors/leadimage.py\n+++ b/plone/app/contenttypes/behaviors/leadimage.py\n@@ -8,15 +8,10 @@\n from zope.component import adapter\n from zope.interface import implementer\n from zope.interface import provider\n-from zope.interface import Interface\n-\n-\n-class ILeadImage(Interface):\n-    pass\n \n \n @provider(IFormFieldProvider)\n-class ILeadImageBehavior(model.Schema):\n+class ILeadImage(model.Schema):\n \n     image = namedfile.NamedBlobImage(\n         title=_(u\'label_leadimage\', default=u\'Lead Image\'),\n@@ -31,25 +26,9 @@ class ILeadImageBehavior(model.Schema):\n     )\n \n \n-@implementer(ILeadImageBehavior)\n+@implementer(ILeadImage)\n @adapter(IDexterityContent)\n class LeadImage(object):\n \n     def __init__(self, context):\n         self.context = context\n-\n-    @property\n-    def image(self):\n-        return self.context.image\n-\n-    @image.setter\n-    def image(self, value):\n-        self.context.image = value\n-\n-    @property\n-    def image_caption(self):\n-        return self.context.image_caption\n-\n-    @image_caption.setter\n-    def image_caption(self, value):\n-        self.context.image_caption = value\ndiff --git a/plone/app/contenttypes/behaviors/richtext.py b/plone/app/contenttypes/behaviors/richtext.py\nindex c89857d5..2332cbf4 100644\n--- a/plone/app/contenttypes/behaviors/richtext.py\n+++ b/plone/app/contenttypes/behaviors/richtext.py\n@@ -9,16 +9,11 @@\n from plone.supermodel import model\n from zope.component import adapter\n from zope.interface import implementer\n-from zope.interface import Interface\n from zope.interface import provider\n \n \n-class IRichText(Interface):\n-    pass\n-\n-\n @provider(IFormFieldProvider)\n-class IRichTextBehavior(model.Schema):\n+class IRichText(model.Schema):\n \n     text = RichTextField(\n         title=_(u\'Text\'),\n@@ -29,21 +24,13 @@ class IRichTextBehavior(model.Schema):\n     model.primary(\'text\')\n \n \n-@implementer(IRichTextBehavior)\n+@implementer(IRichText)\n @adapter(IDexterityContent)\n class RichText(object):\n \n     def __init__(self, context):\n         self.context = context\n \n-    @property\n-    def text(self):\n-        return self.context.text\n-\n-    @text.setter\n-    def text(self, value):\n-        self.context.text = value\n-\n \n class WidgetView(WidgetsView):\n     schema = IRichText\ndiff --git a/plone/app/contenttypes/profiles/default/types/Collection.xml b/plone/app/contenttypes/profiles/default/types/Collection.xml\nindex dd4ddea0..384d3e5f 100644\n--- a/plone/app/contenttypes/profiles/default/types/Collection.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Collection.xml\n@@ -38,7 +38,7 @@\n     <element value="plone.app.dexterity.behaviors.id.IShortName"/>\n     <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n     <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichTextBehavior"/>\n+    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n     <element value="plone.app.relationfield.behavior.IRelatedItems"/>\n     <element value="plone.app.lockingbehavior.behaviors.ILocking" />\n   </property>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Document.xml b/plone/app/contenttypes/profiles/default/types/Document.xml\nindex e23152da..29c558d4 100644\n--- a/plone/app/contenttypes/profiles/default/types/Document.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Document.xml\n@@ -37,7 +37,7 @@\n     <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n     <element value="plone.app.dexterity.behaviors.id.IShortName"/>\n     <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichTextBehavior"/>\n+    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n     <element value="plone.app.relationfield.behavior.IRelatedItems"/>\n     <element value="plone.app.versioningbehavior.behaviors.IVersionable" />\n     <element value="plone.app.contenttypes.behaviors.tableofcontents.ITableOfContents"/>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Event.xml b/plone/app/contenttypes/profiles/default/types/Event.xml\nindex 676a7b57..8e092b5e 100644\n--- a/plone/app/contenttypes/profiles/default/types/Event.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Event.xml\n@@ -39,7 +39,7 @@\n     <element value="plone.app.event.dx.behaviors.IEventContact"/>\n     <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n     <element value="plone.app.content.interfaces.INameFromTitle"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichTextBehavior"/>\n+    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n     <element value="plone.app.dexterity.behaviors.discussion.IAllowDiscussion"/>\n     <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n     <element value="plone.app.dexterity.behaviors.id.IShortName"/>\ndiff --git a/plone/app/contenttypes/profiles/default/types/News_Item.xml b/plone/app/contenttypes/profiles/default/types/News_Item.xml\nindex aab2baea..25791664 100644\n--- a/plone/app/contenttypes/profiles/default/types/News_Item.xml\n+++ b/plone/app/contenttypes/profiles/default/types/News_Item.xml\n@@ -33,13 +33,13 @@\n   <!-- Enabled behaviors -->\n   <property name="behaviors" purge="false">\n     <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichTextBehavior"/>\n+    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n     <element value="plone.app.content.interfaces.INameFromTitle"/>\n     <element value="plone.app.dexterity.behaviors.discussion.IAllowDiscussion"/>\n     <element value="plone.app.dexterity.behaviors.id.IShortName"/>\n     <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n     <element value="plone.app.relationfield.behavior.IRelatedItems"/>\n-    <element value="plone.app.contenttypes.behaviors.leadimage.ILeadImageBehavior"/>\n+    <element value="plone.app.contenttypes.behaviors.leadimage.ILeadImage"/>\n     <element value="plone.app.versioningbehavior.behaviors.IVersionable" />\n     <element value="plone.app.lockingbehavior.behaviors.ILocking" />\n   </property>\ndiff --git a/plone/app/contenttypes/testing.py b/plone/app/contenttypes/testing.py\nindex 6d4966c7..e78c1683 100644\n--- a/plone/app/contenttypes/testing.py\n+++ b/plone/app/contenttypes/testing.py\n@@ -15,6 +15,7 @@\n from zope.interface import alsoProvides\n \n import pkg_resources\n+import unittest\n \n \n def set_browserlayer(request):\n@@ -65,11 +66,11 @@ def tearDownPloneSite(self, portal):\n \n \n try:\n-    pkg_resources.get_distribution(\'Products.ATContentTypes\')\n     import Products.ATContentTypes\n-    TEST_MIGRATION = True\n-except pkg_resources.DistributionNotFound:\n+except ImportError:\n     TEST_MIGRATION = False\n+else:\n+    TEST_MIGRATION = True\n \n \n class PloneAppContenttypesMigration(PloneSandboxLayer):\n@@ -84,6 +85,7 @@ def setUpZope(self, app, configurationContext):\n             return\n \n         # prepare installing Products.ATContentTypes\n+        import Products.ATContentTypes\n         self.loadZCML(package=Products.ATContentTypes)\n         z2.installProduct(app, \'Products.Archetypes\')\n         z2.installProduct(app, \'Products.ATContentTypes\')\ndiff --git a/plone/app/contenttypes/tests/test_behaviors_leadimage.py b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\nindex f397118f..55fa50c3 100644\n--- a/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n+++ b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n@@ -28,7 +28,7 @@ def setUp(self):\n         self.portal.portal_types._setObject(\'leadimagefolder\', fti)\n         fti.klass = \'plone.dexterity.content.Container\'\n         fti.behaviors = (\n-            \'plone.app.contenttypes.behaviors.leadimage.ILeadImageBehavior\',\n+            \'plone.app.contenttypes.behaviors.leadimage.ILeadImage\',\n         )\n         self.fti = fti\n         alsoProvides(self.portal.REQUEST, IPloneAppContenttypesLayer)\n@@ -60,12 +60,12 @@ def test_lead_image_viewlet_shows_up(self):\n         # Image upload\n         file_path = os.path.join(os.path.dirname(__file__), \'image.jpg\')\n         file_ctl = self.browser.getControl(\n-            name=\'form.widgets.ILeadImageBehavior.image\'\n+            name=\'form.widgets.ILeadImage.image\'\n         )\n         file_ctl.add_file(io.FileIO(file_path), \'image/png\', \'image.jpg\')\n         # Image caption\n         self.browser.getControl(\n-            name=\'form.widgets.ILeadImageBehavior.image_caption\'\n+            name=\'form.widgets.ILeadImage.image_caption\'\n         ).value = \'My image caption\'\n         # Submit form\n         self.browser.getControl(\'Save\').click()\ndiff --git a/plone/app/contenttypes/tests/test_behaviors_richtext.py b/plone/app/contenttypes/tests/test_behaviors_richtext.py\nindex d61220e0..0f838c1d 100644\n--- a/plone/app/contenttypes/tests/test_behaviors_richtext.py\n+++ b/plone/app/contenttypes/tests/test_behaviors_richtext.py\n@@ -30,7 +30,7 @@ class RichTextBehaviorFunctionalTest(RichTextBase, unittest.TestCase):\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     _behaviors = (\n-        \'plone.app.contenttypes.behaviors.richtext.IRichTextBehavior\',)\n+        \'plone.app.contenttypes.behaviors.richtext.IRichText\',)\n     _portal_type = \'SomeDocument\'\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_collection.py b/plone/app/contenttypes/tests/test_collection.py\nindex b8467b92..35e162a4 100644\n--- a/plone/app/contenttypes/tests/test_collection.py\n+++ b/plone/app/contenttypes/tests/test_collection.py\n@@ -194,7 +194,7 @@ def test_add_collection(self):\n         browser.getControl(name=widget).value = \'My collection\'\n         widget = \'form.widgets.IDublinCore.description\'\n         browser.getControl(name=widget).value = \'This is my collection.\'\n-        widget = \'form.widgets.IRichTextBehavior.text\'\n+        widget = \'form.widgets.IRichText.text\'\n         browser.getControl(name=widget).value = \'Lorem Ipsum\'\n         widget = \'form.widgets.IShortName.id\'\n         browser.getControl(name=widget).value = \'my-special-collection\'\n@@ -396,19 +396,11 @@ def test_respect_navigation_root(self):\n                               title=\'Collection 1\')\n         collection1 = folder1[\'collection1\']\n         wrapped = ICollection_behavior(collection1)\n-        wrapped.query = [\n-            {\n-                \'i\': \'portal_type\',\n-                \'o\': \'plone.app.querystring.operation.string.is\',\n-                \'v\': \'Document\',\n-            },\n-            # use a "/" path and navroot works fine!\n-            {\n-                \'i\': \'path\',\n-                \'o\': \'plone.app.querystring.operation.string.path\',\n-                \'v\': \'/\',\n-            },\n-        ]\n+        wrapped.query = [{\n+            \'i\': \'portal_type\',\n+            \'o\': \'plone.app.querystring.operation.string.is\',\n+            \'v\': \'Document\',\n+        }]\n \n         # Check if only the item inside folder1 is returned, since it\'s a\n         # navigation root.\ndiff --git a/plone/app/contenttypes/tests/test_document.py b/plone/app/contenttypes/tests/test_document.py\nindex 81655a29..18f69476 100644\n--- a/plone/app/contenttypes/tests/test_document.py\n+++ b/plone/app/contenttypes/tests/test_document.py\n@@ -106,7 +106,7 @@ def test_add_document(self):\n         self.browser.getControl(name=widget).value = \'My document\'\n         widget = \'form.widgets.IDublinCore.description\'\n         self.browser.getControl(name=widget).value = \'This is my document.\'\n-        widget = \'form.widgets.IRichTextBehavior.text\'\n+        widget = \'form.widgets.IRichText.text\'\n         self.browser.getControl(name=widget).value = \'Lorem Ipsum\'\n         widget = \'form.widgets.IShortName.id\'\n         self.browser.getControl(name=widget).value = \'my-special-document\'\ndiff --git a/plone/app/contenttypes/tests/test_event.py b/plone/app/contenttypes/tests/test_event.py\nindex 40b53ed7..9617c5e4 100644\n--- a/plone/app/contenttypes/tests/test_event.py\n+++ b/plone/app/contenttypes/tests/test_event.py\n@@ -105,7 +105,7 @@ def test_add_event(self):\n             name=\'form.widgets.IDublinCore.description\'\n         ).value = \'This is my event.\'\n         self.browser.getControl(\n-            name=\'form.widgets.IRichTextBehavior.text\'\n+            name=\'form.widgets.IRichText.text\'\n         ).value = \'Lorem Ipsum\'\n         self.browser.getControl(\n             name=\'form.widgets.IEventBasic.start\'\ndiff --git a/plone/app/contenttypes/tests/test_link.py b/plone/app/contenttypes/tests/test_link.py\nindex 5f729ba2..e161e5f9 100644\n--- a/plone/app/contenttypes/tests/test_link.py\n+++ b/plone/app/contenttypes/tests/test_link.py\n@@ -173,9 +173,7 @@ def test_link_redirect_view_path_with_variable_and_parameters(self):\n         # As anonymous: redirect\n         logout()\n         self.assertTrue(view())\n-        self._assert_redirect(\n-            \'http://nohost/plone/@@search?SearchableText=Plone\',\n-        )\n+        self._assert_redirect(\'http://nohost/plone/@@search?SearchableText=Plone\')\n \n     def test_mailto_type(self):\n         self.link.remoteUrl = \'mailto:stress@test.us\'\ndiff --git a/plone/app/contenttypes/tests/test_migration_custom.py b/plone/app/contenttypes/tests/test_migration_custom.py\nindex f9b3a68f..0e9a93f6 100644\n--- a/plone/app/contenttypes/tests/test_migration_custom.py\n+++ b/plone/app/contenttypes/tests/test_migration_custom.py\n@@ -7,9 +7,9 @@\n \n if TEST_MIGRATION:\n     from datetime import datetime\n-    from plone.app.contenttypes.migration.field_migrators import migrate_filefield  # noqa E501\n-    from plone.app.contenttypes.migration.field_migrators import migrate_imagefield  # noqa E501\n-    from plone.app.contenttypes.migration.field_migrators import migrate_simplefield  # noqa E501\n+    from plone.app.contenttypes.migration.field_migrators import migrate_filefield\n+    from plone.app.contenttypes.migration.field_migrators import migrate_imagefield\n+    from plone.app.contenttypes.migration.field_migrators import migrate_simplefield  # noqa\n     from plone.app.contenttypes.migration.utils import installTypeIfNeeded\n     from plone.app.testing import applyProfile\n     from plone.app.testing import login\ndiff --git a/plone/app/contenttypes/tests/test_migration_topic.py b/plone/app/contenttypes/tests/test_migration_topic.py\nindex 44dcb513..c7ac2c8a 100644\n--- a/plone/app/contenttypes/tests/test_migration_topic.py\n+++ b/plone/app/contenttypes/tests/test_migration_topic.py\n@@ -16,6 +16,7 @@\n     from zope.component import queryUtility\n     from zope.interface import implementer\n \n+\n     @implementer(ICollection)\n     class FolderishCollection(Container):\n         """Test subclass for folderish ``Collections``.\ndiff --git a/plone/app/contenttypes/tests/test_news_item.py b/plone/app/contenttypes/tests/test_news_item.py\nindex a2299aa3..0bf9a0f8 100644\n--- a/plone/app/contenttypes/tests/test_news_item.py\n+++ b/plone/app/contenttypes/tests/test_news_item.py\n@@ -130,7 +130,7 @@ def test_add_news_item(self):\n             .value = \'This is my news item.\'\n         self.browser.getControl(name=\'form.widgets.IShortName.id\')\\\n             .value = \'\'\n-        self.browser.getControl(name=\'form.widgets.IRichTextBehavior.text\')\\\n+        self.browser.getControl(name=\'form.widgets.IRichText.text\')\\\n             .value = \'Lorem Ipsum\'\n         self.browser.getControl(\'Save\').click()\n \ndiff --git a/plone/app/contenttypes/upgrades.py b/plone/app/contenttypes/upgrades.py\nindex 19c83819..26b8fa81 100644\n--- a/plone/app/contenttypes/upgrades.py\n+++ b/plone/app/contenttypes/upgrades.py\n@@ -103,7 +103,7 @@ def enable_collection_behavior(context):\n def migrate_to_richtext(context):\n     """Update fti\'s to add RichText behaviors and remove old text-fields."""\n \n-    behavior = \'plone.app.contenttypes.behaviors.richtext.IRichTextBehavior\'\n+    behavior = \'plone.app.contenttypes.behaviors.richtext.IRichText\'\n     types = [\n         \'Document\',\n         \'News Item\',\n'

Repository: plone.app.contenttypes


Branch: refs/heads/1.4.x
Date: 2018-10-09T11:20:32+02:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/e848de64bcbbf5dc23c06a5e9f8a776e4878070e

Merge pull request #496 from plone/revert-leadimage-richttext-breaking-behavior-14

Revert the breaking lead image and richt text behavior change.

Files changed:
M CHANGES.rst
M plone/app/contenttypes/behaviors/configure.zcml
M plone/app/contenttypes/behaviors/leadimage.py
M plone/app/contenttypes/behaviors/richtext.py
M plone/app/contenttypes/profiles/default/types/Collection.xml
M plone/app/contenttypes/profiles/default/types/Document.xml
M plone/app/contenttypes/profiles/default/types/Event.xml
M plone/app/contenttypes/profiles/default/types/News_Item.xml
M plone/app/contenttypes/testing.py
M plone/app/contenttypes/tests/test_behaviors_leadimage.py
M plone/app/contenttypes/tests/test_behaviors_richtext.py
M plone/app/contenttypes/tests/test_collection.py
M plone/app/contenttypes/tests/test_document.py
M plone/app/contenttypes/tests/test_event.py
M plone/app/contenttypes/tests/test_link.py
M plone/app/contenttypes/tests/test_migration_custom.py
M plone/app/contenttypes/tests/test_migration_topic.py
M plone/app/contenttypes/tests/test_news_item.py
M plone/app/contenttypes/upgrades.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 6e060f4b..815cc38a 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,7 +14,8 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Really revert breaking behavior marker interface changes in 1.4.12.\n+  [maurits]\n \n \n 1.4.14 (2018-10-03)\ndiff --git a/plone/app/contenttypes/behaviors/configure.zcml b/plone/app/contenttypes/behaviors/configure.zcml\nindex 69cb53fb..a19e2774 100644\n--- a/plone/app/contenttypes/behaviors/configure.zcml\n+++ b/plone/app/contenttypes/behaviors/configure.zcml\n@@ -11,7 +11,7 @@\n     name="plone.leadimage"\n     title="Lead Image"\n     description="Adds image and image caption fields"\n-    provides=".leadimage.ILeadImageBehavior"\n+    provides=".leadimage.ILeadImage"\n     factory=".leadimage.LeadImage"\n     for="plone.dexterity.interfaces.IDexterityContent"\n     marker=".leadimage.ILeadImage"\n@@ -49,7 +49,7 @@\n     name="plone.richtext"\n     title="RichText"\n     description="Adds richtext behavior"\n-    provides=".richtext.IRichTextBehavior"\n+    provides=".richtext.IRichText"\n     factory=".richtext.RichText"\n     for="plone.dexterity.interfaces.IDexterityContent"\n     marker=".richtext.IRichText"\ndiff --git a/plone/app/contenttypes/behaviors/leadimage.py b/plone/app/contenttypes/behaviors/leadimage.py\nindex f7bebbdd..c11c0070 100644\n--- a/plone/app/contenttypes/behaviors/leadimage.py\n+++ b/plone/app/contenttypes/behaviors/leadimage.py\n@@ -8,15 +8,10 @@\n from zope.component import adapter\n from zope.interface import implementer\n from zope.interface import provider\n-from zope.interface import Interface\n-\n-\n-class ILeadImage(Interface):\n-    pass\n \n \n @provider(IFormFieldProvider)\n-class ILeadImageBehavior(model.Schema):\n+class ILeadImage(model.Schema):\n \n     image = namedfile.NamedBlobImage(\n         title=_(u\'label_leadimage\', default=u\'Lead Image\'),\n@@ -31,25 +26,9 @@ class ILeadImageBehavior(model.Schema):\n     )\n \n \n-@implementer(ILeadImageBehavior)\n+@implementer(ILeadImage)\n @adapter(IDexterityContent)\n class LeadImage(object):\n \n     def __init__(self, context):\n         self.context = context\n-\n-    @property\n-    def image(self):\n-        return self.context.image\n-\n-    @image.setter\n-    def image(self, value):\n-        self.context.image = value\n-\n-    @property\n-    def image_caption(self):\n-        return self.context.image_caption\n-\n-    @image_caption.setter\n-    def image_caption(self, value):\n-        self.context.image_caption = value\ndiff --git a/plone/app/contenttypes/behaviors/richtext.py b/plone/app/contenttypes/behaviors/richtext.py\nindex c89857d5..2332cbf4 100644\n--- a/plone/app/contenttypes/behaviors/richtext.py\n+++ b/plone/app/contenttypes/behaviors/richtext.py\n@@ -9,16 +9,11 @@\n from plone.supermodel import model\n from zope.component import adapter\n from zope.interface import implementer\n-from zope.interface import Interface\n from zope.interface import provider\n \n \n-class IRichText(Interface):\n-    pass\n-\n-\n @provider(IFormFieldProvider)\n-class IRichTextBehavior(model.Schema):\n+class IRichText(model.Schema):\n \n     text = RichTextField(\n         title=_(u\'Text\'),\n@@ -29,21 +24,13 @@ class IRichTextBehavior(model.Schema):\n     model.primary(\'text\')\n \n \n-@implementer(IRichTextBehavior)\n+@implementer(IRichText)\n @adapter(IDexterityContent)\n class RichText(object):\n \n     def __init__(self, context):\n         self.context = context\n \n-    @property\n-    def text(self):\n-        return self.context.text\n-\n-    @text.setter\n-    def text(self, value):\n-        self.context.text = value\n-\n \n class WidgetView(WidgetsView):\n     schema = IRichText\ndiff --git a/plone/app/contenttypes/profiles/default/types/Collection.xml b/plone/app/contenttypes/profiles/default/types/Collection.xml\nindex dd4ddea0..384d3e5f 100644\n--- a/plone/app/contenttypes/profiles/default/types/Collection.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Collection.xml\n@@ -38,7 +38,7 @@\n     <element value="plone.app.dexterity.behaviors.id.IShortName"/>\n     <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n     <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichTextBehavior"/>\n+    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n     <element value="plone.app.relationfield.behavior.IRelatedItems"/>\n     <element value="plone.app.lockingbehavior.behaviors.ILocking" />\n   </property>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Document.xml b/plone/app/contenttypes/profiles/default/types/Document.xml\nindex e23152da..29c558d4 100644\n--- a/plone/app/contenttypes/profiles/default/types/Document.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Document.xml\n@@ -37,7 +37,7 @@\n     <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n     <element value="plone.app.dexterity.behaviors.id.IShortName"/>\n     <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichTextBehavior"/>\n+    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n     <element value="plone.app.relationfield.behavior.IRelatedItems"/>\n     <element value="plone.app.versioningbehavior.behaviors.IVersionable" />\n     <element value="plone.app.contenttypes.behaviors.tableofcontents.ITableOfContents"/>\ndiff --git a/plone/app/contenttypes/profiles/default/types/Event.xml b/plone/app/contenttypes/profiles/default/types/Event.xml\nindex 676a7b57..8e092b5e 100644\n--- a/plone/app/contenttypes/profiles/default/types/Event.xml\n+++ b/plone/app/contenttypes/profiles/default/types/Event.xml\n@@ -39,7 +39,7 @@\n     <element value="plone.app.event.dx.behaviors.IEventContact"/>\n     <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n     <element value="plone.app.content.interfaces.INameFromTitle"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichTextBehavior"/>\n+    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n     <element value="plone.app.dexterity.behaviors.discussion.IAllowDiscussion"/>\n     <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n     <element value="plone.app.dexterity.behaviors.id.IShortName"/>\ndiff --git a/plone/app/contenttypes/profiles/default/types/News_Item.xml b/plone/app/contenttypes/profiles/default/types/News_Item.xml\nindex aab2baea..25791664 100644\n--- a/plone/app/contenttypes/profiles/default/types/News_Item.xml\n+++ b/plone/app/contenttypes/profiles/default/types/News_Item.xml\n@@ -33,13 +33,13 @@\n   <!-- Enabled behaviors -->\n   <property name="behaviors" purge="false">\n     <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichTextBehavior"/>\n+    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n     <element value="plone.app.content.interfaces.INameFromTitle"/>\n     <element value="plone.app.dexterity.behaviors.discussion.IAllowDiscussion"/>\n     <element value="plone.app.dexterity.behaviors.id.IShortName"/>\n     <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n     <element value="plone.app.relationfield.behavior.IRelatedItems"/>\n-    <element value="plone.app.contenttypes.behaviors.leadimage.ILeadImageBehavior"/>\n+    <element value="plone.app.contenttypes.behaviors.leadimage.ILeadImage"/>\n     <element value="plone.app.versioningbehavior.behaviors.IVersionable" />\n     <element value="plone.app.lockingbehavior.behaviors.ILocking" />\n   </property>\ndiff --git a/plone/app/contenttypes/testing.py b/plone/app/contenttypes/testing.py\nindex 6d4966c7..e78c1683 100644\n--- a/plone/app/contenttypes/testing.py\n+++ b/plone/app/contenttypes/testing.py\n@@ -15,6 +15,7 @@\n from zope.interface import alsoProvides\n \n import pkg_resources\n+import unittest\n \n \n def set_browserlayer(request):\n@@ -65,11 +66,11 @@ def tearDownPloneSite(self, portal):\n \n \n try:\n-    pkg_resources.get_distribution(\'Products.ATContentTypes\')\n     import Products.ATContentTypes\n-    TEST_MIGRATION = True\n-except pkg_resources.DistributionNotFound:\n+except ImportError:\n     TEST_MIGRATION = False\n+else:\n+    TEST_MIGRATION = True\n \n \n class PloneAppContenttypesMigration(PloneSandboxLayer):\n@@ -84,6 +85,7 @@ def setUpZope(self, app, configurationContext):\n             return\n \n         # prepare installing Products.ATContentTypes\n+        import Products.ATContentTypes\n         self.loadZCML(package=Products.ATContentTypes)\n         z2.installProduct(app, \'Products.Archetypes\')\n         z2.installProduct(app, \'Products.ATContentTypes\')\ndiff --git a/plone/app/contenttypes/tests/test_behaviors_leadimage.py b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\nindex f397118f..55fa50c3 100644\n--- a/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n+++ b/plone/app/contenttypes/tests/test_behaviors_leadimage.py\n@@ -28,7 +28,7 @@ def setUp(self):\n         self.portal.portal_types._setObject(\'leadimagefolder\', fti)\n         fti.klass = \'plone.dexterity.content.Container\'\n         fti.behaviors = (\n-            \'plone.app.contenttypes.behaviors.leadimage.ILeadImageBehavior\',\n+            \'plone.app.contenttypes.behaviors.leadimage.ILeadImage\',\n         )\n         self.fti = fti\n         alsoProvides(self.portal.REQUEST, IPloneAppContenttypesLayer)\n@@ -60,12 +60,12 @@ def test_lead_image_viewlet_shows_up(self):\n         # Image upload\n         file_path = os.path.join(os.path.dirname(__file__), \'image.jpg\')\n         file_ctl = self.browser.getControl(\n-            name=\'form.widgets.ILeadImageBehavior.image\'\n+            name=\'form.widgets.ILeadImage.image\'\n         )\n         file_ctl.add_file(io.FileIO(file_path), \'image/png\', \'image.jpg\')\n         # Image caption\n         self.browser.getControl(\n-            name=\'form.widgets.ILeadImageBehavior.image_caption\'\n+            name=\'form.widgets.ILeadImage.image_caption\'\n         ).value = \'My image caption\'\n         # Submit form\n         self.browser.getControl(\'Save\').click()\ndiff --git a/plone/app/contenttypes/tests/test_behaviors_richtext.py b/plone/app/contenttypes/tests/test_behaviors_richtext.py\nindex d61220e0..0f838c1d 100644\n--- a/plone/app/contenttypes/tests/test_behaviors_richtext.py\n+++ b/plone/app/contenttypes/tests/test_behaviors_richtext.py\n@@ -30,7 +30,7 @@ class RichTextBehaviorFunctionalTest(RichTextBase, unittest.TestCase):\n     layer = PLONE_APP_CONTENTTYPES_FUNCTIONAL_TESTING\n \n     _behaviors = (\n-        \'plone.app.contenttypes.behaviors.richtext.IRichTextBehavior\',)\n+        \'plone.app.contenttypes.behaviors.richtext.IRichText\',)\n     _portal_type = \'SomeDocument\'\n \n     def setUp(self):\ndiff --git a/plone/app/contenttypes/tests/test_collection.py b/plone/app/contenttypes/tests/test_collection.py\nindex b8467b92..35e162a4 100644\n--- a/plone/app/contenttypes/tests/test_collection.py\n+++ b/plone/app/contenttypes/tests/test_collection.py\n@@ -194,7 +194,7 @@ def test_add_collection(self):\n         browser.getControl(name=widget).value = \'My collection\'\n         widget = \'form.widgets.IDublinCore.description\'\n         browser.getControl(name=widget).value = \'This is my collection.\'\n-        widget = \'form.widgets.IRichTextBehavior.text\'\n+        widget = \'form.widgets.IRichText.text\'\n         browser.getControl(name=widget).value = \'Lorem Ipsum\'\n         widget = \'form.widgets.IShortName.id\'\n         browser.getControl(name=widget).value = \'my-special-collection\'\n@@ -396,19 +396,11 @@ def test_respect_navigation_root(self):\n                               title=\'Collection 1\')\n         collection1 = folder1[\'collection1\']\n         wrapped = ICollection_behavior(collection1)\n-        wrapped.query = [\n-            {\n-                \'i\': \'portal_type\',\n-                \'o\': \'plone.app.querystring.operation.string.is\',\n-                \'v\': \'Document\',\n-            },\n-            # use a "/" path and navroot works fine!\n-            {\n-                \'i\': \'path\',\n-                \'o\': \'plone.app.querystring.operation.string.path\',\n-                \'v\': \'/\',\n-            },\n-        ]\n+        wrapped.query = [{\n+            \'i\': \'portal_type\',\n+            \'o\': \'plone.app.querystring.operation.string.is\',\n+            \'v\': \'Document\',\n+        }]\n \n         # Check if only the item inside folder1 is returned, since it\'s a\n         # navigation root.\ndiff --git a/plone/app/contenttypes/tests/test_document.py b/plone/app/contenttypes/tests/test_document.py\nindex 81655a29..18f69476 100644\n--- a/plone/app/contenttypes/tests/test_document.py\n+++ b/plone/app/contenttypes/tests/test_document.py\n@@ -106,7 +106,7 @@ def test_add_document(self):\n         self.browser.getControl(name=widget).value = \'My document\'\n         widget = \'form.widgets.IDublinCore.description\'\n         self.browser.getControl(name=widget).value = \'This is my document.\'\n-        widget = \'form.widgets.IRichTextBehavior.text\'\n+        widget = \'form.widgets.IRichText.text\'\n         self.browser.getControl(name=widget).value = \'Lorem Ipsum\'\n         widget = \'form.widgets.IShortName.id\'\n         self.browser.getControl(name=widget).value = \'my-special-document\'\ndiff --git a/plone/app/contenttypes/tests/test_event.py b/plone/app/contenttypes/tests/test_event.py\nindex 40b53ed7..9617c5e4 100644\n--- a/plone/app/contenttypes/tests/test_event.py\n+++ b/plone/app/contenttypes/tests/test_event.py\n@@ -105,7 +105,7 @@ def test_add_event(self):\n             name=\'form.widgets.IDublinCore.description\'\n         ).value = \'This is my event.\'\n         self.browser.getControl(\n-            name=\'form.widgets.IRichTextBehavior.text\'\n+            name=\'form.widgets.IRichText.text\'\n         ).value = \'Lorem Ipsum\'\n         self.browser.getControl(\n             name=\'form.widgets.IEventBasic.start\'\ndiff --git a/plone/app/contenttypes/tests/test_link.py b/plone/app/contenttypes/tests/test_link.py\nindex 5f729ba2..e161e5f9 100644\n--- a/plone/app/contenttypes/tests/test_link.py\n+++ b/plone/app/contenttypes/tests/test_link.py\n@@ -173,9 +173,7 @@ def test_link_redirect_view_path_with_variable_and_parameters(self):\n         # As anonymous: redirect\n         logout()\n         self.assertTrue(view())\n-        self._assert_redirect(\n-            \'http://nohost/plone/@@search?SearchableText=Plone\',\n-        )\n+        self._assert_redirect(\'http://nohost/plone/@@search?SearchableText=Plone\')\n \n     def test_mailto_type(self):\n         self.link.remoteUrl = \'mailto:stress@test.us\'\ndiff --git a/plone/app/contenttypes/tests/test_migration_custom.py b/plone/app/contenttypes/tests/test_migration_custom.py\nindex f9b3a68f..0e9a93f6 100644\n--- a/plone/app/contenttypes/tests/test_migration_custom.py\n+++ b/plone/app/contenttypes/tests/test_migration_custom.py\n@@ -7,9 +7,9 @@\n \n if TEST_MIGRATION:\n     from datetime import datetime\n-    from plone.app.contenttypes.migration.field_migrators import migrate_filefield  # noqa E501\n-    from plone.app.contenttypes.migration.field_migrators import migrate_imagefield  # noqa E501\n-    from plone.app.contenttypes.migration.field_migrators import migrate_simplefield  # noqa E501\n+    from plone.app.contenttypes.migration.field_migrators import migrate_filefield\n+    from plone.app.contenttypes.migration.field_migrators import migrate_imagefield\n+    from plone.app.contenttypes.migration.field_migrators import migrate_simplefield  # noqa\n     from plone.app.contenttypes.migration.utils import installTypeIfNeeded\n     from plone.app.testing import applyProfile\n     from plone.app.testing import login\ndiff --git a/plone/app/contenttypes/tests/test_migration_topic.py b/plone/app/contenttypes/tests/test_migration_topic.py\nindex 44dcb513..c7ac2c8a 100644\n--- a/plone/app/contenttypes/tests/test_migration_topic.py\n+++ b/plone/app/contenttypes/tests/test_migration_topic.py\n@@ -16,6 +16,7 @@\n     from zope.component import queryUtility\n     from zope.interface import implementer\n \n+\n     @implementer(ICollection)\n     class FolderishCollection(Container):\n         """Test subclass for folderish ``Collections``.\ndiff --git a/plone/app/contenttypes/tests/test_news_item.py b/plone/app/contenttypes/tests/test_news_item.py\nindex a2299aa3..0bf9a0f8 100644\n--- a/plone/app/contenttypes/tests/test_news_item.py\n+++ b/plone/app/contenttypes/tests/test_news_item.py\n@@ -130,7 +130,7 @@ def test_add_news_item(self):\n             .value = \'This is my news item.\'\n         self.browser.getControl(name=\'form.widgets.IShortName.id\')\\\n             .value = \'\'\n-        self.browser.getControl(name=\'form.widgets.IRichTextBehavior.text\')\\\n+        self.browser.getControl(name=\'form.widgets.IRichText.text\')\\\n             .value = \'Lorem Ipsum\'\n         self.browser.getControl(\'Save\').click()\n \ndiff --git a/plone/app/contenttypes/upgrades.py b/plone/app/contenttypes/upgrades.py\nindex 19c83819..26b8fa81 100644\n--- a/plone/app/contenttypes/upgrades.py\n+++ b/plone/app/contenttypes/upgrades.py\n@@ -103,7 +103,7 @@ def enable_collection_behavior(context):\n def migrate_to_richtext(context):\n     """Update fti\'s to add RichText behaviors and remove old text-fields."""\n \n-    behavior = \'plone.app.contenttypes.behaviors.richtext.IRichTextBehavior\'\n+    behavior = \'plone.app.contenttypes.behaviors.richtext.IRichText\'\n     types = [\n         \'Document\',\n         \'News Item\',\n'

