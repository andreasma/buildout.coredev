Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2018-08-13T14:52:53+03:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/plone.schemaeditor/commit/d630820e7c49fe0c9cc304533e9f53c1702aec10

Add more tests for non-ascii vocabulary values

Files changed:
M plone/schemaeditor/tests/test_fields.py

b"diff --git a/plone/schemaeditor/tests/test_fields.py b/plone/schemaeditor/tests/test_fields.py\nindex 14db2e5..cbd9057 100644\n--- a/plone/schemaeditor/tests/test_fields.py\n+++ b/plone/schemaeditor/tests/test_fields.py\n@@ -30,6 +30,10 @@ def assertVocabulary(self, voc, values):\n     def test_singlechoice_voc(self):\n         field = TextLineChoiceField(DummyField())\n         field.values = [u'New York', u'city2|M\xc3\xbcnchen']\n+        self.assertEqual(\n+            field.values,\n+            [u'New York', u'city2|M\xc3\xbcnchen']\n+        )\n         self.assertVocabulary(\n             field.vocabulary,\n             [(u'New York', u'New York', u'New York'),\n@@ -39,6 +43,10 @@ def test_singlechoice_voc(self):\n     def test_multichoice_voc(self):\n         field = TextLineMultiChoiceField(DummyField())\n         field.values = [u'New York', u'city1|Z\xc3\xbcrich']\n+        self.assertEqual(\n+            field.values,\n+            [u'New York', u'city1|Z\xc3\xbcrich']\n+        )\n         self.assertVocabulary(\n             field.vocabulary,\n             [(u'New York', u'New York', u'New York'),\n"

Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2018-08-13T14:56:45+03:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/plone.schemaeditor/commit/1994fc0d9133e37a34d2941a8aa6cfb5303e88a5

Fix issue where serializing vocabulary terms into '|' syntax failed when values contained non-ascii characters

Files changed:
M plone/schemaeditor/fields.py

b"diff --git a/plone/schemaeditor/fields.py b/plone/schemaeditor/fields.py\nindex 40c5072..7fcb460 100644\n--- a/plone/schemaeditor/fields.py\n+++ b/plone/schemaeditor/fields.py\n@@ -120,7 +120,8 @@ def __getattr__(self, name):\n             values = []\n             for term in (self.field.vocabulary or []):\n                 if term.value != term.title:\n-                    values.append('{0:s}|{1:s}'.format(term.value, term.title))\n+                    values.append(u'{0:s}|{1:s}'.format(\n+                        term.value, term.title))\n                 else:\n                     values.append(term.value)\n             return values\n@@ -132,8 +133,8 @@ def _constructVocabulary(self, value):\n         terms = []\n         if value:\n             for item in value:\n-                if item and '|' in item:\n-                    voc_value, voc_title = item.split('|', 1)\n+                if item and u'|' in item:\n+                    voc_value, voc_title = item.split(u'|', 1)\n                 else:\n                     voc_value = item\n                     voc_title = item\n@@ -260,7 +261,8 @@ def __getattr__(self, name):\n             values = []\n             for term in (self.field.value_type.vocabulary or []):\n                 if term.value != term.title:\n-                    values.append('{0:s}|{1:s}'.format(term.value, term.title))\n+                    values.append(u'{0:s}|{1:s}'.format(\n+                        term.value, term.title))\n                 else:\n                     values.append(term.value)\n             return values\n"

Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2018-08-13T14:57:14+03:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/plone.schemaeditor/commit/a1f6888f936fa2296097544c136b6a0f073d23be

Update changelog

Files changed:
M CHANGES.rst

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex e9f4d9e..48400dd 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,7 +14,9 @@ New features:\n \n Bug fixes:\n \n-- *add item here*\n+- Fix issue where serializing vocabulary terms into '|' syntax failed when\n+  values contained non-ascii characters\n+  [datakurre]\n \n \n 2.0.19 (2018-02-02)\n"

Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2018-08-14T09:47:56+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.schemaeditor/commit/234e0170c6c91b176dbe4bdddb5fe2952a0f3f54

Merge branch 'master' into datakurre-vocabularies

Files changed:
M CHANGES.rst
M plone/schemaeditor/browser/schema/listing.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 48400dd..e690b5b 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -18,6 +18,9 @@ Bug fixes:\n   values contained non-ascii characters\n   [datakurre]\n \n+- Allow defaults to be set on dexterity type fields via the web UI (@@fields)\n+  [ezvirtual]\n+\n \n 2.0.19 (2018-02-02)\n -------------------\ndiff --git a/plone/schemaeditor/browser/schema/listing.py b/plone/schemaeditor/browser/schema/listing.py\nindex 3030ab1..ac05e85 100644\n--- a/plone/schemaeditor/browser/schema/listing.py\n+++ b/plone/schemaeditor/browser/schema/listing.py\n@@ -114,8 +114,11 @@ def handleSaveDefaults(self, action):\n             self.status = self.formErrorsMessage\n             return\n \n-        for fname, value in data.items():\n-            self.context.schema[fname].default = value\n+        for widget in self._iterateOverWidgets():\n+            widget_name = widget.field.getName()\n+            if (widget.field.interface is self.context.schema and\n+                    widget_name in data):\n+                self.context.schema[widget_name].default = data[widget_name]\n         notify(SchemaModifiedEvent(self.context))\n \n         # update widgets to take the new defaults into account\n'

Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2018-08-14T09:48:19+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.schemaeditor/commit/f50e596f933adfbc9062dde47044f08984cc7486

Merge pull request #61 from plone/datakurre-vocabularies

 Fix issue where serializing vocabulary terms into '|' syntax failed when values contained non-ascii characters

Files changed:
M CHANGES.rst
M plone/schemaeditor/fields.py
M plone/schemaeditor/tests/test_fields.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 70afae8..e690b5b 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,6 +14,10 @@ New features:\n \n Bug fixes:\n \n+- Fix issue where serializing vocabulary terms into '|' syntax failed when\n+  values contained non-ascii characters\n+  [datakurre]\n+\n - Allow defaults to be set on dexterity type fields via the web UI (@@fields)\n   [ezvirtual]\n \ndiff --git a/plone/schemaeditor/fields.py b/plone/schemaeditor/fields.py\nindex 40c5072..7fcb460 100644\n--- a/plone/schemaeditor/fields.py\n+++ b/plone/schemaeditor/fields.py\n@@ -120,7 +120,8 @@ def __getattr__(self, name):\n             values = []\n             for term in (self.field.vocabulary or []):\n                 if term.value != term.title:\n-                    values.append('{0:s}|{1:s}'.format(term.value, term.title))\n+                    values.append(u'{0:s}|{1:s}'.format(\n+                        term.value, term.title))\n                 else:\n                     values.append(term.value)\n             return values\n@@ -132,8 +133,8 @@ def _constructVocabulary(self, value):\n         terms = []\n         if value:\n             for item in value:\n-                if item and '|' in item:\n-                    voc_value, voc_title = item.split('|', 1)\n+                if item and u'|' in item:\n+                    voc_value, voc_title = item.split(u'|', 1)\n                 else:\n                     voc_value = item\n                     voc_title = item\n@@ -260,7 +261,8 @@ def __getattr__(self, name):\n             values = []\n             for term in (self.field.value_type.vocabulary or []):\n                 if term.value != term.title:\n-                    values.append('{0:s}|{1:s}'.format(term.value, term.title))\n+                    values.append(u'{0:s}|{1:s}'.format(\n+                        term.value, term.title))\n                 else:\n                     values.append(term.value)\n             return values\ndiff --git a/plone/schemaeditor/tests/test_fields.py b/plone/schemaeditor/tests/test_fields.py\nindex 14db2e5..cbd9057 100644\n--- a/plone/schemaeditor/tests/test_fields.py\n+++ b/plone/schemaeditor/tests/test_fields.py\n@@ -30,6 +30,10 @@ def assertVocabulary(self, voc, values):\n     def test_singlechoice_voc(self):\n         field = TextLineChoiceField(DummyField())\n         field.values = [u'New York', u'city2|M\xc3\xbcnchen']\n+        self.assertEqual(\n+            field.values,\n+            [u'New York', u'city2|M\xc3\xbcnchen']\n+        )\n         self.assertVocabulary(\n             field.vocabulary,\n             [(u'New York', u'New York', u'New York'),\n@@ -39,6 +43,10 @@ def test_singlechoice_voc(self):\n     def test_multichoice_voc(self):\n         field = TextLineMultiChoiceField(DummyField())\n         field.values = [u'New York', u'city1|Z\xc3\xbcrich']\n+        self.assertEqual(\n+            field.values,\n+            [u'New York', u'city1|Z\xc3\xbcrich']\n+        )\n         self.assertVocabulary(\n             field.vocabulary,\n             [(u'New York', u'New York', u'New York'),\n"

