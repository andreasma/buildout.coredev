Repository: plone.app.layout


Branch: refs/heads/master
Date: 2018-08-31T02:11:57+02:00
Author: Davi Lima (davilima6) <davilima6@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/6580b2d5987782dfa4b829d75cd510ae79b0116a

Add regression test for Products.CMFPlone#2463

Files changed:
M CHANGES.rst
M plone/app/layout/viewlets/tests/history.txt

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 700fb7e..32873bb 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -10,7 +10,8 @@ Breaking changes:\n \n New features:\n \n-- *add item here*\n+- Add test for Revert to Revision action in History Viewlet\n+  [davilima6]\n \n Bug fixes:\n \ndiff --git a/plone/app/layout/viewlets/tests/history.txt b/plone/app/layout/viewlets/tests/history.txt\nindex 320bc21..0c95b93 100644\n--- a/plone/app/layout/viewlets/tests/history.txt\n+++ b/plone/app/layout/viewlets/tests/history.txt\n@@ -49,12 +49,33 @@ Create a public page with workflow.\n     >>> browser.open(portal_url)\n     >>> browser.getLink(id=\'document\').click()\n     >>> browser.getControl(\'Title\').value = "Doc2"\n+    >>> browser.getControl(\'Summary\').value = "First revision"\n     >>> browser.getControl(\'Save\').click()\n     >>> urldoc2 = browser.url\n \n The history viewlet gracefully handles initial default workflow state.\n \n     >>> browser.getLink(url=\'@@historyview\').click()\n-    >>> print browser.contents\n-    <...<span class="historyAction state-private">Create</span>...\n+    >>> browser.contents\n+    \'...<span class="historyAction state-private">Create</span>...\'\n \n+The history viewlet handles revert actions sucessfully. Let\'s make a revision.\n+\n+    >>> browser.open(urldoc2)\n+    >>> browser.getLink(\'Edit\').click()\n+    >>> browser.getControl(\'Summary\').value = "Changed for revision 2"\n+    >>> browser.getControl(\'Save\').click()\n+\n+The history viewlet now shows a Revert button.\n+\n+    >>> browser.getLink(url=\'@@historyview\').click()\n+    >>> browser.contents\n+    \'...<input class="destructive" type="submit" value="Revert to this revision"...\'\n+\n+After action success, user is redirected to Document, reverted to chosen revision.\n+\n+    >>> browser.getControl(\'Revert\').click()\n+    >>> browser.url in urldoc2\n+    True\n+    >>> browser.contents\n+    \'...<div class="documentDescription description">First revision</div>...\'\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2018-08-31T02:12:21+02:00
Author: Davi Lima (davilima6) <davilima6@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/965a1725d9b978ef0f0f813eda2fe972f156e6b0

Prefer convenience method for following links

Files changed:
M plone/app/layout/viewlets/tests/history.txt

b'diff --git a/plone/app/layout/viewlets/tests/history.txt b/plone/app/layout/viewlets/tests/history.txt\nindex 0c95b93..a9cf845 100644\n--- a/plone/app/layout/viewlets/tests/history.txt\n+++ b/plone/app/layout/viewlets/tests/history.txt\n@@ -24,7 +24,7 @@ error occurs on the server. To see more details, set handleErrors to False:\n Create a public page without workflow.\n \n     >>> browser.open(portal_url)\n-    >>> browser.getLink(id=\'document\').click()\n+    >>> browser.follow(id=\'document\')\n     >>> browser.getControl(\'Title\').value = "Doc1"\n     >>> browser.getControl(\'Save\').click()\n     >>> urldoc1 = browser.url\n@@ -36,7 +36,7 @@ Check that the form has been properly submitted\n \n The history viewlet gracefully handles content without workflow.\n \n-    >>> browser.getLink(url=\'@@historyview\').click()\n+    >>> browser.follow(url=\'@@historyview\')\n \n Create a public page with workflow.\n \n@@ -47,7 +47,7 @@ Create a public page with workflow.\n     >>> transaction.commit()\n \n     >>> browser.open(portal_url)\n-    >>> browser.getLink(id=\'document\').click()\n+    >>> browser.follow(id=\'document\')\n     >>> browser.getControl(\'Title\').value = "Doc2"\n     >>> browser.getControl(\'Summary\').value = "First revision"\n     >>> browser.getControl(\'Save\').click()\n@@ -55,20 +55,20 @@ Create a public page with workflow.\n \n The history viewlet gracefully handles initial default workflow state.\n \n-    >>> browser.getLink(url=\'@@historyview\').click()\n+    >>> browser.follow(url=\'@@historyview\')\n     >>> browser.contents\n     \'...<span class="historyAction state-private">Create</span>...\'\n \n The history viewlet handles revert actions sucessfully. Let\'s make a revision.\n \n     >>> browser.open(urldoc2)\n-    >>> browser.getLink(\'Edit\').click()\n+    >>> browser.follow(\'Edit\')\n     >>> browser.getControl(\'Summary\').value = "Changed for revision 2"\n     >>> browser.getControl(\'Save\').click()\n \n The history viewlet now shows a Revert button.\n \n-    >>> browser.getLink(url=\'@@historyview\').click()\n+    >>> browser.follow(url=\'@@historyview\')\n     >>> browser.contents\n     \'...<input class="destructive" type="submit" value="Revert to this revision"...\'\n \n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2018-09-04T09:21:11+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/c0b3150f9d73d48fb5965d0936c3d8e2efc5e0de

Merge pull request #159 from plone/add_test_return_revision

Add test for History View's Revert to Revision button

Files changed:
M CHANGES.rst
M plone/app/layout/viewlets/tests/history.txt

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 700fb7e..32873bb 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -10,7 +10,8 @@ Breaking changes:\n \n New features:\n \n-- *add item here*\n+- Add test for Revert to Revision action in History Viewlet\n+  [davilima6]\n \n Bug fixes:\n \ndiff --git a/plone/app/layout/viewlets/tests/history.txt b/plone/app/layout/viewlets/tests/history.txt\nindex 320bc21..a9cf845 100644\n--- a/plone/app/layout/viewlets/tests/history.txt\n+++ b/plone/app/layout/viewlets/tests/history.txt\n@@ -24,7 +24,7 @@ error occurs on the server. To see more details, set handleErrors to False:\n Create a public page without workflow.\n \n     >>> browser.open(portal_url)\n-    >>> browser.getLink(id=\'document\').click()\n+    >>> browser.follow(id=\'document\')\n     >>> browser.getControl(\'Title\').value = "Doc1"\n     >>> browser.getControl(\'Save\').click()\n     >>> urldoc1 = browser.url\n@@ -36,7 +36,7 @@ Check that the form has been properly submitted\n \n The history viewlet gracefully handles content without workflow.\n \n-    >>> browser.getLink(url=\'@@historyview\').click()\n+    >>> browser.follow(url=\'@@historyview\')\n \n Create a public page with workflow.\n \n@@ -47,14 +47,35 @@ Create a public page with workflow.\n     >>> transaction.commit()\n \n     >>> browser.open(portal_url)\n-    >>> browser.getLink(id=\'document\').click()\n+    >>> browser.follow(id=\'document\')\n     >>> browser.getControl(\'Title\').value = "Doc2"\n+    >>> browser.getControl(\'Summary\').value = "First revision"\n     >>> browser.getControl(\'Save\').click()\n     >>> urldoc2 = browser.url\n \n The history viewlet gracefully handles initial default workflow state.\n \n-    >>> browser.getLink(url=\'@@historyview\').click()\n-    >>> print browser.contents\n-    <...<span class="historyAction state-private">Create</span>...\n+    >>> browser.follow(url=\'@@historyview\')\n+    >>> browser.contents\n+    \'...<span class="historyAction state-private">Create</span>...\'\n \n+The history viewlet handles revert actions sucessfully. Let\'s make a revision.\n+\n+    >>> browser.open(urldoc2)\n+    >>> browser.follow(\'Edit\')\n+    >>> browser.getControl(\'Summary\').value = "Changed for revision 2"\n+    >>> browser.getControl(\'Save\').click()\n+\n+The history viewlet now shows a Revert button.\n+\n+    >>> browser.follow(url=\'@@historyview\')\n+    >>> browser.contents\n+    \'...<input class="destructive" type="submit" value="Revert to this revision"...\'\n+\n+After action success, user is redirected to Document, reverted to chosen revision.\n+\n+    >>> browser.getControl(\'Revert\').click()\n+    >>> browser.url in urldoc2\n+    True\n+    >>> browser.contents\n+    \'...<div class="documentDescription description">First revision</div>...\'\n'

