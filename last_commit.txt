Repository: plone.namedfile


Branch: refs/heads/4.2.x
Date: 2018-11-05T21:10:24+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.namedfile/commit/82c9caf14e7fc38024305d3ac42d7c805eb42ed8

Do not fail image upload when Exif data is bad.

https://github.com/plone/plone.namedfile/issues/68

Files changed:
M plone/namedfile/file.py

b"diff --git a/plone/namedfile/file.py b/plone/namedfile/file.py\nindex 8a98e44..1f63219 100644\n--- a/plone/namedfile/file.py\n+++ b/plone/namedfile/file.py\n@@ -387,8 +387,15 @@ def __init__(self, data='', contentType='', filename=None):\n                       'Exif Data: %s', exif_data)\n             orientation = exif_data['0th'].get(piexif.ImageIFD.Orientation, 1)\n             if 1 < orientation <= 8:\n-                self.data, self._width, self._height, self.exif = rotate_image(\n-                    self.data)\n+                try:\n+                    self.data, self._width, self._height, self.exif = \\\n+                        rotate_image(self.data)\n+                except KeyboardInterrupt:\n+                    raise\n+                except Exception:\n+                    log.warning(\n+                        'Error rotating image %s based on exif data.',\n+                        filename, exc_info=1)\n             else:\n                 self.exif = exif_data\n \n"

Repository: plone.namedfile


Branch: refs/heads/4.2.x
Date: 2018-11-05T22:08:30+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.namedfile/commit/2f553c514f0f3cd8a1b759a100665904c49e0399

Forgot to commit news file

Files changed:
A news/68.bugfix

b'diff --git a/news/68.bugfix b/news/68.bugfix\nnew file mode 100644\nindex 0000000..9060b3f\n--- /dev/null\n+++ b/news/68.bugfix\n@@ -0,0 +1 @@\n+Do not fail image upload when Exif data is bad.  [maurits]\n'

Repository: plone.namedfile


Branch: refs/heads/4.2.x
Date: 2018-11-09T00:32:47+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.namedfile/commit/d7163c41659174858b143d3c36e928bef0a1a5ec

Merge pull request #70 from plone/issue-68-branch42

Do not fail image upload when Exif data is bad. [4.2]

Files changed:
A news/68.bugfix
M plone/namedfile/file.py

b"diff --git a/news/68.bugfix b/news/68.bugfix\nnew file mode 100644\nindex 0000000..9060b3f\n--- /dev/null\n+++ b/news/68.bugfix\n@@ -0,0 +1 @@\n+Do not fail image upload when Exif data is bad.  [maurits]\ndiff --git a/plone/namedfile/file.py b/plone/namedfile/file.py\nindex 8a98e44..1f63219 100644\n--- a/plone/namedfile/file.py\n+++ b/plone/namedfile/file.py\n@@ -387,8 +387,15 @@ def __init__(self, data='', contentType='', filename=None):\n                       'Exif Data: %s', exif_data)\n             orientation = exif_data['0th'].get(piexif.ImageIFD.Orientation, 1)\n             if 1 < orientation <= 8:\n-                self.data, self._width, self._height, self.exif = rotate_image(\n-                    self.data)\n+                try:\n+                    self.data, self._width, self._height, self.exif = \\\n+                        rotate_image(self.data)\n+                except KeyboardInterrupt:\n+                    raise\n+                except Exception:\n+                    log.warning(\n+                        'Error rotating image %s based on exif data.',\n+                        filename, exc_info=1)\n             else:\n                 self.exif = exif_data\n \n"

