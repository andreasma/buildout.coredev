Repository: Products.CMFPlone


Branch: refs/heads/4.3.x
Date: 2020-01-23T11:55:42+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/96e8a550a297a6f29b31e4cff4e08b65904c9b6f

Password strength checks were not always checked

Include Hotfix 20200121 with tests

Files changed:
A news/3021.bugfix.1
M Products/CMFPlone/RegistrationTool.py
M Products/CMFPlone/tests/testControlPanelScripts.py
M Products/CMFPlone/tests/testRegistrationTool.py

b'diff --git a/Products/CMFPlone/RegistrationTool.py b/Products/CMFPlone/RegistrationTool.py\nindex a3b24e137b..dfd1b8ed07 100644\n--- a/Products/CMFPlone/RegistrationTool.py\n+++ b/Products/CMFPlone/RegistrationTool.py\n@@ -163,7 +163,7 @@ def testPasswordValidity(self, password, confirm=None):\n         # o If the password is valid, return None.\n         # o If not, return a string explaining why.\n         err = self.pasValidation(\'password\', password)\n-        if err and (password == \'\' or not _checkPermission(ManagePortal, self)):\n+        if err:\n             return err\n \n         if confirm is not None and confirm != password:\ndiff --git a/Products/CMFPlone/tests/testControlPanelScripts.py b/Products/CMFPlone/tests/testControlPanelScripts.py\nindex 4bf1118bd1..4f61d8ced9 100644\n--- a/Products/CMFPlone/tests/testControlPanelScripts.py\n+++ b/Products/CMFPlone/tests/testControlPanelScripts.py\n@@ -41,7 +41,8 @@ def test_changeOwnership(self):\n \n     def test_loginChangePassword(self):\n         path = self.folder_path + \'/login_change_password\'\n-        qstring = \'password=foo\'\n+        # Note: needs to be at least five characters.\n+        qstring = \'password=foobar\'\n         self._onlyPOST(path, qstring)\n \n \ndiff --git a/Products/CMFPlone/tests/testRegistrationTool.py b/Products/CMFPlone/tests/testRegistrationTool.py\nindex 3dbb51fd5d..2c8014edb9 100644\n--- a/Products/CMFPlone/tests/testRegistrationTool.py\n+++ b/Products/CMFPlone/tests/testRegistrationTool.py\n@@ -93,6 +93,26 @@ def testTestPasswordValidityConfirm(self):\n         self.failIf(self.registration.testPasswordValidity(\n             \'validpassword\', confirm=\'anotherpassword\') is None)\n \n+    def testTestPasswordValidityPolicy(self):\n+        self.assertIsNone(self.registration.testPasswordValidity("abcde", confirm=None))\n+        self.assertEqual(\n+            self.registration.testPasswordValidity("abcd", confirm=None),\n+            "Your password must contain at least 5 characters.",\n+        )\n+        # Password validity is checked with an empty password\n+        # to get a nice help message to show for the input field.\n+        self.assertEqual(\n+            self.registration.testPasswordValidity("", confirm=None),\n+            "Minimum 5 characters.",\n+        )\n+\n+    def testPasValidation(self):\n+        self.assertIsNone(self.registration.pasValidation("password", "abcde"))\n+        self.assertEqual(\n+            self.registration.pasValidation("password", "abcd"),\n+            "Your password must contain at least 5 characters.",\n+        )\n+\n     def testNewIdAllowed(self):\n         self.assertEqual(self.registration.isMemberIdAllowed(\'newuser\'), 1)\n \ndiff --git a/news/3021.bugfix.1 b/news/3021.bugfix.1\nnew file mode 100644\nindex 0000000000..191a074a5c\n--- /dev/null\n+++ b/news/3021.bugfix.1\n@@ -0,0 +1 @@\n+Merge Hotfix20200121 Check of the strenth of password could be skipped.\n'

Repository: Products.CMFPlone


Branch: refs/heads/4.3.x
Date: 2020-02-11T12:46:48+01:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/Products.CMFPlone/commit/7d495b82ed6e36dad0b03a434911878a5cebd8fd

Merge pull request #3025 from plone/merge-hotfix-20200121-4.3.x-password

4.3.x Hotfix20200121 Password

Files changed:
A news/3021.bugfix.1
M Products/CMFPlone/RegistrationTool.py
M Products/CMFPlone/tests/testControlPanelScripts.py
M Products/CMFPlone/tests/testRegistrationTool.py

b'diff --git a/Products/CMFPlone/RegistrationTool.py b/Products/CMFPlone/RegistrationTool.py\nindex a3b24e137b..dfd1b8ed07 100644\n--- a/Products/CMFPlone/RegistrationTool.py\n+++ b/Products/CMFPlone/RegistrationTool.py\n@@ -163,7 +163,7 @@ def testPasswordValidity(self, password, confirm=None):\n         # o If the password is valid, return None.\n         # o If not, return a string explaining why.\n         err = self.pasValidation(\'password\', password)\n-        if err and (password == \'\' or not _checkPermission(ManagePortal, self)):\n+        if err:\n             return err\n \n         if confirm is not None and confirm != password:\ndiff --git a/Products/CMFPlone/tests/testControlPanelScripts.py b/Products/CMFPlone/tests/testControlPanelScripts.py\nindex 4bf1118bd1..4f61d8ced9 100644\n--- a/Products/CMFPlone/tests/testControlPanelScripts.py\n+++ b/Products/CMFPlone/tests/testControlPanelScripts.py\n@@ -41,7 +41,8 @@ def test_changeOwnership(self):\n \n     def test_loginChangePassword(self):\n         path = self.folder_path + \'/login_change_password\'\n-        qstring = \'password=foo\'\n+        # Note: needs to be at least five characters.\n+        qstring = \'password=foobar\'\n         self._onlyPOST(path, qstring)\n \n \ndiff --git a/Products/CMFPlone/tests/testRegistrationTool.py b/Products/CMFPlone/tests/testRegistrationTool.py\nindex 3dbb51fd5d..2c8014edb9 100644\n--- a/Products/CMFPlone/tests/testRegistrationTool.py\n+++ b/Products/CMFPlone/tests/testRegistrationTool.py\n@@ -93,6 +93,26 @@ def testTestPasswordValidityConfirm(self):\n         self.failIf(self.registration.testPasswordValidity(\n             \'validpassword\', confirm=\'anotherpassword\') is None)\n \n+    def testTestPasswordValidityPolicy(self):\n+        self.assertIsNone(self.registration.testPasswordValidity("abcde", confirm=None))\n+        self.assertEqual(\n+            self.registration.testPasswordValidity("abcd", confirm=None),\n+            "Your password must contain at least 5 characters.",\n+        )\n+        # Password validity is checked with an empty password\n+        # to get a nice help message to show for the input field.\n+        self.assertEqual(\n+            self.registration.testPasswordValidity("", confirm=None),\n+            "Minimum 5 characters.",\n+        )\n+\n+    def testPasValidation(self):\n+        self.assertIsNone(self.registration.pasValidation("password", "abcde"))\n+        self.assertEqual(\n+            self.registration.pasValidation("password", "abcd"),\n+            "Your password must contain at least 5 characters.",\n+        )\n+\n     def testNewIdAllowed(self):\n         self.assertEqual(self.registration.isMemberIdAllowed(\'newuser\'), 1)\n \ndiff --git a/news/3021.bugfix.1 b/news/3021.bugfix.1\nnew file mode 100644\nindex 0000000000..191a074a5c\n--- /dev/null\n+++ b/news/3021.bugfix.1\n@@ -0,0 +1 @@\n+Merge Hotfix20200121 Check of the strenth of password could be skipped.\n'

