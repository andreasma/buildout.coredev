Repository: plone.app.content


Branch: refs/heads/master
Date: 2018-06-17T04:40:47+10:00
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/e2e156d156de268f86516a3b80223d9f0bc11967

Allow vocabulary to be called in subforms https://github.com/plone/Products.CMFPlone/issues/2446

Files changed:
M CHANGES.rst
M plone/app/content/browser/vocabulary.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 1a02e9e..f27d206 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,9 @@ Bug fixes:
 - Python 3 fixes.
   [pbauer]
 
+- Allow `getSources` vocabulary view to be called in subforms
+  [tomgross]
+
 3.5.2 (2018-04-08)
 ------------------
 
diff --git a/plone/app/content/browser/vocabulary.py b/plone/app/content/browser/vocabulary.py
index 27c8da0..8f7955a 100644
--- a/plone/app/content/browser/vocabulary.py
+++ b/plone/app/content/browser/vocabulary.py
@@ -16,6 +16,7 @@
 from Products.Five import BrowserView
 from Products.MimetypesRegistry.MimeTypeItem import guess_icon_path
 from types import FunctionType
+from z3c.form.interfaces import ISubForm
 from zope.component import getUtility
 from zope.component import queryAdapter
 from zope.component import queryUtility
@@ -355,7 +356,11 @@ class SourceView(BaseVocabularyView):
     """Queries a field's source and returns JSON-formatted results."""
 
     def get_context(self):
-        return self.context.context
+        if ISubForm.providedBy(self.context.form):
+            context = self.context.form.parentForm.context
+        else:
+            context = self.context.context
+        return context
 
     def get_vocabulary(self):
         widget = self.context


Repository: plone.app.content


Branch: refs/heads/master
Date: 2018-06-17T08:23:43+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.content/commit/9337a28197d4dcf4efd0d94e8a8c2bb68ce3a911

Merge pull request #157 from plone/tg_subforms

Allow vocabulary to be called in subforms

Files changed:
M CHANGES.rst
M plone/app/content/browser/vocabulary.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 1a02e9e..f27d206 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,9 @@ Bug fixes:
 - Python 3 fixes.
   [pbauer]
 
+- Allow `getSources` vocabulary view to be called in subforms
+  [tomgross]
+
 3.5.2 (2018-04-08)
 ------------------
 
diff --git a/plone/app/content/browser/vocabulary.py b/plone/app/content/browser/vocabulary.py
index 27c8da0..8f7955a 100644
--- a/plone/app/content/browser/vocabulary.py
+++ b/plone/app/content/browser/vocabulary.py
@@ -16,6 +16,7 @@
 from Products.Five import BrowserView
 from Products.MimetypesRegistry.MimeTypeItem import guess_icon_path
 from types import FunctionType
+from z3c.form.interfaces import ISubForm
 from zope.component import getUtility
 from zope.component import queryAdapter
 from zope.component import queryUtility
@@ -355,7 +356,11 @@ class SourceView(BaseVocabularyView):
     """Queries a field's source and returns JSON-formatted results."""
 
     def get_context(self):
-        return self.context.context
+        if ISubForm.providedBy(self.context.form):
+            context = self.context.form.parentForm.context
+        else:
+            context = self.context.context
+        return context
 
     def get_vocabulary(self):
         widget = self.context


