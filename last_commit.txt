Repository: plone.stringinterp


Branch: refs/heads/master
Date: 2018-03-29T11:53:40+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.stringinterp/commit/a679adff80535fb845d696c2fb621a706995ae5a

fix relative import

Files changed:
M plone/stringinterp/__init__.py

b"diff --git a/plone/stringinterp/__init__.py b/plone/stringinterp/__init__.py\nindex 8e649ed..eb6d7c9 100644\n--- a/plone/stringinterp/__init__.py\n+++ b/plone/stringinterp/__init__.py\n@@ -1,4 +1,4 @@\n-from dollarReplace import Interpolator\n+from .dollarReplace import Interpolator\n \n from zope.i18nmessageid import MessageFactory\n _ = MessageFactory('plone')\n"

Repository: plone.stringinterp


Branch: refs/heads/master
Date: 2018-06-07T19:06:06+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.stringinterp/commit/41ceb4ae7462d28c5b3b014b8570d2e61c933e11

fix sorting in substitutionList in py3

Files changed:
M plone/stringinterp/browser.py

b"diff --git a/plone/stringinterp/browser.py b/plone/stringinterp/browser.py\nindex cd28882..b98801f 100644\n--- a/plone/stringinterp/browser.py\n+++ b/plone/stringinterp/browser.py\n@@ -54,11 +54,10 @@ def substitutionList(self):\n         res = []\n         keys = categories.keys()\n         # sort, ignoring case\n-        keys.sort(lambda a, b: cmp(a.lower(), b.lower()))\n-        for key in keys:\n+        for key in sorted(keys, key=lambda s: s.lower()):\n             acat = categories[key]\n             # sort by id, ignoring case\n-            acat.sort(lambda a, b: cmp(a['id'].lower(), b['id'].lower()))\n+            acat = sorted(acat, key=lambda i: i['id'].lower())\n             res.append({'category': key, 'items': acat})\n \n         return res\n"

Repository: plone.stringinterp


Branch: refs/heads/master
Date: 2018-06-22T09:33:13+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.stringinterp/commit/038aa15850ebd30502924d699265c1d33b796199

fix tests for py3

Files changed:
M plone/stringinterp/tests/interpolationTests.txt
M plone/stringinterp/tests/moreSubstitutionTests.txt
M plone/stringinterp/tests/substitutionTests.txt
M plone/stringinterp/tests/testDocTests.py
M plone/stringinterp/tests/wrapperTests.txt

b'diff --git a/plone/stringinterp/tests/interpolationTests.txt b/plone/stringinterp/tests/interpolationTests.txt\nindex d47d31e..1e78ff7 100644\n--- a/plone/stringinterp/tests/interpolationTests.txt\n+++ b/plone/stringinterp/tests/interpolationTests.txt\n@@ -23,7 +23,7 @@ Let\'s test basic interpolation using the homepage::\n     >>> apage = portal[\'front-page\']\n \n     >>> Interpolator(apage)(s)\n-    u\'one two three Welcome to Plone http://nohost/plone/front-page ${nonesuch}\'\n+    \'one two three Welcome to Plone http://nohost/plone/front-page ${nonesuch}\'\n \n \n That was a direct call. Let\'s do it by adapter, too, proving this\n@@ -31,17 +31,19 @@ may be swapped out.\n \n     >>> from plone.stringinterp.interfaces import IStringInterpolator\n     >>> IStringInterpolator(apage)(s)\n-    u\'one two three Welcome to Plone http://nohost/plone/front-page ${nonesuch}\'\n+    \'one two three Welcome to Plone http://nohost/plone/front-page ${nonesuch}\'\n \n \n Test caching scheme\n \n     >>> interpolator = IStringInterpolator(apage)\n     >>> interpolator(s)\n-    u\'one two three Welcome to Plone http://nohost/plone/front-page ${nonesuch}\'\n+    \'one two three Welcome to Plone http://nohost/plone/front-page ${nonesuch}\'\n+\n+    >>> expected = {\'url\': \'http://nohost/plone/front-page\', \'nonesuch\': \'_bad_\', \'title\': \'Welcome to Plone\'}\n+    >>> interpolator._ldict._cache == expected\n+    True\n \n-    >>> interpolator._ldict._cache\n-    {\'url\': u\'http://nohost/plone/front-page\', \'nonesuch\': u\'_bad_\', \'title\': u\'Welcome to Plone\'}\n \n Directly change cache\n \n@@ -50,4 +52,4 @@ Directly change cache\n And prove that the interpolator is using the cache\n \n     >>> interpolator(s)\n-    u\'one two three Welcome to Plone http://nohost/plone/front-page nothing much here\'\n+    \'one two three Welcome to Plone http://nohost/plone/front-page nothing much here\'\ndiff --git a/plone/stringinterp/tests/moreSubstitutionTests.txt b/plone/stringinterp/tests/moreSubstitutionTests.txt\nindex c07c5b8..6c47412 100644\n--- a/plone/stringinterp/tests/moreSubstitutionTests.txt\n+++ b/plone/stringinterp/tests/moreSubstitutionTests.txt\n@@ -101,7 +101,7 @@ Listing Available String Substitutions\n     <Products.Five...SubstitutionInfo object at ...>\n \n     >>> subinfo.substitutionList()[0][\'category\']\n-    u\'All Content\'\n+    \'All Content\'\n \n \n Basic Content\n@@ -115,28 +115,28 @@ Ask for an adapter to get the URL::\n     <plone.stringinterp.adapters.UrlSubstitution object at ...>\n \n     >>> adapter()\n-    u\'http://nohost/plone/sandbox/a-page\'\n+    \'http://nohost/plone/sandbox/a-page\'\n \n \'id\' is an alias for id::\n \n     >>> getAdapter(apage, IStringSubstitution, \'id\')()\n-    u\'a-page\'\n+    \'a-page\'\n \n \n \'parent_id\' is an alias for id::\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_id\')()\n-    u\'sandbox\'\n+    \'sandbox\'\n \n \'url\' is an alias for absolute_url::\n \n     >>> getAdapter(apage, IStringSubstitution, \'url\')()\n-    u\'http://nohost/plone/sandbox/a-page\'\n+    \'http://nohost/plone/sandbox/a-page\'\n \n \'parent_url\' is container url::\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_url\')()\n-    u\'http://nohost/plone/sandbox\'\n+    \'http://nohost/plone/sandbox\'\n \n \n Minimal Dublin Core\n@@ -145,12 +145,12 @@ Minimal Dublin Core\n Title\n \n     >>> getAdapter(apage, IStringSubstitution, \'title\')()\n-    u\'A page\'\n+    \'A page\'\n \n Parent title\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_title\')()\n-    u\'Sandbox\'\n+    \'Sandbox\'\n \n \n The rest of Minimal Dublin::\n@@ -158,19 +158,19 @@ The rest of Minimal Dublin::\n Description\n \n     >>> getAdapter(apage, IStringSubstitution, \'description\')()\n-    u\'This is a short summary\'\n+    \'This is a short summary\'\n \n Content type\n \n     >>> getAdapter(apage, IStringSubstitution, \'type\')()\n-    u\'Page\'\n+    \'Page\'\n \n \n Let\'s try some non-ASCII::\n \n-   >>> apage.setTitle(\'Plone in Espa\xc3\xb1ol\'.decode(\'utf8\'))\n-   >>> getAdapter(apage, IStringSubstitution, \'title\')().encode(\'utf8\')\n-   \'Plone in Espa\\xc3\\xb1ol\'\n+   >>> apage.setTitle(u\'Plone in Espa\xc3\xb1ol\')\n+   >>> getAdapter(apage, IStringSubstitution, \'title\')()\n+   \'Plone in Espa\xc3\xb1ol\'\n \n \n \n@@ -180,10 +180,10 @@ Workflow Aware\n Review State\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state\')()\n-    u\'private\'\n+    \'private\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state_title\')()\n-    u\'Private\'\n+    \'Private\'\n \n \n IDublinCore\n@@ -192,74 +192,74 @@ IDublinCore\n Creator\n \n     >>> getAdapter(apage, IStringSubstitution, \'creator\')()\n-    u\'test_user_1_\'\n+    \'test_user_1_\'\n \n     >>> apage.setCreators( (\'usertwo\', \'userfive\') )\n     >>> getAdapter(apage, IStringSubstitution, \'creator\')()\n-    u\'usertwo\'\n+    \'usertwo\'\n \n Creator Full Name\n \n     >>> getAdapter(apage, IStringSubstitution, \'creator_fullname\')()\n-    u\'User Two\'\n+    \'User Two\'\n \n Creator Email\n \n     >>> getAdapter(apage, IStringSubstitution, \'creator_email\')()\n-    u\'user@two.com\'\n+    \'user@two.com\'\n \n Creators\n \n     >>> getAdapter(apage, IStringSubstitution, \'creators\')()\n-    u\'usertwo, userfive\'\n+    \'usertwo, userfive\'\n \n Creators Emails\n \n     >>> getAdapter(apage, IStringSubstitution, \'creators_emails\')()\n-    u\'user@two.com, user@five.com\'\n+    \'user@two.com, user@five.com\'\n \n Contributors\n \n     >>> getAdapter(apage, IStringSubstitution, \'contributors\')()\n-    u\'contributor one, contributor two\'\n+    \'contributor one, contributor two\'\n \n Contributors Emails\n \n     >>> getAdapter(apage, IStringSubstitution, \'contributors_emails\')()\n-    u\'\'\n+    \'\'\n \n     >>> apage.setContributors( (\'userthree\', \'userfour\') )\n     >>> getAdapter(apage, IStringSubstitution, \'contributors_emails\')()\n-    u\'user@three.com, user@four.com\'\n+    \'user@three.com, user@four.com\'\n \n Subject\n     >>> getAdapter(apage, IStringSubstitution, \'subject\')()\n-    u\'keyword one, keyword two\'\n+    \'keyword one, keyword two\'\n \n Keywords (alias for subject)\n \n     >>> getAdapter(apage, IStringSubstitution, \'keywords\')()\n-    u\'keyword one, keyword two\'\n+    \'keyword one, keyword two\'\n \n Format\n \n     >>> getAdapter(apage, IStringSubstitution, \'format\')()\n-    u\'text/plain\'\n+    \'text/plain\'\n \n Language\n \n     >>> getAdapter(apage, IStringSubstitution, \'language\')()\n-    u\'en\'\n+    \'en\'\n \n Rights\n \n     >>> getAdapter(apage, IStringSubstitution, \'rights\')()\n-    u\'copyright me\'\n+    \'copyright me\'\n \n Identifier\n \n     >>> getAdapter(apage, IStringSubstitution, \'identifier\')()\n-     u\'http://nohost/plone/sandbox/a-page\'\n+     \'http://nohost/plone/sandbox/a-page\'\n \n \n \n@@ -297,27 +297,27 @@ IContentish -- emails for members having a role on context\n ----------------------------------------------------------\n \n     >>> getAdapter(apage, IStringSubstitution, \'owner_emails\')()\n-    u\'...user@three.com...\'\n+    \'...user@three.com...\'\n \n-    >>> getAdapter(apage, IStringSubstitution, \'reviewer_emails\')()\n-    u\'user@two.com, user@four.com\'\n+    >>> sorted(getAdapter(apage, IStringSubstitution, \'reviewer_emails\')().split(\', \'))\n+    [\'user@four.com\', \'user@two.com\']\n \n     >>> getAdapter(apage, IStringSubstitution, \'contributor_emails\')()\n-    u\'user@five.com\'\n+    \'user@five.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'editor_emails\')()\n-    u\'user@four.com\'\n+    \'user@four.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'reader_emails\')()\n-    u\'\'\n+    \'\'\n \n-    >>> getAdapter(apage, IStringSubstitution, \'manager_emails\')()\n-    u\'user@one.com, currentuser@foobar.com\'\n+    >>> sorted(getAdapter(apage, IStringSubstitution, \'manager_emails\')().split(\', \'))\n+    [\'currentuser@foobar.com\', \'user@one.com\']\n \n     >>> sorted(getAdapter(apage, IStringSubstitution, \'member_emails\')(\n     ...     ).split(\', \'))\n-    [u\'user@five.com\', u\'user@four.com\', u\'user@one.com\',\n-    u\'user@three.com\', u\'user@two.com\']\n+    [\'user@five.com\', \'user@four.com\', \'user@one.com\',\n+    \'user@three.com\', \'user@two.com\']\n \n When a user is removed from the user folder, the ownership\n information, local roles, and group memberships for that user can\n@@ -331,26 +331,26 @@ adapters can handle this case.\n     >>> login(portal, TEST_USER_NAME)\n \n     >>> getAdapter(apage, IStringSubstitution, \'owner_emails\')()\n-    u\'currentuser@foobar.com\'\n+    \'currentuser@foobar.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'reviewer_emails\')()\n-    u\'user@four.com\'\n+    \'user@four.com\'\n \n-    >>> getAdapter(apage, IStringSubstitution, \'manager_emails\')()\n-    u\'user@one.com, currentuser@foobar.com\'\n+    >>> sorted(getAdapter(apage, IStringSubstitution, \'manager_emails\')().split(\', \'))\n+    [\'currentuser@foobar.com\', \'user@one.com\']\n \n     >>> sorted(getAdapter(apage, IStringSubstitution, \'member_emails\')(\n     ...     ).split(\', \'))\n-    [u\'user@five.com\', u\'user@four.com\', u\'user@one.com\']\n+    [\'user@five.com\', \'user@four.com\', \'user@one.com\']\n \n IContentish -- info on current user\n -----------------------------------\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_email\')()\n-    u\'currentuser@foobar.com\'\n+    \'currentuser@foobar.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_fullname\')()\n-    u\'Current User\'\n+    \'Current User\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_id\')() == TEST_USER_ID\n     True\n@@ -369,17 +369,17 @@ Inspect a version change (the most recent change)\n Initial revision\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'change comment\'\n+    \'change comment\'\n \n Change title\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_title\')()\n-    u\'Edit\'\n+    \'Edit\'\n \n Change type\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_type\')()\n-    u\'versioning\'\n+    \'versioning\'\n \n Change author\n \n@@ -395,7 +395,7 @@ last change comment is unchanged.\n     >>> wf_tool.doActionFor(apage, \'publish\', comment=\'publish it!\')\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'change comment\'\n+    \'change comment\'\n \n Let\'s create a new object in order to bypass the caching; we\'ll\n use it to test a workflow change\n@@ -410,22 +410,22 @@ use it to test a workflow change\n Review state\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state\')()\n-    u\'published\'\n+    \'published\'\n \n Comment\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'publish it!\'\n+    \'publish it!\'\n \n Change title\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_title\')()\n-    u\'Publish\'\n+    \'Publish\'\n \n Change type\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_type\')()\n-    u\'workflow\'\n+    \'workflow\'\n \n Change author\n \n@@ -438,9 +438,9 @@ Portal infos\n Portal title\n \n     >>> getAdapter(apage, IStringSubstitution, \'portal_title\')()\n-    u\'Plone site\'\n+    \'Plone site\'\n \n Portal URL\n \n     >>> getAdapter(apage, IStringSubstitution, \'portal_url\')()\n-    u\'http://nohost/plone\'\n+    \'http://nohost/plone\'\ndiff --git a/plone/stringinterp/tests/substitutionTests.txt b/plone/stringinterp/tests/substitutionTests.txt\nindex f4d6eda..beb78ff 100644\n--- a/plone/stringinterp/tests/substitutionTests.txt\n+++ b/plone/stringinterp/tests/substitutionTests.txt\n@@ -86,7 +86,7 @@ Listing Available String Substitutions\n     <Products.Five...SubstitutionInfo object at ...>\n \n     >>> subinfo.substitutionList()[0][\'category\']\n-    u\'All Content\'\n+    \'All Content\'\n \n \n Basic Content\n@@ -100,28 +100,28 @@ Ask for an adapter to get the URL::\n     <plone.stringinterp.adapters.UrlSubstitution object at ...>\n \n     >>> adapter()\n-    u\'http://nohost/plone/front-page\'\n+    \'http://nohost/plone/front-page\'\n \n \'id\' is an alias for id::\n \n     >>> getAdapter(apage, IStringSubstitution, \'id\')()\n-    u\'front-page\'\n+    \'front-page\'\n \n \n \'parent_id\' is an alias for id::\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_id\')()\n-    u\'plone\'\n+    \'plone\'\n \n \'url\' is an alias for absolute_url::\n \n     >>> getAdapter(apage, IStringSubstitution, \'url\')()\n-    u\'http://nohost/plone/front-page\'\n+    \'http://nohost/plone/front-page\'\n \n \'parent_url\' is container url::\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_url\')()\n-    u\'http://nohost/plone\'\n+    \'http://nohost/plone\'\n \n \n Minimal Dublin Core\n@@ -130,12 +130,12 @@ Minimal Dublin Core\n Title\n \n     >>> getAdapter(apage, IStringSubstitution, \'title\')()\n-    u\'Welcome to Plone\'\n+    \'Welcome to Plone\'\n \n Parent title\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_title\')()\n-    u\'Plone site\'\n+    \'Plone site\'\n \n \n The rest of Minimal Dublin::\n@@ -143,19 +143,19 @@ The rest of Minimal Dublin::\n Description\n \n     >>> getAdapter(apage, IStringSubstitution, \'description\')()\n-    u\'Congratulations! You have successfully installed Plone.\'\n+    \'Congratulations! You have successfully installed Plone.\'\n \n Content type\n \n     >>> getAdapter(apage, IStringSubstitution, \'type\')()\n-    u\'Page\'\n+    \'Page\'\n \n \n Let\'s try some non-ASCII::\n \n-   >>> apage.setTitle(\'Plone in Espa\xc3\xb1ol\'.decode(\'utf8\'))\n-   >>> getAdapter(apage, IStringSubstitution, \'title\')().encode(\'utf8\')\n-   \'Plone in Espa\\xc3\\xb1ol\'\n+   >>> apage.setTitle(u\'Plone in Espa\xc3\xb1ol\')\n+   >>> getAdapter(apage, IStringSubstitution, \'title\')()\n+   \'Plone in Espa\xc3\xb1ol\'\n \n \n \n@@ -165,10 +165,10 @@ Workflow Aware\n Review State\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state\')()\n-    u\'published\'\n+    \'published\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state_title\')()\n-    u\'Published\'\n+    \'Published\'\n \n \n IDublinCore\n@@ -177,41 +177,41 @@ IDublinCore\n Creators\n \n     >>> getAdapter(apage, IStringSubstitution, \'creators\')()\n-    u\'admin\'\n+    \'admin\'\n \n Contributors\n \n     >>> getAdapter(apage, IStringSubstitution, \'contributors\')()\n-    u\'contributor one, contributor two\'\n+    \'contributor one, contributor two\'\n \n Subject\n     >>> getAdapter(apage, IStringSubstitution, \'subject\')()\n-    u\'keyword one, keyword two\'\n+    \'keyword one, keyword two\'\n \n Keywords (alias for subject)\n \n     >>> getAdapter(apage, IStringSubstitution, \'keywords\')()\n-    u\'keyword one, keyword two\'\n+    \'keyword one, keyword two\'\n \n Format\n \n     >>> getAdapter(apage, IStringSubstitution, \'format\')()\n-    u\'text/plain\'\n+    \'text/plain\'\n \n Language\n \n     >>> getAdapter(apage, IStringSubstitution, \'language\')()\n-    u\'en\'\n+    \'en\'\n \n Rights\n \n     >>> getAdapter(apage, IStringSubstitution, \'rights\')()\n-    u\'copyright me\'\n+    \'copyright me\'\n \n Identifier\n \n     >>> getAdapter(apage, IStringSubstitution, \'identifier\')()\n-     u\'http://nohost/plone/front-page\'\n+     \'http://nohost/plone/front-page\'\n \n \n \n@@ -251,27 +251,30 @@ IContentish -- emails for members having a role on context\n ----------------------------------------------------------\n \n     >>> getAdapter(apage, IStringSubstitution, \'owner_emails\')()\n-    u\'user@three.com\'\n+    \'user@three.com\'\n \n-    >>> getAdapter(apage, IStringSubstitution, \'reviewer_emails\')()\n-    u\'user@two.com, user@four.com\'\n+    >>> result = getAdapter(apage, IStringSubstitution, \'reviewer_emails\')()\n+    >>> u\'user@four.com\' in result\n+    True\n+    >>> u\'user@two.com\' in result\n+    True\n \n     >>> getAdapter(apage, IStringSubstitution, \'contributor_emails\')()\n-    u\'user@five.com\'\n+    \'user@five.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'editor_emails\')()\n-    u\'user@four.com\'\n+    \'user@four.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'reader_emails\')()\n-    u\'\'\n+    \'\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'manager_emails\')()\n-    u\'user@one.com\'\n+    \'user@one.com\'\n \n     >>> sorted(getAdapter(apage, IStringSubstitution, \'member_emails\')(\n     ...     ).split(\', \'))\n-    [u\'currentuser@foobar.com\', u\'user@five.com\', u\'user@four.com\', u\'user@one.com\',\n-     u\'user@three.com\', u\'user@two.com\']\n+    [\'currentuser@foobar.com\', \'user@five.com\', \'user@four.com\', \'user@one.com\',\n+     \'user@three.com\', \'user@two.com\']\n \n When a user is removed from the user folder, the ownership\n information, local roles, and group memberships for that user can\n@@ -285,26 +288,26 @@ adapters can handle this case.\n     >>> login(portal, TEST_USER_NAME)\n \n     >>> getAdapter(apage, IStringSubstitution, \'owner_emails\')()\n-    u\'\'\n+    \'\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'reviewer_emails\')()\n-    u\'user@four.com\'\n+    \'user@four.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'manager_emails\')()\n-    u\'user@one.com\'\n+    \'user@one.com\'\n \n     >>> sorted(getAdapter(apage, IStringSubstitution, \'member_emails\')(\n     ...     ).split(\', \'))\n-    [u\'currentuser@foobar.com\', u\'user@five.com\', u\'user@four.com\', u\'user@one.com\']\n+    [\'currentuser@foobar.com\', \'user@five.com\', \'user@four.com\', \'user@one.com\']\n \n IContentish -- info on current user\n -----------------------------------\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_email\')()\n-    u\'currentuser@foobar.com\'\n+    \'currentuser@foobar.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_fullname\')()\n-    u\'Current User\'\n+    \'Current User\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_id\')() == TEST_USER_ID\n     True\n@@ -323,17 +326,17 @@ Inspect a version change (the most recent change)\n Initial revision\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'change comment\'\n+    \'change comment\'\n \n Change title\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_title\')()\n-    u\'Edit\'\n+    \'Edit\'\n \n Change type\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_type\')()\n-    u\'versioning\'\n+    \'versioning\'\n \n Change author\n \n@@ -349,7 +352,7 @@ last change comment is unchanged.\n     >>> wf_tool.doActionFor(apage, \'retract\', comment=\'retract it!\')\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'change comment\'\n+    \'change comment\'\n \n Let\'s create a new object in order to bypass the caching; we\'ll\n use it to test a workflow change\n@@ -364,22 +367,22 @@ use it to test a workflow change\n Review state\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state\')()\n-    u\'published\'\n+    \'published\'\n \n Comment\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'publish it!\'\n+    \'publish it!\'\n \n Change title\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_title\')()\n-    u\'Publish\'\n+    \'Publish\'\n \n Change type\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_type\')()\n-    u\'workflow\'\n+    \'workflow\'\n \n Change author\n \n@@ -392,9 +395,9 @@ Portal infos\n Portal title\n \n     >>> getAdapter(apage, IStringSubstitution, \'portal_title\')()\n-    u\'Plone site\'\n+    \'Plone site\'\n \n Portal URL\n \n     >>> getAdapter(apage, IStringSubstitution, \'portal_url\')()\n-    u\'http://nohost/plone\'\n+    \'http://nohost/plone\'\ndiff --git a/plone/stringinterp/tests/testDocTests.py b/plone/stringinterp/tests/testDocTests.py\nindex 3e35c1d..98e185f 100644\n--- a/plone/stringinterp/tests/testDocTests.py\n+++ b/plone/stringinterp/tests/testDocTests.py\n@@ -4,6 +4,8 @@\n     PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n )\n import doctest\n+import re\n+import six\n import unittest\n \n \n@@ -15,11 +17,22 @@\n )\n \n \n+class Py23DocChecker(doctest.OutputChecker):\n+    def check_output(self, want, got, optionflags):\n+        if six.PY2:\n+            got = re.sub("u\'(.*?)\'", "\'\\\\1\'", got)\n+        return doctest.OutputChecker.check_output(self, want, got, optionflags)\n+\n+\n def test_suite():\n     return unittest.TestSuite([\n-        layered(doctest.DocFileSuite(\n-            f, package=\'plone.stringinterp.tests\',\n-            optionflags=doctest.NORMALIZE_WHITESPACE | doctest.ELLIPSIS),\n-                layer=PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING)\n-                for f in testfiles\n+        layered(\n+            doctest.DocFileSuite(\n+                f,\n+                package=\'plone.stringinterp.tests\',\n+                optionflags=doctest.NORMALIZE_WHITESPACE | doctest.ELLIPSIS,\n+                checker=Py23DocChecker(),\n+            ),\n+            layer=PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING,\n+            ) for f in testfiles\n         ])\ndiff --git a/plone/stringinterp/tests/wrapperTests.txt b/plone/stringinterp/tests/wrapperTests.txt\nindex 7edf6c9..1e70055 100644\n--- a/plone/stringinterp/tests/wrapperTests.txt\n+++ b/plone/stringinterp/tests/wrapperTests.txt\n@@ -84,7 +84,7 @@ Get custom messages from Wrapper\n \n     >>> sm.registerAdapter(CustomMessageSubstitution, (Interface, ), IStringSubstitution, name=u"custom_message")\n     >>> getAdapter(apage, IStringSubstitution, \'custom_message\')()\n-    u\'A cool message here\'\n+    \'A cool message here\'\n \n     >>> class CustomItemsSubstitution(BaseSubstitution):\n     ...     def safe_call(self):\n@@ -135,7 +135,7 @@ Listing Available String Substitutions\n     <Products.Five...SubstitutionInfo object at ...>\n \n     >>> subinfo.substitutionList()[0][\'category\']\n-    u\'All Content\'\n+    \'All Content\'\n \n \n Basic Content\n@@ -149,28 +149,28 @@ Ask for an adapter to get the URL::\n     <plone.stringinterp.adapters.UrlSubstitution object at ...>\n \n     >>> adapter()\n-    u\'http://nohost/plone/front-page\'\n+    \'http://nohost/plone/front-page\'\n \n \'id\' is an alias for id::\n \n     >>> getAdapter(apage, IStringSubstitution, \'id\')()\n-    u\'front-page\'\n+    \'front-page\'\n \n \n \'parent_id\' is an alias for id::\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_id\')()\n-    u\'plone\'\n+    \'plone\'\n \n \'url\' is an alias for absolute_url::\n \n     >>> getAdapter(apage, IStringSubstitution, \'url\')()\n-    u\'http://nohost/plone/front-page\'\n+    \'http://nohost/plone/front-page\'\n \n \'parent_url\' is container url::\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_url\')()\n-    u\'http://nohost/plone\'\n+    \'http://nohost/plone\'\n \n \n Minimal Dublin Core\n@@ -179,12 +179,12 @@ Minimal Dublin Core\n Title\n \n     >>> getAdapter(apage, IStringSubstitution, \'title\')()\n-    u\'Welcome to Plone\'\n+    \'Welcome to Plone\'\n \n Parent title\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_title\')()\n-    u\'Plone site\'\n+    \'Plone site\'\n \n \n The rest of Minimal Dublin::\n@@ -192,19 +192,19 @@ The rest of Minimal Dublin::\n Description\n \n     >>> getAdapter(apage, IStringSubstitution, \'description\')()\n-    u\'Congratulations! You have successfully installed Plone.\'\n+    \'Congratulations! You have successfully installed Plone.\'\n \n Content type\n \n     >>> getAdapter(apage, IStringSubstitution, \'type\')()\n-    u\'Page\'\n+    \'Page\'\n \n \n Let\'s try some non-ASCII::\n \n-   >>> apage.setTitle(\'Plone in Espa\xc3\xb1ol\'.decode(\'utf8\'))\n-   >>> getAdapter(apage, IStringSubstitution, \'title\')().encode(\'utf8\')\n-   \'Plone in Espa\\xc3\\xb1ol\'\n+   >>> apage.setTitle(u\'Plone in Espa\xc3\xb1ol\')\n+   >>> getAdapter(apage, IStringSubstitution, \'title\')()\n+   \'Plone in Espa\xc3\xb1ol\'\n \n \n \n@@ -214,10 +214,10 @@ Workflow Aware\n Review State\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state\')()\n-    u\'published\'\n+    \'published\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state_title\')()\n-    u\'Published\'\n+    \'Published\'\n \n \n IDublinCore\n@@ -226,41 +226,41 @@ IDublinCore\n Creators\n \n     >>> getAdapter(apage, IStringSubstitution, \'creators\')()\n-    u\'admin\'\n+    \'admin\'\n \n Contributors\n \n     >>> getAdapter(apage, IStringSubstitution, \'contributors\')()\n-    u\'contributor one, contributor two\'\n+    \'contributor one, contributor two\'\n \n Subject\n     >>> getAdapter(apage, IStringSubstitution, \'subject\')()\n-    u\'keyword one, keyword two\'\n+    \'keyword one, keyword two\'\n \n Keywords (alias for subject)\n \n     >>> getAdapter(apage, IStringSubstitution, \'keywords\')()\n-    u\'keyword one, keyword two\'\n+    \'keyword one, keyword two\'\n \n Format\n \n     >>> getAdapter(apage, IStringSubstitution, \'format\')()\n-    u\'text/plain\'\n+    \'text/plain\'\n \n Language\n \n     >>> getAdapter(apage, IStringSubstitution, \'language\')()\n-    u\'en\'\n+    \'en\'\n \n Rights\n \n     >>> getAdapter(apage, IStringSubstitution, \'rights\')()\n-    u\'copyright me\'\n+    \'copyright me\'\n \n Identifier\n \n     >>> getAdapter(apage, IStringSubstitution, \'identifier\')()\n-     u\'http://nohost/plone/front-page\'\n+     \'http://nohost/plone/front-page\'\n \n \n \n@@ -300,27 +300,27 @@ IContentish -- emails for members having a role on context\n ----------------------------------------------------------\n \n     >>> getAdapter(apage, IStringSubstitution, \'owner_emails\')()\n-    u\'user@three.com\'\n+    \'user@three.com\'\n \n-    >>> getAdapter(apage, IStringSubstitution, \'reviewer_emails\')()\n-    u\'user@two.com, user@four.com\'\n+    >>> sorted(getAdapter(apage, IStringSubstitution, \'reviewer_emails\')().split(\', \'))\n+    [\'user@four.com\', \'user@two.com\']\n \n     >>> getAdapter(apage, IStringSubstitution, \'contributor_emails\')()\n-    u\'user@five.com\'\n+    \'user@five.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'editor_emails\')()\n-    u\'user@four.com\'\n+    \'user@four.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'reader_emails\')()\n-    u\'\'\n+    \'\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'manager_emails\')()\n-    u\'user@one.com\'\n+    \'user@one.com\'\n \n     >>> sorted(getAdapter(apage, IStringSubstitution, \'member_emails\')(\n     ...     ).split(\', \'))\n-    [u\'currentuser@foobar.com\', u\'user@five.com\', u\'user@four.com\', u\'user@one.com\',\n-     u\'user@three.com\', u\'user@two.com\']\n+    [\'currentuser@foobar.com\', \'user@five.com\', \'user@four.com\', \'user@one.com\',\n+     \'user@three.com\', \'user@two.com\']\n \n When a user is removed from the user folder, the ownership\n information, local roles, and group memberships for that user can\n@@ -334,26 +334,26 @@ adapters can handle this case.\n     >>> login(portal, TEST_USER_NAME)\n \n     >>> getAdapter(apage, IStringSubstitution, \'owner_emails\')()\n-    u\'\'\n+    \'\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'reviewer_emails\')()\n-    u\'user@four.com\'\n+    \'user@four.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'manager_emails\')()\n-    u\'user@one.com\'\n+    \'user@one.com\'\n \n     >>> sorted(getAdapter(apage, IStringSubstitution, \'member_emails\')(\n     ...     ).split(\', \'))\n-    [u\'currentuser@foobar.com\', u\'user@five.com\', u\'user@four.com\', u\'user@one.com\']\n+    [\'currentuser@foobar.com\', \'user@five.com\', \'user@four.com\', \'user@one.com\']\n \n IContentish -- info on current user\n -----------------------------------\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_email\')()\n-    u\'currentuser@foobar.com\'\n+    \'currentuser@foobar.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_fullname\')()\n-    u\'Current User\'\n+    \'Current User\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_id\')() == TEST_USER_ID\n     True\n@@ -372,17 +372,17 @@ Inspect a version change (the most recent change)\n Initial revision\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'change comment\'\n+    \'change comment\'\n \n Change title\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_title\')()\n-    u\'Edit\'\n+    \'Edit\'\n \n Change type\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_type\')()\n-    u\'versioning\'\n+    \'versioning\'\n \n Change author\n \n@@ -398,7 +398,7 @@ last change comment is unchanged.\n     >>> wf_tool.doActionFor(apage.context, \'retract\', comment=\'retract it!\')\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'change comment\'\n+    \'change comment\'\n \n Let\'s create a new object in order to bypass the caching; we\'ll\n use it to test a workflow change\n@@ -418,22 +418,22 @@ use it to test a workflow change\n Review state\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state\')()\n-    u\'published\'\n+    \'published\'\n \n Comment\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'publish it!\'\n+    \'publish it!\'\n \n Change title\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_title\')()\n-    u\'Publish\'\n+    \'Publish\'\n \n Change type\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_type\')()\n-    u\'workflow\'\n+    \'workflow\'\n \n Change author\n \n@@ -446,9 +446,9 @@ Portal infos\n Portal title\n \n     >>> getAdapter(apage, IStringSubstitution, \'portal_title\')()\n-    u\'Plone site\'\n+    \'Plone site\'\n \n Portal URL\n \n     >>> getAdapter(apage, IStringSubstitution, \'portal_url\')()\n-    u\'http://nohost/plone\'\n+    \'http://nohost/plone\'\n'

Repository: plone.stringinterp


Branch: refs/heads/master
Date: 2018-06-22T09:56:02+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.stringinterp/commit/017b2813bdedd9a732f1bbcc42daa161c196b767

fix tests for py2

Files changed:
M plone/stringinterp/tests/moreSubstitutionTests.txt
M plone/stringinterp/tests/substitutionTests.txt
M plone/stringinterp/tests/wrapperTests.txt

b"diff --git a/plone/stringinterp/tests/moreSubstitutionTests.txt b/plone/stringinterp/tests/moreSubstitutionTests.txt\nindex 6c47412..f3f17b4 100644\n--- a/plone/stringinterp/tests/moreSubstitutionTests.txt\n+++ b/plone/stringinterp/tests/moreSubstitutionTests.txt\n@@ -168,9 +168,13 @@ Content type\n \n Let's try some non-ASCII::\n \n-   >>> apage.setTitle(u'Plone in Espa\xc3\xb1ol')\n+   >>> import six\n+   >>> if six.PY2:\n+   ...     apage.setTitle('Plone in Espa\xc3\xb1ol'.decode('utf8'))\n+   ... else:\n+   ...     apage.setTitle('Plone in Espa\xc3\xb1ol')\n    >>> getAdapter(apage, IStringSubstitution, 'title')()\n-   'Plone in Espa\xc3\xb1ol'\n+   'Plone in Espa\\xf1ol'\n \n \n \ndiff --git a/plone/stringinterp/tests/substitutionTests.txt b/plone/stringinterp/tests/substitutionTests.txt\nindex beb78ff..f328f0d 100644\n--- a/plone/stringinterp/tests/substitutionTests.txt\n+++ b/plone/stringinterp/tests/substitutionTests.txt\n@@ -153,11 +153,13 @@ Content type\n \n Let's try some non-ASCII::\n \n-   >>> apage.setTitle(u'Plone in Espa\xc3\xb1ol')\n+   >>> import six\n+   >>> if six.PY2:\n+   ...     apage.setTitle('Plone in Espa\xc3\xb1ol'.decode('utf8'))\n+   ... else:\n+   ...     apage.setTitle('Plone in Espa\xc3\xb1ol')\n    >>> getAdapter(apage, IStringSubstitution, 'title')()\n-   'Plone in Espa\xc3\xb1ol'\n-\n-\n+   'Plone in Espa\\xf1ol'\n \n Workflow Aware\n --------------\ndiff --git a/plone/stringinterp/tests/wrapperTests.txt b/plone/stringinterp/tests/wrapperTests.txt\nindex 1e70055..470c25c 100644\n--- a/plone/stringinterp/tests/wrapperTests.txt\n+++ b/plone/stringinterp/tests/wrapperTests.txt\n@@ -202,9 +202,13 @@ Content type\n \n Let's try some non-ASCII::\n \n-   >>> apage.setTitle(u'Plone in Espa\xc3\xb1ol')\n+   >>> import six\n+   >>> if six.PY2:\n+   ...     apage.setTitle('Plone in Espa\xc3\xb1ol'.decode('utf8'))\n+   ... else:\n+   ...     apage.setTitle('Plone in Espa\xc3\xb1ol')\n    >>> getAdapter(apage, IStringSubstitution, 'title')()\n-   'Plone in Espa\xc3\xb1ol'\n+   'Plone in Espa\\xf1ol'\n \n \n \n"

Repository: plone.stringinterp


Branch: refs/heads/master
Date: 2018-09-18T15:45:49+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.stringinterp/commit/e35a6da2c2572fafdecab9ace2dfc6cc07bd1a24

add changelog and classifiers

Files changed:
M CHANGES.rst
M setup.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 7770365..0f1e92b 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -10,7 +10,8 @@ Breaking changes:\n \n New features:\n \n-- *add item here*\n+- Add support for Python 3.\n+  [pbauer]\n \n Bug fixes:\n \ndiff --git a/setup.py b/setup.py\nindex 1927e0a..213476d 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -13,11 +13,14 @@\n         "Framework :: Plone",\n         "Framework :: Plone :: 5.0",\n         "Framework :: Plone :: 5.1",\n+        "Framework :: Plone :: 5.2",\n         "Framework :: Zope2",\n         "License :: OSI Approved :: GNU General Public License v2 (GPLv2)",\n         "Operating System :: OS Independent",\n         "Programming Language :: Python",\n         "Programming Language :: Python :: 2.7",\n+        "Programming Language :: Python :: 3.6",\n+        "Programming Language :: Python :: 3.7",\n     ],\n     keywords=\'Plone Zope Interpolation\',\n     author=\'Plone Foundation\',\n'

Repository: plone.stringinterp


Branch: refs/heads/master
Date: 2018-09-18T18:29:26+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.stringinterp/commit/68288794ecae31ceb47fba4b6be1a1611b758762

Merge pull request #12 from plone/python3

Python 3

Files changed:
M CHANGES.rst
M plone/stringinterp/__init__.py
M plone/stringinterp/browser.py
M plone/stringinterp/tests/interpolationTests.txt
M plone/stringinterp/tests/moreSubstitutionTests.txt
M plone/stringinterp/tests/substitutionTests.txt
M plone/stringinterp/tests/testDocTests.py
M plone/stringinterp/tests/wrapperTests.txt
M setup.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 7770365..0f1e92b 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -10,7 +10,8 @@ Breaking changes:\n \n New features:\n \n-- *add item here*\n+- Add support for Python 3.\n+  [pbauer]\n \n Bug fixes:\n \ndiff --git a/plone/stringinterp/__init__.py b/plone/stringinterp/__init__.py\nindex 8e649ed..eb6d7c9 100644\n--- a/plone/stringinterp/__init__.py\n+++ b/plone/stringinterp/__init__.py\n@@ -1,4 +1,4 @@\n-from dollarReplace import Interpolator\n+from .dollarReplace import Interpolator\n \n from zope.i18nmessageid import MessageFactory\n _ = MessageFactory(\'plone\')\ndiff --git a/plone/stringinterp/browser.py b/plone/stringinterp/browser.py\nindex cd28882..b98801f 100644\n--- a/plone/stringinterp/browser.py\n+++ b/plone/stringinterp/browser.py\n@@ -54,11 +54,10 @@ def substitutionList(self):\n         res = []\n         keys = categories.keys()\n         # sort, ignoring case\n-        keys.sort(lambda a, b: cmp(a.lower(), b.lower()))\n-        for key in keys:\n+        for key in sorted(keys, key=lambda s: s.lower()):\n             acat = categories[key]\n             # sort by id, ignoring case\n-            acat.sort(lambda a, b: cmp(a[\'id\'].lower(), b[\'id\'].lower()))\n+            acat = sorted(acat, key=lambda i: i[\'id\'].lower())\n             res.append({\'category\': key, \'items\': acat})\n \n         return res\ndiff --git a/plone/stringinterp/tests/interpolationTests.txt b/plone/stringinterp/tests/interpolationTests.txt\nindex d47d31e..1e78ff7 100644\n--- a/plone/stringinterp/tests/interpolationTests.txt\n+++ b/plone/stringinterp/tests/interpolationTests.txt\n@@ -23,7 +23,7 @@ Let\'s test basic interpolation using the homepage::\n     >>> apage = portal[\'front-page\']\n \n     >>> Interpolator(apage)(s)\n-    u\'one two three Welcome to Plone http://nohost/plone/front-page ${nonesuch}\'\n+    \'one two three Welcome to Plone http://nohost/plone/front-page ${nonesuch}\'\n \n \n That was a direct call. Let\'s do it by adapter, too, proving this\n@@ -31,17 +31,19 @@ may be swapped out.\n \n     >>> from plone.stringinterp.interfaces import IStringInterpolator\n     >>> IStringInterpolator(apage)(s)\n-    u\'one two three Welcome to Plone http://nohost/plone/front-page ${nonesuch}\'\n+    \'one two three Welcome to Plone http://nohost/plone/front-page ${nonesuch}\'\n \n \n Test caching scheme\n \n     >>> interpolator = IStringInterpolator(apage)\n     >>> interpolator(s)\n-    u\'one two three Welcome to Plone http://nohost/plone/front-page ${nonesuch}\'\n+    \'one two three Welcome to Plone http://nohost/plone/front-page ${nonesuch}\'\n+\n+    >>> expected = {\'url\': \'http://nohost/plone/front-page\', \'nonesuch\': \'_bad_\', \'title\': \'Welcome to Plone\'}\n+    >>> interpolator._ldict._cache == expected\n+    True\n \n-    >>> interpolator._ldict._cache\n-    {\'url\': u\'http://nohost/plone/front-page\', \'nonesuch\': u\'_bad_\', \'title\': u\'Welcome to Plone\'}\n \n Directly change cache\n \n@@ -50,4 +52,4 @@ Directly change cache\n And prove that the interpolator is using the cache\n \n     >>> interpolator(s)\n-    u\'one two three Welcome to Plone http://nohost/plone/front-page nothing much here\'\n+    \'one two three Welcome to Plone http://nohost/plone/front-page nothing much here\'\ndiff --git a/plone/stringinterp/tests/moreSubstitutionTests.txt b/plone/stringinterp/tests/moreSubstitutionTests.txt\nindex c07c5b8..f3f17b4 100644\n--- a/plone/stringinterp/tests/moreSubstitutionTests.txt\n+++ b/plone/stringinterp/tests/moreSubstitutionTests.txt\n@@ -101,7 +101,7 @@ Listing Available String Substitutions\n     <Products.Five...SubstitutionInfo object at ...>\n \n     >>> subinfo.substitutionList()[0][\'category\']\n-    u\'All Content\'\n+    \'All Content\'\n \n \n Basic Content\n@@ -115,28 +115,28 @@ Ask for an adapter to get the URL::\n     <plone.stringinterp.adapters.UrlSubstitution object at ...>\n \n     >>> adapter()\n-    u\'http://nohost/plone/sandbox/a-page\'\n+    \'http://nohost/plone/sandbox/a-page\'\n \n \'id\' is an alias for id::\n \n     >>> getAdapter(apage, IStringSubstitution, \'id\')()\n-    u\'a-page\'\n+    \'a-page\'\n \n \n \'parent_id\' is an alias for id::\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_id\')()\n-    u\'sandbox\'\n+    \'sandbox\'\n \n \'url\' is an alias for absolute_url::\n \n     >>> getAdapter(apage, IStringSubstitution, \'url\')()\n-    u\'http://nohost/plone/sandbox/a-page\'\n+    \'http://nohost/plone/sandbox/a-page\'\n \n \'parent_url\' is container url::\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_url\')()\n-    u\'http://nohost/plone/sandbox\'\n+    \'http://nohost/plone/sandbox\'\n \n \n Minimal Dublin Core\n@@ -145,12 +145,12 @@ Minimal Dublin Core\n Title\n \n     >>> getAdapter(apage, IStringSubstitution, \'title\')()\n-    u\'A page\'\n+    \'A page\'\n \n Parent title\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_title\')()\n-    u\'Sandbox\'\n+    \'Sandbox\'\n \n \n The rest of Minimal Dublin::\n@@ -158,19 +158,23 @@ The rest of Minimal Dublin::\n Description\n \n     >>> getAdapter(apage, IStringSubstitution, \'description\')()\n-    u\'This is a short summary\'\n+    \'This is a short summary\'\n \n Content type\n \n     >>> getAdapter(apage, IStringSubstitution, \'type\')()\n-    u\'Page\'\n+    \'Page\'\n \n \n Let\'s try some non-ASCII::\n \n-   >>> apage.setTitle(\'Plone in Espa\xc3\xb1ol\'.decode(\'utf8\'))\n-   >>> getAdapter(apage, IStringSubstitution, \'title\')().encode(\'utf8\')\n-   \'Plone in Espa\\xc3\\xb1ol\'\n+   >>> import six\n+   >>> if six.PY2:\n+   ...     apage.setTitle(\'Plone in Espa\xc3\xb1ol\'.decode(\'utf8\'))\n+   ... else:\n+   ...     apage.setTitle(\'Plone in Espa\xc3\xb1ol\')\n+   >>> getAdapter(apage, IStringSubstitution, \'title\')()\n+   \'Plone in Espa\\xf1ol\'\n \n \n \n@@ -180,10 +184,10 @@ Workflow Aware\n Review State\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state\')()\n-    u\'private\'\n+    \'private\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state_title\')()\n-    u\'Private\'\n+    \'Private\'\n \n \n IDublinCore\n@@ -192,74 +196,74 @@ IDublinCore\n Creator\n \n     >>> getAdapter(apage, IStringSubstitution, \'creator\')()\n-    u\'test_user_1_\'\n+    \'test_user_1_\'\n \n     >>> apage.setCreators( (\'usertwo\', \'userfive\') )\n     >>> getAdapter(apage, IStringSubstitution, \'creator\')()\n-    u\'usertwo\'\n+    \'usertwo\'\n \n Creator Full Name\n \n     >>> getAdapter(apage, IStringSubstitution, \'creator_fullname\')()\n-    u\'User Two\'\n+    \'User Two\'\n \n Creator Email\n \n     >>> getAdapter(apage, IStringSubstitution, \'creator_email\')()\n-    u\'user@two.com\'\n+    \'user@two.com\'\n \n Creators\n \n     >>> getAdapter(apage, IStringSubstitution, \'creators\')()\n-    u\'usertwo, userfive\'\n+    \'usertwo, userfive\'\n \n Creators Emails\n \n     >>> getAdapter(apage, IStringSubstitution, \'creators_emails\')()\n-    u\'user@two.com, user@five.com\'\n+    \'user@two.com, user@five.com\'\n \n Contributors\n \n     >>> getAdapter(apage, IStringSubstitution, \'contributors\')()\n-    u\'contributor one, contributor two\'\n+    \'contributor one, contributor two\'\n \n Contributors Emails\n \n     >>> getAdapter(apage, IStringSubstitution, \'contributors_emails\')()\n-    u\'\'\n+    \'\'\n \n     >>> apage.setContributors( (\'userthree\', \'userfour\') )\n     >>> getAdapter(apage, IStringSubstitution, \'contributors_emails\')()\n-    u\'user@three.com, user@four.com\'\n+    \'user@three.com, user@four.com\'\n \n Subject\n     >>> getAdapter(apage, IStringSubstitution, \'subject\')()\n-    u\'keyword one, keyword two\'\n+    \'keyword one, keyword two\'\n \n Keywords (alias for subject)\n \n     >>> getAdapter(apage, IStringSubstitution, \'keywords\')()\n-    u\'keyword one, keyword two\'\n+    \'keyword one, keyword two\'\n \n Format\n \n     >>> getAdapter(apage, IStringSubstitution, \'format\')()\n-    u\'text/plain\'\n+    \'text/plain\'\n \n Language\n \n     >>> getAdapter(apage, IStringSubstitution, \'language\')()\n-    u\'en\'\n+    \'en\'\n \n Rights\n \n     >>> getAdapter(apage, IStringSubstitution, \'rights\')()\n-    u\'copyright me\'\n+    \'copyright me\'\n \n Identifier\n \n     >>> getAdapter(apage, IStringSubstitution, \'identifier\')()\n-     u\'http://nohost/plone/sandbox/a-page\'\n+     \'http://nohost/plone/sandbox/a-page\'\n \n \n \n@@ -297,27 +301,27 @@ IContentish -- emails for members having a role on context\n ----------------------------------------------------------\n \n     >>> getAdapter(apage, IStringSubstitution, \'owner_emails\')()\n-    u\'...user@three.com...\'\n+    \'...user@three.com...\'\n \n-    >>> getAdapter(apage, IStringSubstitution, \'reviewer_emails\')()\n-    u\'user@two.com, user@four.com\'\n+    >>> sorted(getAdapter(apage, IStringSubstitution, \'reviewer_emails\')().split(\', \'))\n+    [\'user@four.com\', \'user@two.com\']\n \n     >>> getAdapter(apage, IStringSubstitution, \'contributor_emails\')()\n-    u\'user@five.com\'\n+    \'user@five.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'editor_emails\')()\n-    u\'user@four.com\'\n+    \'user@four.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'reader_emails\')()\n-    u\'\'\n+    \'\'\n \n-    >>> getAdapter(apage, IStringSubstitution, \'manager_emails\')()\n-    u\'user@one.com, currentuser@foobar.com\'\n+    >>> sorted(getAdapter(apage, IStringSubstitution, \'manager_emails\')().split(\', \'))\n+    [\'currentuser@foobar.com\', \'user@one.com\']\n \n     >>> sorted(getAdapter(apage, IStringSubstitution, \'member_emails\')(\n     ...     ).split(\', \'))\n-    [u\'user@five.com\', u\'user@four.com\', u\'user@one.com\',\n-    u\'user@three.com\', u\'user@two.com\']\n+    [\'user@five.com\', \'user@four.com\', \'user@one.com\',\n+    \'user@three.com\', \'user@two.com\']\n \n When a user is removed from the user folder, the ownership\n information, local roles, and group memberships for that user can\n@@ -331,26 +335,26 @@ adapters can handle this case.\n     >>> login(portal, TEST_USER_NAME)\n \n     >>> getAdapter(apage, IStringSubstitution, \'owner_emails\')()\n-    u\'currentuser@foobar.com\'\n+    \'currentuser@foobar.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'reviewer_emails\')()\n-    u\'user@four.com\'\n+    \'user@four.com\'\n \n-    >>> getAdapter(apage, IStringSubstitution, \'manager_emails\')()\n-    u\'user@one.com, currentuser@foobar.com\'\n+    >>> sorted(getAdapter(apage, IStringSubstitution, \'manager_emails\')().split(\', \'))\n+    [\'currentuser@foobar.com\', \'user@one.com\']\n \n     >>> sorted(getAdapter(apage, IStringSubstitution, \'member_emails\')(\n     ...     ).split(\', \'))\n-    [u\'user@five.com\', u\'user@four.com\', u\'user@one.com\']\n+    [\'user@five.com\', \'user@four.com\', \'user@one.com\']\n \n IContentish -- info on current user\n -----------------------------------\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_email\')()\n-    u\'currentuser@foobar.com\'\n+    \'currentuser@foobar.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_fullname\')()\n-    u\'Current User\'\n+    \'Current User\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_id\')() == TEST_USER_ID\n     True\n@@ -369,17 +373,17 @@ Inspect a version change (the most recent change)\n Initial revision\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'change comment\'\n+    \'change comment\'\n \n Change title\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_title\')()\n-    u\'Edit\'\n+    \'Edit\'\n \n Change type\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_type\')()\n-    u\'versioning\'\n+    \'versioning\'\n \n Change author\n \n@@ -395,7 +399,7 @@ last change comment is unchanged.\n     >>> wf_tool.doActionFor(apage, \'publish\', comment=\'publish it!\')\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'change comment\'\n+    \'change comment\'\n \n Let\'s create a new object in order to bypass the caching; we\'ll\n use it to test a workflow change\n@@ -410,22 +414,22 @@ use it to test a workflow change\n Review state\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state\')()\n-    u\'published\'\n+    \'published\'\n \n Comment\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'publish it!\'\n+    \'publish it!\'\n \n Change title\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_title\')()\n-    u\'Publish\'\n+    \'Publish\'\n \n Change type\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_type\')()\n-    u\'workflow\'\n+    \'workflow\'\n \n Change author\n \n@@ -438,9 +442,9 @@ Portal infos\n Portal title\n \n     >>> getAdapter(apage, IStringSubstitution, \'portal_title\')()\n-    u\'Plone site\'\n+    \'Plone site\'\n \n Portal URL\n \n     >>> getAdapter(apage, IStringSubstitution, \'portal_url\')()\n-    u\'http://nohost/plone\'\n+    \'http://nohost/plone\'\ndiff --git a/plone/stringinterp/tests/substitutionTests.txt b/plone/stringinterp/tests/substitutionTests.txt\nindex f4d6eda..f328f0d 100644\n--- a/plone/stringinterp/tests/substitutionTests.txt\n+++ b/plone/stringinterp/tests/substitutionTests.txt\n@@ -86,7 +86,7 @@ Listing Available String Substitutions\n     <Products.Five...SubstitutionInfo object at ...>\n \n     >>> subinfo.substitutionList()[0][\'category\']\n-    u\'All Content\'\n+    \'All Content\'\n \n \n Basic Content\n@@ -100,28 +100,28 @@ Ask for an adapter to get the URL::\n     <plone.stringinterp.adapters.UrlSubstitution object at ...>\n \n     >>> adapter()\n-    u\'http://nohost/plone/front-page\'\n+    \'http://nohost/plone/front-page\'\n \n \'id\' is an alias for id::\n \n     >>> getAdapter(apage, IStringSubstitution, \'id\')()\n-    u\'front-page\'\n+    \'front-page\'\n \n \n \'parent_id\' is an alias for id::\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_id\')()\n-    u\'plone\'\n+    \'plone\'\n \n \'url\' is an alias for absolute_url::\n \n     >>> getAdapter(apage, IStringSubstitution, \'url\')()\n-    u\'http://nohost/plone/front-page\'\n+    \'http://nohost/plone/front-page\'\n \n \'parent_url\' is container url::\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_url\')()\n-    u\'http://nohost/plone\'\n+    \'http://nohost/plone\'\n \n \n Minimal Dublin Core\n@@ -130,12 +130,12 @@ Minimal Dublin Core\n Title\n \n     >>> getAdapter(apage, IStringSubstitution, \'title\')()\n-    u\'Welcome to Plone\'\n+    \'Welcome to Plone\'\n \n Parent title\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_title\')()\n-    u\'Plone site\'\n+    \'Plone site\'\n \n \n The rest of Minimal Dublin::\n@@ -143,21 +143,23 @@ The rest of Minimal Dublin::\n Description\n \n     >>> getAdapter(apage, IStringSubstitution, \'description\')()\n-    u\'Congratulations! You have successfully installed Plone.\'\n+    \'Congratulations! You have successfully installed Plone.\'\n \n Content type\n \n     >>> getAdapter(apage, IStringSubstitution, \'type\')()\n-    u\'Page\'\n+    \'Page\'\n \n \n Let\'s try some non-ASCII::\n \n-   >>> apage.setTitle(\'Plone in Espa\xc3\xb1ol\'.decode(\'utf8\'))\n-   >>> getAdapter(apage, IStringSubstitution, \'title\')().encode(\'utf8\')\n-   \'Plone in Espa\\xc3\\xb1ol\'\n-\n-\n+   >>> import six\n+   >>> if six.PY2:\n+   ...     apage.setTitle(\'Plone in Espa\xc3\xb1ol\'.decode(\'utf8\'))\n+   ... else:\n+   ...     apage.setTitle(\'Plone in Espa\xc3\xb1ol\')\n+   >>> getAdapter(apage, IStringSubstitution, \'title\')()\n+   \'Plone in Espa\\xf1ol\'\n \n Workflow Aware\n --------------\n@@ -165,10 +167,10 @@ Workflow Aware\n Review State\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state\')()\n-    u\'published\'\n+    \'published\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state_title\')()\n-    u\'Published\'\n+    \'Published\'\n \n \n IDublinCore\n@@ -177,41 +179,41 @@ IDublinCore\n Creators\n \n     >>> getAdapter(apage, IStringSubstitution, \'creators\')()\n-    u\'admin\'\n+    \'admin\'\n \n Contributors\n \n     >>> getAdapter(apage, IStringSubstitution, \'contributors\')()\n-    u\'contributor one, contributor two\'\n+    \'contributor one, contributor two\'\n \n Subject\n     >>> getAdapter(apage, IStringSubstitution, \'subject\')()\n-    u\'keyword one, keyword two\'\n+    \'keyword one, keyword two\'\n \n Keywords (alias for subject)\n \n     >>> getAdapter(apage, IStringSubstitution, \'keywords\')()\n-    u\'keyword one, keyword two\'\n+    \'keyword one, keyword two\'\n \n Format\n \n     >>> getAdapter(apage, IStringSubstitution, \'format\')()\n-    u\'text/plain\'\n+    \'text/plain\'\n \n Language\n \n     >>> getAdapter(apage, IStringSubstitution, \'language\')()\n-    u\'en\'\n+    \'en\'\n \n Rights\n \n     >>> getAdapter(apage, IStringSubstitution, \'rights\')()\n-    u\'copyright me\'\n+    \'copyright me\'\n \n Identifier\n \n     >>> getAdapter(apage, IStringSubstitution, \'identifier\')()\n-     u\'http://nohost/plone/front-page\'\n+     \'http://nohost/plone/front-page\'\n \n \n \n@@ -251,27 +253,30 @@ IContentish -- emails for members having a role on context\n ----------------------------------------------------------\n \n     >>> getAdapter(apage, IStringSubstitution, \'owner_emails\')()\n-    u\'user@three.com\'\n+    \'user@three.com\'\n \n-    >>> getAdapter(apage, IStringSubstitution, \'reviewer_emails\')()\n-    u\'user@two.com, user@four.com\'\n+    >>> result = getAdapter(apage, IStringSubstitution, \'reviewer_emails\')()\n+    >>> u\'user@four.com\' in result\n+    True\n+    >>> u\'user@two.com\' in result\n+    True\n \n     >>> getAdapter(apage, IStringSubstitution, \'contributor_emails\')()\n-    u\'user@five.com\'\n+    \'user@five.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'editor_emails\')()\n-    u\'user@four.com\'\n+    \'user@four.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'reader_emails\')()\n-    u\'\'\n+    \'\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'manager_emails\')()\n-    u\'user@one.com\'\n+    \'user@one.com\'\n \n     >>> sorted(getAdapter(apage, IStringSubstitution, \'member_emails\')(\n     ...     ).split(\', \'))\n-    [u\'currentuser@foobar.com\', u\'user@five.com\', u\'user@four.com\', u\'user@one.com\',\n-     u\'user@three.com\', u\'user@two.com\']\n+    [\'currentuser@foobar.com\', \'user@five.com\', \'user@four.com\', \'user@one.com\',\n+     \'user@three.com\', \'user@two.com\']\n \n When a user is removed from the user folder, the ownership\n information, local roles, and group memberships for that user can\n@@ -285,26 +290,26 @@ adapters can handle this case.\n     >>> login(portal, TEST_USER_NAME)\n \n     >>> getAdapter(apage, IStringSubstitution, \'owner_emails\')()\n-    u\'\'\n+    \'\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'reviewer_emails\')()\n-    u\'user@four.com\'\n+    \'user@four.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'manager_emails\')()\n-    u\'user@one.com\'\n+    \'user@one.com\'\n \n     >>> sorted(getAdapter(apage, IStringSubstitution, \'member_emails\')(\n     ...     ).split(\', \'))\n-    [u\'currentuser@foobar.com\', u\'user@five.com\', u\'user@four.com\', u\'user@one.com\']\n+    [\'currentuser@foobar.com\', \'user@five.com\', \'user@four.com\', \'user@one.com\']\n \n IContentish -- info on current user\n -----------------------------------\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_email\')()\n-    u\'currentuser@foobar.com\'\n+    \'currentuser@foobar.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_fullname\')()\n-    u\'Current User\'\n+    \'Current User\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_id\')() == TEST_USER_ID\n     True\n@@ -323,17 +328,17 @@ Inspect a version change (the most recent change)\n Initial revision\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'change comment\'\n+    \'change comment\'\n \n Change title\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_title\')()\n-    u\'Edit\'\n+    \'Edit\'\n \n Change type\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_type\')()\n-    u\'versioning\'\n+    \'versioning\'\n \n Change author\n \n@@ -349,7 +354,7 @@ last change comment is unchanged.\n     >>> wf_tool.doActionFor(apage, \'retract\', comment=\'retract it!\')\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'change comment\'\n+    \'change comment\'\n \n Let\'s create a new object in order to bypass the caching; we\'ll\n use it to test a workflow change\n@@ -364,22 +369,22 @@ use it to test a workflow change\n Review state\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state\')()\n-    u\'published\'\n+    \'published\'\n \n Comment\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'publish it!\'\n+    \'publish it!\'\n \n Change title\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_title\')()\n-    u\'Publish\'\n+    \'Publish\'\n \n Change type\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_type\')()\n-    u\'workflow\'\n+    \'workflow\'\n \n Change author\n \n@@ -392,9 +397,9 @@ Portal infos\n Portal title\n \n     >>> getAdapter(apage, IStringSubstitution, \'portal_title\')()\n-    u\'Plone site\'\n+    \'Plone site\'\n \n Portal URL\n \n     >>> getAdapter(apage, IStringSubstitution, \'portal_url\')()\n-    u\'http://nohost/plone\'\n+    \'http://nohost/plone\'\ndiff --git a/plone/stringinterp/tests/testDocTests.py b/plone/stringinterp/tests/testDocTests.py\nindex 3e35c1d..98e185f 100644\n--- a/plone/stringinterp/tests/testDocTests.py\n+++ b/plone/stringinterp/tests/testDocTests.py\n@@ -4,6 +4,8 @@\n     PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING\n )\n import doctest\n+import re\n+import six\n import unittest\n \n \n@@ -15,11 +17,22 @@\n )\n \n \n+class Py23DocChecker(doctest.OutputChecker):\n+    def check_output(self, want, got, optionflags):\n+        if six.PY2:\n+            got = re.sub("u\'(.*?)\'", "\'\\\\1\'", got)\n+        return doctest.OutputChecker.check_output(self, want, got, optionflags)\n+\n+\n def test_suite():\n     return unittest.TestSuite([\n-        layered(doctest.DocFileSuite(\n-            f, package=\'plone.stringinterp.tests\',\n-            optionflags=doctest.NORMALIZE_WHITESPACE | doctest.ELLIPSIS),\n-                layer=PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING)\n-                for f in testfiles\n+        layered(\n+            doctest.DocFileSuite(\n+                f,\n+                package=\'plone.stringinterp.tests\',\n+                optionflags=doctest.NORMALIZE_WHITESPACE | doctest.ELLIPSIS,\n+                checker=Py23DocChecker(),\n+            ),\n+            layer=PLONE_APP_CONTENTTYPES_INTEGRATION_TESTING,\n+            ) for f in testfiles\n         ])\ndiff --git a/plone/stringinterp/tests/wrapperTests.txt b/plone/stringinterp/tests/wrapperTests.txt\nindex 7edf6c9..470c25c 100644\n--- a/plone/stringinterp/tests/wrapperTests.txt\n+++ b/plone/stringinterp/tests/wrapperTests.txt\n@@ -84,7 +84,7 @@ Get custom messages from Wrapper\n \n     >>> sm.registerAdapter(CustomMessageSubstitution, (Interface, ), IStringSubstitution, name=u"custom_message")\n     >>> getAdapter(apage, IStringSubstitution, \'custom_message\')()\n-    u\'A cool message here\'\n+    \'A cool message here\'\n \n     >>> class CustomItemsSubstitution(BaseSubstitution):\n     ...     def safe_call(self):\n@@ -135,7 +135,7 @@ Listing Available String Substitutions\n     <Products.Five...SubstitutionInfo object at ...>\n \n     >>> subinfo.substitutionList()[0][\'category\']\n-    u\'All Content\'\n+    \'All Content\'\n \n \n Basic Content\n@@ -149,28 +149,28 @@ Ask for an adapter to get the URL::\n     <plone.stringinterp.adapters.UrlSubstitution object at ...>\n \n     >>> adapter()\n-    u\'http://nohost/plone/front-page\'\n+    \'http://nohost/plone/front-page\'\n \n \'id\' is an alias for id::\n \n     >>> getAdapter(apage, IStringSubstitution, \'id\')()\n-    u\'front-page\'\n+    \'front-page\'\n \n \n \'parent_id\' is an alias for id::\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_id\')()\n-    u\'plone\'\n+    \'plone\'\n \n \'url\' is an alias for absolute_url::\n \n     >>> getAdapter(apage, IStringSubstitution, \'url\')()\n-    u\'http://nohost/plone/front-page\'\n+    \'http://nohost/plone/front-page\'\n \n \'parent_url\' is container url::\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_url\')()\n-    u\'http://nohost/plone\'\n+    \'http://nohost/plone\'\n \n \n Minimal Dublin Core\n@@ -179,12 +179,12 @@ Minimal Dublin Core\n Title\n \n     >>> getAdapter(apage, IStringSubstitution, \'title\')()\n-    u\'Welcome to Plone\'\n+    \'Welcome to Plone\'\n \n Parent title\n \n     >>> getAdapter(apage, IStringSubstitution, \'parent_title\')()\n-    u\'Plone site\'\n+    \'Plone site\'\n \n \n The rest of Minimal Dublin::\n@@ -192,19 +192,23 @@ The rest of Minimal Dublin::\n Description\n \n     >>> getAdapter(apage, IStringSubstitution, \'description\')()\n-    u\'Congratulations! You have successfully installed Plone.\'\n+    \'Congratulations! You have successfully installed Plone.\'\n \n Content type\n \n     >>> getAdapter(apage, IStringSubstitution, \'type\')()\n-    u\'Page\'\n+    \'Page\'\n \n \n Let\'s try some non-ASCII::\n \n-   >>> apage.setTitle(\'Plone in Espa\xc3\xb1ol\'.decode(\'utf8\'))\n-   >>> getAdapter(apage, IStringSubstitution, \'title\')().encode(\'utf8\')\n-   \'Plone in Espa\\xc3\\xb1ol\'\n+   >>> import six\n+   >>> if six.PY2:\n+   ...     apage.setTitle(\'Plone in Espa\xc3\xb1ol\'.decode(\'utf8\'))\n+   ... else:\n+   ...     apage.setTitle(\'Plone in Espa\xc3\xb1ol\')\n+   >>> getAdapter(apage, IStringSubstitution, \'title\')()\n+   \'Plone in Espa\\xf1ol\'\n \n \n \n@@ -214,10 +218,10 @@ Workflow Aware\n Review State\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state\')()\n-    u\'published\'\n+    \'published\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state_title\')()\n-    u\'Published\'\n+    \'Published\'\n \n \n IDublinCore\n@@ -226,41 +230,41 @@ IDublinCore\n Creators\n \n     >>> getAdapter(apage, IStringSubstitution, \'creators\')()\n-    u\'admin\'\n+    \'admin\'\n \n Contributors\n \n     >>> getAdapter(apage, IStringSubstitution, \'contributors\')()\n-    u\'contributor one, contributor two\'\n+    \'contributor one, contributor two\'\n \n Subject\n     >>> getAdapter(apage, IStringSubstitution, \'subject\')()\n-    u\'keyword one, keyword two\'\n+    \'keyword one, keyword two\'\n \n Keywords (alias for subject)\n \n     >>> getAdapter(apage, IStringSubstitution, \'keywords\')()\n-    u\'keyword one, keyword two\'\n+    \'keyword one, keyword two\'\n \n Format\n \n     >>> getAdapter(apage, IStringSubstitution, \'format\')()\n-    u\'text/plain\'\n+    \'text/plain\'\n \n Language\n \n     >>> getAdapter(apage, IStringSubstitution, \'language\')()\n-    u\'en\'\n+    \'en\'\n \n Rights\n \n     >>> getAdapter(apage, IStringSubstitution, \'rights\')()\n-    u\'copyright me\'\n+    \'copyright me\'\n \n Identifier\n \n     >>> getAdapter(apage, IStringSubstitution, \'identifier\')()\n-     u\'http://nohost/plone/front-page\'\n+     \'http://nohost/plone/front-page\'\n \n \n \n@@ -300,27 +304,27 @@ IContentish -- emails for members having a role on context\n ----------------------------------------------------------\n \n     >>> getAdapter(apage, IStringSubstitution, \'owner_emails\')()\n-    u\'user@three.com\'\n+    \'user@three.com\'\n \n-    >>> getAdapter(apage, IStringSubstitution, \'reviewer_emails\')()\n-    u\'user@two.com, user@four.com\'\n+    >>> sorted(getAdapter(apage, IStringSubstitution, \'reviewer_emails\')().split(\', \'))\n+    [\'user@four.com\', \'user@two.com\']\n \n     >>> getAdapter(apage, IStringSubstitution, \'contributor_emails\')()\n-    u\'user@five.com\'\n+    \'user@five.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'editor_emails\')()\n-    u\'user@four.com\'\n+    \'user@four.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'reader_emails\')()\n-    u\'\'\n+    \'\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'manager_emails\')()\n-    u\'user@one.com\'\n+    \'user@one.com\'\n \n     >>> sorted(getAdapter(apage, IStringSubstitution, \'member_emails\')(\n     ...     ).split(\', \'))\n-    [u\'currentuser@foobar.com\', u\'user@five.com\', u\'user@four.com\', u\'user@one.com\',\n-     u\'user@three.com\', u\'user@two.com\']\n+    [\'currentuser@foobar.com\', \'user@five.com\', \'user@four.com\', \'user@one.com\',\n+     \'user@three.com\', \'user@two.com\']\n \n When a user is removed from the user folder, the ownership\n information, local roles, and group memberships for that user can\n@@ -334,26 +338,26 @@ adapters can handle this case.\n     >>> login(portal, TEST_USER_NAME)\n \n     >>> getAdapter(apage, IStringSubstitution, \'owner_emails\')()\n-    u\'\'\n+    \'\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'reviewer_emails\')()\n-    u\'user@four.com\'\n+    \'user@four.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'manager_emails\')()\n-    u\'user@one.com\'\n+    \'user@one.com\'\n \n     >>> sorted(getAdapter(apage, IStringSubstitution, \'member_emails\')(\n     ...     ).split(\', \'))\n-    [u\'currentuser@foobar.com\', u\'user@five.com\', u\'user@four.com\', u\'user@one.com\']\n+    [\'currentuser@foobar.com\', \'user@five.com\', \'user@four.com\', \'user@one.com\']\n \n IContentish -- info on current user\n -----------------------------------\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_email\')()\n-    u\'currentuser@foobar.com\'\n+    \'currentuser@foobar.com\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_fullname\')()\n-    u\'Current User\'\n+    \'Current User\'\n \n     >>> getAdapter(apage, IStringSubstitution, \'user_id\')() == TEST_USER_ID\n     True\n@@ -372,17 +376,17 @@ Inspect a version change (the most recent change)\n Initial revision\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'change comment\'\n+    \'change comment\'\n \n Change title\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_title\')()\n-    u\'Edit\'\n+    \'Edit\'\n \n Change type\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_type\')()\n-    u\'versioning\'\n+    \'versioning\'\n \n Change author\n \n@@ -398,7 +402,7 @@ last change comment is unchanged.\n     >>> wf_tool.doActionFor(apage.context, \'retract\', comment=\'retract it!\')\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'change comment\'\n+    \'change comment\'\n \n Let\'s create a new object in order to bypass the caching; we\'ll\n use it to test a workflow change\n@@ -418,22 +422,22 @@ use it to test a workflow change\n Review state\n \n     >>> getAdapter(apage, IStringSubstitution, \'review_state\')()\n-    u\'published\'\n+    \'published\'\n \n Comment\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_comment\')()\n-    u\'publish it!\'\n+    \'publish it!\'\n \n Change title\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_title\')()\n-    u\'Publish\'\n+    \'Publish\'\n \n Change type\n \n     >>> getAdapter(apage, IStringSubstitution, \'change_type\')()\n-    u\'workflow\'\n+    \'workflow\'\n \n Change author\n \n@@ -446,9 +450,9 @@ Portal infos\n Portal title\n \n     >>> getAdapter(apage, IStringSubstitution, \'portal_title\')()\n-    u\'Plone site\'\n+    \'Plone site\'\n \n Portal URL\n \n     >>> getAdapter(apage, IStringSubstitution, \'portal_url\')()\n-    u\'http://nohost/plone\'\n+    \'http://nohost/plone\'\ndiff --git a/setup.py b/setup.py\nindex 1927e0a..213476d 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -13,11 +13,14 @@\n         "Framework :: Plone",\n         "Framework :: Plone :: 5.0",\n         "Framework :: Plone :: 5.1",\n+        "Framework :: Plone :: 5.2",\n         "Framework :: Zope2",\n         "License :: OSI Approved :: GNU General Public License v2 (GPLv2)",\n         "Operating System :: OS Independent",\n         "Programming Language :: Python",\n         "Programming Language :: Python :: 2.7",\n+        "Programming Language :: Python :: 3.6",\n+        "Programming Language :: Python :: 3.7",\n     ],\n     keywords=\'Plone Zope Interpolation\',\n     author=\'Plone Foundation\',\n'

