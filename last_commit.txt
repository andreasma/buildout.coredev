Repository: Products.CMFPlone


Branch: refs/heads/5.1.x
Date: 2019-08-16T17:37:01+02:00
Author: Katja Suess (ksuess) <k.suess@rohberg.ch>
Commit: https://github.com/plone/Products.CMFPlone/commit/353a13e44bad08f72da1855451eed8dbc62cf20e

Breadcrumbs: url of subfolder of hidden folder

folder hidden by IHideFromBreadcrumbs

Files changed:
A news/2935.bugfix
M Products/CMFPlone/browser/navigation.py
M Products/CMFPlone/tests/testNavigationView.py

b"diff --git a/Products/CMFPlone/browser/navigation.py b/Products/CMFPlone/browser/navigation.py\nindex 27bae5816..784d00216 100644\n--- a/Products/CMFPlone/browser/navigation.py\n+++ b/Products/CMFPlone/browser/navigation.py\n@@ -225,13 +225,10 @@ def breadcrumbs(self):\n         view = getMultiAdapter((container, request), name='breadcrumbs_view')\n         base = tuple(view.breadcrumbs())\n \n-        # Some things want to be hidden from the breadcrumbs\n+        # Remove hidden objects from breadcrumbs\n         if IHideFromBreadcrumbs.providedBy(context):\n             return base\n \n-        if base:\n-            item_url = '%s/%s' % (base[-1]['absolute_url'], name)\n-\n         rootPath = getNavigationRoot(context)\n         itemPath = '/'.join(context.getPhysicalPath())\n \ndiff --git a/Products/CMFPlone/tests/testNavigationView.py b/Products/CMFPlone/tests/testNavigationView.py\nindex 35ee18d86..bc284cc5b 100644\n--- a/Products/CMFPlone/tests/testNavigationView.py\n+++ b/Products/CMFPlone/tests/testNavigationView.py\n@@ -752,9 +752,23 @@ def testBreadcrumbsFilterByInterface(self):\n         directlyProvides(self.portal.folder1, IHideFromBreadcrumbs)\n         newcrumbs = view.breadcrumbs()\n         self.assertEqual(len(crumbs) - 1, len(newcrumbs))\n-        self.assertEqual(newcrumbs[0]['absolute_url'],\n+        self.assertEqual(newcrumbs[-1]['absolute_url'],\n                          self.portal.folder1.doc11.absolute_url())\n \n+    def testBreadcrumbsFilterByInterface2(self):\n+        # Test url of subfolder of hidden folder.\n+        self.portal.folder1.invokeFactory('Folder', 'subfolder11')\n+        directlyProvides(self.portal.folder1.subfolder11, IHideFromBreadcrumbs)\n+        self.portal.folder1.subfolder11.invokeFactory('Folder', 'subfolder111')\n+        self.portal.folder1.subfolder11.subfolder111.invokeFactory(\n+            'Document', 'doc1111')\n+        doc1111 = self.portal.folder1.subfolder11.subfolder111.doc1111\n+        view = self.view_class(doc1111, self.request)\n+        newcrumbs = view.breadcrumbs()\n+        self.assertEqual(\n+            newcrumbs[-2]['absolute_url'],\n+            self.portal.folder1.subfolder11.subfolder111.absolute_url()\n+            )\n \n def test_suite():\n     from unittest import TestSuite, makeSuite\ndiff --git a/news/2935.bugfix b/news/2935.bugfix\nnew file mode 100644\nindex 000000000..bce0788ad\n--- /dev/null\n+++ b/news/2935.bugfix\n@@ -0,0 +1 @@\n+Breadcrumbs: consider hidden folders (providing IHideFromBreadcrumbs) when creating urls. [ksuess]\n"

Repository: Products.CMFPlone


Branch: refs/heads/5.1.x
Date: 2019-08-27T15:23:45+02:00
Author: Peter Mathis (petschki) <petschki@users.noreply.github.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/8f830e84dbd2fea2297b88e3f1dc69967fb495fd

Merge pull request #2940 from plone/5.1.x-breadcrumbs-with-hidden-folder

Breadcrumbs of element in path with hidden folder [5.1]

Files changed:
A news/2935.bugfix
M Products/CMFPlone/browser/navigation.py
M Products/CMFPlone/tests/testNavigationView.py

b"diff --git a/Products/CMFPlone/browser/navigation.py b/Products/CMFPlone/browser/navigation.py\nindex 27bae5816..784d00216 100644\n--- a/Products/CMFPlone/browser/navigation.py\n+++ b/Products/CMFPlone/browser/navigation.py\n@@ -225,13 +225,10 @@ def breadcrumbs(self):\n         view = getMultiAdapter((container, request), name='breadcrumbs_view')\n         base = tuple(view.breadcrumbs())\n \n-        # Some things want to be hidden from the breadcrumbs\n+        # Remove hidden objects from breadcrumbs\n         if IHideFromBreadcrumbs.providedBy(context):\n             return base\n \n-        if base:\n-            item_url = '%s/%s' % (base[-1]['absolute_url'], name)\n-\n         rootPath = getNavigationRoot(context)\n         itemPath = '/'.join(context.getPhysicalPath())\n \ndiff --git a/Products/CMFPlone/tests/testNavigationView.py b/Products/CMFPlone/tests/testNavigationView.py\nindex 35ee18d86..bc284cc5b 100644\n--- a/Products/CMFPlone/tests/testNavigationView.py\n+++ b/Products/CMFPlone/tests/testNavigationView.py\n@@ -752,9 +752,23 @@ def testBreadcrumbsFilterByInterface(self):\n         directlyProvides(self.portal.folder1, IHideFromBreadcrumbs)\n         newcrumbs = view.breadcrumbs()\n         self.assertEqual(len(crumbs) - 1, len(newcrumbs))\n-        self.assertEqual(newcrumbs[0]['absolute_url'],\n+        self.assertEqual(newcrumbs[-1]['absolute_url'],\n                          self.portal.folder1.doc11.absolute_url())\n \n+    def testBreadcrumbsFilterByInterface2(self):\n+        # Test url of subfolder of hidden folder.\n+        self.portal.folder1.invokeFactory('Folder', 'subfolder11')\n+        directlyProvides(self.portal.folder1.subfolder11, IHideFromBreadcrumbs)\n+        self.portal.folder1.subfolder11.invokeFactory('Folder', 'subfolder111')\n+        self.portal.folder1.subfolder11.subfolder111.invokeFactory(\n+            'Document', 'doc1111')\n+        doc1111 = self.portal.folder1.subfolder11.subfolder111.doc1111\n+        view = self.view_class(doc1111, self.request)\n+        newcrumbs = view.breadcrumbs()\n+        self.assertEqual(\n+            newcrumbs[-2]['absolute_url'],\n+            self.portal.folder1.subfolder11.subfolder111.absolute_url()\n+            )\n \n def test_suite():\n     from unittest import TestSuite, makeSuite\ndiff --git a/news/2935.bugfix b/news/2935.bugfix\nnew file mode 100644\nindex 000000000..bce0788ad\n--- /dev/null\n+++ b/news/2935.bugfix\n@@ -0,0 +1 @@\n+Breadcrumbs: consider hidden folders (providing IHideFromBreadcrumbs) when creating urls. [ksuess]\n"

