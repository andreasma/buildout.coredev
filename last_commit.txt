Repository: plone.app.folder


Branch: refs/heads/master
Date: 2018-09-22T17:56:45+02:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.folder/commit/0a5bbdd324f0841d44f5f8c79d1321e5e56e5dc0

Fix missing ``dict.has_key`` in Python3

Files changed:
M CHANGES.rst
M src/plone/app/folder/migration.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 13e9d3c..80fa6e8 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,6 +14,9 @@ New features:\n \n Bug fixes:\n \n+- Fix missing ``dict.has_key`` in Python3\n+  [ale-rt]\n+\n - Fix GopipIndex for py3\n   [pbauer]\n \ndiff --git a/src/plone/app/folder/migration.py b/src/plone/app/folder/migration.py\nindex b80ccf0..43ec285 100644\n--- a/src/plone/app/folder/migration.py\n+++ b/src/plone/app/folder/migration.py\n@@ -1,15 +1,16 @@\n # -*- coding: utf-8 -*-\n from Acquisition import aq_base\n-from Products.BTreeFolder2.BTreeFolder2 import BTreeFolder2Base as BTreeFolder\n-from Products.Five.browser import BrowserView\n from logging import getLogger\n from plone.app.folder.utils import checkpointIterator\n from plone.app.folder.utils import findObjects\n from plone.app.folder.utils import timer\n+from Products.BTreeFolder2.BTreeFolder2 import BTreeFolder2Base as BTreeFolder\n+from Products.Five.browser import BrowserView\n from time import clock\n from time import strftime\n from transaction import get\n \n+\n logger = getLogger(__name__)\n \n \n@@ -36,7 +37,10 @@ def migrate(self, folder):\n         folder = aq_base(folder)\n         assert isinstance(folder, BTreeFolder)\n         assert folder.getId()       # make sure the object is properly loaded\n-        has = folder.__dict__.has_key\n+\n+        def has(key):\n+            return key in folder.__dict__\n+\n         if has('_tree') and not has('_objects'):\n             return False            # already migrated...\n         folder._initBTrees()        # create _tree, _count, _mt_index\n"

Repository: plone.app.folder


Branch: refs/heads/master
Date: 2018-09-22T19:30:56+02:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.folder/commit/038fca70389e1c6d6af19a2ae0a151580b5f5cf5

Merge pull request #18 from plone/python3

Fix missing ``dict.has_key`` in Python3

Files changed:
M CHANGES.rst
M src/plone/app/folder/migration.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 13e9d3c..80fa6e8 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -14,6 +14,9 @@ New features:\n \n Bug fixes:\n \n+- Fix missing ``dict.has_key`` in Python3\n+  [ale-rt]\n+\n - Fix GopipIndex for py3\n   [pbauer]\n \ndiff --git a/src/plone/app/folder/migration.py b/src/plone/app/folder/migration.py\nindex b80ccf0..43ec285 100644\n--- a/src/plone/app/folder/migration.py\n+++ b/src/plone/app/folder/migration.py\n@@ -1,15 +1,16 @@\n # -*- coding: utf-8 -*-\n from Acquisition import aq_base\n-from Products.BTreeFolder2.BTreeFolder2 import BTreeFolder2Base as BTreeFolder\n-from Products.Five.browser import BrowserView\n from logging import getLogger\n from plone.app.folder.utils import checkpointIterator\n from plone.app.folder.utils import findObjects\n from plone.app.folder.utils import timer\n+from Products.BTreeFolder2.BTreeFolder2 import BTreeFolder2Base as BTreeFolder\n+from Products.Five.browser import BrowserView\n from time import clock\n from time import strftime\n from transaction import get\n \n+\n logger = getLogger(__name__)\n \n \n@@ -36,7 +37,10 @@ def migrate(self, folder):\n         folder = aq_base(folder)\n         assert isinstance(folder, BTreeFolder)\n         assert folder.getId()       # make sure the object is properly loaded\n-        has = folder.__dict__.has_key\n+\n+        def has(key):\n+            return key in folder.__dict__\n+\n         if has('_tree') and not has('_objects'):\n             return False            # already migrated...\n         folder._initBTrees()        # create _tree, _count, _mt_index\n"

