Repository: plone.dexterity


Branch: refs/heads/master
Date: 2018-10-05T23:45:40-04:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.dexterity/commit/ccdec8bc9160b3813c9b2515a6d950a157c53c5f

encode unicode message as utf-8, not default encoding

Files changed:
M plone/dexterity/filerepresentation.py

b"diff --git a/plone/dexterity/filerepresentation.py b/plone/dexterity/filerepresentation.py\nindex 22e0c6f..9ebf6e5 100644\n--- a/plone/dexterity/filerepresentation.py\n+++ b/plone/dexterity/filerepresentation.py\n@@ -690,10 +690,10 @@ def _getStream(self):\n         message = self._getMessage()\n         if six.PY2:\n             # message.as_string will return str in both Python 2 and 3\n-            mode = 'w+b'\n+            kw = {'mode': 'w+b'}\n         else:\n-            mode = 'w+'\n-        out = tempfile.TemporaryFile(mode=mode)\n+            kw = {'mode': 'w+', 'encoding': 'utf-8'}\n+        out = tempfile.TemporaryFile(**kw)\n         out.write(message.as_string())\n         self._size = out.tell()\n         out.seek(0)\n"

Repository: plone.dexterity


Branch: refs/heads/master
Date: 2018-10-06T08:43:31-04:00
Author: David Glick (davisagli) <dglick@salesforce.com>
Commit: https://github.com/plone/plone.dexterity/commit/a7523ae306ae541724438f68b40fc7238ac31e1e

Merge pull request #91 from plone/fix-message-encoding

encode unicode message as utf-8, not default encoding

Files changed:
M plone/dexterity/filerepresentation.py

b"diff --git a/plone/dexterity/filerepresentation.py b/plone/dexterity/filerepresentation.py\nindex 22e0c6f..9ebf6e5 100644\n--- a/plone/dexterity/filerepresentation.py\n+++ b/plone/dexterity/filerepresentation.py\n@@ -690,10 +690,10 @@ def _getStream(self):\n         message = self._getMessage()\n         if six.PY2:\n             # message.as_string will return str in both Python 2 and 3\n-            mode = 'w+b'\n+            kw = {'mode': 'w+b'}\n         else:\n-            mode = 'w+'\n-        out = tempfile.TemporaryFile(mode=mode)\n+            kw = {'mode': 'w+', 'encoding': 'utf-8'}\n+        out = tempfile.TemporaryFile(**kw)\n         out.write(message.as_string())\n         self._size = out.tell()\n         out.seek(0)\n"

