Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2018-03-27T20:57:59-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/8604bbdaed683aa828bf5c500b141969a4700aec

Include new paths for TinyMCE css. plone/Products.CMFPlone#2359

Files changed:
A plone/app/upgrade/v51/profiles/to_512/registry.xml
M CHANGES.rst
M plone/app/upgrade/v51/configure.zcml
M plone/app/upgrade/v51/profiles.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index fe2e9d22..8b4667c9 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Change in TinyMCE css location so bundles can be built without errors
+  Fixes `issue 2359 <https://github.com/plone/Products.CMFPlone/issues/2359>`_.
+  [frapell]
 
 
 2.0.12 (2018-03-10)
diff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml
index b1743d84..6a177156 100644
--- a/plone/app/upgrade/v51/configure.zcml
+++ b/plone/app/upgrade/v51/configure.zcml
@@ -225,10 +225,10 @@ Add image scaling options to image handling control panel.
         destination="5112"
         profile="Products.CMFPlone:plone">
 
-        <gs:upgradeStep
-            title="Miscellaneous"
-            description=""
-            handler="..utils.null_upgrade_step"
+        <gs:upgradeDepends
+            title="Run to512 upgrade profile."
+            description="Update css resources for TinyMCE 4.7.6"
+            import_profile="plone.app.upgrade.v51:to512"
             />
 
     </gs:upgradeSteps>
diff --git a/plone/app/upgrade/v51/profiles.zcml b/plone/app/upgrade/v51/profiles.zcml
index 860171c1..e90ab39c 100644
--- a/plone/app/upgrade/v51/profiles.zcml
+++ b/plone/app/upgrade/v51/profiles.zcml
@@ -68,4 +68,13 @@
       provides="Products.GenericSetup.interfaces.EXTENSION"
       />
 
+  <genericsetup:registerProfile
+      name="to512"
+      title="Upgrade profile for Plone 5.1.1 to Plone 5.1.2"
+      description=""
+      directory="profiles/to_512"
+      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"
+      provides="Products.GenericSetup.interfaces.EXTENSION"
+      />
+
 </configure>
diff --git a/plone/app/upgrade/v51/profiles/to_512/registry.xml b/plone/app/upgrade/v51/profiles/to_512/registry.xml
new file mode 100644
index 00000000..7a19f79c
--- /dev/null
+++ b/plone/app/upgrade/v51/profiles/to_512/registry.xml
@@ -0,0 +1,15 @@
+<?xml version="1.0"?>
+<registry>
+
+  <records prefix="plone.resources/tinymce"
+            interface='Products.CMFPlone.interfaces.IResourceRegistry'>
+      <value key="js">++plone++static/components/tinymce-builded/js/tinymce/tinymce.js</value>
+      <value key="export">window.tinyMCE</value>
+      <value key="init">function () { this.tinyMCE.DOM.events.domLoaded = true; return this.tinyMCE; }</value>
+      <value key="css">
+        <element>++plone++static/components/tinymce-builded/js/tinymce/skins/lightgray/skin.min.css</element>
+        <element>++plone++static/components/tinymce-builded/js/tinymce/skins/lightgray/content.min.css</element>
+      </value>
+  </records>
+
+</registry>


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2018-03-28T00:29:47-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/c904fb53dc08d41fe006dc8a139427c02d57cd9a

Update last_compilation to deliver new bundles

Files changed:
M plone/app/upgrade/v51/profiles/to_512/registry.xml

diff --git a/plone/app/upgrade/v51/profiles/to_512/registry.xml b/plone/app/upgrade/v51/profiles/to_512/registry.xml
index 7a19f79c..b4f46c6d 100644
--- a/plone/app/upgrade/v51/profiles/to_512/registry.xml
+++ b/plone/app/upgrade/v51/profiles/to_512/registry.xml
@@ -12,4 +12,18 @@
       </value>
   </records>
 
+  <!-- Update ``last_compilation`` to deliver new bundles -->
+  <records
+      prefix="plone.bundles/plone"
+      interface="Products.CMFPlone.interfaces.IBundleRegistry"
+      purge="False">
+    <value key="last_compilation">2018-03-28 00:00:00</value>
+  </records>
+  <records
+      prefix="plone.bundles/plone-logged-in"
+      interface="Products.CMFPlone.interfaces.IBundleRegistry"
+      purge="False">
+    <value key="last_compilation">2018-03-28 00:00:00</value>
+  </records>
+
 </registry>


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2018-03-29T13:00:42+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.upgrade/commit/d6a136165373a06cdaf107acc01253576bfc6f97

Merge pull request #154 from plone/gh-2359

Include new paths for TinyMCE css

Files changed:
A plone/app/upgrade/v51/profiles/to_512/registry.xml
M CHANGES.rst
M plone/app/upgrade/v51/configure.zcml
M plone/app/upgrade/v51/profiles.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index fe2e9d22..8b4667c9 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,7 +14,9 @@ New features:
 
 Bug fixes:
 
-- *add item here*
+- Change in TinyMCE css location so bundles can be built without errors
+  Fixes `issue 2359 <https://github.com/plone/Products.CMFPlone/issues/2359>`_.
+  [frapell]
 
 
 2.0.12 (2018-03-10)
diff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml
index b1743d84..6a177156 100644
--- a/plone/app/upgrade/v51/configure.zcml
+++ b/plone/app/upgrade/v51/configure.zcml
@@ -225,10 +225,10 @@ Add image scaling options to image handling control panel.
         destination="5112"
         profile="Products.CMFPlone:plone">
 
-        <gs:upgradeStep
-            title="Miscellaneous"
-            description=""
-            handler="..utils.null_upgrade_step"
+        <gs:upgradeDepends
+            title="Run to512 upgrade profile."
+            description="Update css resources for TinyMCE 4.7.6"
+            import_profile="plone.app.upgrade.v51:to512"
             />
 
     </gs:upgradeSteps>
diff --git a/plone/app/upgrade/v51/profiles.zcml b/plone/app/upgrade/v51/profiles.zcml
index 860171c1..e90ab39c 100644
--- a/plone/app/upgrade/v51/profiles.zcml
+++ b/plone/app/upgrade/v51/profiles.zcml
@@ -68,4 +68,13 @@
       provides="Products.GenericSetup.interfaces.EXTENSION"
       />
 
+  <genericsetup:registerProfile
+      name="to512"
+      title="Upgrade profile for Plone 5.1.1 to Plone 5.1.2"
+      description=""
+      directory="profiles/to_512"
+      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"
+      provides="Products.GenericSetup.interfaces.EXTENSION"
+      />
+
 </configure>
diff --git a/plone/app/upgrade/v51/profiles/to_512/registry.xml b/plone/app/upgrade/v51/profiles/to_512/registry.xml
new file mode 100644
index 00000000..b4f46c6d
--- /dev/null
+++ b/plone/app/upgrade/v51/profiles/to_512/registry.xml
@@ -0,0 +1,29 @@
+<?xml version="1.0"?>
+<registry>
+
+  <records prefix="plone.resources/tinymce"
+            interface='Products.CMFPlone.interfaces.IResourceRegistry'>
+      <value key="js">++plone++static/components/tinymce-builded/js/tinymce/tinymce.js</value>
+      <value key="export">window.tinyMCE</value>
+      <value key="init">function () { this.tinyMCE.DOM.events.domLoaded = true; return this.tinyMCE; }</value>
+      <value key="css">
+        <element>++plone++static/components/tinymce-builded/js/tinymce/skins/lightgray/skin.min.css</element>
+        <element>++plone++static/components/tinymce-builded/js/tinymce/skins/lightgray/content.min.css</element>
+      </value>
+  </records>
+
+  <!-- Update ``last_compilation`` to deliver new bundles -->
+  <records
+      prefix="plone.bundles/plone"
+      interface="Products.CMFPlone.interfaces.IBundleRegistry"
+      purge="False">
+    <value key="last_compilation">2018-03-28 00:00:00</value>
+  </records>
+  <records
+      prefix="plone.bundles/plone-logged-in"
+      interface="Products.CMFPlone.interfaces.IBundleRegistry"
+      purge="False">
+    <value key="last_compilation">2018-03-28 00:00:00</value>
+  </records>
+
+</registry>


